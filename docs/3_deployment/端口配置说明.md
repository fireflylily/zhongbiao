# ç«¯å£é…ç½®è¯´æ˜

> **é‡è¦**: æ‰€æœ‰éƒ¨ç½²æ–¹å¼å¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„ç«¯å£é…ç½®

## ğŸ“Œ æ ‡å‡†ç«¯å£é…ç½®

**ç»Ÿä¸€æ ‡å‡†ç«¯å£ï¼š8110**

æ‰€æœ‰é…ç½®æ–‡ä»¶å·²ç»Ÿä¸€ä½¿ç”¨ **8110** ç«¯å£ï¼š
- âœ… Flaskåº”ç”¨ï¼š8110
- âœ… Nginxä»£ç†ï¼š8110
- âœ… Dockerå®¹å™¨ï¼š8110

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### 1. ä»£ç é»˜è®¤é…ç½®

**æ–‡ä»¶**: `ai_tender_system/common/config.py:254`

```python
'port': int(os.getenv('WEB_PORT', '8110'))  # âœ… é»˜è®¤8110
```

å¦‚æœ `.env` æ–‡ä»¶æœªé…ç½® `WEB_PORT`ï¼Œå°†ä½¿ç”¨æ­¤é»˜è®¤å€¼ã€‚

### 2. ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ¨èï¼‰

**æ–‡ä»¶**: `ai_tender_system/.env`

```bash
# WebæœåŠ¡å™¨é…ç½®
WEB_HOST=0.0.0.0
WEB_PORT=8110  # âœ… æ˜ç¡®æŒ‡å®šç«¯å£

# è°ƒè¯•æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒè®¾ä¸ºFalseï¼‰
DEBUG=False

# å¯†é’¥é…ç½®
SECRET_KEY=your-secret-key-here
```

### 3. Nginxé…ç½®

**æ–‡ä»¶**: `nginx/ai-tender-system.conf:47`

```nginx
location /api {
    proxy_pass http://localhost:8110;  # âœ… ä»£ç†åˆ°8110
    # ...
}
```

### 4. Dockeré…ç½®

**æ–‡ä»¶**: `docker-compose.yml:11`

```yaml
ports:
  - "8110:8110"  # âœ… ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
```

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜1: ç«¯å£ä¸ä¸€è‡´å¯¼è‡´502é”™è¯¯

**ç°è±¡**: æµè§ˆå™¨è®¿é—®æ˜¾ç¤º 502 Bad Gateway

**åŸå› **: Flaskåº”ç”¨è¿è¡Œåœ¨8082ï¼Œä½†Nginxä»£ç†é…ç½®çš„æ˜¯8110

**è§£å†³**:
```bash
# æ£€æŸ¥é…ç½®ä¸€è‡´æ€§
cd /var/www/ai-tender-system
./scripts/check-config.sh

# åœæ­¢8082ç«¯å£çš„è¿›ç¨‹
sudo lsof -ti:8082 | xargs sudo kill

# ç¡®ä¿.envé…ç½®æ­£ç¡®
echo "WEB_PORT=8110" >> ai_tender_system/.env

# é‡æ–°å¯åŠ¨åº”ç”¨
source venv/bin/activate
python -m ai_tender_system.web.app
```

### é—®é¢˜2: æ—§è¿›ç¨‹å ç”¨ç«¯å£

**ç°è±¡**: å¯åŠ¨æç¤º "Address already in use"

**è§£å†³**:
```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo lsof -i:8110

# æ€æ‰æ—§è¿›ç¨‹
sudo lsof -ti:8110 | xargs sudo kill -9
```

### é—®é¢˜3: å‰ç«¯é™æ€èµ„æº404

**ç°è±¡**: CSS/JSæ–‡ä»¶åŠ è½½å¤±è´¥

**åŸå› **: ç›´æ¥è®¿é—® `http://8.140.21.235:8082`ï¼Œä½†é™æ€èµ„æºè·¯å¾„æ˜¯ç»å¯¹è·¯å¾„

**è§£å†³**: ä½¿ç”¨Nginxç»Ÿä¸€å…¥å£
```bash
# è®¿é—®
http://8.140.21.235  (é€šè¿‡Nginxï¼Œæ— éœ€ç«¯å£å·)

# è€Œä¸æ˜¯
http://8.140.21.235:8082  (ç›´æ¥è®¿é—®Flask)
```

## âœ… é…ç½®éªŒè¯æ¸…å•

åœ¨éƒ¨ç½²å‰/åè¿è¡Œé…ç½®æ£€æŸ¥è„šæœ¬ï¼š

```bash
cd /var/www/ai-tender-system
./scripts/check-config.sh
```

**é¢„æœŸè¾“å‡º**:
```
=========================================
  é…ç½®ä¸€è‡´æ€§æ£€æŸ¥
=========================================

1ï¸âƒ£  æ£€æŸ¥ä»£ç é»˜è®¤ç«¯å£é…ç½®...
âœ… ä»£ç é»˜è®¤ç«¯å£ï¼š8110 (æ­£ç¡®)

2ï¸âƒ£  æ£€æŸ¥Dockeré…ç½®...
âœ… Dockeræ˜ å°„ç«¯å£ï¼š8110 (æ­£ç¡®)

3ï¸âƒ£  æ£€æŸ¥Nginxé…ç½®...
âœ… Nginxä»£ç†ç«¯å£ï¼š8110 (æ­£ç¡®)

4ï¸âƒ£  æ£€æŸ¥.envæ–‡ä»¶é…ç½®...
âœ… .envç«¯å£é…ç½®ï¼š8110 (æ­£ç¡®)

5ï¸âƒ£  æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ...
âœ… ç«¯å£8110å·²è¢«ä½¿ç”¨ (æ­£ç¡®)

=========================================
  æ£€æŸ¥ç»“æœæ±‡æ€»
=========================================
ğŸ‰ æ‰€æœ‰é…ç½®æ£€æŸ¥é€šè¿‡ï¼
```

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤ï¼ˆå«é…ç½®éªŒè¯ï¼‰

### ä¼ ç»Ÿéƒ¨ç½²

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/ai-tender-system

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# 3. æ£€æŸ¥é…ç½®ä¸€è‡´æ€§
./scripts/check-config.sh

# 4. å¦‚æœæœ‰é”™è¯¯ï¼Œä¿®å¤åé‡æ–°æ£€æŸ¥

# 5. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# 6. åœæ­¢æ—§è¿›ç¨‹ï¼ˆå¦‚æœ‰ï¼‰
sudo lsof -ti:8082 | xargs sudo kill -9 2>/dev/null || true
sudo lsof -ti:8110 | xargs sudo kill -9 2>/dev/null || true

# 7. å¯åŠ¨åº”ç”¨
nohup python -m ai_tender_system.web.app > logs/app.log 2>&1 &

# 8. éªŒè¯
sleep 3
curl http://localhost:8110/api/health

# 9. éƒ¨ç½²Nginxé…ç½®ï¼ˆå¦‚æœªéƒ¨ç½²ï¼‰
sudo cp nginx/ai-tender-system.conf /etc/nginx/sites-available/
sudo ln -sf /etc/nginx/sites-available/ai-tender-system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# 10. æµè§ˆå™¨è®¿é—®
# http://8.140.21.235
```

### Dockeréƒ¨ç½²

```bash
# 1. é…ç½®æ£€æŸ¥
./scripts/check-config.sh

# 2. éƒ¨ç½²
./scripts/docker-deploy.sh

# 3. éªŒè¯
curl http://localhost:8110/api/health
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€ä½¿ç”¨ç¯å¢ƒå˜é‡

åœ¨ `ai_tender_system/.env` ä¸­æ˜ç¡®é…ç½®ï¼š
```bash
WEB_PORT=8110
```

è€Œä¸æ˜¯ä¾èµ–ä»£ç é»˜è®¤å€¼ã€‚

### 2. ä½¿ç”¨é…ç½®éªŒè¯è„šæœ¬

æ¯æ¬¡éƒ¨ç½²å‰è¿è¡Œï¼š
```bash
./scripts/check-config.sh
```

### 3. é€šè¿‡Nginxè®¿é—®

ç”Ÿäº§ç¯å¢ƒåº”è¯¥é€šè¿‡Nginxè®¿é—®ï¼š
- âœ… `http://8.140.21.235` (80ç«¯å£ï¼ŒNginx)
- âŒ `http://8.140.21.235:8110` (ç›´æ¥è®¿é—®Flask)

### 4. ç›‘æ§ç«¯å£ä½¿ç”¨

å®šæœŸæ£€æŸ¥ï¼š
```bash
# æŸ¥çœ‹8110ç«¯å£ä½¿ç”¨æƒ…å†µ
sudo lsof -i:8110

# æŸ¥çœ‹åº”ç”¨è¿›ç¨‹
ps aux | grep "ai_tender_system.web.app"
```

## ğŸ“Š ç«¯å£ä½¿ç”¨å†å²

| æ—¶é—´ | ç«¯å£ | åŸå›  | çŠ¶æ€ |
|------|------|------|------|
| åˆæœŸ | 8000 | å¼€å‘æµ‹è¯• | å·²åºŸå¼ƒ |
| ä¸­æœŸ | 8082 | ä»£ç é»˜è®¤å€¼ | âŒ å·²å¼ƒç”¨ |
| ç°åœ¨ | 8110 | ç»Ÿä¸€æ ‡å‡† | âœ… å½“å‰ä½¿ç”¨ |

---

**æœ€åæ›´æ–°**: 2025-11-20
**ç»´æŠ¤è€…**: lvhe
**ç‰ˆæœ¬**: 2.1.0
