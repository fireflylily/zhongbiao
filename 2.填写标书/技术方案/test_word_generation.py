#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
æµ‹è¯•Wordæ–‡æ¡£ç”ŸæˆåŠŸèƒ½
"""

import sys
import os
from pathlib import Path

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.insert(0, str(Path(__file__).parent))

from TenderGenerator.generators.word_generator import get_word_generator

def test_word_generation():
    """æµ‹è¯•Wordæ–‡æ¡£ç”ŸæˆåŠŸèƒ½"""
    
    print("=" * 60)
    print("æµ‹è¯•Wordæ–‡æ¡£ç”ŸæˆåŠŸèƒ½")
    print("=" * 60)
    
    # åˆ›å»ºæµ‹è¯•æ•°æ®
    test_proposal_data = {
        'title': 'ä¸­é‚®ä¿é™©æ‰‹æœºå·å®åè®¤è¯æœåŠ¡æŠ€æœ¯æ–¹æ¡ˆ',
        'project_name': 'ä¸­é‚®ä¿é™©æ‰‹æœºå·å®åè®¤è¯æœåŠ¡é¡¹ç›®',
        'company': 'æ™ºæ…§è¶³è¿¹æ•°æ®ç§‘æŠ€æœ‰é™å…¬å¸',
        'contact': 'contact@example.com',
        'version': 'V1.0',
        'sections': [
            {
                'title': '1. é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ',
                'content': '''æœ¬é¡¹ç›®æ—¨åœ¨ä¸ºä¸­é‚®ä¿é™©æä¾›æ‰‹æœºå·å®åè®¤è¯æœåŠ¡ï¼Œæ»¡è¶³ç›‘ç®¡åˆè§„è¦æ±‚ã€‚

é¡¹ç›®èƒŒæ™¯ï¼š
éšç€é‡‘èç§‘æŠ€çš„å¿«é€Ÿå‘å±•å’Œç›‘ç®¡æ”¿ç­–çš„æ—¥è¶‹ä¸¥æ ¼ï¼Œä¿é™©è¡Œä¸šå¯¹å®¢æˆ·èº«ä»½éªŒè¯çš„è¦æ±‚æ„ˆå‘ä¸¥è°¨ã€‚

éœ€æ±‚åˆ†æï¼š
1. ä¸šåŠ¡éœ€æ±‚ï¼šæ”¯æŒæ–°å®¢æˆ·æ³¨å†Œè®¤è¯ã€æ—¢æœ‰å®¢æˆ·ä¿¡æ¯æ›´æ–°éªŒè¯ç­‰åœºæ™¯
2. åŠŸèƒ½éœ€æ±‚ï¼šå¤šç»´åº¦éªŒè¯å¼•æ“ã€æ™ºèƒ½é£é™©è¯„ä¼°ç³»ç»Ÿ
3. éåŠŸèƒ½æ€§éœ€æ±‚ï¼šé«˜å¯ç”¨æ€§ã€é«˜æ€§èƒ½ã€æ•°æ®å®‰å…¨''',
                'subsections': [
                    {
                        'title': '1.1 é¡¹ç›®èƒŒæ™¯',
                        'content': 'è¯¦ç»†çš„é¡¹ç›®èƒŒæ™¯æè¿°...'
                    },
                    {
                        'title': '1.2 éœ€æ±‚åˆ†æ', 
                        'content': 'è¯¦ç»†çš„éœ€æ±‚åˆ†æå†…å®¹...'
                    }
                ]
            },
            {
                'title': '2. æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡',
                'content': '''æœ¬ç« èŠ‚æè¿°è¯¦ç»†çš„æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡ã€‚

ç³»ç»Ÿæ¶æ„é‡‡ç”¨å¾®æœåŠ¡è®¾è®¡ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š
â€¢ é«˜å¯æ‰©å±•æ€§
â€¢ é«˜å¯ç”¨æ€§
â€¢ å®‰å…¨å¯é 

æŠ€æœ¯é€‰å‹ï¼š
- å¼€å‘è¯­è¨€ï¼šJava 17
- æ¡†æ¶ï¼šSpring Boot + Spring Cloud
- æ•°æ®åº“ï¼šMySQL + Redis
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šApache Kafka''',
                'subsections': [
                    {
                        'title': '2.1 ç³»ç»Ÿæ¶æ„',
                        'content': 'ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡...'
                    },
                    {
                        'title': '2.2 æŠ€æœ¯é€‰å‹',
                        'content': 'æŠ€æœ¯é€‰å‹çš„è¯¦ç»†è¯´æ˜...'
                    }
                ]
            },
            {
                'title': '3. å®æ–½è®¡åˆ’',
                'content': '''é¡¹ç›®å®æ–½åˆ†ä¸º5ä¸ªé˜¶æ®µï¼š

**ç¬¬ä¸€é˜¶æ®µ**ï¼šéœ€æ±‚è°ƒç ”ä¸ç³»ç»Ÿè®¾è®¡ï¼ˆ4å‘¨ï¼‰
- æ·±å…¥è°ƒç ”ä¸šåŠ¡éœ€æ±‚
- å®Œæˆç³»ç»Ÿæ¶æ„è®¾è®¡
- åˆ¶å®šå¼€å‘è®¡åˆ’

**ç¬¬äºŒé˜¶æ®µ**ï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆ8å‘¨ï¼‰
- å®ç°è®¤è¯æ ¸å¿ƒå¼•æ“
- å¼€å‘APIæ¥å£
- é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡

**ç¬¬ä¸‰é˜¶æ®µ**ï¼šç³»ç»Ÿæµ‹è¯•ï¼ˆ4å‘¨ï¼‰
- åŠŸèƒ½æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- å®‰å…¨æµ‹è¯•

**ç¬¬å››é˜¶æ®µ**ï¼šè¯•è¿è¡Œï¼ˆ2å‘¨ï¼‰
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- è¯•è¿è¡ŒéªŒè¯

**ç¬¬äº”é˜¶æ®µ**ï¼šæ­£å¼ä¸Šçº¿ï¼ˆæŒç»­ï¼‰
- ç³»ç»Ÿæ­£å¼æŠ•äº§
- è¿ç»´æ”¯æŒ'''
            }
        ]
    }
    
    test_outline_data = {
        'title': 'æŠ€æœ¯æ–¹æ¡ˆå¤§çº²',
        'sections': [
            {'title': 'é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ', 'level': 1},
            {'title': 'æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡', 'level': 1}, 
            {'title': 'å®æ–½è®¡åˆ’', 'level': 1}
        ]
    }
    
    # è·å–Wordç”Ÿæˆå™¨
    word_generator = get_word_generator()
    
    # ç”ŸæˆWordæ–‡æ¡£
    output_file = "test_proposal.docx"
    
    print(f"å¼€å§‹ç”ŸæˆWordæ–‡æ¡£: {output_file}")
    success = word_generator.export_proposal_to_word(
        test_proposal_data,
        test_outline_data,
        output_file
    )
    
    if success:
        print(f"âœ… Wordæ–‡æ¡£ç”ŸæˆæˆåŠŸ: {output_file}")
        
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if os.path.exists(output_file):
            file_size = os.path.getsize(output_file)
            print(f"ğŸ“„ æ–‡ä»¶å¤§å°: {file_size} å­—èŠ‚")
        else:
            print("âŒ æ–‡ä»¶ä¸å­˜åœ¨")
            
    else:
        print("âŒ Wordæ–‡æ¡£ç”Ÿæˆå¤±è´¥")
    
    print("\n" + "=" * 60)
    print("æµ‹è¯•å®Œæˆ")
    print("=" * 60)

if __name__ == "__main__":
    test_word_generation()