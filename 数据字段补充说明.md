# 数据字段补充说明

## ✅ 已完成的字段变体添加

### 1. 单位性质 / 企业性质
- **标准字段名**: `companyType`
- **已添加变体**: `'单位性质'`, `'企业性质'`
- **数据库字段**: `companies.company_type`
- **状态**: ✅ 完全支持

### 2. 法定代表人（负责人）姓名
- **标准字段名**: `legalRepresentative`
- **已添加变体**: `'法定代表人姓名'`, `'法定代表人名称'`, `'负责人'`, `'负责人姓名'`
- **数据库字段**: `companies.legal_representative`
- **状态**: ✅ 完全支持

### 3. 经营期限 ⚠️
- **标准字段名**: `businessTerm`
- **已添加变体**: `'经营期限'`, `'营业期限'`, `'经营年限'`
- **数据库字段**: ❌ **不存在** - 需要补充
- **状态**: ⚠️ 字段识别支持，但无数据来源

---

## 📋 需要补充的数据

### `businessTerm` (经营期限) 数据来源方案

#### 方案1: 数据库新增字段 ✅ 推荐
在 `companies` 表中添加 `business_term` 字段：

```sql
ALTER TABLE companies ADD COLUMN business_term TEXT;
```

**数据格式建议**:
- 格式1: `"2020年01月01日至2040年12月31日"` （中文日期范围）
- 格式2: `"2020-01-01至2040-12-31"` （ISO日期范围）
- 格式3: `"长期"` （长期经营）

**数据来源**:
- 从营业执照OCR提取
- 或在公司信息管理界面手动填写

#### 方案2: 从营业执照OCR实时提取
在文档填充时，如果 `businessTerm` 数据为空：
1. 检查公司是否有营业执照图片
2. 调用OCR服务提取"营业期限"字段
3. 缓存提取结果到数据库

#### 方案3: 使用公司成立日期推算
如果无法获取准确的经营期限：
- 使用 `companies.establish_date` + 固定年限（如20年）
- 或使用 `"长期"` 占位

---

## 🔧 后端API需要的修改

### `/process-business-response` 接口

在 `api_business_bp.py` 的字段映射中添加 `businessTerm`:

```python
field_mapping = {
    # ... 现有字段 ...
    'businessTerm': 'business_term',  # 新增
}
```

### 数据库查询修改

修改公司信息查询，包含 `business_term` 字段：

```python
# 在 get_company_detail() 方法中
SELECT
    company_id,
    company_name,
    # ... 其他字段 ...
    business_term  # 新增
FROM companies
WHERE company_id = ?
```

---

## 📊 当前状态总结

| 字段 | 识别支持 | 数据库支持 | 完整度 |
|------|---------|-----------|-------|
| 单位性质 | ✅ | ✅ company_type | ✅ 100% |
| 法定代表人（负责人）姓名 | ✅ | ✅ legal_representative | ✅ 100% |
| 经营期限 | ✅ | ❌ **需要添加** | ⚠️ 50% |

---

## 🎯 下一步行动

1. **决定数据来源方案**
   - [ ] 选择方案1（推荐）：数据库新增字段
   - [ ] 或选择方案2：OCR实时提取
   - [ ] 或选择方案3：使用推算值

2. **数据库结构修改**（如果选择方案1）
   - [ ] 执行ALTER TABLE语句
   - [ ] 更新数据库迁移脚本
   - [ ] 更新公司信息管理界面，添加"经营期限"输入

3. **后端API修改**
   - [ ] 更新 `api_business_bp.py` 的字段映射
   - [ ] 更新 `get_company_detail()` 查询语句
   - [ ] 测试数据流通

4. **OCR提取逻辑**（如果需要）
   - [ ] 在营业执照OCR模块中提取"营业期限"
   - [ ] 将提取结果保存到数据库

---

## ✅ 测试验证

已通过测试（`test_new_field_variants.py`）：

```
✅ 所有字段识别测试通过！
✅ 所有文档填充测试通过！
```

测试覆盖：
- ✅ 字段变体识别正确
- ✅ 冒号模式填充正确
- ✅ 括号保留正确（如"法定代表人（负责人）"）
- ✅ 空值跳过正确

---

## 📝 相关文件

- `/Users/lvhe/Downloads/zhongbiao/zhongbiao/ai_tender_system/modules/business_response/smart_filler.py` (行450-466)
- `/Users/lvhe/Downloads/zhongbiao/zhongbiao/ai_tender_system/web/blueprints/api_business_bp.py` (行201-222)
- `/Users/lvhe/Downloads/zhongbiao/zhongbiao/test_new_field_variants.py` (测试文件)

---

**生成日期**: 2025-10-20
**修改记录**: 添加三个字段变体支持 - `单位性质`, `经营期限`, `法定代表人（负责人）姓名`
