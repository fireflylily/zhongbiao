<!-- é¦–é¡µä»ªè¡¨æ¿ - ä¼˜åŒ–ç‰ˆ -->

<!-- æ¬¢è¿åŒºåŸŸ -->
<div class="welcome-section mb-4">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h2 class="welcome-title mb-2">
                <span id="greeting">æ‚¨å¥½</span>ï¼Œ<span class="text-primary">{{ session.get('username', 'ç”¨æˆ·') }}</span> ğŸ‘‹
            </h2>
            <p class="text-muted mb-0">æ¬¢è¿ä½¿ç”¨å…ƒæ™¯AIæ™ºèƒ½æ ‡ä¹¦ç”Ÿæˆå¹³å°ï¼Œè®©æˆ‘ä»¬å¼€å§‹ä»Šå¤©çš„å·¥ä½œå§ï¼</p>
        </div>
        <div class="col-md-4 text-end">
            <div class="welcome-date">
                <i class="bi bi-calendar-event me-2"></i>
                <span id="currentDate"></span>
            </div>
            <div class="welcome-time text-muted">
                <i class="bi bi-clock me-2"></i>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>
</div>

<!-- âš¡ å·¥ä½œæµç¨‹å›¾ -->
{% include 'components/index/workflow-diagram.html' %}


<!-- åº•éƒ¨ä¿¡æ¯ -->
<div class="dashboard-footer text-center py-4 border-top mt-4">
    <p class="text-muted mb-2">
        <i class="bi bi-info-circle me-2"></i>
        éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹
        <a href="/help.html" class="text-decoration-none">ä½¿ç”¨æŒ‡å—</a>
        æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ
    </p>
    <small class="text-muted">
        Â© 2025 å…ƒæ™¯AIæ™ºèƒ½æ ‡ä¹¦ç”Ÿæˆå¹³å° | Powered by China Unicom
    </small>
</div>

<!-- Dashboard JavaScript -->
<script>
// æ›´æ–°é—®å€™è¯­
function updateGreeting() {
    const hour = new Date().getHours();
    let greeting = 'æ‚¨å¥½';

    if (hour < 6) {
        greeting = 'å‡Œæ™¨å¥½';
    } else if (hour < 9) {
        greeting = 'æ—©ä¸Šå¥½';
    } else if (hour < 12) {
        greeting = 'ä¸Šåˆå¥½';
    } else if (hour < 14) {
        greeting = 'ä¸­åˆå¥½';
    } else if (hour < 18) {
        greeting = 'ä¸‹åˆå¥½';
    } else if (hour < 22) {
        greeting = 'æ™šä¸Šå¥½';
    } else {
        greeting = 'å¤œæ·±äº†';
    }

    const greetingEl = document.getElementById('greeting');
    if (greetingEl) {
        greetingEl.textContent = greeting;
    }
}

// æ›´æ–°æ—¥æœŸæ—¶é—´
function updateDateTime() {
    const now = new Date();

    // æ›´æ–°æ—¥æœŸ
    const dateEl = document.getElementById('currentDate');
    if (dateEl) {
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        dateEl.textContent = now.toLocaleDateString('zh-CN', options);
    }

    // æ›´æ–°æ—¶é—´
    const timeEl = document.getElementById('currentTime');
    if (timeEl) {
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        timeEl.textContent = `${hours}:${minutes}:${seconds}`;
    }
}

// åŠ è½½ç»Ÿè®¡æ•°æ®
async function loadDashboardStats() {
    try {
        // è¿™é‡Œå¯ä»¥è°ƒç”¨å®é™…çš„APIè·å–ç»Ÿè®¡æ•°æ®
        // ç›®å‰ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
        const stats = {
            totalDocuments: 127,
            completedTasks: 98,
            pendingTasks: 15
        };

        // ä½¿ç”¨åŠ¨ç”»æ•ˆæœæ›´æ–°æ•°å­—
        animateNumber('totalDocuments', 0, stats.totalDocuments, 1000);
        animateNumber('completedTasks', 0, stats.completedTasks, 1000);
        animateNumber('pendingTasks', 0, stats.pendingTasks, 1000);
    } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
    }
}

// æ•°å­—åŠ¨ç”»æ•ˆæœ
function animateNumber(elementId, start, end, duration) {
    const element = document.getElementById(elementId);
    if (!element) return;

    const range = end - start;
    const increment = range / (duration / 16); // 60fps
    let current = start;

    const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
            current = end;
            clearInterval(timer);
        }
        element.textContent = Math.floor(current);
    }, 16);
}

// åˆå§‹åŒ–dashboard
document.addEventListener('DOMContentLoaded', function() {
    updateGreeting();
    updateDateTime();
    loadDashboardStats();

    // æ¯ç§’æ›´æ–°æ—¶é—´
    setInterval(updateDateTime, 1000);

    // æ¯åˆ†é’Ÿæ›´æ–°é—®å€™è¯­
    setInterval(updateGreeting, 60000);
});
</script>
