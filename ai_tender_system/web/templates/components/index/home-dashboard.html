<!-- 首页仪表板 - 优化版 -->

<!-- 欢迎区域 -->
<div class="welcome-section mb-4">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h2 class="welcome-title mb-2">
                <span id="greeting">您好</span>，<span class="text-primary">{{ session.get('username', '用户') }}</span> 👋
            </h2>
            <p class="text-muted mb-0">欢迎使用元景AI智能标书生成平台，让我们开始今天的工作吧！</p>
        </div>
        <div class="col-md-4 text-end">
            <div class="welcome-date">
                <i class="bi bi-calendar-event me-2"></i>
                <span id="currentDate"></span>
            </div>
            <div class="welcome-time text-muted">
                <i class="bi bi-clock me-2"></i>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>
</div>

<!-- ⚡ 工作流程图 -->
{% include 'components/index/workflow-diagram.html' %}


<!-- 底部信息 -->
<div class="dashboard-footer text-center py-4 border-top mt-4">
    <p class="text-muted mb-2">
        <i class="bi bi-info-circle me-2"></i>
        需要帮助？查看
        <a href="/help.html" class="text-decoration-none">使用指南</a>
        或联系技术支持
    </p>
    <small class="text-muted">
        © 2025 元景AI智能标书生成平台 | Powered by China Unicom
    </small>
</div>

<!-- Dashboard JavaScript -->
<script>
// 更新问候语
function updateGreeting() {
    const hour = new Date().getHours();
    let greeting = '您好';

    if (hour < 6) {
        greeting = '凌晨好';
    } else if (hour < 9) {
        greeting = '早上好';
    } else if (hour < 12) {
        greeting = '上午好';
    } else if (hour < 14) {
        greeting = '中午好';
    } else if (hour < 18) {
        greeting = '下午好';
    } else if (hour < 22) {
        greeting = '晚上好';
    } else {
        greeting = '夜深了';
    }

    const greetingEl = document.getElementById('greeting');
    if (greetingEl) {
        greetingEl.textContent = greeting;
    }
}

// 更新日期时间
function updateDateTime() {
    const now = new Date();

    // 更新日期
    const dateEl = document.getElementById('currentDate');
    if (dateEl) {
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        dateEl.textContent = now.toLocaleDateString('zh-CN', options);
    }

    // 更新时间
    const timeEl = document.getElementById('currentTime');
    if (timeEl) {
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        timeEl.textContent = `${hours}:${minutes}:${seconds}`;
    }
}

// 加载统计数据
async function loadDashboardStats() {
    try {
        // 这里可以调用实际的API获取统计数据
        // 目前使用模拟数据
        const stats = {
            totalDocuments: 127,
            completedTasks: 98,
            pendingTasks: 15
        };

        // 使用动画效果更新数字
        animateNumber('totalDocuments', 0, stats.totalDocuments, 1000);
        animateNumber('completedTasks', 0, stats.completedTasks, 1000);
        animateNumber('pendingTasks', 0, stats.pendingTasks, 1000);
    } catch (error) {
        console.error('加载统计数据失败:', error);
    }
}

// 数字动画效果
function animateNumber(elementId, start, end, duration) {
    const element = document.getElementById(elementId);
    if (!element) return;

    const range = end - start;
    const increment = range / (duration / 16); // 60fps
    let current = start;

    const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
            current = end;
            clearInterval(timer);
        }
        element.textContent = Math.floor(current);
    }, 16);
}

// 初始化dashboard
document.addEventListener('DOMContentLoaded', function() {
    updateGreeting();
    updateDateTime();
    loadDashboardStats();

    // 每秒更新时间
    setInterval(updateDateTime, 1000);

    // 每分钟更新问候语
    setInterval(updateGreeting, 60000);
});
</script>
