<!-- 功能说明 -->
<div class="row mb-3">
    <div class="col-12">
        <div class="alert alert-info" role="alert">
            <h6 class="alert-heading"><i class="bi bi-info-circle me-2"></i>内联回复功能（原地插入应答）</h6>
            <p class="mb-2">该功能会在原文档中每个需求后<strong>直接插入应答</strong>，特点：</p>
            <ul class="mb-0 small">
                <li><strong>原地插入</strong>：应答紧跟在每个需求段落后面</li>
                <li><strong>灰色底纹标记</strong>：应答内容添加浅灰色背景（RGB 217,217,217），便于识别</li>
                <li><strong>格式完整保留</strong>：保持原文档的字体、样式、结构不变</li>
                <li><strong>专业提示词</strong>：使用三种专业模板（点对点/内容生成/标题简化）</li>
            </ul>
        </div>
    </div>
</div>

<!-- 公司项目信息展示卡片 - 使用共用组件 -->
{% set section = 'point-to-point' %}
{% include 'components/common/company-project-info-card.html' %}

<!-- 点对点应答功能区域 -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-chat-dots"></i> 点对点智能应答
                </h6>
            </div>
            <div class="card-body">
                <form id="uploadForm">
                    <!-- 隐藏的表单字段存储公司ID -->
                    <input type="hidden" id="pointToPointCompanyId" name="companyId" value="">
                    <!-- 隐藏字段：存储从HITL传递过来的技术需求文件信息 -->
                    <input type="hidden" id="technicalFileTaskId" name="technicalFileTaskId" value="">
                    <input type="hidden" id="technicalFileUrl" name="technicalFileUrl" value="">

                    <!-- 文件上传区域 -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="bi bi-file-earmark-text"></i> 招标文档上传
                        </label>
                        <div class="upload-area" id="uploadArea">
                            <i class="bi bi-cloud-upload-fill text-primary display-1"></i>
                            <h5 class="mt-3">拖放文档到此处</h5>
                            <p class="text-muted mb-3">或点击选择文件</p>
                            <p class="text-muted small">
                                支持格式：Word文档 (.docx, .doc) 和 PDF文件 (.pdf)<br>
                                最大文件大小：50MB
                            </p>
                            <input type="file" class="d-none" id="fileInput" name="file"
                                   accept=".docx,.doc,.pdf">
                        </div>

                        <!-- 文件信息显示 -->
                        <div class="mt-3 d-none" id="fileInfo">
                            <div class="alert alert-info d-flex align-items-center">
                                <i class="bi bi-file-earmark-text me-2"></i>
                                <div>
                                    已选择文件：<strong id="fileName"></strong>
                                    <span class="text-muted" id="fileSize"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 处理配置 -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="bidRole" class="form-label">
                                <i class="bi bi-person-badge"></i> 投标角色
                            </label>
                            <select class="form-select" id="bidRole" name="bidRole">
                                <option value="primary" selected>应标</option>
                                <option value="secondary">陪标</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="responseFrequency" class="form-label">
                                <i class="bi bi-gear"></i> 应答频率
                            </label>
                            <select class="form-select" id="responseFrequency" name="responseFrequency">
                                <option value="every_paragraph">每段应答</option>
                                <option value="every_page">每页应答</option>
                                <option value="every_section">每章节应答</option>
                                <option value="end_of_document">文档末尾统一应答</option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="responseMode" class="form-label">
                                <i class="bi bi-cpu"></i> 应答方式
                            </label>
                            <select class="form-select" id="responseMode" name="responseMode">
                                <option value="ai" selected>AI智能应答</option>
                                <option value="simple">简单应答</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="aiModel" class="form-label">
                                <strong>选择AI模型：</strong>
                                <button type="button" class="btn btn-sm btn-outline-info ms-2" onclick="refreshModels()">
                                    <i class="bi bi-arrow-clockwise"></i> 刷新
                                </button>
                            </label>
                            <select class="form-select" name="aiModel" id="aiModel" onchange="onModelChange()">
                                <optgroup label="始皇API">
                                    <option value="shihuang-gpt4o-mini" selected>始皇-GPT4o迷你版（快速高效）</option>
                                    <option value="shihuang-gpt4">始皇-GPT4专业版（深度分析）</option>
                                </optgroup>
                                <optgroup label="联通元景">
                                    <option value="unicom-yuanjing">联通元景模型</option>
                                </optgroup>
                                <optgroup label="OpenAI">
                                    <option value="gpt-4o-mini">GPT-4O Mini (推荐)</option>
                                    <option value="gpt-4o">GPT-4O (高质量)</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (快速)</option>
                                </optgroup>
                            </select>

                            <!-- 模型状态显示 -->
                            <div class="mt-2" id="modelStatus" style="display: none;">
                                <small class="d-flex align-items-center">
                                    <span id="modelStatusIcon" class="me-1"></span>
                                    <span id="modelStatusText"></span>
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- 处理按钮 -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg" id="processBtn" disabled>
                            <i class="bi bi-play-circle"></i> 开始处理
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 进度条 -->
<div class="progress mb-3 d-none" id="progressBar">
    <div class="progress-bar progress-bar-striped progress-bar-animated"
         role="progressbar" style="width: 0%"></div>
</div>

<!-- 处理结果区域 -->
<div class="row d-none" id="resultArea">
    <div class="col-12">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0">
                    <i class="bi bi-check-circle"></i> 处理完成
                </h6>
            </div>
            <div class="card-body">
                <div id="resultMessage" class="mb-3">
                    <!-- 处理结果信息将在这里显示 -->
                </div>
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-outline-primary" id="previewBtn">
                        <i class="bi bi-eye"></i> 预览
                    </button>
                    <button class="btn btn-success" id="downloadBtn">
                        <i class="bi bi-download"></i> 下载结果文件
                    </button>
                    <button class="btn btn-primary" id="confirmCompleteBtn">
                        <i class="bi bi-check-circle"></i> 确认完成并返回主页
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 错误显示区域 -->
<div class="row d-none" id="errorArea">
    <div class="col-12">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0">
                    <i class="bi bi-x-circle"></i> 处理失败
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-danger" id="errorMessage">
                    <!-- 错误信息将在这里显示 -->
                </div>
                <div class="text-center">
                    <button class="btn btn-outline-danger me-2" id="retryBtn">
                        <i class="bi bi-arrow-clockwise"></i> 重试
                    </button>
                    <button class="btn btn-outline-secondary" id="resetBtn">
                        <i class="bi bi-x-circle"></i> 重置
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 历史文件列表 -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-clock-history"></i> 历史处理文件
                </h6>
                <button type="button" class="btn btn-sm btn-outline-primary" onclick="loadPointToPointFilesList()">
                    <i class="bi bi-arrow-clockwise"></i> 刷新列表
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="pointToPointFilesTable">
                        <thead>
                            <tr>
                                <th>文件名</th>
                                <th>公司</th>
                                <th>处理时间</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="pointToPointFilesTableBody">
                            <tr>
                                <td colspan="5" class="text-center text-muted">
                                    <i class="bi bi-hourglass-split"></i> 加载中...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 隐藏的表格行模板，用于JavaScript动态生成 -->
                <template id="pointToPointFileRowTemplate">
                    <tr>
                        <td class="file-name"></td>
                        <td class="company-name"></td>
                        <td class="process-time"></td>
                        <td class="status"></td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <button type="button" class="btn btn-outline-primary preview-btn"
                                        onclick="previewPointDocument(this)"
                                        data-file-path=""
                                        title="预览文档">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button type="button" class="btn btn-outline-success edit-btn"
                                        onclick="editPointDocument(this)"
                                        data-file-path=""
                                        title="编辑文档">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="btn btn-outline-info download-btn"
                                        onclick="downloadPointDocument(this)"
                                        data-file-path=""
                                        title="下载文档">
                                    <i class="bi bi-download"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </template>

                <!-- 空状态显示 -->
                <div class="text-center text-muted d-none" id="pointToPointNoFiles">
                    <i class="bi bi-inbox display-4"></i>
                    <p class="mt-3">暂无历史处理文件</p>
                    <p class="small">处理完成的文件将在这里显示</p>
                </div>
            </div>
        </div>
    </div>
</div>