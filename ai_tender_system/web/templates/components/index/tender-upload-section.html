<!--
招标文档上传区域 - 分步骤处理重构版本
设计架构说明：
1. 分离上传和处理：先上传文件，再分步处理信息
2. 参考资质上传：使用相同的UI设计模式
3. 清晰的步骤：上传 → 处理控制 → 结果展示
4. 用户可控：用户可选择处理哪些信息类型
-->

<!-- 第0部分：项目和公司选择区域 -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="bi bi-folder"></i> 项目和公司信息
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <!-- 项目选择 -->
                    <div class="col-md-6">
                        <label for="tenderProjectSelect" class="form-label">
                            <i class="bi bi-folder2"></i> 关联项目
                        </label>
                        <div class="d-flex align-items-center gap-2">
                            <select class="form-select" id="tenderProjectSelect">
                                <option value="" selected>新建项目</option>
                            </select>
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="refreshProjectsBtn" title="刷新项目列表">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                        <small class="text-muted">选择现有项目或创建新项目</small>
                    </div>

                    <!-- 公司选择 -->
                    <div class="col-md-6">
                        <label for="tenderCompanySelect" class="form-label">
                            <i class="bi bi-building"></i> 应答公司 <span class="text-danger">*</span>
                        </label>
                        <div class="d-flex align-items-center gap-2">
                            <select class="form-select" id="tenderCompanySelect" required>
                                <option value="">请选择公司...</option>
                            </select>
                            <button type="button" class="btn btn-outline-info btn-sm" onclick="window.location.href='/knowledge_base?action=company_management';" title="管理公司">
                                <i class="bi bi-building"></i> 管理
                            </button>
                        </div>
                        <div class="mt-1">
                            <small class="text-muted">当前：</small>
                            <span id="tenderSelectedCompanyName" class="text-muted">未选择</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 第1部分：文件上传区域 -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-cloud-upload"></i> 步骤1：上传招标文档
                </h6>
            </div>
            <div class="card-body">
                <!-- 使用通用上传组件，配置为纯上传模式 -->
                <div id="tenderUploadContainer"></div>

                <!-- 上传成功后的文件信息显示 -->
                <div class="mt-3 d-none" id="uploadedFileInfo">
                    <div class="card border-start border-success border-4 shadow-sm">
                        <div class="card-body py-3 bg-light">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill text-success me-2" style="font-size: 1.25rem;"></i>
                                    <div>
                                        <div class="mb-0">
                                            <strong class="text-dark">文件上传成功</strong>
                                        </div>
                                        <div class="small">
                                            <span id="uploadedFileName" class="text-primary fw-medium"></span>
                                            <span class="text-muted ms-2">(<span id="uploadedFileSize"></span>)</span>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="previewTenderBtn">
                                    <i class="bi bi-eye"></i> 预览文档
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 第2部分：信息处理控制区域 -->
<div class="row mb-4 d-none" id="processingControlArea">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-gear"></i> 步骤2：选择处理信息类型
                </h6>
            </div>
            <div class="card-body">
                <!-- AI模型选择 -->
                <div class="row g-3 mb-4">
                    <div class="col-12">
                        <label for="tenderAiModel" class="form-label">
                            选择AI模型 <span class="text-danger">*</span>
                        </label>
                        <div class="d-flex align-items-center gap-2">
                            <select class="form-select" name="tenderAiModel" id="tenderAiModel" onchange="onTenderModelChange()">
                                <optgroup label="始皇API">
                                    <option value="shihuang-gpt4o-mini" selected>始皇-GPT4o迷你版（快速高效）</option>
                                    <option value="shihuang-gpt4">始皇-GPT4专业版（深度分析）</option>
                                </optgroup>
                                <optgroup label="联通元景">
                                    <option value="unicom-yuanjing">联通元景模型</option>
                                </optgroup>
                                <optgroup label="OpenAI">
                                    <option value="gpt-4o-mini">GPT-4O Mini (推荐)</option>
                                    <option value="gpt-4o">GPT-4O (高质量)</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (快速)</option>
                                </optgroup>
                            </select>
                            <button type="button" class="btn btn-outline-info btn-sm" onclick="refreshModels()" title="刷新模型列表">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                        <!-- 模型状态显示 -->
                        <div class="mt-2" id="tenderModelStatus" style="display: none;">
                            <small class="d-flex align-items-center">
                                <span id="tenderModelStatusIcon" class="me-1"></span>
                                <span id="tenderModelStatusText"></span>
                            </small>
                        </div>
                    </div>
                </div>

                <div class="row g-3 text-center">
                    <div class="col-md-3">
                        <button class="btn btn-outline-primary w-100" id="processBasicInfoBtn" disabled>
                            <i class="bi bi-info-circle"></i><br>
                            <small>处理基本信息</small>
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-success w-100" id="processQualificationBtn" disabled>
                            <i class="bi bi-award"></i><br>
                            <small>处理资质要求</small>
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-warning w-100" id="processScoringBtn" disabled>
                            <i class="bi bi-star"></i><br>
                            <small>处理评分信息</small>
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-primary w-100" id="processAllBtn" disabled>
                            <i class="bi bi-lightning"></i><br>
                            <small>一键全部处理</small>
                        </button>
                    </div>
                </div>

                <!-- 处理进度显示 -->
                <div class="mt-3 d-none" id="processingProgress">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated"
                             role="progressbar" style="width: 0%" id="processingProgressBar">
                            <span id="processingProgressText">准备处理...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 第3部分：结果展示区域 -->
<div class="row g-3 mb-4 d-none" id="resultsDisplayArea">
    <!-- 基本信息展示 -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-info-circle"></i> 基本信息
                </h6>
                <button class="btn btn-sm btn-link text-white" type="button" data-bs-toggle="collapse" data-bs-target="#basicInfoCollapse" aria-expanded="true">
                    <i class="bi bi-chevron-down"></i>
                </button>
            </div>
            <div class="collapse show" id="basicInfoCollapse">
                <div class="card-body" id="basicInfoDisplay">
                    <div class="text-muted text-center">
                        <i class="bi bi-hourglass-split"></i><br>
                        等待处理...
                    </div>
                </div>
                <div class="card-footer bg-light text-center d-none" id="basicInfoFooter">
                    <button class="btn btn-sm btn-primary" id="saveBasicInfoBtn" disabled>
                        <i class="bi bi-save"></i> 保存基本信息
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 资质要求展示 -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-award"></i> 资质要求
                </h6>
                <button class="btn btn-sm btn-link text-white" type="button" data-bs-toggle="collapse" data-bs-target="#qualificationCollapse" aria-expanded="true">
                    <i class="bi bi-chevron-down"></i>
                </button>
            </div>
            <div class="collapse show" id="qualificationCollapse">
                <div class="card-body" id="qualificationDisplay">
                    <div class="text-muted text-center">
                        <i class="bi bi-hourglass-split"></i><br>
                        等待处理...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 评分信息展示 -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-star"></i> 评分信息
                </h6>
                <button class="btn btn-sm btn-link text-white" type="button" data-bs-toggle="collapse" data-bs-target="#scoringCollapse" aria-expanded="true">
                    <i class="bi bi-chevron-down"></i>
                </button>
            </div>
            <div class="collapse show" id="scoringCollapse">
                <div class="card-body" id="scoringDisplay">
                    <div class="text-muted text-center">
                        <i class="bi bi-hourglass-split"></i><br>
                        等待处理...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 操作按钮 -->
    <div class="col-12">
        <div class="text-center mt-2">
            <button class="btn btn-primary me-2" id="saveProjectBtn" disabled>
                <i class="bi bi-save"></i> 保存项目
            </button>
            <button class="btn btn-outline-secondary me-2" id="resetAllBtn">
                <i class="bi bi-arrow-counterclockwise"></i> 重新开始
            </button>
        </div>
    </div>
</div>

<!-- 错误显示区域 -->
<div class="row d-none" id="tenderErrorArea">
    <div class="col-12">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0">
                    <i class="bi bi-x-circle"></i> 处理失败
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-danger" id="tenderErrorMessage">
                    <!-- 错误信息将在这里显示 -->
                </div>
                <div class="text-center">
                    <button class="btn btn-outline-danger me-2" id="tenderRetryErrorBtn">
                        <i class="bi bi-arrow-clockwise"></i> 重试
                    </button>
                    <button class="btn btn-outline-secondary" id="tenderResetErrorBtn">
                        <i class="bi bi-x-circle"></i> 重置
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 功能特点 -->
<div class="row g-3 mb-5">
    <div class="col-md-4">
        <div class="card feature-card">
            <div class="card-body text-center">
                <i class="bi bi-search text-info" style="font-size: 2rem;"></i>
                <h5 class="card-title mt-3">智能提取</h5>
                <p class="card-text text-muted">AI自动识别招标文件中的关键信息</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card feature-card">
            <div class="card-body text-center">
                <i class="bi bi-list-check text-success" style="font-size: 2rem;"></i>
                <h5 class="card-title mt-3">完整字段</h5>
                <p class="card-text text-muted">提取招标人、代理、时间等8个关键字段</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card feature-card">
            <div class="card-body text-center">
                <i class="bi bi-gear text-warning" style="font-size: 2rem;"></i>
                <h5 class="card-title mt-3">配置保存</h5>
                <p class="card-text text-muted">自动保存提取结果到配置文件</p>
            </div>
        </div>
    </div>
</div>

<!-- 功能说明 -->
<div class="row mt-5">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="bi bi-info-circle"></i> 功能说明
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>📄 提取字段</h6>
                        <ul>
                            <li>招标人（采购人/甲方）</li>
                            <li>招标代理（代理机构）</li>
                            <li>投标方式（公开招标等）</li>
                            <li>投标地点（递交地点）</li>
                            <li>投标时间（截止时间）</li>
                            <li>中标人数量（预计数量）</li>
                            <li>项目名称</li>
                            <li>项目编号（招标编号）</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>🔧 技术特点</h6>
                        <ul>
                            <li>AI智能识别关键信息</li>
                            <li>支持多种文档格式</li>
                            <li>自动提取结构化数据</li>
                            <li>保存配置便于复用</li>
                            <li>一键导出Excel格式</li>
                            <li>实时进度反馈</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>