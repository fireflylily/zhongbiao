<!-- 文档库管理界面 - 全屏视图（对齐 knowledge_base.html） -->
<div class="knowledge-base-content" id="documentLibraryContent" style="width: 100%; min-height: 500px;">
    <!-- 主内容容器 - DocumentManager会在这里渲染完整的文档库视图 -->
    <div id="documentLibraryMainContent" style="width: 100%; min-height: 500px;">
        <!-- 初始加载提示 -->
        <div class="text-center py-5">
            <div class="mb-3">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">加载中...</span>
                </div>
            </div>
            <p class="text-muted">正在加载文档库...</p>
        </div>
    </div>
</div>

<script>
(function() {
    // 当tab被激活时，初始化文档库
    const documentLibraryTab = document.getElementById('document-library-nav');
    if (documentLibraryTab) {
        documentLibraryTab.addEventListener('shown.bs.tab', async function() {
            console.log('文档库tab已激活');
            await initializeDocumentLibrary();
        });
    }

    // 初始化文档库
    async function initializeDocumentLibrary() {
        try {
            // 检查文档管理器是否已加载
            if (!window.documentManager) {
                console.error('DocumentManager未加载');
                showError('文档库功能未正确加载，请刷新页面重试');
                return;
            }

            // 渲染文档库视图（全屏覆盖，显示所有文档的统一列表）
            if (typeof window.documentManager.renderDocumentLibraryView === 'function') {
                await window.documentManager.renderDocumentLibraryView();
            } else {
                console.error('renderDocumentLibraryView方法不存在');
                showFallbackView();
            }

        } catch (error) {
            console.error('初始化文档库失败:', error);
            showError('加载文档库失败: ' + error.message);
        }
    }

    // 显示错误信息
    function showError(message) {
        const html = `
            <div class="alert alert-danger m-4">
                <i class="bi bi-exclamation-triangle me-2"></i>
                ${message}
            </div>
        `;
        const mainContent = document.getElementById('documentLibraryMainContent');
        if (mainContent) {
            mainContent.innerHTML = html;
        }
    }

    // 显示备用视图（当管理器不可用时）
    function showFallbackView() {
        const html = `
            <div class="text-center py-5">
                <i class="bi bi-folder text-info" style="font-size: 4rem;"></i>
                <h5 class="mt-3 text-muted">文档库</h5>
                <p class="text-muted">管理所有企业和产品的技术文档，提供统一的文档浏览和搜索</p>
                <div class="mt-4">
                    <button class="btn btn-primary btn-lg" onclick="window.location.href='/knowledge_base'">
                        <i class="bi bi-box-arrow-up-right me-2"></i>打开知识库页面
                    </button>
                </div>
            </div>
        `;
        const mainContent = document.getElementById('documentLibraryMainContent');
        if (mainContent) {
            mainContent.innerHTML = html;
        }
    }
})();
</script>
