<!-- 企业信息库管理界面 - 全屏列表视图（对齐 knowledge_base.html） -->
<div class="knowledge-base-content" id="companyLibraryContent">
    <!-- 主内容容器 - CompanyProfileManager会在这里渲染完整的企业列表视图 -->
    <div id="mainContent">
        <!-- 初始加载提示 -->
        <div class="text-center py-5">
            <div class="mb-3">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">加载中...</span>
                </div>
            </div>
            <p class="text-muted">正在加载企业信息库...</p>
        </div>
    </div>
</div>

<script>
(function() {
    // 当tab被激活时，初始化企业信息库
    const companyLibraryTab = document.getElementById('company-library-nav');
    if (companyLibraryTab) {
        companyLibraryTab.addEventListener('shown.bs.tab', async function() {
            console.log('企业信息库tab已激活');
            await initializeCompanyLibrary();
        });
    }

    // 初始化企业信息库
    async function initializeCompanyLibrary() {
        try {
            // 检查管理器是否已加载
            if (!window.companyProfileManager) {
                console.error('CompanyProfileManager未加载');
                showError('企业信息库功能未正确加载，请刷新页面重试');
                return;
            }

            // 渲染企业列表视图（全屏覆盖）
            if (typeof window.companyProfileManager.renderCompanyListView === 'function') {
                await window.companyProfileManager.renderCompanyListView();
            } else {
                console.error('renderCompanyListView方法不存在');
                showFallbackView();
            }

        } catch (error) {
            console.error('初始化企业信息库失败:', error);
            showError('加载企业信息库失败: ' + error.message);
        }
    }

    // 显示错误信息
    function showError(message) {
        const html = `
            <div class="alert alert-danger m-4">
                <i class="bi bi-exclamation-triangle me-2"></i>
                ${message}
            </div>
        `;
        const mainContent = document.getElementById('mainContent');
        if (mainContent) {
            mainContent.innerHTML = html;
        }
    }

    // 显示备用视图（当管理器不可用时）
    function showFallbackView() {
        const html = `
            <div class="text-center py-5">
                <i class="bi bi-building text-muted" style="font-size: 4rem;"></i>
                <h5 class="mt-3 text-muted">企业信息库</h5>
                <p class="text-muted">管理企业基本信息、资质证书和财务文档</p>
            </div>
        `;
        const mainContent = document.getElementById('mainContent');
        if (mainContent) {
            mainContent.innerHTML = html;
        }
    }
})();
</script>
