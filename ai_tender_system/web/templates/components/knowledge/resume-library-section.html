<!-- 简历库管理界面 -->
<div id="resumeLibraryContainer" style="width: 100%; min-height: 500px;">
    <!-- 初始加载提示 -->
    <div class="text-center py-5" id="resumeLoadingIndicator">
        <div class="mb-3">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">加载中...</span>
            </div>
        </div>
        <p class="text-muted">正在加载简历库...</p>
    </div>
</div>

<script>
(function() {
    // 当tab被激活时，初始化简历库
    const resumeLibraryTab = document.getElementById('resume-library-nav');
    if (resumeLibraryTab) {
        resumeLibraryTab.addEventListener('shown.bs.tab', async function() {
            console.log('简历库tab已激活');
            await initializeResumeLibrary();
        });
    }

    // 初始化简历库
    async function initializeResumeLibrary() {
        console.log('[INIT] 开始初始化简历库...');
        try {
            // 检查简历库管理器是否已加载
            console.log('[INIT] 检查简历库管理器:', window.resumeLibraryManager);
            if (!window.resumeLibraryManager) {
                console.error('[INIT] ResumeLibraryManager未加载');
                showError('简历库功能未正确加载，请刷新页面重试');
                return;
            }

            // 初始化管理器（如果尚未初始化）
            console.log('[INIT] 检查initialize方法:', typeof window.resumeLibraryManager.initialize);
            if (typeof window.resumeLibraryManager.initialize === 'function') {
                console.log('[INIT] 调用initialize...');
                await window.resumeLibraryManager.initialize();
                console.log('[INIT] initialize完成');
            }

            // 渲染简历库视图
            console.log('[INIT] 检查renderResumeLibraryView方法:', typeof window.resumeLibraryManager.renderResumeLibraryView);
            if (typeof window.resumeLibraryManager.renderResumeLibraryView === 'function') {
                console.log('[INIT] 调用renderResumeLibraryView...');
                await window.resumeLibraryManager.renderResumeLibraryView();
                console.log('[INIT] renderResumeLibraryView完成');
            } else {
                console.error('[INIT] renderResumeLibraryView方法不存在');
                showFallbackView();
            }

        } catch (error) {
            console.error('[INIT] 初始化简历库失败:', error);
            showError('加载简历库失败: ' + error.message);
        }
    }

    // 显示错误信息
    function showError(message) {
        const html = `
            <div class="alert alert-danger m-4">
                <i class="bi bi-exclamation-triangle me-2"></i>
                ${message}
            </div>
        `;
        const container = document.getElementById('resumeLibraryContainer');
        if (container) {
            container.innerHTML = html;
        }
    }

    // 显示备用视图（当管理器不可用时）
    function showFallbackView() {
        const html = `
            <div class="text-center py-5">
                <i class="bi bi-person-badge text-info" style="font-size: 4rem;"></i>
                <h5 class="mt-3 text-muted">简历库</h5>
                <p class="text-muted">管理人员简历，支持智能解析和批量导出</p>
                <button class="btn btn-primary mt-3" onclick="location.reload()">
                    <i class="bi bi-arrow-clockwise me-2"></i>重新加载
                </button>
            </div>
        `;
        const container = document.getElementById('resumeLibraryContainer');
        if (container) {
            container.innerHTML = html;
        }
    }

    // 如果是默认激活的tab，立即初始化
    if (resumeLibraryTab && resumeLibraryTab.classList.contains('active')) {
        initializeResumeLibrary();
    }
})();
</script>