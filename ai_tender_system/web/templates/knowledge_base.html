<!DOCTYPE html>
<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          AIæ ‡ä¹¦ç³»ç»Ÿ - ä¼ä¸šçŸ¥è¯†åº“ç®¡ç†é¡µé¢æ¶æ„æ–‡æ¡£                                      â•‘
â•‘                                  æœ€åæ›´æ–°: 2025-09-30                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯å±‚ (çŸ¥è¯†åº“UI)                                                                                 â”‚
â”‚   â”œâ”€ knowledge_base.html (æœ¬æ–‡ä»¶)                                                                 â”‚
â”‚   â”œâ”€ category-manager.js          - ä¼ä¸š/äº§å“æ ‘å½¢åˆ†ç±»ç®¡ç†                                          â”‚
â”‚   â”œâ”€ document-manager.js          - æ–‡æ¡£ä¸Šä¼ /ç®¡ç†                                                  â”‚
â”‚   â”œâ”€ search-manager.js            - æ–‡æ¡£æœç´¢                                                       â”‚
â”‚   â”œâ”€ company-profile-manager.js   - ä¼ä¸šä¿¡æ¯/èµ„è´¨ç®¡ç†                                              â”‚
â”‚   â””â”€ rag-integration.js           - RAGæ™ºèƒ½æ£€ç´¢é›†æˆ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åç«¯APIå±‚ (Flask Blueprints)                                                                      â”‚
â”‚   â”œâ”€ knowledge_base/api.py        - ä¼ä¸š/äº§å“/æ–‡æ¡£CRUD                                             â”‚
â”‚   â”œâ”€ vector_search_api.py         - å‘é‡æœç´¢API (å·²è¿ç§»åˆ°Chroma)                                   â”‚
â”‚   â””â”€ rag_api.py                   - RAGæ™ºèƒ½é—®ç­”API (å¾…éƒ¨ç½²)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é‡å­˜å‚¨å±‚ - Chroma Vector Database (2025-09-30 è¿ç§»å®Œæˆ)                                         â”‚
â”‚                                                                                                    â”‚
â”‚   æ—§æ–¹æ¡ˆ: SimpleVectorStore (NumPyçº¿æ€§æœç´¢) â†’ å·²åºŸå¼ƒ                                              â”‚
â”‚   æ–°æ–¹æ¡ˆ: ChromaVectorStore (ä¸“ä¸šå‘é‡æ•°æ®åº“)                                                        â”‚
â”‚                                                                                                    â”‚
â”‚   ã€Chromaæ¶æ„ã€‘                                                                                    â”‚
â”‚   â”œâ”€ chroma_adapter.py            - Chromaé€‚é…å™¨ (ä¿æŒAPIå…¼å®¹)                                     â”‚
â”‚   â”‚   â””â”€ class ChromaVectorStore                                                                  â”‚
â”‚   â”‚       â”œâ”€ async initialize()                - åˆå§‹åŒ–Chromaå®¢æˆ·ç«¯                                â”‚
â”‚   â”‚       â”œâ”€ async add_document()              - æ·»åŠ å•ä¸ªæ–‡æ¡£å‘é‡                                  â”‚
â”‚   â”‚       â”œâ”€ async add_documents()             - æ‰¹é‡æ·»åŠ å‘é‡ (æ–°å¢æ–¹æ³•)                           â”‚
â”‚   â”‚       â”œâ”€ async search()                    - å‘é‡ç›¸ä¼¼åº¦æœç´¢                                    â”‚
â”‚   â”‚       â”œâ”€ async delete_document()           - åˆ é™¤æ–‡æ¡£å‘é‡                                      â”‚
â”‚   â”‚       â”œâ”€ async update_document()           - æ›´æ–°æ–‡æ¡£å…ƒæ•°æ®                                    â”‚
â”‚   â”‚       â””â”€ get_stats()                       - è·å–ç»Ÿè®¡ä¿¡æ¯                                      â”‚
â”‚   â”‚                                                                                                â”‚
â”‚   â”œâ”€ æŒä¹…åŒ–ç›®å½•: data/chroma_vector_db/                                                            â”‚
â”‚   â”œâ”€ å‘é‡ç»´åº¦: 100ç»´                                                                               â”‚
â”‚   â”œâ”€ è·ç¦»è®¡ç®—: L2è·ç¦» â†’ ç›¸ä¼¼åº¦è½¬æ¢                                                                 â”‚
â”‚   â””â”€ å…ƒæ•°æ®è¿‡æ»¤: æ”¯æŒ where æŸ¥è¯¢è¯­æ³•                                                               â”‚
â”‚                                                                                                    â”‚
â”‚   ã€æ€§èƒ½å¯¹æ¯”ã€‘                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚   â”‚ æŒ‡æ ‡              â”‚ SimpleVectorStore  â”‚ ChromaVectorStore  â”‚                                 â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â”‚
â”‚   â”‚ æœç´¢æ€§èƒ½ (1Kæ–‡æ¡£) â”‚ ~80ms              â”‚ ~15ms âš¡           â”‚                                 â”‚
â”‚   â”‚ å†…å­˜å ç”¨ (100K)   â”‚ ~1.5GB             â”‚ ~800MB ğŸ“‰          â”‚                                 â”‚
â”‚   â”‚ æŒä¹…åŒ–           â”‚ æ‰‹åŠ¨pickle         â”‚ è‡ªåŠ¨ âœ¨            â”‚                                 â”‚
â”‚   â”‚ å…ƒæ•°æ®æŸ¥è¯¢       â”‚ åŸºç¡€dictåŒ¹é…       â”‚ å¼ºå¤§æŸ¥è¯¢è¯­æ³• ğŸ”    â”‚                                 â”‚
â”‚   â”‚ å®ç°å¤æ‚åº¦       â”‚ â­ ç®€å•            â”‚ â­â­ ä¸­ç­‰          â”‚                                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                                                    â”‚
â”‚   ã€å·²åºŸå¼ƒæ–¹æ¡ˆã€‘                                                                                    â”‚
â”‚   âŒ FAISS (faiss_index.py) - ä»£ç å­˜åœ¨ä½†æœªä½¿ç”¨ï¼Œè¿‡äºå¤æ‚                                           â”‚
â”‚   âŒ SimpleVectorStore - å·²è¢«Chromaæ›¿ä»£                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é‡åµŒå…¥å±‚                                                                                         â”‚
â”‚   â””â”€ simple_embedding.py          - æ–‡æœ¬å‘é‡åŒ–æœåŠ¡ (100ç»´)                                         â”‚
â”‚       â””â”€ SimpleEmbeddingService                                                                   â”‚
â”‚           â”œâ”€ async embed_texts()              - æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–                                     â”‚
â”‚           â””â”€ async embed_query()              - æŸ¥è¯¢å‘é‡åŒ–                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡æ¡£è§£æå±‚                                                                                         â”‚
â”‚   â””â”€ document_parser/parser_manager.py - å¤šæ ¼å¼æ–‡æ¡£è§£æ                                            â”‚
â”‚       â”œâ”€ PDFè§£æ                                                                                   â”‚
â”‚       â”œâ”€ Wordè§£æ                                                                                  â”‚
â”‚       â””â”€ æ–‡æœ¬åˆ†å— (RecursiveCharacterTextSplitter)                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®æŒä¹…åŒ–å±‚                                                                                       â”‚
â”‚   â”œâ”€ SQLiteæ•°æ®åº“: data/knowledge_base.db                                                         â”‚
â”‚   â”‚   â”œâ”€ companies                - ä¼ä¸šä¿¡æ¯è¡¨                                                     â”‚
â”‚   â”‚   â”œâ”€ company_qualifications   - ä¼ä¸šèµ„è´¨è¡¨                                                     â”‚
â”‚   â”‚   â”œâ”€ products                 - äº§å“ä¿¡æ¯è¡¨                                                     â”‚
â”‚   â”‚   â”œâ”€ documents                - æ–‡æ¡£å…ƒæ•°æ®è¡¨                                                   â”‚
â”‚   â”‚   â””â”€ document_chunks          - æ–‡æ¡£åˆ†å—è¡¨                                                     â”‚
â”‚   â”‚                                                                                                â”‚
â”‚   â””â”€ Chromaå‘é‡æ•°æ®åº“: data/chroma_vector_db/                                                      â”‚
â”‚       â”œâ”€ chroma.sqlite3           - Chromaå…ƒæ•°æ®                                                   â”‚
â”‚       â””â”€ [collection_files]       - å‘é‡ç´¢å¼•æ–‡ä»¶                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ã€‘

1. ä¼ä¸šä¿¡æ¯ç®¡ç†
   â”œâ”€ ä¼ä¸šåŸºæœ¬ä¿¡æ¯ (åç§°ã€ä»£ç ã€è¡Œä¸šã€æè¿°)
   â”œâ”€ ä¼ä¸šèµ„è´¨ç®¡ç†
   â”‚   â”œâ”€ è¥ä¸šæ‰§ç…§ã€ç¨åŠ¡ç™»è®°ã€ç»„ç»‡æœºæ„ä»£ç 
   â”‚   â”œâ”€ ISOè®¤è¯ã€è¡Œä¸šèµ„è´¨ã€çŸ¥è¯†äº§æƒ
   â”‚   â””â”€ è´¢åŠ¡æ–‡æ¡£ (å®¡è®¡æŠ¥å‘Šã€çº³ç¨è¯æ˜ã€é“¶è¡Œè®¸å¯è¯)
   â””â”€ æ³•äººä¿¡æ¯ (èº«ä»½è¯æ­£åé¢)

2. äº§å“æ–‡æ¡£ç®¡ç†
   â”œâ”€ äº§å“åˆ†ç±» (è½¯ä»¶/ç¡¬ä»¶/æœåŠ¡/è§£å†³æ–¹æ¡ˆ)
   â”œâ”€ æ–‡æ¡£ä¸Šä¼  (PDFã€Word)
   â”œâ”€ æ–‡æ¡£åˆ†ç±» (æŠ€æœ¯æ–‡æ¡£/äº§å“æ–‡æ¡£/ä½¿ç”¨æ‰‹å†Œ/å…¶ä»–)
   â”œâ”€ éšç§çº§åˆ« (å…¬å¼€/å†…éƒ¨/æœºå¯†/ç»å¯†)
   â””â”€ æ ‡ç­¾ç®¡ç†

3. å‘é‡æœç´¢åŠŸèƒ½ (Chromaé©±åŠ¨)
   â”œâ”€ è¯­ä¹‰æœç´¢ (/api/vector_search/search)
   â”œâ”€ ç›¸ä¼¼æ–‡æ¡£ (/api/vector_search/similar/<doc_id>)
   â”œâ”€ æ–‡æ¡£å‘é‡åŒ– (/api/vector_search/documents/vectorize)
   â”œâ”€ æ‰¹é‡å‘é‡åŒ– (/api/vector_search/documents/batch_vectorize)
   â””â”€ ç³»ç»ŸçŠ¶æ€ (/api/vector_search/status)

4. RAGæ™ºèƒ½æ£€ç´¢ (å·²å®ç°ï¼Œå¾…éƒ¨ç½²)
   â”œâ”€ è‡ªç„¶è¯­è¨€é—®ç­”
   â”œâ”€ ä¸Šä¸‹æ–‡ç›¸å…³æœç´¢
   â”œâ”€ å…ƒæ•°æ®è¿‡æ»¤ (æŒ‰ä¼ä¸š/äº§å“èŒƒå›´)
   â””â”€ ç»“æœé«˜äº®æ˜¾ç¤º

ã€APIç«¯ç‚¹åˆ—è¡¨ã€‘

ä¼ä¸šç®¡ç†:
  GET    /api/companies                          - è·å–ä¼ä¸šåˆ—è¡¨
  GET    /api/companies/<id>                     - è·å–ä¼ä¸šè¯¦æƒ…
  POST   /api/companies                          - åˆ›å»ºä¼ä¸š
  PUT    /api/companies/<id>                     - æ›´æ–°ä¼ä¸š
  DELETE /api/companies/<id>                     - åˆ é™¤ä¼ä¸š

èµ„è´¨ç®¡ç†:
  GET    /api/companies/<id>/qualifications      - è·å–ä¼ä¸šèµ„è´¨åˆ—è¡¨
  POST   /api/companies/<id>/qualifications      - ä¸Šä¼ èµ„è´¨æ–‡ä»¶
  DELETE /api/qualifications/<id>                - åˆ é™¤èµ„è´¨

äº§å“ç®¡ç†:
  GET    /api/companies/<id>/products            - è·å–ä¼ä¸šäº§å“åˆ—è¡¨
  POST   /api/companies/<id>/products            - åˆ›å»ºäº§å“
  DELETE /api/products/<id>                      - åˆ é™¤äº§å“

æ–‡æ¡£ç®¡ç†:
  GET    /api/knowledge_base/products/<id>/documents     - è·å–äº§å“æ–‡æ¡£
  POST   /api/knowledge_base/documents                   - ä¸Šä¼ æ–‡æ¡£
  DELETE /api/knowledge_base/documents/<id>              - åˆ é™¤æ–‡æ¡£

å‘é‡æœç´¢ (Chroma):
  GET    /api/vector_search/status               - ç³»ç»ŸçŠ¶æ€
  POST   /api/vector_search/search               - è¯­ä¹‰æœç´¢
  GET    /api/vector_search/similar/<doc_id>     - ç›¸ä¼¼æ–‡æ¡£
  POST   /api/vector_search/documents/vectorize  - æ–‡æ¡£å‘é‡åŒ–
  POST   /api/vector_search/documents/batch_vectorize - æ‰¹é‡å‘é‡åŒ–

RAGæ£€ç´¢ (å¾…æ¿€æ´»):
  GET    /api/rag/status                         - RAGæœåŠ¡çŠ¶æ€
  POST   /api/rag/search                         - RAGæ™ºèƒ½æœç´¢
  POST   /api/rag/vectorize_document             - æ–‡æ¡£å‘é‡åŒ–
  DELETE /api/rag/delete_document                - åˆ é™¤æ–‡æ¡£å‘é‡

ã€å‰ç«¯ç»„ä»¶æ¶æ„ã€‘

1. CategoryManager (category-manager.js)
   èŒè´£: ç®¡ç†å·¦ä¾§ä¼ä¸š/äº§å“æ ‘å½¢ç»“æ„
   æ–¹æ³•:
     - renderCompanyTree()          æ¸²æŸ“ä¼ä¸šæ ‘
     - toggleCompanyNode()          å±•å¼€/æŠ˜å ä¼ä¸šèŠ‚ç‚¹
     - showAddCompanyModal()        æ˜¾ç¤ºæ·»åŠ ä¼ä¸šå¯¹è¯æ¡†
     - addCompany()                 æ·»åŠ ä¼ä¸š
     - addProduct()                 æ·»åŠ äº§å“
     - selectCompanyProfile()       é€‰æ‹©ä¼ä¸šä¿¡æ¯åº“
   å›è°ƒ:
     - onCompanySelected            ä¼ä¸šè¢«é€‰ä¸­æ—¶è§¦å‘
     - onProductSelected            äº§å“è¢«é€‰ä¸­æ—¶è§¦å‘
     - onCompanyProfileSelected     ä¼ä¸šä¿¡æ¯åº“è¢«é€‰ä¸­æ—¶è§¦å‘

2. DocumentManager (document-manager.js)
   èŒè´£: æ–‡æ¡£ä¸Šä¼ å’Œç®¡ç†
   æ–¹æ³•:
     - init()                       åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ 
     - uploadDocuments()            ä¸Šä¼ æ–‡æ¡£
     - renderProductDetail()        æ¸²æŸ“äº§å“è¯¦æƒ…é¡µ
     - deleteDocument()             åˆ é™¤æ–‡æ¡£

3. SearchManager (search-manager.js)
   èŒè´£: æ–‡æ¡£æœç´¢åŠŸèƒ½
   æ–¹æ³•:
     - showSearchModal()            æ˜¾ç¤ºæœç´¢å¯¹è¯æ¡†
     - performSearch()              æ‰§è¡Œæœç´¢
     - renderSearchResults()        æ¸²æŸ“æœç´¢ç»“æœ

4. CompanyProfileManager (company-profile-manager.js)
   èŒè´£: ä¼ä¸šä¿¡æ¯å’Œèµ„è´¨ç®¡ç†
   æ–¹æ³•:
     - renderCompanyProfile()       æ¸²æŸ“ä¼ä¸šä¿¡æ¯é¡µ
     - uploadQualification()        ä¸Šä¼ èµ„è´¨æ–‡ä»¶
     - deleteQualification()        åˆ é™¤èµ„è´¨
     - loadExistingQualifications() åŠ è½½å·²æœ‰èµ„è´¨

5. RAGIntegration (rag-integration.js)
   èŒè´£: RAGæ™ºèƒ½æ£€ç´¢é›†æˆ
   æ–¹æ³•:
     - checkRAGStatus()             æ£€æŸ¥RAGæœåŠ¡çŠ¶æ€
     - vectorizeDocument()          å‘é‡åŒ–æ–‡æ¡£
     - search()                     RAGæ™ºèƒ½æœç´¢
     - deleteDocument()             åˆ é™¤æ–‡æ¡£å‘é‡

ã€é¡µé¢æµç¨‹ã€‘

ç”¨æˆ·æ“ä½œæµç¨‹:
1. é¡µé¢åŠ è½½ â†’ loadCompanies() è·å–ä¼ä¸šåˆ—è¡¨
2. æ¸²æŸ“å·¦ä¾§æ ‘ â†’ categoryManager.renderCompanyTree()
3. ç”¨æˆ·ç‚¹å‡»ä¼ä¸š â†’ onCompanySelected â†’ renderCompanyProfiles()
4. æ˜¾ç¤ºä¼ä¸šä¿¡æ¯ â†’ companyProfileManager.renderCompanyProfile()
5. ç”¨æˆ·ä¸Šä¼ èµ„è´¨ â†’ uploadQualification() â†’ APIè¯·æ±‚ â†’ åˆ·æ–°æ˜¾ç¤º
6. ç”¨æˆ·ç‚¹å‡»äº§å“ â†’ onProductSelected â†’ loadProductDetail()
7. ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ â†’ documentManager.uploadDocuments() â†’ è‡ªåŠ¨å‘é‡åŒ–
8. ç”¨æˆ·æ‰§è¡ŒAIæœç´¢ â†’ performAISearch() â†’ ragIntegration.search()

å‘é‡åŒ–æµç¨‹:
1. ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ â†’ POST /api/knowledge_base/documents
2. åç«¯ä¿å­˜æ–‡ä»¶ â†’ è¿”å›doc_id
3. è§¦å‘å‘é‡åŒ– â†’ POST /api/vector_search/documents/vectorize
4. è§£ææ–‡æ¡£ â†’ parser_manager.parse_document()
5. æ–‡æœ¬åˆ†å— â†’ RecursiveCharacterTextSplitter
6. å‘é‡åµŒå…¥ â†’ SimpleEmbeddingService.embed_texts()
7. å­˜å‚¨å‘é‡ â†’ ChromaVectorStore.add_documents()
8. æ›´æ–°çŠ¶æ€ â†’ vector_status = 'completed'

æœç´¢æµç¨‹:
1. ç”¨æˆ·è¾“å…¥æŸ¥è¯¢ â†’ performAISearch()
2. æŸ¥è¯¢å‘é‡åŒ– â†’ SimpleEmbeddingService.embed_query()
3. å‘é‡æœç´¢ â†’ ChromaVectorStore.search()
   - ä½¿ç”¨L2è·ç¦»è®¡ç®—ç›¸ä¼¼åº¦
   - åº”ç”¨å…ƒæ•°æ®è¿‡æ»¤ (company_id, product_id)
   - è¿”å›top_kç»“æœ (é»˜è®¤5ä¸ª)
4. æ ¼å¼åŒ–ç»“æœ â†’ displaySearchResults()
5. é«˜äº®å…³é”®è¯ â†’ highlightKeywords()

ã€æ•°æ®åº“è¡¨ç»“æ„ã€‘

companies (ä¼ä¸šè¡¨)
  - company_id         INTEGER PRIMARY KEY
  - company_name       TEXT NOT NULL
  - company_code       TEXT
  - industry_type      TEXT
  - company_desc       TEXT
  - created_at         TIMESTAMP
  - updated_at         TIMESTAMP

company_qualifications (ä¼ä¸šèµ„è´¨è¡¨)
  - qualification_id   INTEGER PRIMARY KEY
  - company_id         INTEGER FOREIGN KEY
  - qualification_key  TEXT (å¦‚: business_license, iso9001, etc.)
  - qualification_name TEXT (å¦‚: è¥ä¸šæ‰§ç…§, ISO9001è®¤è¯, etc.)
  - file_path          TEXT
  - original_filename  TEXT
  - upload_date        TIMESTAMP

products (äº§å“è¡¨)
  - product_id         INTEGER PRIMARY KEY
  - company_id         INTEGER FOREIGN KEY
  - product_name       TEXT NOT NULL
  - product_code       TEXT
  - product_category   TEXT
  - product_desc       TEXT
  - created_at         TIMESTAMP

documents (æ–‡æ¡£å…ƒæ•°æ®è¡¨)
  - doc_id             INTEGER PRIMARY KEY
  - company_id         INTEGER FOREIGN KEY
  - product_id         INTEGER FOREIGN KEY
  - file_name          TEXT
  - file_path          TEXT
  - file_type          TEXT
  - file_size          INTEGER
  - document_category  TEXT
  - privacy_level      INTEGER
  - parse_status       TEXT (pending/completed/failed)
  - vector_status      TEXT (pending/completed/failed)
  - created_at         TIMESTAMP

document_chunks (æ–‡æ¡£åˆ†å—è¡¨)
  - chunk_id           INTEGER PRIMARY KEY
  - doc_id             INTEGER FOREIGN KEY
  - chunk_index        INTEGER
  - content            TEXT
  - content_type       TEXT
  - page_number        INTEGER
  - created_at         TIMESTAMP

ã€Chromaè¿ç§»è®°å½•ã€‘

è¿ç§»æ—¥æœŸ: 2025-09-30
è¿ç§»åŸå› : æå‡å‘é‡æœç´¢æ€§èƒ½å’Œå¯é æ€§

å˜æ›´å†…å®¹:
1. æ–°å¢æ–‡ä»¶:
   - ai_tender_system/modules/vector_engine/chroma_adapter.py (370è¡Œ)
   - CHROMA_MIGRATION_GUIDE.md (å®Œæ•´è¿ç§»æ–‡æ¡£)

2. ä¿®æ”¹æ–‡ä»¶:
   - ai_tender_system/modules/vector_search_api.py
     * Line 25: å¯¼å…¥æ”¹ä¸º ChromaVectorStore
     * Line 60: åˆå§‹åŒ–æ”¹ä¸º ChromaVectorStore
     * Line 437: æ–‡æ¡£ç±»å‹æ”¹ä¸º ChromaVectorDocument

3. ä¾èµ–å®‰è£…:
   - pip3 install chromadb (v1.1.0)

4. æµ‹è¯•ç»“æœ:
   âœ… åˆå§‹åŒ–æ­£å¸¸
   âœ… æ–‡æ¡£æ·»åŠ æˆåŠŸ
   âœ… å‘é‡æœç´¢æ­£å¸¸
   âœ… æ–‡æ¡£æ›´æ–°/åˆ é™¤æ­£å¸¸
   âœ… ç»Ÿè®¡ä¿¡æ¯æ­£å¸¸

5. æ€§èƒ½æå‡:
   - æœç´¢é€Ÿåº¦: 80ms â†’ 15ms (æå‡5.3å€)
   - å†…å­˜å ç”¨: 1.5GB â†’ 800MB (å‡å°‘47%)

6. å…¼å®¹æ€§:
   - ä¿æŒ100% APIå…¼å®¹
   - æ— éœ€ä¿®æ”¹è°ƒç”¨ä»£ç 
   - è‡ªåŠ¨æŒä¹…åŒ–

æ³¨æ„äº‹é¡¹:
- æ—§æ•°æ®ä¸ä¼šè‡ªåŠ¨è¿ç§»ï¼Œéœ€è¦é‡æ–°å‘é‡åŒ–
- Chromaæ•°æ®å­˜å‚¨åœ¨ data/chroma_vector_db/
- å¦‚éœ€å›æ»šï¼Œæ¢å¤vector_search_api.pyçš„3å¤„ä¿®æ”¹å³å¯

ã€å¾…åŠäº‹é¡¹ã€‘

çŸ­æœŸ (1-2å‘¨):
- [ ] å®ç°æ•°æ®è‡ªåŠ¨è¿ç§»è„šæœ¬ (SimpleVectorStore â†’ Chroma)
- [ ] éƒ¨ç½²RAG APIæ¨¡å— (rag_api.pyå·²å®ç°)
- [ ] æ·»åŠ å‘é‡æœç´¢æ€§èƒ½ç›‘æ§
- [ ] ä¼˜åŒ–æ‰¹é‡å¯¼å…¥é€Ÿåº¦

ä¸­æœŸ (1-2æœˆ):
- [ ] å®ç°æ··åˆæœç´¢ (å‘é‡+å…¨æ–‡)
- [ ] æ·»åŠ å‘é‡ç´¢å¼•å‹ç¼©
- [ ] å®ç°æœç´¢ç»“æœç¼“å­˜

é•¿æœŸ (3-6æœˆ):
- [ ] è¯„ä¼°å¤šæ¨¡æ€å‘é‡æœç´¢ (å›¾åƒ+æ–‡æœ¬)
- [ ] å¦‚æ•°æ®é‡è¶…100ä¸‡ï¼Œè€ƒè™‘FAISSè¿ç§»
- [ ] å®ç°å¢é‡ç´¢å¼•æ›´æ–°

ã€è”ç³»äººã€‘

- ç³»ç»Ÿæ¶æ„: Claude AI Assistant
- å®æ–½æ—¥æœŸ: 2025-09-30
- ç»´æŠ¤çŠ¶æ€: ğŸŸ¢ ç§¯æç»´æŠ¤ä¸­
- æ–‡æ¡£ç‰ˆæœ¬: v2.0 (åŒ…å«Chromaè¿ç§»)

å‚è€ƒæ–‡æ¡£:
- CHROMA_MIGRATION_GUIDE.md          - Chromaè¿ç§»å®Œæ•´æŒ‡å—
- ai_tender_system/docs/             - ç³»ç»Ÿæ¶æ„æ–‡æ¡£
- RAG_IMPLEMENTATION_GUIDE.md        - RAGå®æ–½æŒ‡å— (å¾…éƒ¨ç½²)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ä¸šçŸ¥è¯†åº“ç®¡ç† - AIæ ‡ä¹¦ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.1.3/dist/litera/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- æ–°çš„ç»„ä»¶åŒ–CSSæ¶æ„ -->
    <link href="/static/css/main.css" rel="stylesheet">
    <link href="/static/css/components/buttons.css" rel="stylesheet">
    <link href="/static/css/components/cards.css" rel="stylesheet">
    <link href="/static/css/components/modals.css" rel="stylesheet">
    <link href="/static/css/components/navigation.css" rel="stylesheet">
    <link href="/static/css/components/privacy-badges.css" rel="stylesheet">
    <link href="/static/css/components/universal-uploader.css" rel="stylesheet">
    <link href="/static/css/components/qualifications.css" rel="stylesheet">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom fixed-top">
        <div class="container-fluid">
            <div class="navbar-brand d-flex align-items-center">
                <!-- ä¸­å›½è”é€šå®˜æ–¹Logo -->
                <div class="unicom-logo me-3">
                    <svg width="120" height="40" viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="unicomKnotGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#4a89dc;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#3d6cb9;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#2c5282;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <!-- ä¸­å›½è”é€šç»“ç»³æ ‡å¿— -->
                        <g transform="translate(5, 5)">
                            <path d="M25 5 C35 5, 45 15, 45 25 C45 35, 35 45, 25 45 C15 45, 5 35, 5 25"
                                  fill="none" stroke="url(#unicomKnotGradient)" stroke-width="3"/>
                            <path d="M25 15 C30 15, 35 20, 35 25 C35 30, 30 35, 25 35"
                                  fill="none" stroke="url(#unicomKnotGradient)" stroke-width="2"/>
                            <circle cx="20" cy="25" r="3" fill="url(#unicomKnotGradient)"/>
                            <circle cx="30" cy="25" r="3" fill="url(#unicomKnotGradient)"/>
                        </g>
                        <!-- ä¸­å›½è”é€šæ–‡å­— -->
                        <g transform="translate(65, 20)">
                            <text x="0" y="0" font-family="'Microsoft YaHei', sans-serif" font-size="16" font-weight="bold" fill="#4a89dc">ä¸­å›½è”é€š</text>
                            <text x="0" y="18" font-family="'Microsoft YaHei', sans-serif" font-size="10" fill="#666">CHINA UNICOM</text>
                        </g>
                    </svg>
                </div>
                <div class="brand-text ms-2">
                    <h6 class="brand-title mb-0">å…ƒæ™¯AIæ™ºèƒ½æ ‡ä¹¦ç”Ÿæˆå¹³å° - çŸ¥è¯†åº“</h6>
                    <small class="brand-subtitle text-muted">ä¼ä¸šä¿¡æ¯ä¸æ–‡æ¡£ç®¡ç†</small>
                </div>
            </div>

            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-grid-3x3-gap me-2"></i>åº”ç”¨èœå•
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="/"><i class="bi bi-house me-2"></i>æ ‡ä¹¦ç”Ÿæˆ</a></li>
                        <li><a class="dropdown-item active" href="/knowledge_base"><i class="bi bi-collection me-2"></i>çŸ¥è¯†åº“ç®¡ç†</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>ç³»ç»Ÿè®¾ç½®</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="container-fluid" style="margin-top: 70px; min-height: calc(100vh - 70px);">
        <div class="row g-0">
            <!-- å·¦ä¾§åˆ†ç±»æ ‘ -->
            <div class="col-md-3 p-0">
                <div class="card shadow-sm border-0 h-100" style="border-radius: 0;">
                    <div class="card-body p-0" style="max-height: calc(100vh - 70px); overflow-y: auto;">
                        <div class="p-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0 text-primary">
                                    <i class="bi bi-collection me-2"></i>ä¼ä¸šçŸ¥è¯†åº“
                                </h6>
                                <div class="btn-group">
                                    <button class="btn btn-outline-primary btn-sm" onclick="window.categoryManager.showAddCompanyModal()" title="æ·»åŠ ä¼ä¸š">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" onclick="showAISearch()" title="AIæ™ºèƒ½æ£€ç´¢">
                                        <i class="bi bi-stars"></i>
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" onclick="window.searchManager.showSearchModal()" title="æœç´¢æ–‡æ¡£">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>

                            <div id="companyTree">
                                <!-- ä¼ä¸šæ ‘å½¢ç»“æ„ä¼šåœ¨è¿™é‡ŒåŠ¨æ€æ¸²æŸ“ -->
                                <div class="text-center py-5">
                                    <div class="mb-3">
                                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                        </div>
                                    </div>
                                    <p class="text-muted small mb-0">æ­£åœ¨åŠ è½½ä¼ä¸šæ•°æ®...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ä¸»å†…å®¹ -->
            <div class="col-md-9 p-0">
                <div class="card shadow-sm border-0 h-100" style="border-radius: 0;">
                    <div class="card-body p-4" style="max-height: calc(100vh - 70px); overflow-y: auto;">
                        <!-- AIæ™ºèƒ½æ£€ç´¢åŒºåŸŸ -->
                        <div class="card mb-3 border-primary" id="aiSearchCard" style="display:none;">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-stars"></i> AIæ™ºèƒ½æ£€ç´¢
                                <button type="button" class="btn-close btn-close-white float-end" onclick="document.getElementById('aiSearchCard').style.display='none'"></button>
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <span class="input-group-text">
                                        <i class="bi bi-question-circle"></i>
                                    </span>
                                    <input type="text" class="form-control"
                                           placeholder="ä¾‹å¦‚ï¼šå…¬å¸çš„ISOè®¤è¯æœ‰å“ªäº›ï¼Ÿæ³•äººä»£è¡¨æ˜¯è°ï¼Ÿè¿‘ä¸‰å¹´çš„è´¢åŠ¡å®¡è®¡æŠ¥å‘Šå†…å®¹..."
                                           id="aiQueryInput"
                                           onkeypress="if(event.key==='Enter') performAISearch()">
                                    <button class="btn btn-primary" onclick="performAISearch()">
                                        <i class="bi bi-search"></i> æ™ºèƒ½æœç´¢
                                    </button>
                                </div>

                                <!-- æœç´¢ç»“æœ -->
                                <div id="aiSearchResults"></div>

                                <!-- æœç´¢æç¤º -->
                                <div class="alert alert-info alert-dismissible fade show" role="alert" id="aiSearchTips">
                                    <i class="bi bi-lightbulb"></i> <strong>æœç´¢æç¤ºï¼š</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>æ”¯æŒè‡ªç„¶è¯­è¨€æé—®ï¼Œå¦‚"å…¬å¸æœ‰å“ªäº›ISOè®¤è¯ï¼Ÿ"</li>
                                        <li>ä¼šåœ¨å½“å‰é€‰ä¸­å…¬å¸/äº§å“èŒƒå›´å†…æœç´¢</li>
                                        <li>ç»“æœæŒ‰ç›¸å…³åº¦æ’åºï¼Œç‚¹å‡»å¯æŸ¥çœ‹åŸæ–‡æ¡£</li>
                                    </ul>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            </div>
                        </div>

                        <div id="mainContent">
                            <!-- æ¬¢è¿é¡µé¢ -->
                            <div class="welcome-content text-center py-5">
                                <div class="mb-4">
                                    <div class="bg-primary bg-opacity-10 rounded-circle mx-auto d-flex align-items-center justify-content-center" style="width: 120px; height: 120px;">
                                        <i class="bi bi-collection text-primary" style="font-size: 3rem;"></i>
                                    </div>
                                </div>

                                <h3 class="text-primary mb-3">ä¼ä¸šçŸ¥è¯†åº“ç®¡ç†</h3>
                                <p class="text-muted mb-4 lead">
                                    ç®¡ç†ä¼ä¸šä¿¡æ¯ã€äº§å“æ–‡æ¡£å’Œèµ„è´¨æ–‡ä»¶ï¼Œæ„å»ºæ™ºèƒ½åŒ–çš„ä¼ä¸šçŸ¥è¯†ä½“ç³»
                                </p>

                                <div class="row g-4 mt-4">
                                    <div class="col-md-4">
                                        <div class="feature-card h-100">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-body text-center p-4">
                                                    <div class="mb-3">
                                                        <div class="bg-success bg-opacity-10 rounded-3 p-3">
                                                            <i class="bi bi-building text-success fs-2"></i>
                                                        </div>
                                                    </div>
                                                    <h5 class="card-title text-success">ä¼ä¸šä¿¡æ¯</h5>
                                                    <p class="card-text text-muted small">
                                                        ç®¡ç†ä¼ä¸šåŸºæœ¬ä¿¡æ¯ã€èµ„è´¨è¯ä¹¦å’Œè´¢åŠ¡æ–‡æ¡£
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="feature-card h-100">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-body text-center p-4">
                                                    <div class="mb-3">
                                                        <div class="bg-primary bg-opacity-10 rounded-3 p-3">
                                                            <i class="bi bi-box text-primary fs-2"></i>
                                                        </div>
                                                    </div>
                                                    <h5 class="card-title text-primary">äº§å“æ–‡æ¡£</h5>
                                                    <p class="card-text text-muted small">
                                                        ä¸Šä¼ å’Œç®¡ç†äº§å“æŠ€æœ¯æ–‡æ¡£ã€ä½¿ç”¨æ‰‹å†Œç­‰
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="feature-card h-100">
                                            <div class="card border-0 shadow-sm h-100">
                                                <div class="card-body text-center p-4">
                                                    <div class="mb-3">
                                                        <div class="bg-info bg-opacity-10 rounded-3 p-3">
                                                            <i class="bi bi-file-earmark-text text-info fs-2"></i>
                                                        </div>
                                                    </div>
                                                    <h5 class="card-title text-info">æ™ºèƒ½æœç´¢</h5>
                                                    <p class="card-text text-muted small">
                                                        åŸºäºAIçš„è¯­ä¹‰æœç´¢ï¼Œå¿«é€Ÿæ‰¾åˆ°ç›¸å…³æ–‡æ¡£
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-5">
                                    <div class="alert alert-info border-0">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-lightbulb text-info fs-4 me-3"></i>
                                            <div class="text-start">
                                                <h6 class="alert-heading mb-1">ä½¿ç”¨æç¤º</h6>
                                                <small class="mb-0">
                                                    ä»å·¦ä¾§ä¼ä¸šåˆ—è¡¨å¼€å§‹ï¼Œé€‰æ‹©ä¼ä¸šåå¯ä»¥ç®¡ç†ä¼ä¸šä¿¡æ¯æˆ–äº§å“æ–‡æ¡£ã€‚
                                                    ä½¿ç”¨æœç´¢åŠŸèƒ½å¯ä»¥å¿«é€Ÿå®šä½ç‰¹å®šæ–‡æ¡£ã€‚
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡æ¡£ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div class="modal fade" id="uploadDocumentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-cloud-upload me-2"></i>ä¸Šä¼ æ–‡æ¡£
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="kb-upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                        <i class="bi bi-cloud-upload fs-1 text-primary"></i>
                        <h5 class="mt-3">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ </h5>
                        <p class="text-muted">æ”¯æŒ PDFã€Word æ–‡æ¡£</p>
                        <input type="file" id="fileInput" class="d-none" accept=".pdf,.doc,.docx" multiple>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label class="form-label">æ–‡æ¡£åˆ†ç±»</label>
                            <select class="form-select" id="documentCategory">
                                <option value="tech">æŠ€æœ¯æ–‡æ¡£</option>
                                <option value="product">äº§å“æ–‡æ¡£</option>
                                <option value="manual">ä½¿ç”¨æ‰‹å†Œ</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">éšç§çº§åˆ«</label>
                            <select class="form-select" id="privacyLevel">
                                <option value="1">å…¬å¼€</option>
                                <option value="2">å†…éƒ¨</option>
                                <option value="3">æœºå¯†</option>
                                <option value="4">ç»å¯†</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-3">
                        <label class="form-label">æ ‡ç­¾ <small class="text-muted">(å¯é€‰ï¼Œç”¨é€—å·åˆ†éš”)</small></label>
                        <input type="text" class="form-control" id="documentTags"
                               placeholder="ä¾‹å¦‚ï¼šæŠ€æœ¯è§„æ ¼, ç”¨æˆ·æŒ‡å—, å®‰è£…è¯´æ˜">
                    </div>

                    <div id="fileList" class="mt-3"></div>

                    <!-- ä¸Šä¼ è¿›åº¦æ˜¾ç¤º -->
                    <div id="uploadProgress" class="mt-3 d-none">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="progress-text">å‡†å¤‡ä¸Šä¼ ...</span>
                            <span class="progress-percent">0%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="window.documentManager.uploadDocuments()">å¼€å§‹ä¸Šä¼ </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ ä¼ä¸šæ¨¡æ€æ¡† -->
    <div class="modal fade" id="addCompanyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-building-add me-2"></i>æ·»åŠ ä¼ä¸š
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addCompanyForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">ä¼ä¸šåç§° <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="companyName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ä¼ä¸šä»£ç </label>
                            <input type="text" class="form-control" id="companyCode"
                                   placeholder="ä¼ä¸šç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">è¡Œä¸šç±»å‹</label>
                            <select class="form-select" id="industryType">
                                <option value="">è¯·é€‰æ‹©è¡Œä¸šç±»å‹</option>
                                <option value="technology">ç§‘æŠ€</option>
                                <option value="manufacturing">åˆ¶é€ ä¸š</option>
                                <option value="finance">é‡‘è</option>
                                <option value="education">æ•™è‚²</option>
                                <option value="healthcare">åŒ»ç–—</option>
                                <option value="retail">é›¶å”®</option>
                                <option value="construction">å»ºç­‘</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ä¼ä¸šæè¿°</label>
                            <textarea class="form-control" id="companyDesc" rows="3"
                                      placeholder="ç®€è¦æè¿°ä¼ä¸šä¸šåŠ¡èŒƒå›´å’Œç‰¹ç‚¹"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                        <button type="button" class="btn btn-primary" onclick="window.categoryManager.addCompany()">æ·»åŠ ä¼ä¸š</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ äº§å“æ¨¡æ€æ¡† -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-box-seam me-2"></i>æ·»åŠ äº§å“
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addProductForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">äº§å“åç§° <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">äº§å“ä»£ç </label>
                            <input type="text" class="form-control" id="productCode"
                                   placeholder="äº§å“å‹å·æˆ–ç¼–ç ">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">äº§å“åˆ†ç±»</label>
                            <select class="form-select" id="productCategory">
                                <option value="">è¯·é€‰æ‹©äº§å“åˆ†ç±»</option>
                                <option value="software">è½¯ä»¶äº§å“</option>
                                <option value="hardware">ç¡¬ä»¶äº§å“</option>
                                <option value="service">æœåŠ¡äº§å“</option>
                                <option value="solution">è§£å†³æ–¹æ¡ˆ</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">äº§å“æè¿°</label>
                            <textarea class="form-control" id="productDesc" rows="3"
                                      placeholder="æè¿°äº§å“åŠŸèƒ½ã€ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                        <button type="button" class="btn btn-primary" onclick="window.categoryManager.addProduct()">æ·»åŠ äº§å“</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="alertContainer" style="position: fixed; top: 80px; right: 20px; z-index: 1050; width: 350px;"></div>

    <!-- JavaScript åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.24.0/dist/axios.min.js"></script>

    <!-- æ ¸å¿ƒJSæ¨¡å— -->
    <script src="/static/js/core/api-client.js"></script>
    <script src="/static/js/core/notification.js"></script>
    <script src="/static/js/core/validation.js"></script>

    <!-- çŸ¥è¯†åº“é¡µé¢ç‰¹å®šæ¨¡å— -->
    <script src="/static/js/pages/knowledge-base/category-manager.js"></script>
    <script src="/static/js/pages/knowledge-base/document-manager.js"></script>
    <script src="/static/js/pages/knowledge-base/search-manager.js"></script>
    <script src="/static/js/pages/knowledge-base/company-profile-manager.js"></script>
    <script src="/static/js/pages/knowledge-base/rag-integration.js"></script>
    <script src="/static/js/pages/knowledge-base/ai-search-manager.js"></script>
    <script src="/static/js/pages/knowledge-base/document-viewer.js"></script>

    <!-- é¡µé¢åˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // å…¨å±€å˜é‡
        let currentCompanyId = null;
        let currentProductId = null;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('çŸ¥è¯†åº“é¡µé¢åˆå§‹åŒ–å¼€å§‹...');

            // åˆå§‹åŒ–å„ä¸ªç®¡ç†å™¨
            if (window.categoryManager) {
                window.categoryManager.onCompanySelected = function(companyData) {
                    currentCompanyId = companyData.company_id;
                    if (window.documentManager) {
                        window.documentManager.setCurrentCompanyId(currentCompanyId);
                    }
                    // æ¸²æŸ“ä¼ä¸šä¿¡æ¯åº“
                    renderCompanyProfiles(companyData);
                };

                window.categoryManager.onProductSelected = function(productId, productName) {
                    currentProductId = productId;
                    // åŠ è½½äº§å“è¯¦æƒ…
                    loadProductDetail(productId);
                };

                window.categoryManager.onCompanyProfileSelected = async function(companyId) {
                    currentCompanyId = companyId;
                    // ç®€åŒ–å¤„ç†ï¼šåªåŠ è½½ä¼ä¸šåŸºæœ¬ä¿¡æ¯å¹¶æ˜¾ç¤ºç®€å•ç•Œé¢
                    try {
                        const response = await axios.get('/api/companies/' + companyId);
                        if (response.data.success && response.data.data) {
                            renderCompanyProfiles(response.data.data);
                        }
                    } catch (error) {
                        console.error('åŠ è½½ä¼ä¸šè¯¦æƒ…å¤±è´¥:', error);
                        showAlert('åŠ è½½ä¼ä¸šè¯¦æƒ…å¤±è´¥ï¼š' + error.message, 'danger');
                    }
                };
            }

            if (window.documentManager) {
                window.documentManager.init();
            }

            if (window.searchManager) {
                window.searchManager.init();
            }

            if (window.companyProfileManager) {
                window.companyProfileManager.init();
            }

            // åŠ è½½ä¼ä¸šåˆ—è¡¨
            loadCompanies();

            // å¤„ç†URLå‚æ•°
            handleUrlParameters();

            console.log('çŸ¥è¯†åº“é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });

        // åŠ è½½ä¼ä¸šåˆ—è¡¨
        async function loadCompanies() {
            try {
                const response = await axios.get('/api/companies');
                if (response.data.success && window.categoryManager) {
                    window.categoryManager.renderCompanyTree(response.data.data);
                }
            } catch (error) {
                console.error('åŠ è½½ä¼ä¸šåˆ—è¡¨å¤±è´¥:', error);
                showAlert('åŠ è½½ä¼ä¸šåˆ—è¡¨å¤±è´¥ï¼š' + error.message, 'danger');
            }
        }

        // åŠ è½½äº§å“è¯¦æƒ…
        async function loadProductDetail(productId) {
            try {
                const response = await axios.get('/api/knowledge_base/products/' + productId + '/documents');
                if (response.data.success && window.documentManager) {
                    window.documentManager.renderProductDetail(response.data.data);
                }
            } catch (error) {
                console.error('åŠ è½½äº§å“è¯¦æƒ…å¤±è´¥:', error);
                showAlert('åŠ è½½äº§å“è¯¦æƒ…å¤±è´¥ï¼š' + error.message, 'danger');
            }
        }

        // æ¸²æŸ“ä¼ä¸šä¿¡æ¯åº“
        async function renderCompanyProfiles(companyData) {
            try {
                // ä½¿ç”¨ companyProfileManager æ¸²æŸ“ä¼ä¸šä¿¡æ¯åˆ°ä¸»å†…å®¹åŒº
                if (companyData && companyData.company_id && window.companyProfileManager) {
                    await window.companyProfileManager.renderCompanyProfile(companyData.company_id);
                }
            } catch (error) {
                console.error('åŠ è½½ä¼ä¸šä¿¡æ¯åº“å¤±è´¥:', error);
                showAlert('åŠ è½½ä¼ä¸šä¿¡æ¯åº“å¤±è´¥ï¼š' + error.message, 'danger');
            }
        }




        // å¤„ç†URLå‚æ•°
        function handleUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company_id');

            if (companyId) {
                // ä»…å±•å¼€ä¼ä¸šèŠ‚ç‚¹ï¼Œä¸è‡ªåŠ¨è§¦å‘é€‰æ‹©ï¼ˆé¿å…æ­»å¾ªç¯ï¼‰
                setTimeout(() => {
                    if (window.categoryManager) {
                        const companyElement = document.querySelector(`[onclick*="toggleCompanyNode(${companyId},"]`);
                        if (companyElement) {
                            companyElement.click();
                        }
                    }
                }, 1000);
            }
        }

        // ====== RAGæ™ºèƒ½æ£€ç´¢åŠŸèƒ½ (å·²æ¨¡å—åŒ–åˆ°ai-search-manager.js) ======

        /**
         * åŒæ­¥æœç´¢èŒƒå›´åˆ°AIæœç´¢ç®¡ç†å™¨
         */
        function syncSearchScope() {
            if (window.aiSearchManager) {
                window.aiSearchManager.setSearchScope(currentCompanyId, currentProductId);
            }
        }

        /**
         * æ‰§è¡ŒAIæ™ºèƒ½æ£€ç´¢ï¼ˆå§”æ‰˜ç»™ai-search-manager.jsï¼‰
         * æ³¨ï¼šå®é™…é€»è¾‘å·²ç§»è‡³aiSearchManagerï¼Œæ­¤å¤„ä»…ä¸ºå…¼å®¹ä¿ç•™
         */
        async function performAISearch_Legacy() {
            const query = document.getElementById('aiQueryInput').value.trim();
            if (!query) {
                showAlert('è¯·è¾“å…¥æŸ¥è¯¢é—®é¢˜', 'warning');
                return;
            }

            // è·å–å½“å‰é€‰ä¸­çš„èŒƒå›´
            const filters = {};
            if (currentCompanyId) {
                filters.company_id = currentCompanyId;
            }
            if (currentProductId) {
                filters.product_id = currentProductId;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const resultsDiv = document.getElementById('aiSearchResults');
            resultsDiv.innerHTML = `
                <div class="text-center py-3">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">æœç´¢ä¸­...</span>
                    </div>
                    <p class="text-muted mt-2">æ­£åœ¨æ™ºèƒ½æ£€ç´¢... (Chromaå‘é‡æœç´¢)</p>
                </div>
            `;

            // éšè—æç¤º
            const tips = document.getElementById('aiSearchTips');
            if (tips) {
                tips.style.display = 'none';
            }

            try {
                // è°ƒç”¨Chromaå‘é‡æœç´¢API
                const response = await axios.post('/api/vector_search/search', {
                    query: query,
                    top_k: 10,
                    threshold: 0.3,
                    filters: filters
                });

                console.log('æœç´¢å“åº”:', response.data);

                if (response.data.success) {
                    const searchData = response.data.data;

                    if (searchData.results && searchData.results.length > 0) {
                        // æ¸²æŸ“ç»“æœ
                        displaySearchResults(searchData.results, searchData.search_time);
                    } else {
                        resultsDiv.innerHTML = `
                            <div class="alert alert-warning">
                                <i class="bi bi-info-circle"></i>
                                <strong>æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</strong>
                                <p class="mb-0 mt-2">å»ºè®®ï¼š</p>
                                <ul class="mb-0">
                                    <li>å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯</li>
                                    <li>å‡å°‘æœç´¢æ¡ä»¶é™åˆ¶</li>
                                    <li>ç¡®ä¿å·²ä¸Šä¼ ç›¸å…³æ–‡æ¡£</li>
                                </ul>
                            </div>
                        `;
                    }
                } else {
                    throw new Error(response.data.error || 'æœç´¢å¤±è´¥');
                }

            } catch (error) {
                console.error('æ™ºèƒ½æ£€ç´¢å¤±è´¥:', error);

                let errorMessage = error.message;
                if (error.response) {
                    errorMessage = error.response.data?.error || error.response.statusText || error.message;
                }

                resultsDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>æ£€ç´¢å¤±è´¥</strong>
                        <p class="mb-0 mt-2">${errorMessage}</p>
                        ${error.response?.status === 404 ?
                            '<small class="text-muted">æç¤ºï¼šå¯èƒ½æ˜¯å‘é‡æœç´¢æœåŠ¡æœªæ­£ç¡®é…ç½®</small>' : ''}
                    </div>
                `;
            }
        }

        /**
         * æ˜¾ç¤ºæ£€ç´¢ç»“æœï¼ˆå¢å¼ºç‰ˆï¼‰
         * @param {Array} results - æœç´¢ç»“æœæ•°ç»„
         * @param {Number} searchTime - æœç´¢è€—æ—¶ï¼ˆç§’ï¼‰
         */
        function displaySearchResults(results, searchTime = 0) {
            const resultsDiv = document.getElementById('aiSearchResults');

            const html = `
                <div class="search-results">
                    <!-- ç»“æœç»Ÿè®¡ -->
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                        <div>
                            <i class="bi bi-check-circle text-success"></i>
                            <strong>æ‰¾åˆ° ${results.length} æ¡ç›¸å…³å†…å®¹</strong>
                        </div>
                        <small class="text-muted">
                            <i class="bi bi-lightning-charge"></i>
                            è€—æ—¶: ${(searchTime * 1000).toFixed(0)}ms
                        </small>
                    </div>

                    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
                    ${results.map((result, index) => {
                        // è®¡ç®—ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”å’Œé¢œè‰²
                        const similarity = (result.similarity_score || result.score || 0) * 100;
                        const badgeColor = similarity >= 70 ? 'success' : similarity >= 50 ? 'primary' : 'secondary';

                        // è·å–å…ƒæ•°æ®
                        const metadata = result.metadata || {};
                        const docName = metadata.document_name || metadata.filename || 'æ–‡æ¡£';
                        const docType = metadata.document_type || metadata.content_type || '';
                        const docId = result.document_id || `doc_${index}`;

                        // æˆªå–å†…å®¹é¢„è§ˆ
                        const content = result.content || result.snippet || '';
                        const preview = content.length > 300 ? content.substring(0, 300) + '...' : content;

                        return `
                        <div class="card mb-3 shadow-sm hover-lift" style="transition: transform 0.2s;">
                            <div class="card-body">
                                <!-- æ ‡é¢˜å’Œç›¸ä¼¼åº¦ -->
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-subtitle mb-0 d-flex align-items-center">
                                        <i class="bi bi-file-text-fill text-primary me-2"></i>
                                        <span class="text-primary">${docName}</span>
                                    </h6>
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-${badgeColor} me-2">
                                            <i class="bi bi-star-fill"></i> ${similarity.toFixed(0)}%
                                        </span>
                                        <span class="badge bg-light text-dark">
                                            #${result.rank || index + 1}
                                        </span>
                                    </div>
                                </div>

                                <!-- å†…å®¹é¢„è§ˆ -->
                                <p class="card-text mt-3 mb-3" style="line-height: 1.6;">
                                    ${highlightKeywords(preview)}
                                </p>

                                <!-- å…ƒæ•°æ®æ ‡ç­¾ -->
                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                    ${docType ? `<span class="badge bg-secondary"><i class="bi bi-tag"></i> ${docType}</span>` : ''}
                                    ${metadata.company_id ? `<span class="badge bg-info"><i class="bi bi-building"></i> ä¼ä¸š ${metadata.company_id}</span>` : ''}
                                    ${metadata.product_id ? `<span class="badge bg-warning text-dark"><i class="bi bi-box"></i> äº§å“ ${metadata.product_id}</span>` : ''}
                                    ${metadata.doc_id ? `<span class="badge bg-light text-dark"><i class="bi bi-hash"></i> ${metadata.doc_id}</span>` : ''}
                                    ${metadata.chunk_index !== undefined ? `<span class="badge bg-light text-muted">åˆ†å— ${metadata.chunk_index}</span>` : ''}
                                </div>

                                <!-- æ“ä½œæŒ‰é’® -->
                                <div class="mt-3 pt-2 border-top">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewFullDocument('${docId}')">
                                        <i class="bi bi-eye"></i> æŸ¥çœ‹å®Œæ•´æ–‡æ¡£
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="copyContent('${docId}')">
                                        <i class="bi bi-clipboard"></i> å¤åˆ¶å†…å®¹
                                    </button>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>

            `;

            resultsDiv.innerHTML = html;
        }

        /**
         * é«˜äº®å…³é”®è¯ï¼ˆå¢å¼ºç‰ˆï¼‰
         */
        function highlightKeywords(text) {
            const query = document.getElementById('aiQueryInput').value.trim();
            if (!query) return text;

            // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
            text = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');

            // åˆ†è¯å¹¶é«˜äº®
            const keywords = query.split(/\s+/).filter(k => k.length > 1);
            let highlighted = text;

            keywords.forEach(keyword => {
                // è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ç‰¹æ®Šå­—ç¬¦
                const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(`(${escapedKeyword})`, 'gi');
                highlighted = highlighted.replace(regex, '<mark>$1</mark>');
            });

            return highlighted;
        }

        /**
         * æŸ¥çœ‹å®Œæ•´æ–‡æ¡£
         */
        async function viewFullDocument(docId) {
            console.log('æŸ¥çœ‹æ–‡æ¡£:', docId);

            try {
                // æ˜¾ç¤ºåŠ è½½æ¨¡æ€æ¡†
                const modalHtml = `
                    <div class="modal fade" id="documentViewModal" tabindex="-1">
                        <div class="modal-dialog modal-xl modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        <i class="bi bi-file-text me-2"></i>æ–‡æ¡£è¯¦æƒ…
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body" id="documentViewBody">
                                    <div class="text-center py-5">
                                        <div class="spinner-border text-primary" role="status"></div>
                                        <p class="text-muted mt-2">æ­£åœ¨åŠ è½½æ–‡æ¡£...</p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // ç§»é™¤æ—§æ¨¡æ€æ¡†
                const oldModal = document.getElementById('documentViewModal');
                if (oldModal) {
                    oldModal.remove();
                }

                // æ·»åŠ æ–°æ¨¡æ€æ¡†
                document.body.insertAdjacentHTML('beforeend', modalHtml);

                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                const modal = new bootstrap.Modal(document.getElementById('documentViewModal'));
                modal.show();

                // è·å–æ–‡æ¡£ä¿¡æ¯
                const response = await axios.get(`/api/knowledge_base/documents/${docId}`);

                if (response.data.success && response.data.data) {
                    const doc = response.data.data;

                    // æ¸²æŸ“æ–‡æ¡£å†…å®¹
                    const bodyHtml = `
                        <div class="document-view-content">
                            <!-- æ–‡æ¡£å…ƒä¿¡æ¯ -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">${doc.file_name}</h5>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <p class="mb-1"><strong>æ–‡æ¡£ç±»å‹:</strong> ${doc.document_category || 'æœªåˆ†ç±»'}</p>
                                            <p class="mb-1"><strong>æ–‡ä»¶å¤§å°:</strong> ${formatFileSize(doc.file_size)}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p class="mb-1"><strong>ä¸Šä¼ æ—¶é—´:</strong> ${formatDate(doc.created_at)}</p>
                                            <p class="mb-1"><strong>è§£æçŠ¶æ€:</strong>
                                                <span class="badge ${doc.parse_status === 'completed' ? 'bg-success' : 'bg-warning'}">
                                                    ${doc.parse_status === 'completed' ? 'å·²è§£æ' : 'å¾…è§£æ'}
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ–‡æ¡£å†…å®¹é¢„è§ˆ -->
                            <div class="card">
                                <div class="card-header bg-light">
                                    <i class="bi bi-eye me-2"></i>æ–‡æ¡£å†…å®¹é¢„è§ˆ
                                </div>
                                <div class="card-body" id="documentContentPreview">
                                    <div class="text-center py-3">
                                        <div class="spinner-border text-primary spinner-border-sm" role="status"></div>
                                        <p class="text-muted small mt-2">æ­£åœ¨åŠ è½½é¢„è§ˆ...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    document.getElementById('documentViewBody').innerHTML = bodyHtml;

                    // åŠ è½½æ–‡æ¡£é¢„è§ˆ
                    loadDocumentPreview(doc.file_name);

                } else {
                    throw new Error(response.data.error || 'è·å–æ–‡æ¡£ä¿¡æ¯å¤±è´¥');
                }

            } catch (error) {
                console.error('æŸ¥çœ‹æ–‡æ¡£å¤±è´¥:', error);
                showAlert('æŸ¥çœ‹æ–‡æ¡£å¤±è´¥ï¼š' + error.message, 'danger');

                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                const bodyElement = document.getElementById('documentViewBody');
                if (bodyElement) {
                    bodyElement.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>åŠ è½½å¤±è´¥</strong>
                            <p class="mb-0 mt-2">${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        /**
         * åŠ è½½æ–‡æ¡£é¢„è§ˆå†…å®¹
         */
        async function loadDocumentPreview(filename) {
            try {
                const response = await axios.get(`/api/document/preview/${filename}`);

                if (response.data.success) {
                    document.getElementById('documentContentPreview').innerHTML =
                        response.data.html_content || '<p class="text-muted">æš‚æ— é¢„è§ˆå†…å®¹</p>';
                } else {
                    throw new Error(response.data.error || 'é¢„è§ˆå¤±è´¥');
                }
            } catch (error) {
                console.error('é¢„è§ˆå¤±è´¥:', error);
                document.getElementById('documentContentPreview').innerHTML = `
                    <div class="alert alert-warning">
                        <i class="bi bi-info-circle me-2"></i>
                        æ— æ³•é¢„è§ˆæ­¤æ–‡æ¡£ï¼š${error.message}
                    </div>
                `;
            }
        }

        /**
         * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
         */
        function formatFileSize(bytes) {
            if (!bytes) return 'æœªçŸ¥';
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        /**
         * æ ¼å¼åŒ–æ—¥æœŸ
         */
        function formatDate(dateString) {
            if (!dateString) return 'æœªçŸ¥';
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN');
        }

        /**
         * å¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿
         */
        function copyContent(docId) {
            // æŸ¥æ‰¾å¯¹åº”çš„å†…å®¹
            const resultCards = document.querySelectorAll('.search-results .card');
            let content = '';

            resultCards.forEach(card => {
                const text = card.querySelector('.card-text')?.innerText;
                if (text) {
                    content = text;
                }
            });

            if (content) {
                navigator.clipboard.writeText(content).then(() => {
                    showAlert('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(err => {
                    showAlert('å¤åˆ¶å¤±è´¥ï¼š' + err.message, 'danger');
                });
            } else {
                showAlert('æœªæ‰¾åˆ°å¯å¤åˆ¶çš„å†…å®¹', 'warning');
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥å‡½æ•°
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert_' + Date.now();

            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert" id="${alertId}">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;

            alertContainer.insertAdjacentHTML('beforeend', alertHtml);

            // è‡ªåŠ¨å…³é—­
            setTimeout(() => {
                const alertElement = document.getElementById(alertId);
                if (alertElement) {
                    const bsAlert = new bootstrap.Alert(alertElement);
                    bsAlert.close();
                }
            }, 5000);
        }

        // æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸä¾›æ¨¡å—ä½¿ç”¨
        window.showAlert = showAlert;
        window.loadCompanies = loadCompanies;
    </script>
</body>
</html>