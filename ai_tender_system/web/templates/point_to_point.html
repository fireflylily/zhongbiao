<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>点对点应答系统 - AI标书智能生成系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .upload-area {
            border: 2px dashed #007bff;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            background-color: #f8f9fa;
            border-color: #0056b3;
        }
        .upload-area.dragover {
            background-color: #e3f2fd;
            border-color: #1976d2;
        }
        .feature-card {
            transition: transform 0.2s;
        }
        .feature-card:hover {
            transform: translateY(-2px);
        }
        .progress {
            display: none;
        }
        .footer {
            margin-top: 50px;
            padding: 20px 0;
            border-top: 1px solid #dee2e6;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- 页面标题 -->
        <div class="row">
            <div class="col-12">
                <div class="text-center mb-5">
                    <h1 class="display-4 text-primary">
                        <i class="bi bi-chat-dots"></i> 点对点应答系统
                    </h1>
                    <p class="lead text-muted">智能识别采购需求，自动生成专业技术应答</p>
                </div>
            </div>
        </div>

        <!-- 导航菜单 -->
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-pills nav-justified mb-4" id="mainNav">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html">
                            <i class="bi bi-house"></i> 首页
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tender_info.html">
                            <i class="bi bi-search"></i> 读取信息
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/business_response.html">
                            <i class="bi bi-briefcase"></i> 商务应答
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/point_to_point.html">
                            <i class="bi bi-chat-dots"></i> 点对点应答
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tech_proposal.html">
                            <i class="bi bi-file-earmark-code"></i> 技术方案
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 页面内容 -->
        <div class="row">
            <div class="col-12">
                <!-- 当前公司信息显示 -->
                <div class="row mb-3" id="pointToPointCompanyInfo" style="display: none;">
                    <div class="col-12">
                        <div class="alert alert-info d-flex align-items-center">
                            <i class="bi bi-building me-2"></i>
                            <span>当前应答公司: <strong id="pointToPointCompanyName"></strong></span>
                            <a href="/company_selection.html" class="btn btn-outline-primary btn-sm ms-auto">
                                <i class="bi bi-pencil"></i> 切换公司
                            </a>
                        </div>
                    </div>
                </div>

                <!-- 未选择公司时的提示 -->
                <div class="row mb-3" id="pointToPointNoCompany">
                    <div class="col-12">
                        <div class="alert alert-warning d-flex align-items-center">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <span>请先选择应答公司</span>
                            <a href="/company_selection.html" class="btn btn-warning btn-sm ms-auto">
                                <i class="bi bi-building"></i> 选择公司
                            </a>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-upload"></i> 文档上传处理</h5>
                            </div>
                            <div class="card-body">
                                <form id="uploadForm" enctype="multipart/form-data">
                                    <div class="upload-area" id="uploadArea">
                                        <i class="bi bi-cloud-upload text-primary" style="font-size: 3rem;"></i>
                                        <h4 class="mt-3">拖拽文档到这里或点击选择</h4>
                                        <p class="text-muted">支持 .docx 和 .doc 格式，最大 50MB</p>
                                        <input type="file" class="d-none" id="fileInput" name="file" accept=".docx,.doc">
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="document.getElementById('fileInput').click();">
                                            <i class="bi bi-folder2-open"></i> 选择文件
                                        </button>
                                    </div>
                                    
                                    <div id="fileInfo" class="mt-3" style="display: none;">
                                        <div class="alert alert-info">
                                            <i class="bi bi-file-earmark-text"></i>
                                            <span id="fileName"></span>
                                            <span id="fileSize" class="text-muted ms-2"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3 text-center">
                                        <button type="submit" class="btn btn-outline-success btn-sm me-3" id="processBtn" disabled>
                                            <i class="bi bi-play-fill"></i> 开始处理
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="window.location.href='/tech_proposal.html'">
                                            <i class="bi bi-arrow-right"></i> 下一步：技术方案
                                        </button>
                                    </div>
                                </form>
                                
                                <!-- 进度条 -->
                                <div class="progress mt-3" id="progressBar">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         role="progressbar" style="width: 0%"></div>
                                </div>
                                
                                <!-- 结果区域 -->
                                <div id="resultArea" class="mt-4" style="display: none;">
                                    <div class="alert alert-success">
                                        <h5><i class="bi bi-check-circle"></i> 处理完成！</h5>
                                        <p id="resultMessage"></p>
                                        <div class="mt-3">
                                            <button id="downloadBtn" class="btn btn-outline-primary btn-sm me-2">
                                                <i class="bi bi-download"></i> 下载处理后的文档
                                            </button>
                                            <button id="previewBtn" class="btn btn-outline-success btn-sm me-2">
                                                <i class="bi bi-eye"></i> 预览文档
                                            </button>
                                            <button id="viewFilesBtn" class="btn btn-outline-info btn-sm">
                                                <i class="bi bi-file-earmark-text"></i> 查看所有文件
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 错误区域 -->
                                <div id="errorArea" class="mt-4" style="display: none;">
                                    <div class="alert alert-danger">
                                        <h5><i class="bi bi-exclamation-triangle"></i> 处理失败</h5>
                                        <p id="errorMessage"></p>
                                        <div class="mt-3">
                                            <button type="button" class="btn btn-outline-primary btn-sm" id="retryBtn">
                                                <i class="bi bi-arrow-clockwise"></i> 重试
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" id="resetBtn">
                                                <i class="bi bi-arrow-counterclockwise"></i> 重新选择文件
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 功能特点 -->
                <div class="row mb-5">
                    <div class="col-md-4 mb-3">
                        <div class="card feature-card">
                            <div class="card-body text-center">
                                <i class="bi bi-lightning-charge text-warning" style="font-size: 2rem;"></i>
                                <h5 class="card-title mt-3">智能识别</h5>
                                <p class="card-text text-muted">自动识别文档中的需求条目，减少遗漏</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card feature-card">
                            <div class="card-body text-center">
                                <i class="bi bi-cpu text-primary" style="font-size: 2rem;"></i>
                                <h5 class="card-title mt-3">AI生成</h5>
                                <p class="card-text text-muted">使用先进AI模型生成专业技术应答</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card feature-card">
                            <div class="card-body text-center">
                                <i class="bi bi-palette text-success" style="font-size: 2rem;"></i>
                                <h5 class="card-title mt-3">格式美化</h5>
                                <p class="card-text text-muted">自动设置字体、颜色、底纹和行距</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 使用说明 -->
                <div class="row mt-5">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-question-circle"></i> 使用说明</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>📋 支持的文档格式</h6>
                                        <ul>
                                            <li>Microsoft Word 文档 (.docx)</li>
                                            <li>Microsoft Word 97-2003 文档 (.doc)</li>
                                            <li>文档大小限制：50MB</li>
                                        </ul>
                                        
                                        <h6>🎯 处理功能</h6>
                                        <ul>
                                            <li>自动识别采购需求条目</li>
                                            <li>生成"应答：满足。"格式的专业应答</li>
                                            <li>保持原文档格式和字体</li>
                                            <li>应答内容：黑色字体，灰色底纹，1.5倍行距</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>🔧 API配置</h6>
                                        <ul>
                                            <li>配置始皇API密钥以获得更专业的AI应答</li>
                                            <li>不配置API密钥将使用内置应答模板</li>
                                            <li>建议使用GPT-4o-mini模型获得最佳效果</li>
                                        </ul>
                                        
                                        <h6>⚠️ 注意事项</h6>
                                        <ul>
                                            <li>处理时间视文档大小和复杂度而定</li>
                                            <li>请确保网络连接稳定</li>
                                            <li>建议备份原始文档</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="footer text-center">
            <div class="container">
                <p>&copy; 2025 AI标书智能生成系统. 智慧足迹科技有限公司</p>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/common.js"></script>
    <script src="js/point_to_point.js"></script>

    <script>
        // 页面初始化
        onPageReady(function() {
            // 从URL和存储中恢复状态
            const companyId = StateManager.getCompanyId();
            if (companyId) {
                console.log('当前选择的公司ID:', companyId);
            }

            // 更新导航链接，保持状态参数
            updateNavigationLinks();
        });

        function updateNavigationLinks() {
            const nav = document.getElementById('mainNav');
            const companyId = StateManager.getCompanyId();
            
            if (nav && companyId) {
                nav.querySelectorAll('a.nav-link').forEach(link => {
                    if (!link.href.includes('companyId=')) {
                        const url = new URL(link.href, window.location.origin);
                        url.searchParams.set('companyId', companyId);
                        link.href = url.toString();
                    }
                });
            }
        }
    </script>
</body>
</html>