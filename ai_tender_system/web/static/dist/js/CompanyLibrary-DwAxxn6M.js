import{r as a,O as e,g as t,ab as l,ac as o,R as s,P as i,Q as r,a8 as n,q as c,ad as d,ae as p,_ as u}from"./index.js";/* empty css                             *//* empty css                    *//* empty css                     *//* empty css               */import{E as m,a as _}from"./el-select-C9o-AACO.js";/* empty css                */import{L as y}from"./Loading-BVrBuWXd.js";import{E as f}from"./Empty-BGDtB1R2.js";/* empty css                */import{C as v}from"./Card-DUwk2sCS.js";/* empty css                                                                        *//* empty css                                                                          */import{ap as w,am as g,an as h,aW as b,av as j,ar as k,au as x,at as C,as as q,ax as E,aQ as z,aq as L,aR as V}from"./editor-CZjPbfOV.js";/* empty css                   *//* empty css                */import{c as P}from"./company-DX6fQVXW.js";import{E as I}from"./index-DgL8sT1k.js";import{E as Q,a as $}from"./index-CMv7nVh-.js";import{E as D}from"./index-CjQ1irBn.js";import{E as O}from"./strings-DJcURSVo.js";import"./index-DXP9jmAU.js";import"./toNumber-CU4OoPoC.js";import"./_baseIteratee--ghgRM4z.js";import"./flatMap-MHcQtZLg.js";import"./map-TpIQimNd.js";import"./_baseEach-BmaHGmee.js";import"./index-DzFGJ3Ky.js";import"./raf-B6jWGkGX.js";const U={class:"company-library"},F={class:"stats-bar"},M={class:"stat-content"},N={class:"stat-icon"},R={class:"stat-info"},W={class:"stat-value"},A={class:"stat-content"},G={class:"stat-icon"},H={class:"stat-info"},T={class:"stat-value"},B={class:"filter-section"},J={class:"qualification-progress"},K={class:"progress-text"},S=u(w({__name:"CompanyLibrary",setup(u){const w=a(),{success:S,error:X}=e(),Y=g(!1),Z=g([]),aa=g({keyword:"",industry:""}),ea=h(()=>{let a=[...Z.value];if(aa.value.keyword){const e=aa.value.keyword.toLowerCase();a=a.filter(a=>{var t,l,o;return(null==(t=a.company_name)?void 0:t.toLowerCase().includes(e))||(null==(l=a.social_credit_code)?void 0:l.toLowerCase().includes(e))||(null==(o=a.company_code)?void 0:o.toLowerCase().includes(e))})}return aa.value.industry&&(a=a.filter(a=>a.industry_type===aa.value.industry)),a}),ta=async()=>{Y.value=!0;try{const a=(await P.getCompanies()).data||[],e=await Promise.all(a.map(async a=>{let e=0;try{const t=await P.getCompanyQualifications(a.company_id);t.data&&(e=Object.keys(t.data).length)}catch(l){}const t=Math.round(e/17*100);return{company_id:a.company_id,company_name:a.company_name||"未命名",company_code:a.company_code||"",social_credit_code:a.social_credit_code||"-",legal_representative:a.legal_representative||"-",registered_capital:a.registered_capital||"-",employee_count:a.employee_count||"-",industry_type:a.industry_type||"",product_count:a.product_count||0,document_count:a.document_count||0,qualification_completed:e,qualification_total:17,qualification_progress:t,created_at:a.created_at||"-",updated_at:a.updated_at||"-",...a}}));Z.value=e}catch(a){X("加载失败",a instanceof Error?a.message:"未知错误")}finally{Y.value=!1}},la=()=>{},oa=()=>{aa.value.keyword="",aa.value.industry=""},sa=()=>{w.push("/knowledge/company/new")};return b(()=>{ta()}),(a,e)=>{const u=t,g=I,h=r,b=i,ia=_,ra=m,na=c,ca=s,da=$,pa=D,ua=O,ma=Q;return k(),j("div",U,[x("div",F,[C(g,{class:"stat-card"},{default:q(()=>[x("div",M,[x("div",N,[C(u,{size:32,color:"#409eff"},{default:q(()=>[C(E(l))]),_:1})]),x("div",R,[e[2]||(e[2]=x("div",{class:"stat-label"},"总企业数",-1)),x("div",W,z(Z.value.length),1)])])]),_:1}),C(g,{class:"stat-card"},{default:q(()=>[x("div",A,[x("div",G,[C(u,{size:32,color:"#67c23a"},{default:q(()=>[C(E(o))]),_:1})]),x("div",H,[e[3]||(e[3]=x("div",{class:"stat-label"},"筛选结果",-1)),x("div",T,z(ea.value.length),1)])])]),_:1})]),C(E(v),{title:"企业列表"},{default:q(()=>[x("div",B,[C(ca,{inline:!0,model:aa.value},{default:q(()=>[C(b,{label:"搜索"},{default:q(()=>[C(h,{modelValue:aa.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>aa.value.keyword=a),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:la},{prefix:q(()=>[C(u,null,{default:q(()=>[C(E(n))]),_:1})]),_:1},8,["modelValue"])]),_:1}),C(b,{label:"行业类型"},{default:q(()=>[C(ra,{modelValue:aa.value.industry,"onUpdate:modelValue":e[1]||(e[1]=a=>aa.value.industry=a),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:la},{default:q(()=>[C(ia,{label:"全部行业",value:""}),C(ia,{label:"科技",value:"technology"}),C(ia,{label:"制造业",value:"manufacturing"}),C(ia,{label:"金融",value:"finance"}),C(ia,{label:"教育",value:"education"}),C(ia,{label:"医疗",value:"healthcare"}),C(ia,{label:"零售",value:"retail"}),C(ia,{label:"建筑",value:"construction"}),C(ia,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),C(b,null,{default:q(()=>[C(na,{onClick:oa},{default:q(()=>[C(u,null,{default:q(()=>[C(E(d))]),_:1}),e[4]||(e[4]=V(" 重置 ",-1))]),_:1})]),_:1}),C(b,{style:{"margin-left":"auto"}},{default:q(()=>[C(na,{type:"primary",onClick:sa},{default:q(()=>[C(u,null,{default:q(()=>[C(E(p))]),_:1}),e[5]||(e[5]=V(" 新建企业 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),Y.value?(k(),L(E(y),{key:0,text:"加载中..."})):ea.value.length?(k(),L(ma,{key:2,data:ea.value,stripe:"",style:{width:"100%"}},{default:q(()=>[C(da,{prop:"company_id",label:"ID",width:"70",fixed:""}),C(da,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),C(da,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),C(da,{prop:"legal_representative",label:"法定代表人",width:"120"}),C(da,{prop:"registered_capital",label:"注册资本",width:"120"}),C(da,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),C(da,{label:"资质完成度",width:"180",align:"center"},{default:q(({row:a})=>{return[x("div",J,[C(pa,{percentage:a.qualification_progress||0,color:(e=a.qualification_progress||0,e<30?"#f56c6c":e<70?"#e6a23c":"#67c23a"),"stroke-width":8},null,8,["percentage","color"]),x("span",K,z(a.qualification_completed||0)+"/"+z(a.qualification_total||17),1)])];var e}),_:1}),C(da,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:q(({row:a})=>[C(ua,{size:"small",type:"info"},{default:q(()=>[V(z(a.product_count||0),1)]),_:2},1024)]),_:1}),C(da,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:q(({row:a})=>[C(ua,{size:"small",type:"success"},{default:q(()=>[V(z(a.document_count||0),1)]),_:2},1024)]),_:1}),C(da,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),C(da,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),C(da,{label:"操作",width:"220",fixed:"right"},{default:q(({row:a})=>[C(na,{text:"",type:"primary",size:"small",onClick:e=>(a=>{w.push(`/knowledge/company/${a.company_id}`)})(a)},{default:q(()=>[...e[6]||(e[6]=[V(" 查看详情 ",-1)])]),_:1},8,["onClick"]),C(na,{text:"",type:"warning",size:"small",onClick:e=>(a=>{w.push(`/knowledge/company/${a.company_id}`)})(a)},{default:q(()=>[...e[7]||(e[7]=[V(" 编辑 ",-1)])]),_:1},8,["onClick"]),C(na,{text:"",type:"danger",size:"small",onClick:e=>(async a=>{try{if(!confirm(`确定要删除企业 "${a.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`))return;await P.deleteCompany(a.company_id),S("删除成功",`已删除企业: ${a.company_name}`),await ta()}catch(e){X("删除失败",e instanceof Error?e.message:"未知错误")}})(a)},{default:q(()=>[...e[8]||(e[8]=[V(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(k(),L(E(f),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1})])}}}),[["__scopeId","data-v-265a347f"]]);export{S as default};
