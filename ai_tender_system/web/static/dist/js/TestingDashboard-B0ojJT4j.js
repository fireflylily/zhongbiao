import{a6 as e,ao as a,q as s,l,am as t,G as i,E as n,J as r,_ as o}from"./index.js";/* empty css                                                                          */import{E as u}from"./el-text-CIVxKMll.js";import{E as c}from"./el-pagination-DFbFFE83.js";/* empty css               */import{E as d,a as v}from"./el-select-C9o-AACO.js";/* empty css                     *//* empty css                             *//* empty css                    */import{t as p}from"./test-runner-Cn6tQuYf.js";/* empty css                *//* empty css                */import{C as m}from"./Card-DUwk2sCS.js";/* empty css                                                                        */import{ap as f,am as g,an as _,aW as h,bF as y,av as w,ar as b,at as k,as as x,au as j,aJ as C,aQ as z,az as V,aR as E,ax as T,aq as F,aL as I}from"./editor-CZjPbfOV.js";/* empty css                   *//* empty css                */import{E as D}from"./index-DgL8sT1k.js";import{E as P}from"./index-DzFGJ3Ky.js";import{E as S}from"./strings-DJcURSVo.js";import{E as U,a as H}from"./index-CMv7nVh-.js";import{E as A}from"./index-CjQ1irBn.js";import{E as M}from"./index-DWyHgBtB.js";import"./index-DXP9jmAU.js";import"./toNumber-CU4OoPoC.js";import"./_baseIteratee--ghgRM4z.js";import"./flatMap-MHcQtZLg.js";import"./map-TpIQimNd.js";import"./_baseEach-BmaHGmee.js";import"./raf-B6jWGkGX.js";const O={class:"automated-test"},q={class:"quick-info-grid"},J={class:"info-content"},L={class:"info-text"},N={class:"info-value"},Q={class:"info-content"},$={class:"info-text"},B={class:"info-value"},G={class:"info-content"},R={class:"info-text"},W={class:"info-content"},K={class:"info-text"},X={class:"info-value small"},Y={class:"control-panel"},Z={class:"run-options"},ee={class:"test-env-selector"},ae={key:0,class:"test-options"},se={key:1,class:"test-options"},le={key:0,class:"results-panel"},te={class:"stats-header"},ie={class:"test-stats"},ne={class:"stat-item success"},re={class:"stat-content"},oe={class:"stat-value"},ue={class:"stat-item danger"},ce={class:"stat-content"},de={class:"stat-value"},ve={class:"stat-item warning"},pe={class:"stat-content"},me={class:"stat-value"},fe={class:"stat-item info"},ge={class:"stat-content"},_e={class:"stat-value"},he={class:"stat-item"},ye={class:"stat-content"},we={class:"stat-value"},be={key:1,class:"coverage-section"},ke={class:"coverage-header"},xe={class:"coverage-actions"},je={class:"coverage-summary"},Ce={class:"summary-item"},ze={class:"summary-value"},Ve={class:"summary-item"},Ee={class:"summary-value success"},Te={class:"summary-item"},Fe={class:"summary-value danger"},Ie={class:"pagination-wrapper"},De={class:"history-section"},Pe={class:"history-header"},Se={class:"header-actions"},Ue={key:0,class:"result-summary"},He={class:"result-item success"},Ae={class:"result-item danger"},Me={class:"result-item warning"},Oe={key:1,class:"text-muted"},qe={key:0},Je={key:1,class:"text-muted"},Le={key:0,class:"empty-state"},Ne={key:2,class:"logs-section"},Qe={class:"logs-header"},$e={class:"header-actions"},Be={key:0,class:"logs-content"},Ge={key:1,class:"empty-logs"},Re=o(f({__name:"TestingDashboard",setup(o){const f=g(null),Re=g("backend"),We=g("unit"),Ke=g(""),Xe=g(!0),Ye=g(!1),Ze=g(null),ea=g(null),aa=g(null),sa=g(null),la=g([]),ta=g(null),ia=g(1),na=g(20),ra=_(()=>{if(!sa.value)return[];const e=(ia.value-1)*na.value,a=e+na.value;return sa.value.files.slice(e,a)}),oa=async()=>{try{const e=await p.getQuickInfo();e.success&&(f.value=e.info)}catch(e){}},ua=async()=>{var e,a;if(!Ye.value)try{let e;if("frontend"===Re.value){n.info("æ­£åœ¨è¿è¡Œå‰ç«¯Vitestæµ‹è¯•..."),e=await fetch("/api/testing/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_type:"frontend",test_module:Ke.value})});const a=await e.json();a.success?(n.success(`å‰ç«¯æµ‹è¯•å®Œæˆï¼é€šè¿‡: ${a.passed}, å¤±è´¥: ${a.failed}`),Ze.value={task_id:`frontend_${Date.now()}`,status:"completed",result:{passed:a.passed||0,failed:a.failed||0,skipped:a.skipped||0,errors:0,duration:0,total:a.total_tests||0},logs:a.output?a.output.split("\n"):[],test_type:"frontend",created_time:(new Date).toISOString()},await oa()):n.error("å‰ç«¯æµ‹è¯•è¿è¡Œå¤±è´¥: "+(a.error||"æœªçŸ¥é”™è¯¯"))}else e=await p.runTests(We.value,Xe.value,!0),e.success&&(ea.value=e.task_id,Ye.value=!0,n.success("æµ‹è¯•å·²å¼€å§‹è¿è¡Œ"),ca())}catch(s){n.error((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.error)||"å¯åŠ¨æµ‹è¯•å¤±è´¥")}},ca=()=>{aa.value&&clearInterval(aa.value),aa.value=window.setInterval(async()=>{if(ea.value)try{const e=await p.getTestStatus(ea.value);e.success&&(Ze.value=e.task,await I(),ta.value&&(ta.value.scrollTop=ta.value.scrollHeight),"completed"!==Ze.value.status&&"failed"!==Ze.value.status||(da(),Ye.value=!1,Xe.value&&"completed"===Ze.value.status&&await va(),await oa(),await pa(),"completed"===Ze.value.status?n.success("æµ‹è¯•è¿è¡Œå®Œæˆ"):n.error("æµ‹è¯•è¿è¡Œå¤±è´¥")))}catch(e){}},1e3)},da=()=>{aa.value&&(clearInterval(aa.value),aa.value=null)},va=async()=>{try{const e=await p.getCoverageData();e.success&&(sa.value=e.coverage)}catch(e){}},pa=async()=>{try{const e=await p.getTestHistory(20);e.success&&(la.value=e.history)}catch(e){}},ma=async()=>{try{await r.confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•åŽ†å²è®°å½•å—ï¼Ÿ","ç¡®è®¤æ¸…é™¤",{type:"warning"}),await p.clearHistory(),la.value=[],n.success("åŽ†å²è®°å½•å·²æ¸…é™¤")}catch(e){}},fa=()=>{var e;if(!(null==(e=Ze.value)?void 0:e.logs))return;const a=Ze.value.logs.join("\n");navigator.clipboard.writeText(a).then(()=>{n.success("æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")})},ga=e=>e>=80?"coverage-excellent":e>=50?"coverage-good":e>=30?"coverage-fair":"coverage-poor",_a=e=>e>=80?"#67C23A":e>=50?"#409EFF":e>=30?"#E6A23C":"#F56C6C",ha=e=>({pending:"ç­‰å¾…ä¸­",running:"è¿è¡Œä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"}[e]||e),ya=e=>{const a="test"===e?"/api/testing/view/report":"/api/testing/view/coverage";window.open(a,"_blank")},wa=e=>{na.value=e,ia.value=1},ba=e=>{ia.value=e};return h(async()=>{await oa(),await pa(),await va()}),y(()=>{da()}),(r,o)=>{const p=s,g=D,_=a,h=e,y=P,I=v,ea=d,aa=S,ca=A,da=H,va=U,ka=c,xa=u,ja=M;return b(),w("div",O,[k(T(m),{title:"ðŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œå™¨"},{extra:x(()=>[k(p,{onClick:oa,icon:T(i),circle:"",size:"small",title:"åˆ·æ–°"},null,8,["icon"])]),default:x(()=>{var e;return[j("div",q,[k(g,{class:"info-card",shadow:"hover"},{default:x(()=>{var e;return[j("div",J,[o[9]||(o[9]=j("i",{class:"bi-list-check info-icon"},null,-1)),j("div",L,[o[8]||(o[8]=j("div",{class:"info-label"},"æ€»æµ‹è¯•æ•°",-1)),j("div",N,z((null==(e=f.value)?void 0:e.total_tests)||0),1)])])]}),_:1}),k(g,{class:"info-card",shadow:"hover"},{default:x(()=>{var e;return[j("div",Q,[o[11]||(o[11]=j("i",{class:"bi-file-earmark-code info-icon"},null,-1)),j("div",$,[o[10]||(o[10]=j("div",{class:"info-label"},"æµ‹è¯•æ–‡ä»¶",-1)),j("div",B,z((null==(e=f.value)?void 0:e.test_files)||0),1)])])]}),_:1}),k(g,{class:"info-card",shadow:"hover"},{default:x(()=>{var e,a;return[j("div",G,[o[13]||(o[13]=j("i",{class:"bi-pie-chart info-icon"},null,-1)),j("div",R,[o[12]||(o[12]=j("div",{class:"info-label"},"æµ‹è¯•è¦†ç›–çŽ‡",-1)),j("div",{class:V(["info-value",ga((null==(e=f.value)?void 0:e.coverage_percent)||0)])},z(((null==(a=f.value)?void 0:a.coverage_percent)||0).toFixed(2))+"% ",3)])])]}),_:1}),k(g,{class:"info-card",shadow:"hover"},{default:x(()=>{var e;return[j("div",W,[o[15]||(o[15]=j("i",{class:"bi-clock-history info-icon"},null,-1)),j("div",K,[o[14]||(o[14]=j("div",{class:"info-label"},"æœ€åŽè¿è¡Œ",-1)),j("div",X,z((null==(e=f.value)?void 0:e.last_run)||"æœªè¿è¡Œ"),1)])])]}),_:1})]),j("div",Y,[k(g,{shadow:"never"},{header:x(()=>[...o[16]||(o[16]=[j("span",null,"è¿è¡Œæµ‹è¯•",-1)])]),default:x(()=>[j("div",Z,[j("div",ee,[o[19]||(o[19]=j("span",{class:"selector-label"},"æµ‹è¯•çŽ¯å¢ƒ:",-1)),k(h,{modelValue:Re.value,"onUpdate:modelValue":o[0]||(o[0]=e=>Re.value=e),disabled:Ye.value,size:"default"},{default:x(()=>[k(_,{value:"backend"},{default:x(()=>[...o[17]||(o[17]=[E("ðŸ åŽç«¯æµ‹è¯•",-1)])]),_:1}),k(_,{value:"frontend"},{default:x(()=>[...o[18]||(o[18]=[E("ðŸŽ¨ å‰ç«¯æµ‹è¯•",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),"backend"===Re.value?(b(),w("div",ae,[k(h,{modelValue:We.value,"onUpdate:modelValue":o[1]||(o[1]=e=>We.value=e),disabled:Ye.value},{default:x(()=>[k(_,{value:"unit"},{default:x(()=>[...o[20]||(o[20]=[E("å•å…ƒæµ‹è¯•",-1)])]),_:1}),k(_,{value:"integration"},{default:x(()=>[...o[21]||(o[21]=[E("é›†æˆæµ‹è¯•",-1)])]),_:1}),k(_,{value:"all"},{default:x(()=>[...o[22]||(o[22]=[E("å…¨éƒ¨æµ‹è¯•",-1)])]),_:1})]),_:1},8,["modelValue","disabled"]),k(y,{modelValue:Xe.value,"onUpdate:modelValue":o[2]||(o[2]=e=>Xe.value=e),disabled:Ye.value},{default:x(()=>[...o[23]||(o[23]=[E(" ç”Ÿæˆè¦†ç›–çŽ‡æŠ¥å‘Š ",-1)])]),_:1},8,["modelValue","disabled"])])):C("",!0),"frontend"===Re.value?(b(),w("div",se,[k(ea,{modelValue:Ke.value,"onUpdate:modelValue":o[3]||(o[3]=e=>Ke.value=e),placeholder:"é€‰æ‹©æ¨¡å—ï¼ˆç•™ç©º=å…¨éƒ¨ï¼‰",clearable:"",disabled:Ye.value,style:{width:"300px"}},{default:x(()=>[k(I,{label:"å…¨éƒ¨å‰ç«¯æµ‹è¯•",value:""}),k(I,{label:"å•†åŠ¡åº”ç­”æ¨¡å—",value:"Business/Response"}),k(I,{label:"æŠ€æœ¯æ–¹æ¡ˆæ¨¡å—",value:"Business/TechProposal"}),k(I,{label:"å·¥å…·å‡½æ•°",value:"utils"}),k(I,{label:"APIè°ƒç”¨",value:"api"})]),_:1},8,["modelValue","disabled"])])):C("",!0),k(p,{type:"primary",icon:Ye.value?T(l):T(t),loading:Ye.value,onClick:ua,size:"large"},{default:x(()=>[E(z(Ye.value?"æµ‹è¯•è¿è¡Œä¸­...":"frontend"===Re.value?"è¿è¡Œå‰ç«¯æµ‹è¯•":"è¿è¡ŒåŽç«¯æµ‹è¯•"),1)]),_:1},8,["icon","loading"])])]),_:1})]),(null==(e=Ze.value)?void 0:e.result)?(b(),w("div",le,[k(g,{shadow:"never",class:"stats-card"},{header:x(()=>[j("div",te,[o[24]||(o[24]=j("span",null,"æµ‹è¯•ç»“æžœ",-1)),k(aa,{type:Ze.value.result.passed?"success":"danger",effect:"dark"},{default:x(()=>[E(z(Ze.value.result.passed?"âœ… é€šè¿‡":"âŒ å¤±è´¥"),1)]),_:1},8,["type"])])]),default:x(()=>{var e;return[j("div",ie,[j("div",ne,[o[26]||(o[26]=j("i",{class:"bi-check-circle"},null,-1)),j("div",re,[o[25]||(o[25]=j("div",{class:"stat-label"},"é€šè¿‡",-1)),j("div",oe,z(Ze.value.result.passed),1)])]),j("div",ue,[o[28]||(o[28]=j("i",{class:"bi-x-circle"},null,-1)),j("div",ce,[o[27]||(o[27]=j("div",{class:"stat-label"},"å¤±è´¥",-1)),j("div",de,z(Ze.value.result.failed),1)])]),j("div",ve,[o[30]||(o[30]=j("i",{class:"bi-skip-forward-circle"},null,-1)),j("div",pe,[o[29]||(o[29]=j("div",{class:"stat-label"},"è·³è¿‡",-1)),j("div",me,z(Ze.value.result.skipped),1)])]),j("div",fe,[o[32]||(o[32]=j("i",{class:"bi-exclamation-circle"},null,-1)),j("div",ge,[o[31]||(o[31]=j("div",{class:"stat-label"},"é”™è¯¯",-1)),j("div",_e,z(Ze.value.result.errors),1)])]),j("div",he,[o[34]||(o[34]=j("i",{class:"bi-stopwatch"},null,-1)),j("div",ye,[o[33]||(o[33]=j("div",{class:"stat-label"},"è€—æ—¶",-1)),j("div",we,z(null==(e=Ze.value.result.duration)?void 0:e.toFixed(2))+"s",1)])])])]}),_:1})])):C("",!0),sa.value?(b(),w("div",be,[k(g,{shadow:"never"},{header:x(()=>[j("div",ke,[o[36]||(o[36]=j("span",null,"æµ‹è¯•è¦†ç›–çŽ‡",-1)),j("div",xe,[k(p,{size:"small",onClick:o[4]||(o[4]=e=>ya("coverage")),type:"primary",plain:""},{default:x(()=>[...o[35]||(o[35]=[E(" ðŸ“Š æŸ¥çœ‹å®Œæ•´HTMLæŠ¥å‘Š ",-1)])]),_:1}),k(ca,{percentage:sa.value.coverage_percent,color:_a(sa.value.coverage_percent),"stroke-width":20,"text-inside":"",style:{flex:"1","max-width":"300px"}},null,8,["percentage","color"])])])]),default:x(()=>[j("div",je,[j("div",Ce,[o[37]||(o[37]=j("span",{class:"summary-label"},"æ€»ä»£ç è¡Œæ•°:",-1)),j("span",ze,z(sa.value.total_statements),1)]),j("div",Ve,[o[38]||(o[38]=j("span",{class:"summary-label"},"å·²è¦†ç›–:",-1)),j("span",Ee,z(sa.value.covered_statements),1)]),j("div",Te,[o[39]||(o[39]=j("span",{class:"summary-label"},"æœªè¦†ç›–:",-1)),j("span",Fe,z(sa.value.missing_statements),1)])]),k(va,{data:ra.value,border:"",stripe:"","max-height":"400"},{default:x(()=>[k(da,{prop:"file",label:"æ–‡ä»¶","min-width":"300","show-overflow-tooltip":""}),k(da,{prop:"statements",label:"æ€»è¡Œæ•°",width:"100",align:"center"}),k(da,{prop:"covered",label:"å·²è¦†ç›–",width:"100",align:"center"}),k(da,{prop:"missing",label:"æœªè¦†ç›–",width:"100",align:"center"}),k(da,{label:"è¦†ç›–çŽ‡",width:"150",align:"center"},{default:x(({row:e})=>[k(ca,{percentage:e.coverage,color:_a(e.coverage),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),j("span",{class:V(ga(e.coverage)),style:{"margin-left":"8px"}},z(e.coverage.toFixed(1))+"% ",3)]),_:1})]),_:1},8,["data"]),j("div",Ie,[k(ka,{"current-page":ia.value,"onUpdate:currentPage":o[5]||(o[5]=e=>ia.value=e),"page-size":na.value,"onUpdate:pageSize":o[6]||(o[6]=e=>na.value=e),"page-sizes":[10,20,50,100],total:sa.value.files.length,layout:"total, sizes, prev, pager, next",onSizeChange:wa,onCurrentChange:ba},null,8,["current-page","page-size","total"])])]),_:1})])):C("",!0),j("div",De,[k(g,{shadow:"never"},{header:x(()=>[j("div",Pe,[o[42]||(o[42]=j("span",null,"æµ‹è¯•åŽ†å²",-1)),j("div",Se,[k(p,{size:"small",onClick:pa},{default:x(()=>[...o[40]||(o[40]=[E("åˆ·æ–°",-1)])]),_:1}),k(p,{size:"small",type:"danger",onClick:ma},{default:x(()=>[...o[41]||(o[41]=[E("æ¸…é™¤",-1)])]),_:1})])])]),default:x(()=>[k(va,{data:la.value,border:"",stripe:""},{default:x(()=>[k(da,{label:"ä»»åŠ¡ID",width:"200","show-overflow-tooltip":""},{default:x(({row:e})=>[k(xa,{size:"small",type:"info"},{default:x(()=>[E(z(e.task_id),1)]),_:2},1024)]),_:1}),k(da,{prop:"test_type",label:"æµ‹è¯•ç±»åž‹",width:"120",align:"center"},{default:x(({row:e})=>[k(aa,{size:"small",effect:"plain"},{default:x(()=>{return[E(z((a=e.test_type,{unit:"å•å…ƒæµ‹è¯•",integration:"é›†æˆæµ‹è¯•",all:"å…¨éƒ¨æµ‹è¯•"}[a]||a)),1)];var a}),_:2},1024)]),_:1}),k(da,{label:"çŠ¶æ€",width:"100",align:"center"},{default:x(({row:e})=>{return[k(aa,{type:(a=e.status,{pending:"info",running:"warning",completed:"success",failed:"danger"}[a]||"info"),size:"small"},{default:x(()=>[E(z(ha(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),k(da,{label:"ç»“æžœ",width:"200",align:"center"},{default:x(({row:e})=>[e.result?(b(),w("div",Ue,[j("span",He,"âœ“ "+z(e.result.passed),1),j("span",Ae,"âœ— "+z(e.result.failed),1),j("span",Me,"âŠ™ "+z(e.result.skipped),1)])):(b(),w("span",Oe,"-"))]),_:1}),k(da,{prop:"created_time",label:"åˆ›å»ºæ—¶é—´",width:"180"}),k(da,{label:"è€—æ—¶",width:"100",align:"center"},{default:x(({row:e})=>{var a;return[e.result?(b(),w("span",qe,z(null==(a=e.result.duration)?void 0:a.toFixed(2))+"s",1)):(b(),w("span",Je,"-"))]}),_:1}),k(da,{label:"æ“ä½œ",width:"120",fixed:"right",align:"center"},{default:x(({row:e})=>[k(p,{size:"small",onClick:a=>{return s=e,Ze.value=s,void n.info("å·²åŠ è½½æµ‹è¯•è¯¦æƒ…");var s}},{default:x(()=>[...o[43]||(o[43]=[E("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),0===la.value.length?(b(),w("div",Le,[k(ja,{description:"æš‚æ— æµ‹è¯•åŽ†å²"})])):C("",!0)]),_:1})]),Ze.value?(b(),w("div",Ne,[k(g,{shadow:"never",class:"logs-card"},{header:x(()=>[j("div",Qe,[o[47]||(o[47]=j("span",null,"ðŸ“ æµ‹è¯•æ—¥å¿—",-1)),j("div",$e,[Ye.value?(b(),F(aa,{key:0,type:"info",effect:"plain"},{default:x(()=>[...o[44]||(o[44]=[j("i",{class:"bi-arrow-clockwise rotating"},null,-1),E(" è¿è¡Œä¸­... ",-1)])]),_:1})):C("",!0),k(p,{size:"small",onClick:o[7]||(o[7]=e=>ya("test")),type:"success",plain:""},{default:x(()=>[...o[45]||(o[45]=[E(" ðŸ“„ æŸ¥çœ‹HTMLæµ‹è¯•æŠ¥å‘Š ",-1)])]),_:1}),k(p,{size:"small",onClick:fa},{default:x(()=>[...o[46]||(o[46]=[E("å¤åˆ¶æ—¥å¿—",-1)])]),_:1})])])]),default:x(()=>[j("div",{class:"logs-container",ref_key:"logsContainer",ref:ta},[Ze.value.logs&&Ze.value.logs.length>0?(b(),w("pre",Be,z(Ze.value.logs.join("\n")),1)):(b(),w("div",Ge,[...o[48]||(o[48]=[j("i",{class:"bi-terminal"},null,-1),j("p",null,"ç­‰å¾…æµ‹è¯•å¼€å§‹...",-1)])]))],512)]),_:1})])):C("",!0)]}),_:1})])}}}),[["__scopeId","data-v-1352d080"]]);export{Re as default};
