import{aL as e,bC as a,av as t,b6 as l,b7 as c,aM as o,aO as r,aZ as u,aT as n,bI as s,bF as d,bd as i,be as _,aS as p,bG as m,c6 as f,c7 as v,b0 as y,b1 as h,aR as b,aV as g,aX as V,aU as w,aY as j,aN as k,bb as C,cX as x,c4 as U,ca as D,c5 as E,cY as I,cZ as Y,c_ as z,c$ as M,c2 as F,a_ as P,d0 as A,bA as L}from"./index.js";/* empty css               */import{L as q}from"./Loading-K1G2Hqsj.js";/* empty css                                                                          *//* empty css                */import"./DocumentPreview.vue_vue_type_style_index_0_scoped_3e333bda_lang-e-Hg8YbH.js";/* empty css                *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css                */import{a as N,f as R,k as X}from"./formatters-BCM66Wc4.js";import{E as B}from"./el-divider-BQhRlSBM.js";import{E as G}from"./el-date-picker-panel-CVoXZzF3.js";import{E as O,a as T}from"./el-select-Bg6tRkm-.js";import{E as Z}from"./Empty-DCcAshlT.js";import{c as J}from"./company-CDLBTJzM.js";import{E as S}from"./index-pL0-fGnR.js";import{a as $,E as H}from"./index-CicgRNCL.js";import{E as K}from"./index-vOji2UsA.js";import{E as Q}from"./index-C3XccYQN.js";import"./index-CbEdxjaG.js";import"./advancedFormat-BecPpoif.js";import"./index-BkTUUs11.js";import"./strings-CAibmfqB.js";import"./toNumber-Dx_mmd_0.js";import"./_baseIteratee-0c652xZp.js";import"./cloneDeep-BA-8E20e.js";const W={class:"case-basic-info-tab"},ee={class:"card-header"},ae={key:2,class:"attachments-grid"},te={class:"attachment-header"},le={class:"attachment-body"},ce=["title"],oe={class:"file-info"},re={class:"file-size"},ue={class:"file-date"},ne={key:0,class:"file-desc"},se={class:"attachment-actions"},de=P(e({__name:"CaseBasicInfoTab",props:{caseId:{},caseData:{}},emits:["update"],setup(e,{emit:P}){const A=e,L=P,{success:de,error:ie}=a(),_e=t(),pe=t(!1),me=t([]),fe=t({company_id:null,case_title:"",case_number:"",customer_name:"",product_category:"",industry:"金融",contract_type:"合同",final_customer_name:"",contract_amount:"",contract_start_date:"",contract_end_date:"",party_a_contact_name:"",party_a_contact_phone:"",party_a_contact_email:""}),ve={company_id:[{required:!0,message:"请选择所属企业",trigger:"change"}],case_title:[{required:!0,message:"请输入案例标题",trigger:"blur"}],customer_name:[{required:!0,message:"请输入客户名称",trigger:"blur"}],contract_type:[{required:!0,message:"请选择合同类型",trigger:"change"}]},ye=t(!1),he=t([]),be=t(!1),ge=t(!1),Ve=t(),we=t(),je=t([]),ke=t({attachment_type:"contract",description:"",file:null}),Ce={attachment_type:[{required:!0,message:"请选择附件类型",trigger:"change"}]};l(()=>A.caseData,e=>{e&&(fe.value={company_id:e.company_id||null,case_title:e.case_title||"",case_number:e.case_number||"",customer_name:e.customer_name||"",product_category:e.product_category||"",industry:e.industry||"金融",contract_type:e.contract_type||"合同",final_customer_name:e.final_customer_name||"",contract_amount:e.contract_amount||"",contract_start_date:e.contract_start_date||"",contract_end_date:e.contract_end_date||"",party_a_contact_name:e.party_a_contact_name||"",party_a_contact_phone:e.party_a_contact_phone||"",party_a_contact_email:e.party_a_contact_email||""})},{immediate:!0,deep:!0});const xe=async()=>{_e.value&&await _e.value.validate(async e=>{if(e){pe.value=!0;try{const e=await X.updateCase(A.caseId,fe.value);e.success?(de("保存成功","案例信息已更新"),L("update")):ie("保存失败",e.error||"未知错误")}catch(a){ie("保存失败",a instanceof Error?a.message:"未知错误")}finally{pe.value=!1}}})},Ue=()=>{var e;null==(e=_e.value)||e.resetFields()},De=e=>{switch(e){case"contract":return F;case"acceptance":return M;case"testimony":return z;case"photo":return Y;default:return I}},Ee=e=>{switch(e){case"contract":return"#409eff";case"acceptance":return"#67c23a";case"testimony":return"#e6a23c";case"photo":return"#f56c6c";default:return"#909399"}},Ie=e=>{switch(e){case"contract":return"primary";case"acceptance":return"success";case"testimony":return"warning";case"photo":return"danger";default:return"info"}},Ye=e=>{switch(e){case"contract":return"合同文件";case"acceptance":return"验收证明";case"testimony":return"客户证明";case"photo":return"项目照片";default:return"其他材料"}},ze=async()=>{ye.value=!0;try{const e=await X.getCaseAttachments(A.caseId);e.success&&e.data&&(he.value=e.data)}catch(e){ie("加载失败",e instanceof Error?e.message:"未知错误")}finally{ye.value=!1}},Me=e=>{if(e.raw){const a=20971520;if(e.raw.size>a)return ie("文件过大","文件大小不能超过20MB"),je.value=[],void(ke.value.file=null);ke.value.file=e.raw}},Fe=()=>{ke.value.file=null},Pe=()=>{be.value=!0},Ae=async()=>{Ve.value&&await Ve.value.validate(async e=>{if(e)if(ke.value.file){ge.value=!0;try{const e=await X.uploadCaseAttachment(A.caseId,ke.value.file,ke.value.attachment_type,ke.value.description||void 0);e.success?(de("上传成功","附件已上传"),be.value=!1,await ze(),L("update")):ie("上传失败",e.error||"未知错误")}catch(a){ie("上传失败",a instanceof Error?a.message:"未知错误")}finally{ge.value=!1}}else ie("请选择文件","请先选择要上传的文件")})},Le=()=>{var e;je.value=[],ke.value={attachment_type:"contract",description:"",file:null},null==(e=Ve.value)||e.resetFields()};return c(()=>{(async()=>{try{const e=await J.getCompanies();e.success&&e.data&&(me.value=e.data)}catch(e){}})(),ze()}),(e,a)=>{const t=T,l=O,c=d,I=H,Y=$,z=m,M=v,F=f,P=G,A=B,J=h,qe=s,Ne=S,Re=V,Xe=K,Be=Q,Ge=D;return r(),o("div",W,[u(Ne,{style:{"margin-bottom":"20px"}},{header:n(()=>[...a[19]||(a[19]=[b("span",null,"案例基本信息",-1)])]),default:n(()=>[u(qe,{ref_key:"formRef",ref:_e,model:fe.value,rules:ve,"label-width":"140px"},{default:n(()=>[u(Y,{gutter:20},{default:n(()=>[u(I,{span:12},{default:n(()=>[u(c,{label:"所属企业",prop:"company_id"},{default:n(()=>[u(l,{modelValue:fe.value.company_id,"onUpdate:modelValue":a[0]||(a[0]=e=>fe.value.company_id=e),placeholder:"请选择企业",filterable:"",style:{width:"100%"}},{default:n(()=>[(r(!0),o(i,null,_(me.value,e=>(r(),p(t,{key:e.company_id,label:e.company_name,value:e.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(Y,{gutter:20},{default:n(()=>[u(I,{span:12},{default:n(()=>[u(c,{label:"案例标题",prop:"case_title"},{default:n(()=>[u(z,{modelValue:fe.value.case_title,"onUpdate:modelValue":a[1]||(a[1]=e=>fe.value.case_title=e),placeholder:"请输入案例标题/合同名称"},null,8,["modelValue"])]),_:1})]),_:1}),u(I,{span:12},{default:n(()=>[u(c,{label:"案例编号",prop:"case_number"},{default:n(()=>[u(z,{modelValue:fe.value.case_number,"onUpdate:modelValue":a[2]||(a[2]=e=>fe.value.case_number=e),placeholder:"请输入案例编号（可选）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(Y,{gutter:20},{default:n(()=>[u(I,{span:12},{default:n(()=>[u(c,{label:"客户名称",prop:"customer_name"},{default:n(()=>[u(z,{modelValue:fe.value.customer_name,"onUpdate:modelValue":a[3]||(a[3]=e=>fe.value.customer_name=e),placeholder:"请输入甲方客户名称"},null,8,["modelValue"])]),_:1})]),_:1}),u(I,{span:12},{default:n(()=>[u(c,{label:"产品分类",prop:"product_category"},{default:n(()=>[u(l,{modelValue:fe.value.product_category,"onUpdate:modelValue":a[4]||(a[4]=e=>fe.value.product_category=e),placeholder:"请选择产品分类",clearable:"",style:{width:"100%"}},{default:n(()=>[u(t,{label:"风控产品",value:"风控产品"}),u(t,{label:"实修",value:"实修"}),u(t,{label:"免密",value:"免密"}),u(t,{label:"风控位置",value:"风控位置"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(Y,{gutter:20},{default:n(()=>[u(I,{span:12},{default:n(()=>[u(c,{label:"所属行业",prop:"industry"},{default:n(()=>[u(l,{modelValue:fe.value.industry,"onUpdate:modelValue":a[5]||(a[5]=e=>fe.value.industry=e),placeholder:"请选择行业",clearable:"",style:{width:"100%"}},{default:n(()=>[u(t,{label:"科技",value:"科技"}),u(t,{label:"制造业",value:"制造业"}),u(t,{label:"金融",value:"金融"}),u(t,{label:"教育",value:"教育"}),u(t,{label:"医疗",value:"医疗"}),u(t,{label:"建筑",value:"建筑"}),u(t,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),u(I,{span:12},{default:n(()=>[u(c,{label:"合同类型",prop:"contract_type"},{default:n(()=>[u(F,{modelValue:fe.value.contract_type,"onUpdate:modelValue":a[6]||(a[6]=e=>fe.value.contract_type=e)},{default:n(()=>[u(M,{label:"合同"},{default:n(()=>[...a[20]||(a[20]=[y("合同",-1)])]),_:1}),u(M,{label:"订单"},{default:n(()=>[...a[21]||(a[21]=[y("订单",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(Y,{gutter:20},{default:n(()=>[u(I,{span:12},{default:n(()=>[u(c,{label:"合同金额",prop:"contract_amount"},{default:n(()=>[u(z,{modelValue:fe.value.contract_amount,"onUpdate:modelValue":a[7]||(a[7]=e=>fe.value.contract_amount=e),placeholder:"如：100万元、百万级"},{append:n(()=>[...a[22]||(a[22]=[y("元",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(Y,{gutter:20},{default:n(()=>[u(I,{span:12},{default:n(()=>[u(c,{label:"最终客户",prop:"final_customer_name"},{default:n(()=>[u(z,{modelValue:fe.value.final_customer_name,"onUpdate:modelValue":a[8]||(a[8]=e=>fe.value.final_customer_name=e),placeholder:"订单类型时填写最终客户",disabled:"订单"!==fe.value.contract_type},null,8,["modelValue","disabled"])]),_:1})]),_:1}),u(I,{span:12},{default:n(()=>[u(c,{label:"合同开始日期",prop:"contract_start_date"},{default:n(()=>[u(P,{modelValue:fe.value.contract_start_date,"onUpdate:modelValue":a[9]||(a[9]=e=>fe.value.contract_start_date=e),type:"date",placeholder:"选择开始日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(Y,{gutter:20},{default:n(()=>[u(I,{span:12},{default:n(()=>[u(c,{label:"合同结束日期",prop:"contract_end_date"},{default:n(()=>[u(P,{modelValue:fe.value.contract_end_date,"onUpdate:modelValue":a[10]||(a[10]=e=>fe.value.contract_end_date=e),type:"date",placeholder:"选择结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(A,{"content-position":"left"},{default:n(()=>[...a[23]||(a[23]=[y("客户联系方式",-1)])]),_:1}),u(Y,{gutter:20},{default:n(()=>[u(I,{span:8},{default:n(()=>[u(c,{label:"联系人姓名",prop:"party_a_contact_name"},{default:n(()=>[u(z,{modelValue:fe.value.party_a_contact_name,"onUpdate:modelValue":a[11]||(a[11]=e=>fe.value.party_a_contact_name=e),placeholder:"联系人"},null,8,["modelValue"])]),_:1})]),_:1}),u(I,{span:8},{default:n(()=>[u(c,{label:"联系电话",prop:"party_a_contact_phone"},{default:n(()=>[u(z,{modelValue:fe.value.party_a_contact_phone,"onUpdate:modelValue":a[12]||(a[12]=e=>fe.value.party_a_contact_phone=e),placeholder:"联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),u(I,{span:8},{default:n(()=>[u(c,{label:"联系邮箱",prop:"party_a_contact_email"},{default:n(()=>[u(z,{modelValue:fe.value.party_a_contact_email,"onUpdate:modelValue":a[13]||(a[13]=e=>fe.value.party_a_contact_email=e),placeholder:"邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(c,null,{default:n(()=>[u(J,{type:"primary",loading:pe.value,onClick:xe},{default:n(()=>[...a[24]||(a[24]=[y(" 保存 ",-1)])]),_:1},8,["loading"]),u(J,{onClick:Ue},{default:n(()=>[...a[25]||(a[25]=[y("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),u(Ne,null,{header:n(()=>[b("div",ee,[a[27]||(a[27]=b("span",null,"案例附件",-1)),u(J,{type:"primary",size:"small",onClick:Pe},{default:n(()=>[u(Re,null,{default:n(()=>[u(g(U))]),_:1}),a[26]||(a[26]=y(" 上传附件 ",-1))]),_:1})])]),default:n(()=>[ye.value?(r(),p(g(q),{key:0,text:"加载附件中..."})):he.value.length?(r(),o("div",ae,[(r(!0),o(i,null,_(he.value,e=>(r(),o("div",{key:e.attachment_id,class:"attachment-card"},[b("div",te,[u(Re,{size:32,color:Ee(e.attachment_type)},{default:n(()=>[(r(),p(w(De(e.attachment_type))))]),_:2},1032,["color"]),u(Xe,{type:Ie(e.attachment_type),size:"small"},{default:n(()=>[y(j(Ye(e.attachment_type)),1)]),_:2},1032,["type"])]),b("div",le,[b("div",{class:"file-name",title:e.original_filename},j(e.original_filename),9,ce),b("div",oe,[b("span",re,j(g(N)(e.file_size)),1),b("span",ue,j(g(R)(e.uploaded_at,"date")),1)]),e.attachment_description?(r(),o("div",ne,j(e.attachment_description),1)):k("",!0)]),b("div",se,[u(J,{size:"small",onClick:a=>(e=>{const a=X.downloadCaseAttachment(e.attachment_id);window.open(a,"_blank")})(e)},{default:n(()=>[u(Re,null,{default:n(()=>[u(g(C))]),_:1}),a[28]||(a[28]=y(" 下载 ",-1))]),_:1},8,["onClick"]),u(J,{size:"small",type:"danger",onClick:a=>(async e=>{try{if(!confirm(`确定要删除附件 "${e.original_filename}" 吗？`))return;const a=await X.deleteCaseAttachment(e.attachment_id);a.success?(de("删除成功","附件已删除"),await ze(),L("update")):ie("删除失败",a.error||"未知错误")}catch(a){ie("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:n(()=>[u(Re,null,{default:n(()=>[u(g(x))]),_:1}),a[29]||(a[29]=y(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])):(r(),p(g(Z),{key:1,type:"no-data",description:"暂无附件"}))]),_:1}),u(Ge,{modelValue:be.value,"onUpdate:modelValue":a[18]||(a[18]=e=>be.value=e),title:"上传案例附件",width:"500px",onClose:Le},{footer:n(()=>[u(J,{onClick:a[17]||(a[17]=e=>be.value=!1)},{default:n(()=>[...a[32]||(a[32]=[y("取消",-1)])]),_:1}),u(J,{type:"primary",loading:ge.value,onClick:Ae},{default:n(()=>[...a[33]||(a[33]=[y(" 确定上传 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[u(qe,{ref_key:"uploadFormRef",ref:Ve,model:ke.value,rules:Ce,"label-width":"120px"},{default:n(()=>[u(c,{label:"附件类型",prop:"attachment_type"},{default:n(()=>[u(l,{modelValue:ke.value.attachment_type,"onUpdate:modelValue":a[14]||(a[14]=e=>ke.value.attachment_type=e),placeholder:"请选择附件类型",style:{width:"100%"}},{default:n(()=>[u(t,{label:"合同文件",value:"contract"}),u(t,{label:"验收证明",value:"acceptance"}),u(t,{label:"客户证明",value:"testimony"}),u(t,{label:"项目照片",value:"photo"}),u(t,{label:"其他材料",value:"other"})]),_:1},8,["modelValue"])]),_:1}),u(c,{label:"附件说明",prop:"description"},{default:n(()=>[u(z,{modelValue:ke.value.description,"onUpdate:modelValue":a[15]||(a[15]=e=>ke.value.description=e),type:"textarea",rows:2,placeholder:"请简要说明附件内容（可选）"},null,8,["modelValue"])]),_:1}),u(c,{label:"选择文件",prop:"file"},{default:n(()=>[u(Be,{ref_key:"uploadRef",ref:we,"file-list":je.value,"onUpdate:fileList":a[16]||(a[16]=e=>je.value=e),"auto-upload":!1,limit:1,"on-change":Me,"on-remove":Fe,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",drag:""},{tip:n(()=>[...a[30]||(a[30]=[b("div",{class:"el-upload__tip"}," 支持PDF、DOC、DOCX、JPG、PNG格式，文件大小不超过20MB ",-1)])]),default:n(()=>[u(Re,{class:"el-icon--upload"},{default:n(()=>[u(g(E))]),_:1}),a[31]||(a[31]=b("div",{class:"el-upload__text"},[y(" 拖拽文件到这里 或 "),b("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-5aafca86"]]),ie={class:"case-detail"},_e={class:"detail-header"},pe={class:"header-title"},me={key:1,class:"detail-content"},fe=P(e({__name:"CaseDetail",setup(e){const l=A(),s=L(),{error:d}=a(),i=t(!1),_=t(0),m=t({}),f=async()=>{i.value=!0;try{const e=await X.getCase(_.value);e.success&&e.data?m.value=e.data:(d("加载失败","无法获取案例信息"),V())}catch(e){d("加载失败",e instanceof Error?e.message:"未知错误"),V()}finally{i.value=!1}},v=async()=>{await f()},V=()=>{s.push("/knowledge/case-library")};return c(()=>{const e=l.params.id;if(e){if(_.value=parseInt(e,10),isNaN(_.value))return d("参数错误","无效的案例ID"),void V();f()}else d("参数错误","缺少案例ID"),V()}),(e,a)=>{const t=h,l=K;return r(),o("div",ie,[b("div",_e,[u(t,{onClick:V,icon:"ArrowLeft"},{default:n(()=>[...a[0]||(a[0]=[y("返回列表",-1)])]),_:1}),b("div",pe,[b("h2",null,j(m.value.case_title||"案例详情"),1),m.value.contract_type?(r(),p(l,{key:0,type:"合同"===m.value.contract_type?"primary":"success"},{default:n(()=>[y(j(m.value.contract_type),1)]),_:1},8,["type"])):k("",!0),m.value.product_category?(r(),p(l,{key:1,type:"primary"},{default:n(()=>[y(j(m.value.product_category),1)]),_:1})):k("",!0)])]),i.value?(r(),p(g(q),{key:0,text:"加载案例信息中..."})):(r(),o("div",me,[u(de,{"case-id":_.value,"case-data":m.value,onUpdate:v},null,8,["case-id","case-data"])]))])}}}),[["__scopeId","data-v-ea362180"]]);export{fe as default};
