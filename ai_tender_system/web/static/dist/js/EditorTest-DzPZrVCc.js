import{Q as e,R as t,c as a,N as n,C as l,a as o,M as s,j as r}from"./vendor-element-plus-CEQaQHNc.js";import{eu as d}from"./vendor-other-CxXkF0Pk.js";/* empty css                                                                          */import"./vendor-editor-CGvuleas.js";/* empty css                                                                        */import{R as u}from"./RichTextEditor-C6U3pK9p.js";import"./vendor-dayjs-CeOjnJlt.js";import{_ as i}from"./index.js";import{d as c,r as p,P as m,M as v,c as h,L as g,Q as f,N as y,H as _,O as b,I as k,R as w}from"./vendor-vue-DnBj6vzG.js";import"./vendor-echarts-C00rBISf.js";import"./vendor-axios-BG7aBJwU.js";const C={class:"editor-test-page"},x={style:{"white-space":"pre-wrap","font-size":"12px"}},j={class:"editor-container"},L=i(c({__name:"EditorTest",setup(i){const c=p(null),L=p(""),S=p("word"),T=p(null),P=p(!1),$=p(""),E=e=>{e.raw&&(T.value=e.raw,r.success(`已选择文件: ${e.name}`))},R=async()=>{if(T.value){P.value=!0,$.value="正在转换Word文档...\n";try{const e=new FormData;e.append("file",T.value);const t=await fetch("/api/editor/upload-temp",{method:"POST",body:e});if(!t.ok)throw new Error("文件上传失败");const a=(await t.json()).file_path;$.value+=`✓ 文件已上传: ${a}\n`,$.value+="正在转换为HTML...\n";const n=await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:a})}),l=await n.json();if(!l.success||!l.html_content)throw new Error(l.error||"转换失败");{$.value+=`✓ 转换成功！HTML长度: ${l.html_content.length}\n`;const e=(l.html_content.match(/page-break/g)||[]).length;$.value+=`✓ 检测到 ${e} 个分页符\n`,L.value=l.html_content,c.value&&c.value.setContent(l.html_content),r.success("Word文档已加载到编辑器")}}catch(e){$.value+=`❌ 错误: ${e.message}\n`,r.error("转换失败: "+e.message)}finally{P.value=!1}}else r.warning("请先选择Word文档")},A=()=>{const e='\n<h1>第一章 项目概述</h1>\n<p>这是第一章的内容。我们将在这里介绍项目的基本情况和背景。</p>\n<p>项目名称：智能标书管理系统</p>\n<p>项目目标：提高标书编写效率，降低人工成本。</p>\n\n<hr data-type="page-break" />\n\n<h1>第二章 技术方案</h1>\n<p>本章介绍我们采用的技术方案和架构设计。</p>\n<h2>2.1 系统架构</h2>\n<p>系统采用前后端分离架构，前端使用Vue3 + TypeScript，后端使用Python Flask。</p>\n<h2>2.2 技术栈</h2>\n<ul>\n  <li>前端：Vue3 + Element Plus + UmoEditor</li>\n  <li>后端：Python Flask + SQLAlchemy</li>\n  <li>数据库：SQLite / MySQL</li>\n</ul>\n\n<hr data-type="page-break" />\n\n<h1>第三章 实施计划</h1>\n<p>本章描述项目的实施计划和时间安排。</p>\n<table>\n  <tr>\n    <th>阶段</th>\n    <th>任务</th>\n    <th>时间</th>\n  </tr>\n  <tr>\n    <td>第一阶段</td>\n    <td>需求分析</td>\n    <td>2周</td>\n  </tr>\n  <tr>\n    <td>第二阶段</td>\n    <td>系统开发</td>\n    <td>8周</td>\n  </tr>\n  <tr>\n    <td>第三阶段</td>\n    <td>测试上线</td>\n    <td>2周</td>\n  </tr>\n</table>\n\n<hr data-type="page-break" />\n\n<h1>第四章 总结</h1>\n<p>通过本项目的实施，将大幅提升标书编写效率。</p>\n<p><strong>预期成果：</strong></p>\n<ul>\n  <li>标书编写时间缩短50%</li>\n  <li>错误率降低80%</li>\n  <li>用户满意度提升</li>\n</ul>\n  ';L.value=e,c.value&&c.value.setContent(e),r.success("测试内容已加载（包含3个分页符）")},V=()=>{if(!c.value)return void r.warning("编辑器未就绪");const e=c.value.getContent()+'<hr data-type="page-break" />';c.value.setContent(e),r.success("已插入分页符")},W=()=>{L.value="",c.value&&c.value.clear(),r.success("编辑器已清空")},q=()=>{const e="<p>"+"这是一个很长的段落内容。".repeat(50)+"</p>\n",t=`\n<h1>第一章 项目背景</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第二章 需求分析</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第三章 技术方案</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第四章 实施计划</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第五章 总结</h1>\n${e.repeat(30)}\n  `;L.value=t,c.value&&c.value.setContent(t),r.success("超长文档已加载（包含原生分页符）")},F=()=>{if(c.value)try{c.value.insertPageBreak()?(r.success("✅ 已插入原生分页符"),setTimeout(()=>{const e=c.value.getContent().match(/<div class="umo-page-break"[^>]*>/g);e&&e.length;const t=document.querySelector('[contenteditable="true"]');if(t){t.querySelectorAll(".umo-page-break")}},200)):r.error("插入失败，返回false")}catch(e){r.error("插入失败: "+e.message)}else r.warning("编辑器未就绪")},H=()=>{if(!c.value)return void r.warning("编辑器未就绪");let e=c.value.getEditor();if(e&&e.__v_isRef&&(e=e.value),e&&e.commands){Object.keys(e.commands).filter(e=>e.toLowerCase().includes("page")||e.toLowerCase().includes("break"))}r.success("调试信息已输出到Console，请查看")},M=()=>{var e;if(c.value)try{let t=c.value.getEditor();t&&t.__v_isRef&&(t=t.value),c.value.setLayout&&c.value.setLayout("page"),(null==(e=t.extensionStorage)?void 0:e.page)&&(t.extensionStorage.page.layout="page");const a=document.querySelector(".umo-editor-container");a&&(a.classList.add("page-layout"),a.classList.remove("continuous-layout"));const n=document.querySelectorAll('.umo-editor-container button, .umo-toolbar button, [role="button"]'),l=Array.from(n).filter(e=>{const t=e.textContent||"",a=e.getAttribute("title")||"",n=e.getAttribute("aria-label")||"";return t.includes("页面")||t.includes("布局")||a.includes("页面")||a.includes("布局")||a.toLowerCase().includes("layout")||n.includes("页面")||n.includes("布局")});l.forEach((e,t)=>{}),l.length>0&&l[0].click(),setTimeout(()=>{document.querySelectorAll(".umo-page, [data-page-number]")},300),r.success("已尝试强制启用分页模式，请查看Console")}catch(t){r.error("操作失败: "+t.message)}else r.warning("编辑器未就绪")},O=()=>{setTimeout(()=>{H()},500)};return(r,i)=>{const p=a,Q=l,I=n,N=o,U=t,B=e,D=s;return v(),m("div",C,[h(D,{shadow:"never"},{header:y(()=>[...i[2]||(i[2]=[b("h2",null,"📝 编辑器 & 分页符测试",-1)])]),default:y(()=>[h(B,{modelValue:S.value,"onUpdate:modelValue":i[0]||(i[0]=e=>S.value=e),type:"card"},{default:y(()=>[h(U,{label:"Word文档测试",name:"word"},{default:y(()=>[h(p,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:y(()=>[...i[3]||(i[3]=[_(" 💡 上传一个包含分页符的Word文档，测试分页符是否正确显示 ",-1)])]),_:1}),h(I,{class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".doc,.docx","on-change":E},{tip:y(()=>[...i[4]||(i[4]=[b("div",{class:"el-upload__tip"}," 仅支持 .doc / .docx 格式文件 ",-1)])]),default:y(()=>[h(Q,{class:"el-icon--upload"},{default:y(()=>[h(k(d))]),_:1}),i[5]||(i[5]=b("div",{class:"el-upload__text"},[_(" 拖拽Word文档到此处或 "),b("em",null,"点击上传")],-1))]),_:1}),T.value?(v(),g(N,{key:0,type:"primary",loading:P.value,onClick:R,style:{"margin-top":"16px"}},{default:y(()=>[...i[6]||(i[6]=[_(" 转换并加载到编辑器 ",-1)])]),_:1},8,["loading"])):f("",!0)]),_:1}),h(U,{label:"手动分页符测试",name:"manual"},{default:y(()=>[h(p,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:y(()=>[...i[7]||(i[7]=[_(" 💡 点击下方按钮加载包含分页符的测试内容 ",-1)])]),_:1}),h(N,{type:"primary",onClick:A},{default:y(()=>[...i[8]||(i[8]=[_(" 加载测试内容（带分页符） ",-1)])]),_:1}),h(N,{onClick:V,disabled:!c.value},{default:y(()=>[...i[9]||(i[9]=[_(" 插入HR分页符 ",-1)])]),_:1},8,["disabled"]),h(N,{onClick:F,disabled:!c.value,type:"success"},{default:y(()=>[...i[10]||(i[10]=[_(" 插入原生分页符（实验） ",-1)])]),_:1},8,["disabled"]),h(N,{onClick:H,disabled:!c.value,type:"warning"},{default:y(()=>[...i[11]||(i[11]=[_(" 调试编辑器API ",-1)])]),_:1},8,["disabled"]),h(N,{onClick:M,disabled:!c.value,type:"danger"},{default:y(()=>[...i[12]||(i[12]=[_(" 强制启用分页模式 ",-1)])]),_:1},8,["disabled"]),h(N,{onClick:W,disabled:!c.value},{default:y(()=>[...i[13]||(i[13]=[_(" 清空编辑器 ",-1)])]),_:1},8,["disabled"])]),_:1}),h(U,{label:"长文档测试",name:"long"},{default:y(()=>[h(p,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:y(()=>[...i[14]||(i[14]=[_(" 💡 加载超长文档，测试编辑器性能和分页布局 ",-1)])]),_:1}),h(N,{type:"primary",onClick:q},{default:y(()=>[...i[15]||(i[15]=[_(" 加载长文档（4章节） ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),$.value?(v(),g(D,{key:0,shadow:"never",style:{"margin-top":"16px"}},{header:y(()=>[...i[16]||(i[16]=[b("h3",null,"转换日志",-1)])]),default:y(()=>[b("pre",x,w($.value),1)]),_:1})):f("",!0),h(D,{shadow:"never",style:{"margin-top":"16px"}},{header:y(()=>[...i[17]||(i[17]=[b("h3",null,"富文本编辑器",-1)])]),default:y(()=>[b("div",j,[h(k(u),{ref_key:"editorRef",ref:c,modelValue:L.value,"onUpdate:modelValue":i[1]||(i[1]=e=>L.value=e),title:"测试文档",height:800,onReady:O},null,8,["modelValue"])])]),_:1})])}}}),[["__scopeId","data-v-e5c086fb"]]);export{L as default};
