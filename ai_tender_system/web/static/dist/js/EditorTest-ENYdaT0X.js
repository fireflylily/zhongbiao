import{d as e,r as t,e as a,o as n,f as l,k as o,l as s,w as r,aw as d,ax as u,m as i,p as c,at as p,n as m,ad as v,h,aR as g,g as f,as as y,t as _,A as b}from"./vendor-UMr2cBTC.js";/* empty css                                                                          *//* empty css                                                                        */import{R as w}from"./RichTextEditor-ClY3fAHT.js";import{_ as k}from"./index.js";const C={class:"editor-test-page"},x={style:{"white-space":"pre-wrap","font-size":"12px"}},S={class:"editor-container"},L=k(e({__name:"EditorTest",setup(e){const k=t(null),L=t(""),T=t("word"),$=t(null),j=t(!1),A=t(""),E=e=>{e.raw&&($.value=e.raw,b.success(`已选择文件: ${e.name}`))},P=async()=>{if($.value){j.value=!0,A.value="正在转换Word文档...\n";try{const e=new FormData;e.append("file",$.value);const t=await fetch("/api/editor/upload-temp",{method:"POST",body:e});if(!t.ok)throw new Error("文件上传失败");const a=(await t.json()).file_path;A.value+=`✓ 文件已上传: ${a}\n`,A.value+="正在转换为HTML...\n";const n=await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:a})}),l=await n.json();if(!l.success||!l.html_content)throw new Error(l.error||"转换失败");{A.value+=`✓ 转换成功！HTML长度: ${l.html_content.length}\n`;const e=(l.html_content.match(/page-break/g)||[]).length;A.value+=`✓ 检测到 ${e} 个分页符\n`,L.value=l.html_content,k.value&&k.value.setContent(l.html_content),b.success("Word文档已加载到编辑器")}}catch(e){A.value+=`❌ 错误: ${e.message}\n`,b.error("转换失败: "+e.message)}finally{j.value=!1}}else b.warning("请先选择Word文档")},R=()=>{const e='\n<h1>第一章 项目概述</h1>\n<p>这是第一章的内容。我们将在这里介绍项目的基本情况和背景。</p>\n<p>项目名称：智能标书管理系统</p>\n<p>项目目标：提高标书编写效率，降低人工成本。</p>\n\n<hr data-type="page-break" />\n\n<h1>第二章 技术方案</h1>\n<p>本章介绍我们采用的技术方案和架构设计。</p>\n<h2>2.1 系统架构</h2>\n<p>系统采用前后端分离架构，前端使用Vue3 + TypeScript，后端使用Python Flask。</p>\n<h2>2.2 技术栈</h2>\n<ul>\n  <li>前端：Vue3 + Element Plus + UmoEditor</li>\n  <li>后端：Python Flask + SQLAlchemy</li>\n  <li>数据库：SQLite / MySQL</li>\n</ul>\n\n<hr data-type="page-break" />\n\n<h1>第三章 实施计划</h1>\n<p>本章描述项目的实施计划和时间安排。</p>\n<table>\n  <tr>\n    <th>阶段</th>\n    <th>任务</th>\n    <th>时间</th>\n  </tr>\n  <tr>\n    <td>第一阶段</td>\n    <td>需求分析</td>\n    <td>2周</td>\n  </tr>\n  <tr>\n    <td>第二阶段</td>\n    <td>系统开发</td>\n    <td>8周</td>\n  </tr>\n  <tr>\n    <td>第三阶段</td>\n    <td>测试上线</td>\n    <td>2周</td>\n  </tr>\n</table>\n\n<hr data-type="page-break" />\n\n<h1>第四章 总结</h1>\n<p>通过本项目的实施，将大幅提升标书编写效率。</p>\n<p><strong>预期成果：</strong></p>\n<ul>\n  <li>标书编写时间缩短50%</li>\n  <li>错误率降低80%</li>\n  <li>用户满意度提升</li>\n</ul>\n  ';L.value=e,k.value&&k.value.setContent(e),b.success("测试内容已加载（包含3个分页符）")},V=()=>{if(!k.value)return void b.warning("编辑器未就绪");const e=k.value.getContent()+'<hr data-type="page-break" />';k.value.setContent(e),b.success("已插入分页符")},W=()=>{L.value="",k.value&&k.value.clear(),b.success("编辑器已清空")},q=()=>{const e="<p>"+"这是一个很长的段落内容。".repeat(50)+"</p>\n",t=`\n<h1>第一章 项目背景</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第二章 需求分析</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第三章 技术方案</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第四章 实施计划</h1>\n${e.repeat(30)}\n\n<div class="umo-page-break" data-line-number="false" data-content="分页符"></div>\n\n<h1>第五章 总结</h1>\n${e.repeat(30)}\n  `;L.value=t,k.value&&k.value.setContent(t),b.success("超长文档已加载（包含原生分页符）")},F=()=>{if(k.value)try{k.value.insertPageBreak()?(b.success("✅ 已插入原生分页符"),setTimeout(()=>{const e=k.value.getContent().match(/<div class="umo-page-break"[^>]*>/g);e&&e.length;const t=document.querySelector('[contenteditable="true"]');if(t){t.querySelectorAll(".umo-page-break")}},200)):b.error("插入失败，返回false")}catch(e){b.error("插入失败: "+e.message)}else b.warning("编辑器未就绪")},H=()=>{if(!k.value)return void b.warning("编辑器未就绪");let e=k.value.getEditor();if(e&&e.__v_isRef&&(e=e.value),e&&e.commands){Object.keys(e.commands).filter(e=>e.toLowerCase().includes("page")||e.toLowerCase().includes("break"))}b.success("调试信息已输出到Console，请查看")},O=()=>{var e;if(k.value)try{let t=k.value.getEditor();t&&t.__v_isRef&&(t=t.value),k.value.setLayout&&k.value.setLayout("page"),(null==(e=t.extensionStorage)?void 0:e.page)&&(t.extensionStorage.page.layout="page");const a=document.querySelector(".umo-editor-container");a&&(a.classList.add("page-layout"),a.classList.remove("continuous-layout"));const n=document.querySelectorAll('.umo-editor-container button, .umo-toolbar button, [role="button"]'),l=Array.from(n).filter(e=>{const t=e.textContent||"",a=e.getAttribute("title")||"",n=e.getAttribute("aria-label")||"";return t.includes("页面")||t.includes("布局")||a.includes("页面")||a.includes("布局")||a.toLowerCase().includes("layout")||n.includes("页面")||n.includes("布局")});l.forEach((e,t)=>{}),l.length>0&&l[0].click(),setTimeout(()=>{document.querySelectorAll(".umo-page, [data-page-number]")},300),b.success("已尝试强制启用分页模式，请查看Console")}catch(t){b.error("操作失败: "+t.message)}else b.warning("编辑器未就绪")},M=()=>{setTimeout(()=>{H()},500)};return(e,t)=>{const b=i,Q=v,U=p,z=f,D=u,I=d,B=y;return n(),a("div",C,[l(B,{shadow:"never"},{header:r(()=>[...t[2]||(t[2]=[m("h2",null,"📝 编辑器 & 分页符测试",-1)])]),default:r(()=>[l(I,{modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=e=>T.value=e),type:"card"},{default:r(()=>[l(D,{label:"Word文档测试",name:"word"},{default:r(()=>[l(b,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:r(()=>[...t[3]||(t[3]=[c(" 💡 上传一个包含分页符的Word文档，测试分页符是否正确显示 ",-1)])]),_:1}),l(U,{class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".doc,.docx","on-change":E},{tip:r(()=>[...t[4]||(t[4]=[m("div",{class:"el-upload__tip"}," 仅支持 .doc / .docx 格式文件 ",-1)])]),default:r(()=>[l(Q,{class:"el-icon--upload"},{default:r(()=>[l(h(g))]),_:1}),t[5]||(t[5]=m("div",{class:"el-upload__text"},[c(" 拖拽Word文档到此处或 "),m("em",null,"点击上传")],-1))]),_:1}),$.value?(n(),o(z,{key:0,type:"primary",loading:j.value,onClick:P,style:{"margin-top":"16px"}},{default:r(()=>[...t[6]||(t[6]=[c(" 转换并加载到编辑器 ",-1)])]),_:1},8,["loading"])):s("",!0)]),_:1}),l(D,{label:"手动分页符测试",name:"manual"},{default:r(()=>[l(b,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:r(()=>[...t[7]||(t[7]=[c(" 💡 点击下方按钮加载包含分页符的测试内容 ",-1)])]),_:1}),l(z,{type:"primary",onClick:R},{default:r(()=>[...t[8]||(t[8]=[c(" 加载测试内容（带分页符） ",-1)])]),_:1}),l(z,{onClick:V,disabled:!k.value},{default:r(()=>[...t[9]||(t[9]=[c(" 插入HR分页符 ",-1)])]),_:1},8,["disabled"]),l(z,{onClick:F,disabled:!k.value,type:"success"},{default:r(()=>[...t[10]||(t[10]=[c(" 插入原生分页符（实验） ",-1)])]),_:1},8,["disabled"]),l(z,{onClick:H,disabled:!k.value,type:"warning"},{default:r(()=>[...t[11]||(t[11]=[c(" 调试编辑器API ",-1)])]),_:1},8,["disabled"]),l(z,{onClick:O,disabled:!k.value,type:"danger"},{default:r(()=>[...t[12]||(t[12]=[c(" 强制启用分页模式 ",-1)])]),_:1},8,["disabled"]),l(z,{onClick:W,disabled:!k.value},{default:r(()=>[...t[13]||(t[13]=[c(" 清空编辑器 ",-1)])]),_:1},8,["disabled"])]),_:1}),l(D,{label:"长文档测试",name:"long"},{default:r(()=>[l(b,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:r(()=>[...t[14]||(t[14]=[c(" 💡 加载超长文档，测试编辑器性能和分页布局 ",-1)])]),_:1}),l(z,{type:"primary",onClick:q},{default:r(()=>[...t[15]||(t[15]=[c(" 加载长文档（4章节） ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),A.value?(n(),o(B,{key:0,shadow:"never",style:{"margin-top":"16px"}},{header:r(()=>[...t[16]||(t[16]=[m("h3",null,"转换日志",-1)])]),default:r(()=>[m("pre",x,_(A.value),1)]),_:1})):s("",!0),l(B,{shadow:"never",style:{"margin-top":"16px"}},{header:r(()=>[...t[17]||(t[17]=[m("h3",null,"富文本编辑器",-1)])]),default:r(()=>[m("div",S,[l(h(w),{ref_key:"editorRef",ref:k,modelValue:L.value,"onUpdate:modelValue":t[1]||(t[1]=e=>L.value=e),title:"测试文档",height:800,onReady:M},null,8,["modelValue"])])]),_:1})])}}}),[["__scopeId","data-v-e5c086fb"]]);export{L as default};
