import{M as a,O as e,g as t,ae as l,af as o,R as s,P as i,Q as r,U as n,q as d,ag as c,ah as u,ai as p,aj as m,_}from"./index.js";/* empty css                             *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                                                                        */import{E as f,a as y}from"./el-select-DdF3cFxb.js";/* empty css                */import{L as v}from"./Loading-q_BNBU2K.js";import{E as w}from"./Empty-B5MIzHkd.js";/* empty css                */import{C as g}from"./Card-B7Csokz5.js";/* empty css                                                                          */import{aq as h,am as b,an as j,aV as x,aw as k,as as C,av as E,au as q,at as V,ay as z,aR as L,ar as I,aS as D}from"./editor-BksuvsBo.js";/* empty css                   *//* empty css                */import{c as P}from"./company-CgN_f2mJ.js";import{C as U}from"./CompanyInfoExtractorDialog-BZzaOg4A.js";import{E as $}from"./index-CaR2Xywu.js";import{b as M,E as O,a as Q}from"./index-4AJA-Lo_.js";import{E as R,a as F}from"./index-BQ1extYL.js";import{E as H}from"./index-BRJO3xF8.js";import{E as S}from"./index-CVN4vWqy.js";import"./index-DIagUHFq.js";import"./strings-DK8QLfUq.js";import"./index-CzDCqbWO.js";import"./toNumber-CaKcxK6u.js";import"./_baseFindIndex-BTqrMG7V.js";import"./_baseIteratee-CoZ4vtCr.js";import"./el-tab-pane-BmqP5eQA.js";import"./raf-B6jWGkGX.js";import"./clamp-DXmBoM08.js";import"./index-DJhc04Ps.js";import"./cloneDeep-syPWYH98.js";import"./index-BC8-jPfA.js";import"./index-D3Fm_fS5.js";import"./index-D9lgUf6z.js";import"./flatMap-Cn50Lb61.js";import"./map-D9sy2acr.js";import"./_baseEach-C84OUv0l.js";const A={class:"company-library"},G={class:"stats-bar"},J={class:"stat-content"},K={class:"stat-icon"},N={class:"stat-info"},W={class:"stat-value"},X={class:"stat-content"},Y={class:"stat-icon"},B={class:"stat-info"},T={class:"stat-value"},Z={class:"filter-section"},aa={class:"qualification-progress"},ea={class:"progress-text"},ta=_(h({__name:"CompanyLibrary",setup(_){const h=a(),{success:ta,error:la}=e(),oa=b(!1),sa=b([]),ia=b({keyword:"",industry:""}),ra=b(!1),na=j(()=>{let a=[...sa.value];if(ia.value.keyword){const e=ia.value.keyword.toLowerCase();a=a.filter(a=>{var t,l,o;return(null==(t=a.company_name)?void 0:t.toLowerCase().includes(e))||(null==(l=a.social_credit_code)?void 0:l.toLowerCase().includes(e))||(null==(o=a.company_code)?void 0:o.toLowerCase().includes(e))})}return ia.value.industry&&(a=a.filter(a=>a.industry_type===ia.value.industry)),a}),da=async()=>{oa.value=!0;try{const a=(await P.getCompanies()).data||[],e=await Promise.all(a.map(async a=>{let e=0;try{const t=await P.getCompanyQualifications(a.company_id);t.data&&(e=Object.keys(t.data).length)}catch(l){}const t=Math.round(e/17*100);return{company_id:a.company_id,company_name:a.company_name||"未命名",company_code:a.company_code||"",social_credit_code:a.social_credit_code||"-",legal_representative:a.legal_representative||"-",registered_capital:a.registered_capital||"-",employee_count:a.employee_count||"-",industry_type:a.industry_type||"",product_count:a.product_count||0,document_count:a.document_count||0,qualification_completed:e,qualification_total:17,qualification_progress:t,created_at:a.created_at||"-",updated_at:a.updated_at||"-",...a}}));sa.value=e}catch(a){la("加载失败",a instanceof Error?a.message:"未知错误")}finally{oa.value=!1}},ca=()=>{},ua=()=>{ia.value.keyword="",ia.value.industry=""},pa=()=>{h.push("/knowledge/company/new")},ma=a=>{"manual"===a?h.push("/knowledge/company/new"):"extract"===a&&(ra.value=!0)},_a=a=>{h.push(`/knowledge/company/${a}`)};return x(()=>{da()}),(a,e)=>{const _=t,b=$,j=r,x=i,fa=y,ya=f,va=d,wa=Q,ga=O,ha=M,ba=s,ja=F,xa=H,ka=S,Ca=R;return C(),k("div",A,[E("div",G,[q(b,{class:"stat-card"},{default:V(()=>[E("div",J,[E("div",K,[q(_,{size:32,color:"#409eff"},{default:V(()=>[q(z(l))]),_:1})]),E("div",N,[e[3]||(e[3]=E("div",{class:"stat-label"},"总企业数",-1)),E("div",W,L(sa.value.length),1)])])]),_:1}),q(b,{class:"stat-card"},{default:V(()=>[E("div",X,[E("div",Y,[q(_,{size:32,color:"#67c23a"},{default:V(()=>[q(z(o))]),_:1})]),E("div",B,[e[4]||(e[4]=E("div",{class:"stat-label"},"筛选结果",-1)),E("div",T,L(na.value.length),1)])])]),_:1})]),q(z(g),{title:"企业列表"},{default:V(()=>[E("div",Z,[q(ba,{inline:!0,model:ia.value},{default:V(()=>[q(x,{label:"搜索"},{default:V(()=>[q(j,{modelValue:ia.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>ia.value.keyword=a),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:ca},{prefix:V(()=>[q(_,null,{default:V(()=>[q(z(n))]),_:1})]),_:1},8,["modelValue"])]),_:1}),q(x,{label:"行业类型"},{default:V(()=>[q(ya,{modelValue:ia.value.industry,"onUpdate:modelValue":e[1]||(e[1]=a=>ia.value.industry=a),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:ca},{default:V(()=>[q(fa,{label:"全部行业",value:""}),q(fa,{label:"科技",value:"technology"}),q(fa,{label:"制造业",value:"manufacturing"}),q(fa,{label:"金融",value:"finance"}),q(fa,{label:"教育",value:"education"}),q(fa,{label:"医疗",value:"healthcare"}),q(fa,{label:"零售",value:"retail"}),q(fa,{label:"建筑",value:"construction"}),q(fa,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),q(x,null,{default:V(()=>[q(va,{onClick:ua},{default:V(()=>[q(_,null,{default:V(()=>[q(z(c))]),_:1}),e[5]||(e[5]=D(" 重置 ",-1))]),_:1})]),_:1}),q(x,{style:{"margin-left":"auto"}},{default:V(()=>[q(ha,{"split-button":"",type:"primary",onClick:pa,onCommand:ma},{dropdown:V(()=>[q(ga,null,{default:V(()=>[q(wa,{command:"manual"},{default:V(()=>[q(_,null,{default:V(()=>[q(z(p))]),_:1}),e[6]||(e[6]=D(" 手动创建 ",-1))]),_:1}),q(wa,{command:"extract",divided:""},{default:V(()=>[q(_,null,{default:V(()=>[q(z(m))]),_:1}),e[7]||(e[7]=D(" 从标书创建 ",-1))]),_:1})]),_:1})]),default:V(()=>[q(_,null,{default:V(()=>[q(z(u))]),_:1}),e[8]||(e[8]=D(" 新建企业 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),q(U,{modelValue:ra.value,"onUpdate:modelValue":e[2]||(e[2]=a=>ra.value=a),onSuccess:_a},null,8,["modelValue"]),oa.value?(C(),I(z(v),{key:0,text:"加载中..."})):na.value.length?(C(),I(Ca,{key:2,data:na.value,stripe:"",style:{width:"100%"}},{default:V(()=>[q(ja,{prop:"company_id",label:"ID",width:"70",fixed:""}),q(ja,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),q(ja,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),q(ja,{prop:"legal_representative",label:"法定代表人",width:"120"}),q(ja,{prop:"registered_capital",label:"注册资本",width:"120"}),q(ja,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),q(ja,{label:"资质完成度",width:"180",align:"center"},{default:V(({row:a})=>{return[E("div",aa,[q(xa,{percentage:a.qualification_progress||0,color:(e=a.qualification_progress||0,e<30?"#f56c6c":e<70?"#e6a23c":"#67c23a"),"stroke-width":8},null,8,["percentage","color"]),E("span",ea,L(a.qualification_completed||0)+"/"+L(a.qualification_total||17),1)])];var e}),_:1}),q(ja,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:V(({row:a})=>[q(ka,{size:"small",type:"info"},{default:V(()=>[D(L(a.product_count||0),1)]),_:2},1024)]),_:1}),q(ja,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:V(({row:a})=>[q(ka,{size:"small",type:"success"},{default:V(()=>[D(L(a.document_count||0),1)]),_:2},1024)]),_:1}),q(ja,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),q(ja,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),q(ja,{label:"操作",width:"220",fixed:"right"},{default:V(({row:a})=>[q(va,{text:"",type:"primary",size:"small",onClick:e=>(a=>{h.push(`/knowledge/company/${a.company_id}`)})(a)},{default:V(()=>[...e[9]||(e[9]=[D(" 查看详情 ",-1)])]),_:1},8,["onClick"]),q(va,{text:"",type:"warning",size:"small",onClick:e=>(a=>{h.push(`/knowledge/company/${a.company_id}`)})(a)},{default:V(()=>[...e[10]||(e[10]=[D(" 编辑 ",-1)])]),_:1},8,["onClick"]),q(va,{text:"",type:"danger",size:"small",onClick:e=>(async a=>{try{if(!confirm(`确定要删除企业 "${a.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`))return;await P.deleteCompany(a.company_id),ta("删除成功",`已删除企业: ${a.company_name}`),await da()}catch(e){la("删除失败",e instanceof Error?e.message:"未知错误")}})(a)},{default:V(()=>[...e[11]||(e[11]=[D(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(C(),I(z(w),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1})])}}}),[["__scopeId","data-v-08cfc62f"]]);export{ta as default};
