import{p as e,M as a,o as t,_ as l}from"./index.js";import{I as s,E as i}from"./IconButton-Qee39fER.js";/* empty css               */import"./el-select-DqTgNP53.js";/* empty css                     *//* empty css                             *//* empty css                    *//* empty css                */import{L as r}from"./Loading-BbpkiFy4.js";import{E as o}from"./Empty-_DWqpRYT.js";/* empty css                */import{C as n}from"./Card-CnnUN2Lr.js";/* empty css                */import{aw as p,am as c,aW as u,aC as d,az as m,aE as _,aA as f,ay as y,aD as v,aF as b,aR as h,aQ as g,aO as j,bc as w}from"./editor-BnIwMfSr.js";/* empty css                                                                          *//* empty css                   *//* empty css                                                                        */import{t as k}from"./tender-ZYcn_VXM.js";import{c as z}from"./company-DX6fQVXW.js";import{E as x,a as C}from"./index-C_g1mHHx.js";import{E}from"./index-BINbdg4f.js";import{E as D}from"./strings-C1SMPKoP.js";import"./index-MUx5pvc7.js";import"./toNumber-CvdKE1Ff.js";import"./_baseIteratee-BqOhzFRz.js";import"./index-JsWBjt7x.js";import"./flatMap-mWT7Ede4.js";import"./map-4pQfWjzt.js";import"./_baseEach-Bi-tj1bN.js";import"./index-BadcLKMM.js";import"./raf-B6jWGkGX.js";const P={class:"tender-management"},M={key:3,class:"pagination-wrapper"},I=l(p({__name:"Management",setup(l){const p=c(!1),I=c(!1),Y=c([]),$=c(1),F=c(10),H=c(0),S=e(),{success:T,error:U}=a(),A=async()=>{var e,a;p.value=!0;try{const t=await k.getProjects({page:$.value,page_size:F.value}),l=(null==(e=t.data)?void 0:e.items)||t.data||[];Y.value=l.map(e=>({id:e.project_id,name:e.project_name,number:e.project_number,company_name:e.company_name,status:e.status,created_at:e.created_at,...e})),H.value=(null==(a=t.data)?void 0:a.total)||Y.value.length}catch(t){U("加载失败",t instanceof Error?t.message:"未知错误")}finally{p.value=!1}},L=e=>{S.push({name:"TenderManagementDetail",params:{id:e.id}})},N=async()=>{I.value=!0;try{const e=(await z.getCompanies()).data||[];if(0===e.length)return void U("无法创建项目：请先添加公司信息");const a=(await k.createProject({project_name:"新项目",project_number:`PRJ-${Date.now()}`,company_id:e[0].company_id})).project_id;T("创建成功"),S.push({name:"TenderManagementDetail",params:{id:a}})}catch(e){const a=e instanceof Error?e.message:"未知错误";U(`创建项目失败：${a}`)}finally{I.value=!1}},O=e=>{F.value=e,$.value=1,A()},Q=e=>{$.value=e,A()};return u(()=>{A()}),(e,a)=>{const l=t,c=C,u=E,z=D,S=x,R=i;return m(),d("div",P,[_(b(n),{title:"项目列表"},{actions:f(()=>[_(l,{type:"primary",loading:I.value,onClick:N},{default:f(()=>[...a[2]||(a[2]=[j("i",{class:"bi bi-plus-lg"},null,-1),h(" 新建项目 ",-1)])]),_:1},8,["loading"])]),default:f(()=>[p.value?(m(),y(b(r),{key:0,text:"加载中..."})):Y.value.length?(m(),y(S,{key:2,data:Y.value,stripe:"",style:{width:"100%"}},{default:f(()=>[_(c,{prop:"id",label:"ID",width:"70",fixed:""}),_(c,{prop:"name",label:"项目名称","min-width":"200",fixed:""},{default:f(({row:e})=>[_(u,{type:"primary",onClick:a=>L(e)},{default:f(()=>[h(g(e.name),1)]),_:2},1032,["onClick"])]),_:1}),_(c,{prop:"tenderer",label:"招标人","min-width":"180","show-overflow-tooltip":""}),_(c,{prop:"authorized_person_name",label:"被授权人",width:"100"}),_(c,{label:"商务应答",width:"100",align:"center"},{default:f(({row:e})=>{return[(t=e,"已完成"===(null==(l=t.business_response)?void 0:l.status)||(null==(s=t.business_response)?void 0:s.file_path)?(m(),y(z,{key:0,type:"success",size:"small"},{default:f(()=>[...a[3]||(a[3]=[j("i",{class:"bi bi-check-circle-fill"},null,-1),h(" 已生成 ",-1)])]),_:1})):(m(),y(z,{key:1,type:"info",size:"small"},{default:f(()=>[...a[4]||(a[4]=[j("i",{class:"bi bi-dash-circle"},null,-1),h(" 未生成 ",-1)])]),_:1})))];var t,l,s}),_:1}),_(c,{label:"技术点对点",width:"110",align:"center"},{default:f(({row:e})=>{return[(t=e,"已完成"===(null==(l=t.tech_response)?void 0:l.status)||(null==(s=t.tech_response)?void 0:s.file_path)?(m(),y(z,{key:0,type:"success",size:"small"},{default:f(()=>[...a[5]||(a[5]=[j("i",{class:"bi bi-check-circle-fill"},null,-1),h(" 已生成 ",-1)])]),_:1})):(m(),y(z,{key:1,type:"info",size:"small"},{default:f(()=>[...a[6]||(a[6]=[j("i",{class:"bi bi-dash-circle"},null,-1),h(" 未生成 ",-1)])]),_:1})))];var t,l,s}),_:1}),_(c,{label:"技术方案",width:"100",align:"center"},{default:f(({row:e})=>{return[(t=e,"已完成"===(null==(l=t.tech_proposal)?void 0:l.status)||(null==(s=t.tech_proposal)?void 0:s.file_path)?(m(),y(z,{key:0,type:"success",size:"small"},{default:f(()=>[...a[7]||(a[7]=[j("i",{class:"bi bi-check-circle-fill"},null,-1),h(" 已生成 ",-1)])]),_:1})):(m(),y(z,{key:1,type:"info",size:"small"},{default:f(()=>[...a[8]||(a[8]=[j("i",{class:"bi bi-dash-circle"},null,-1),h(" 未生成 ",-1)])]),_:1})))];var t,l,s}),_:1}),_(c,{label:"最后融合",width:"100",align:"center"},{default:f(({row:e})=>{return[(t=e,"已完成"===(null==(l=t.fusion)?void 0:l.status)||(null==(s=t.fusion)?void 0:s.file_path)?(m(),y(z,{key:0,type:"success",size:"small"},{default:f(()=>[...a[9]||(a[9]=[j("i",{class:"bi bi-check-circle-fill"},null,-1),h(" 已融合 ",-1)])]),_:1})):(m(),y(z,{key:1,type:"info",size:"small"},{default:f(()=>[...a[10]||(a[10]=[j("i",{class:"bi bi-dash-circle"},null,-1),h(" 未融合 ",-1)])]),_:1})))];var t,l,s}),_:1}),_(c,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:f(({row:e})=>["active"===e.status?(m(),y(z,{key:0,type:"success"},{default:f(()=>[...a[11]||(a[11]=[h("进行中",-1)])]),_:1})):"completed"===e.status?(m(),y(z,{key:1,type:"primary"},{default:f(()=>[...a[12]||(a[12]=[h("已完成",-1)])]),_:1})):(m(),y(z,{key:2,type:"info"},{default:f(()=>[...a[13]||(a[13]=[h("草稿",-1)])]),_:1}))]),_:1}),_(c,{prop:"created_at",label:"创建时间",width:"160"},{default:f(({row:e})=>{return[h(g((a=e.created_at,a?w(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),_(c,{label:"操作",width:"120",fixed:"right"},{default:f(({row:e})=>[_(b(s),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:a=>L(e)},null,8,["onClick"]),_(b(s),{icon:"bi-trash",type:"danger",tooltip:"删除项目",onClick:a=>(async e=>{try{if(!confirm(`确定要删除项目 "${e.name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`))return;await k.deleteProject(e.id),T("删除成功",`已删除项目: ${e.name}`),await A()}catch(a){U("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])):(m(),y(b(o),{key:1,type:"no-data",description:"暂无项目"})),Y.value.length>0?(m(),d("div",M,[_(R,{"current-page":$.value,"onUpdate:currentPage":a[0]||(a[0]=e=>$.value=e),"page-size":F.value,"onUpdate:pageSize":a[1]||(a[1]=e=>F.value=e),total:H.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:Q},null,8,["current-page","page-size","total"])])):v("",!0)]),_:1})])}}}),[["__scopeId","data-v-2cddd536"]]);export{I as default};
