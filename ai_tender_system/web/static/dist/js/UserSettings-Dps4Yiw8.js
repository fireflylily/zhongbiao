import{M as a,N as e,R as l,P as s,Q as r,g as o,aq as d,q as t,ab as u,ag as n,n as i,am as m,ar as p,as as f,E as w,_ as c}from"./index.js";/* empty css                *//* empty css                *//* empty css               */import{E as _,a as g}from"./el-tab-pane-CrT1S_Zl.js";import{E as b}from"./el-space-3Lup-rUq.js";import{E as v}from"./el-text-Cbr1aI-6.js";import{P}from"./PageHeader-_Ra4a2cc.js";import{E as y}from"./index-nzMCCPZ_.js";import{E as j}from"./index-DOF8wyI3.js";import{aq as h,am as x,bu as V,aw as U,as as E,au as q,av as k,at as R,ay as S,aS as z,aR as C}from"./editor-B2OO2pov.js";import"./raf-B6jWGkGX.js";import"./strings-AttvWK4d.js";import"./clamp-DmrTTiq0.js";import"./toNumber-BHhAPexX.js";const F={class:"user-settings-page"},I={class:"settings-container"},N={class:"tab-label"},T={class:"tab-label"},D=c(h({__name:"UserSettings",setup(c){const h=a(),D=e(),G=x("password"),H=x(),L=V({oldPassword:"",newPassword:"",confirmPassword:""}),M=x(!1),Q={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"},{validator:(a,e,l)=>{e&&e===L.oldPassword?l(new Error("新密码不能与当前密码相同")):l()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(a,e,l)=>{e!==L.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]};function W(){var a;null==(a=H.value)||a.resetFields(),L.oldPassword="",L.newPassword="",L.confirmPassword=""}async function Y(){var a,e,l,s;if(!H.value)return;if(await H.value.validate().catch(()=>!1)){M.value=!0;try{const a=await f.changePassword({old_password:L.oldPassword,new_password:L.newPassword,confirm_password:L.confirmPassword});a.success?(w.success("密码修改成功，请重新登录"),W(),setTimeout(async()=>{await D.logout(),h.push("/login")},2e3)):w.error(a.message||"修改密码失败")}catch(r){401===(null==(a=r.response)?void 0:a.status)?w.error((null==(e=r.response.data)?void 0:e.message)||"当前密码错误"):w.error((null==(s=null==(l=r.response)?void 0:l.data)?void 0:s.message)||"修改密码失败，请稍后重试")}finally{M.value=!1}}}return(a,e)=>{const f=o,w=r,c=s,h=v,x=t,V=b,A=l,B=i,J=g,K=y,O=_,X=j;return E(),U("div",F,[q(P,{title:"用户设置",icon:"bi-gear"}),k("div",I,[q(X,{class:"settings-card"},{default:R(()=>[q(O,{modelValue:G.value,"onUpdate:modelValue":e[3]||(e[3]=a=>G.value=a),class:"settings-tabs"},{default:R(()=>[q(J,{label:"修改密码",name:"password"},{label:R(()=>[k("span",N,[q(f,null,{default:R(()=>[q(S(d))]),_:1}),e[4]||(e[4]=z(" 修改密码 ",-1))])]),default:R(()=>[q(A,{ref_key:"passwordFormRef",ref:H,model:L,rules:Q,"label-width":"120px",class:"password-form"},{default:R(()=>[q(c,{label:"当前密码",prop:"oldPassword"},{default:R(()=>[q(w,{modelValue:L.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=a=>L.oldPassword=a),type:"password",placeholder:"请输入当前密码","show-password":"",clearable:""},{prefix:R(()=>[q(f,null,{default:R(()=>[q(S(d))]),_:1})]),_:1},8,["modelValue"])]),_:1}),q(c,{label:"新密码",prop:"newPassword"},{extra:R(()=>[q(h,{type:"info",size:"small"},{default:R(()=>[...e[5]||(e[5]=[z("密码长度至少为6个字符",-1)])]),_:1})]),default:R(()=>[q(w,{modelValue:L.newPassword,"onUpdate:modelValue":e[1]||(e[1]=a=>L.newPassword=a),type:"password",placeholder:"请输入新密码（至少6个字符）","show-password":"",clearable:""},{prefix:R(()=>[q(f,null,{default:R(()=>[q(S(d))]),_:1})]),_:1},8,["modelValue"])]),_:1}),q(c,{label:"确认新密码",prop:"confirmPassword"},{default:R(()=>[q(w,{modelValue:L.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>L.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":"",clearable:""},{prefix:R(()=>[q(f,null,{default:R(()=>[q(S(d))]),_:1})]),_:1},8,["modelValue"])]),_:1}),q(c,null,{default:R(()=>[q(V,null,{default:R(()=>[q(x,{type:"primary",loading:M.value,onClick:Y},{default:R(()=>[q(f,null,{default:R(()=>[q(S(u))]),_:1}),e[6]||(e[6]=z(" 确认修改 ",-1))]),_:1},8,["loading"]),q(x,{onClick:W},{default:R(()=>[q(f,null,{default:R(()=>[q(S(n))]),_:1}),e[7]||(e[7]=z(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),q(B,{title:"温馨提示",type:"warning",closable:!1,"show-icon":"",class:"mt-4"},{default:R(()=>[...e[8]||(e[8]=[k("ul",{class:"tips-list"},[k("li",null,"修改密码后需要重新登录"),k("li",null,"请妥善保管您的密码，不要告诉他人"),k("li",null,"建议定期更换密码，提高账号安全性")],-1)])]),_:1})]),_:1}),q(J,{label:"基本信息",name:"profile"},{label:R(()=>[k("span",T,[q(f,null,{default:R(()=>[q(S(m))]),_:1}),e[9]||(e[9]=z(" 基本信息 ",-1))])]),default:R(()=>[q(A,{"label-width":"120px",class:"profile-form"},{default:R(()=>[q(c,{label:"用户名"},{default:R(()=>{var a;return[q(w,{"model-value":(null==(a=S(D).currentUser)?void 0:a.username)||"-",readonly:"",disabled:""},{prefix:R(()=>[q(f,null,{default:R(()=>[q(S(m))]),_:1})]),_:1},8,["model-value"])]}),_:1}),q(c,{label:"邮箱"},{default:R(()=>{var a;return[q(w,{"model-value":(null==(a=S(D).currentUser)?void 0:a.email)||"-",readonly:"",disabled:""},{prefix:R(()=>[q(f,null,{default:R(()=>[q(S(p))]),_:1})]),_:1},8,["model-value"])]}),_:1}),q(c,{label:"角色"},{default:R(()=>{var a,e;return[q(K,{type:(e=null==(a=S(D).currentUser)?void 0:a.role,{"管理员":"danger","高级管理":"danger","项目经理":"warning","内部员工":"success","普通用户":"info"}[e||""]||"info"),size:"large"},{default:R(()=>{var a;return[z(C((null==(a=S(D).currentUser)?void 0:a.role)||"-"),1)]}),_:1},8,["type"])]}),_:1}),q(c,{label:"用户ID"},{default:R(()=>[q(h,null,{default:R(()=>{var a;return[z(C((null==(a=S(D).currentUser)?void 0:a.id)||"-"),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])])}}}),[["__scopeId","data-v-9bea309a"]]);export{D as default};
