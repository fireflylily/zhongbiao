import{u as e,bl as a,az as l,bm as t,ay as o,bn as i,l as r,_ as s,w as d,M as n,L as c,e as u,bo as p,aS as m,bp as v,ap as _,d as f,ab as y,ac as g,aP as h,t as b,bq as k,O as w,S as C,B as x,P as V,N as j,h as E,G as N,q as U}from"./index.js";/* empty css               */import{E as $,a as z,s as O}from"./el-select-CldpbmUv.js";/* empty css                     *//* empty css                             */import{E as S}from"./el-tree-CUlCaDRQ.js";/* empty css                    */import"./el-text-Kv3Vn9-t.js";import{E as T}from"./el-input-number-CnPBhObR.js";/* empty css                */import{E as K}from"./el-pagination-CQGtFIJ_.js";/* empty css                    */import{a as P,E as M}from"./el-tab-pane-CC1O_BHr.js";/* empty css                         *//* empty css                */import{ap as L,ao as A,bz as R,aF as q,am as D,c3 as B,bR as F,aG as I,bO as J,an as H,bt as G,aW as Q,bA as W,au as Y,ar as X,aw as Z,ax as ee,as as ae,ay as le,aC as te,aq as oe,aD as ie,az as re,aA as se,aU as de,av as ne,bv as ce}from"./editor-Dt4gYtYt.js";import{L as ue}from"./Loading-DJ2LU2Ls.js";import{E as pe}from"./Empty-CwZAaoJK.js";import{C as me}from"./Card-SJ5b36FP.js";/* empty css                                                        *//* empty css                                                                            *//* empty css                   *//* empty css                */import{E as ve}from"./index-CzbDvFem.js";import{a as _e,E as fe}from"./index-CUA8F766.js";import{E as ye,a as ge}from"./index-IU_h0TRZ.js";import{e as he,E as be}from"./strings-BjAjE6k-.js";import{E as ke,a as we}from"./index-BX21ihZ_.js";import{E as Ce}from"./index-BgAfl9sI.js";import{E as xe,a as Ve}from"./index-zK8U2JRv.js";import"./index-CcWeoNg9.js";import"./toNumber-D5oObipZ.js";import"./_baseIteratee-BnEJjc-Z.js";import"./index-GOKzZPhn.js";import"./index-zLnbxgQE.js";import"./index-DdGYlGy6.js";import"./raf-BZHcGSIv.js";import"./clamp-BWjOrnxb.js";import"./flatMap-B-HSJstM.js";import"./map-7mKJdJp1.js";import"./_baseEach-BT2EtZBY.js";const je=D({extends:z,setup(e,a){const l=z.setup(e,a);delete l.selectOptionClick;const t=B().proxy;return q(()=>{l.select.states.cachedOptions.get(t.value)||l.select.onOptionCreate(t)}),L(()=>a.attrs.visible,e=>{q(()=>{l.states.visible=e})},{immediate:!0}),l},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function Ee(e){return e||0===e}function Ne(e){return F(e)&&e.length}function Ue(e){return F(e)?e:Ee(e)?[e]:[]}function $e(e,a,l,t,o){for(let i=0;i<e.length;i++){const r=e[i];if(a(r,i,e,o))return t?t(r,i,e,o):r;{const e=l(r);if(Ne(e)){const o=$e(e,a,l,t,r);if(o)return o}}}}function ze(e,a,l,t){for(let o=0;o<e.length;o++){const i=e[o];a(i,o,e,t);const r=l(i);Ne(r)&&ze(r,a,l,i)}}var Oe=D({props:{data:{type:Array,default:()=>[]}},setup(e){const a=J(O);return L(()=>e.data,()=>{var l;e.data.forEach(e=>{a.states.cachedOptions.has(e.value)||a.states.cachedOptions.set(e.value,e)});const t=(null==(l=a.selectRef)?void 0:l.querySelectorAll("input"))||[];r&&!Array.from(t).includes(document.activeElement)&&a.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const Se=d(s(D({name:"ElTreeSelect",inheritAttrs:!1,props:{...$.props,...S.props,cacheData:{type:Array,default:()=>[]}},setup(r,s){const{slots:d,expose:n}=s,c=H(),u=H(),p=A(()=>r.nodeKey||r.valueKey||"value"),m=((t,{attrs:o,emit:i},{select:r,tree:s,key:d})=>{const n=e("tree-select");return L(()=>t.data,()=>{t.filterable&&q(()=>{var e,a;null==(a=s.value)||a.filter(null==(e=r.value)?void 0:e.states.inputValue)})},{flush:"post"}),{...a(R(t),Object.keys($.props)),...o,class:A(()=>o.class),style:A(()=>o.style),"onUpdate:modelValue":e=>i(l,e),valueKey:d,popperClass:A(()=>{const e=[n.e("popper")];return t.popperClass&&e.push(t.popperClass),e.join(" ")}),filterMethod:(e="")=>{var a;t.filterMethod?t.filterMethod(e):t.remoteMethod?t.remoteMethod(e):null==(a=s.value)||a.filter(e)}}})(r,s,{select:c,tree:u,key:p}),{cacheOptions:v,..._}=((e,{attrs:r,slots:s,emit:d},{select:n,tree:c,key:u})=>{L([()=>e.modelValue,c],()=>{e.showCheckbox&&q(()=>{const a=c.value;a&&!i(a.getCheckedKeys(),Ue(e.modelValue))&&a.setCheckedKeys(Ue(e.modelValue))})},{immediate:!0,deep:!0});const p=A(()=>({value:u.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),m=(e,a)=>{var l;const t=p.value[e];return I(t)?t(a,null==(l=c.value)?void 0:l.getNode(m("value",a))):a[t]},v=Ue(e.modelValue).map(a=>$e(e.data||[],e=>m("value",e)===a,e=>m("children",e),(e,a,l,t)=>t&&m("value",t))).filter(e=>Ee(e)),_=A(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const a=[];return ze(e.data.concat(e.cacheData),e=>{const l=m("value",e);a.push({value:l,currentLabel:m("label",e),isDisabled:m("disabled",e)})},e=>m("children",e)),a}),f=()=>{var e;return null==(e=c.value)?void 0:e.getCheckedKeys().filter(e=>{var a;const l=null==(a=c.value)?void 0:a.getNode(e);return!o(l)&&t(l.childNodes)})};return{...a(R(e),Object.keys(S.props)),...r,nodeKey:u,expandOnClickNode:A(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:A(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(v):v),renderContent:(a,{node:l,data:t,store:o})=>a(je,{value:m("value",t),label:m("label",t),disabled:m("disabled",t),visible:l.visible},e.renderContent?()=>e.renderContent(a,{node:l,data:t,store:o}):s.default?()=>s.default({node:l,data:t,store:o}):void 0),filterNodeMethod:(a,l,t)=>e.filterNodeMethod?e.filterNodeMethod(a,l,t):!a||new RegExp(he(a),"i").test(m("label",l)||""),onNodeClick:(a,l,t)=>{var o,i,s,d;if(null==(o=r.onNodeClick)||o.call(r,a,l,t),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!l.isLeaf)e.expandOnClickNode&&t.proxy.handleExpandIconClick();else if(!m("disabled",a)){const e=null==(i=n.value)?void 0:i.states.options.get(m("value",a));null==(s=n.value)||s.handleOptionSelect(e)}null==(d=n.value)||d.focus()}},onCheck:(a,t)=>{var o;if(!e.showCheckbox)return;const i=m("value",a),s={};ze([c.value.store.root],e=>s[e.key]=e,e=>e.childNodes);const u=t.checkedKeys,p=e.multiple?Ue(e.modelValue).filter(e=>!(e in s)&&!u.includes(e)):[],v=p.concat(u);if(e.checkStrictly)d(l,e.multiple?v:v.includes(i)?i:void 0);else if(e.multiple){const e=f();d(l,p.concat(e))}else{const t=$e([a],e=>!Ne(m("children",e))&&!m("disabled",e),e=>m("children",e)),o=t?m("value",t):void 0,i=Ee(e.modelValue)&&!!$e([a],a=>m("value",a)===e.modelValue,e=>m("children",e));d(l,o===e.modelValue||i?void 0:o)}q(()=>{var l;const t=Ue(e.modelValue);c.value.setCheckedKeys(t),null==(l=r.onCheck)||l.call(r,a,{checkedKeys:c.value.getCheckedKeys(),checkedNodes:c.value.getCheckedNodes(),halfCheckedKeys:c.value.getHalfCheckedKeys(),halfCheckedNodes:c.value.getHalfCheckedNodes()})}),null==(o=n.value)||o.focus()},onNodeExpand:(a,t,o)=>{var i;null==(i=r.onNodeExpand)||i.call(r,a,t,o),q(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&t.checked){const a={},t=c.value.getCheckedKeys();ze([c.value.store.root],e=>a[e.key]=e,e=>e.childNodes);const o=Ue(e.modelValue).filter(e=>!(e in a)&&!t.includes(e)),i=f();d(l,o.concat(i))}})},cacheOptions:_}})(r,s,{select:c,tree:u,key:p}),f=G({});return n(f),Q(()=>{Object.assign(f,{...a(u.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...a(c.value,["focus","blur","selectedLabel"]),treeRef:u.value,selectRef:c.value})}),()=>W($,G({...m,ref:e=>c.value=e}),{...d,default:()=>[W(Oe,{data:v.value}),W(S,G({..._,ref:e=>u.value=e}))]})}}),[["__file","tree-select.vue"]])),Te={class:"product-management"},Ke={class:"stats-bar"},Pe={class:"stat-content"},Me={class:"stat-icon categories"},Le={class:"stat-info"},Ae={class:"stat-value"},Re={class:"stat-content"},qe={class:"stat-icon items"},De={class:"stat-info"},Be={class:"stat-value"},Fe={class:"stat-content"},Ie={class:"stat-icon tags"},Je={class:"stat-info"},He={class:"stat-value"},Ge={class:"stat-content"},Qe={class:"stat-icon capabilities"},We={class:"stat-info"},Ye={class:"stat-value"},Xe={class:"tab-toolbar"},Ze={key:2,class:"categories-list"},ea={class:"category-header"},aa={class:"category-info"},la={class:"category-name"},ta={class:"items-container"},oa={class:"tree-node"},ia={class:"node-label"},ra={class:"node-actions"},sa={class:"capabilities-toolbar"},da={key:3,class:"pagination-wrapper"},na={class:"original-text"},ca="/api",ua="/api/capability",pa=U(D({__name:"ProductManagement",setup(e){const{success:a,error:l}=n(),t=c(),o=A(()=>t.currentCompanyId||1),i=H("categories"),r=H(!1),s=H(!1),d=H([]),U=H([]),O=H(!1),R=H("create"),q=H({category_id:null,category_name:"",category_code:"",category_description:"",category_order:999}),D=H(),B={category_name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],category_code:[{required:!0,message:"请输入分类代码",trigger:"blur"}]},F=H(!1),I=H("create"),J=H(null),W=H({item_id:null,item_name:"",item_code:"",item_description:"",item_order:999}),he=H(),je={item_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},Ee=A(()=>d.value.reduce((e,a)=>e+a.items.length,0)),Ne=G({tagCount:0,capabilityCount:0,verifiedCount:0}),Ue=H(!1),$e=H([]),ze={label:"tag_name",children:"children"},Oe=H(null),pa=H(""),ma=H(!1),va=H([]),_a=H(""),fa=H(1),ya=H(20),ga=H(0),ha=H(!1),ba=H("create"),ka=H({tag_id:null,tag_name:"",tag_code:"",parent_tag_id:null,description:"",example_keywords:""}),wa=H(),Ca={tag_name:[{required:!0,message:"请输入标签名称",trigger:"blur"}],tag_code:[{required:!0,message:"请输入标签代码",trigger:"blur"}]},xa=H(!1),Va=H(null),ja=H(!1),Ea=G({doc_ids:[],tag_id:null}),Na=H([]),Ua=H(!1),$a=async()=>{r.value=!0;try{const e=await fetch(`${ca}/product-categories`),a=await e.json();a.success?d.value=a.data||[]:l("加载失败",a.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{r.value=!1}},za=()=>{R.value="create",q.value={category_id:null,category_name:"",category_code:"",category_description:"",category_order:999},O.value=!0},Oa=async()=>{D.value&&await D.value.validate(async e=>{if(e){s.value=!0;try{const e="edit"===R.value,t=e?`${ca}/product-categories/${q.value.category_id}`:`${ca}/product-categories`,o=await fetch(t,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q.value)}),i=await o.json();i.success?(a(e?"更新成功":"创建成功",i.message),O.value=!1,await $a()):l(e?"更新失败":"创建失败",i.error||"未知错误")}catch(t){l("保存失败",t instanceof Error?t.message:"未知错误")}finally{s.value=!1}}})},Sa=async()=>{he.value&&J.value&&await he.value.validate(async e=>{if(e){s.value=!0;try{const e="edit"===I.value,t=e?`${ca}/product-category-items/${W.value.item_id}`:`${ca}/product-categories/${J.value.category_id}/items`,o=await fetch(t,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W.value)}),i=await o.json();i.success?(a(e?"更新成功":"创建成功",i.message),F.value=!1,await $a()):l(e?"更新失败":"创建失败",i.error||"未知错误")}catch(t){l("保存失败",t instanceof Error?t.message:"未知错误")}finally{s.value=!1}}})},Ta=async()=>{Ue.value=!0;try{const e=await fetch(`${ua}/tags?company_id=${o.value}`),a=await e.json();a.success?($e.value=a.data||[],Ne.tagCount=Ka($e.value)):l("加载失败",a.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{Ue.value=!1}},Ka=e=>e.reduce((e,a)=>e+1+(a.children?Ka(a.children):0),0),Pa=async()=>{ma.value=!0;try{const e=new URLSearchParams({company_id:String(o.value),page:String(fa.value),page_size:String(ya.value)});Oe.value&&e.append("tag_id",String(Oe.value)),_a.value&&e.append("keyword",_a.value);const a=await fetch(`${ua}/capabilities?${e}`),t=await a.json();t.success?(va.value=t.data||[],ga.value=t.total||0,Ne.capabilityCount=ga.value,Ne.verifiedCount=va.value.filter(e=>e.verified).length):l("加载失败",t.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{ma.value=!1}},Ma=()=>{fa.value=1,Pa()},La=e=>{Oe.value=e.tag_id,pa.value=e.tag_name,fa.value=1,Pa()},Aa=()=>{ba.value="create",ka.value={tag_id:null,tag_name:"",tag_code:"",parent_tag_id:null,description:"",example_keywords:""},ha.value=!0},Ra=async()=>{wa.value&&await wa.value.validate(async e=>{if(e){s.value=!0;try{const e="edit"===ba.value,t=e?`${ua}/tags/${ka.value.tag_id}`:`${ua}/tags`,i={...ka.value,company_id:o.value},r=await fetch(t,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),s=await r.json();s.success?(a(e?"更新成功":"创建成功"),ha.value=!1,await Ta()):l(e?"更新失败":"创建失败",s.error||"未知错误")}catch(t){l("保存失败",t instanceof Error?t.message:"未知错误")}finally{s.value=!1}}})},qa=async e=>{try{const t=await fetch(`${ua}/capabilities/${e.capability_id}/verify`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({verified:!e.verified})}),o=await t.json();o.success?(e.verified=!e.verified,a(e.verified?"已验证":"已取消验证")):l("操作失败",o.error||"未知错误")}catch(t){l("操作失败",t instanceof Error?t.message:"未知错误")}},Da=async()=>{Va.value&&await qa(Va.value)},Ba=async()=>{Ea.doc_ids=[],Ea.tag_id=Oe.value;try{const e=await fetch(`/api/documents?company_id=${o.value}&limit=100`),a=await e.json();a.success&&(Na.value=a.data||[])}catch(e){}ja.value=!0},Fa=async()=>{Ua.value=!0;try{const e=await fetch(`${ua}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({company_id:o.value,doc_ids:Ea.doc_ids,tag_id:Ea.tag_id})}),t=await e.json();t.success?(a("提取完成",`成功提取 ${t.extracted_count||0} 个能力`),ja.value=!1,Pa()):l("提取失败",t.error||"未知错误")}catch(e){l("提取失败",e instanceof Error?e.message:"未知错误")}finally{Ua.value=!1}};return Q(()=>{$a(),Ta(),Pa()}),L(i,e=>{"categories"!==e||d.value.length?"capabilities"!==e||$e.value.length||(Ta(),Pa()):$a()}),L(o,()=>{Ta(),Pa()}),(e,t)=>{const o=u,n=ve,c=f,L=be,A=ge,H=ye,G=fe,Q=_e,Ka=P,Ia=S,Ja=we,Ha=w,Ga=Ce,Qa=K,Wa=ke,Ya=M,Xa=j,Za=T,el=V,al=E,ll=Se,tl=Ve,ol=xe,il=z,rl=$;return X(),Y("div",Te,[Z("div",Ke,[ee(n,{class:"stat-card"},{default:ae(()=>[Z("div",Pe,[Z("div",Me,[ee(o,{size:32,color:"#409eff"},{default:ae(()=>[ee(le(p))]),_:1})]),Z("div",Le,[t[31]||(t[31]=Z("div",{class:"stat-label"},"产品分类",-1)),Z("div",Ae,te(d.value.length),1)])])]),_:1}),ee(n,{class:"stat-card"},{default:ae(()=>[Z("div",Re,[Z("div",qe,[ee(o,{size:32,color:"#67c23a"},{default:ae(()=>[ee(le(m))]),_:1})]),Z("div",De,[t[32]||(t[32]=Z("div",{class:"stat-label"},"分类项目",-1)),Z("div",Be,te(Ee.value),1)])])]),_:1}),ee(n,{class:"stat-card"},{default:ae(()=>[Z("div",Fe,[Z("div",Ie,[ee(o,{size:32,color:"#e6a23c"},{default:ae(()=>[ee(le(v))]),_:1})]),Z("div",Je,[t[33]||(t[33]=Z("div",{class:"stat-label"},"能力标签",-1)),Z("div",He,te(Ne.tagCount),1)])])]),_:1}),ee(n,{class:"stat-card"},{default:ae(()=>[Z("div",Ge,[Z("div",Qe,[ee(o,{size:32,color:"#909399"},{default:ae(()=>[ee(le(_))]),_:1})]),Z("div",We,[t[34]||(t[34]=Z("div",{class:"stat-label"},"能力条目",-1)),Z("div",Ye,te(Ne.capabilityCount),1)])])]),_:1})]),ee(Ya,{modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=e=>i.value=e),type:"border-card"},{default:ae(()=>[ee(Ka,{label:"产品分类",name:"categories"},{default:ae(()=>[Z("div",Xe,[ee(c,{type:"primary",onClick:za},{default:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(y))]),_:1}),t[35]||(t[35]=ie(" 新建分类 ",-1))]),_:1})]),r.value?(X(),oe(le(ue),{key:0,text:"加载中..."})):d.value.length?(X(),Y("div",Ze,[ee(Q,{modelValue:U.value,"onUpdate:modelValue":t[1]||(t[1]=e=>U.value=e),accordion:""},{default:ae(()=>[(X(!0),Y(re,null,se(d.value,e=>(X(),oe(G,{key:e.category_id,name:e.category_id},{title:ae(()=>[Z("div",ea,[Z("div",aa,[Z("span",la,te(e.category_name),1),ee(L,{size:"small",type:"info",class:"category-tag"},{default:ae(()=>[ie(te(e.items.length)+" 项 ",1)]),_:2},1024)]),Z("div",{class:"category-actions",onClick:t[0]||(t[0]=de(()=>{},["stop"]))},[ee(c,{text:"",type:"primary",size:"small",onClick:a=>(e=>{J.value=e,I.value="create",W.value={item_id:null,item_name:"",item_code:"",item_description:"",item_order:999},F.value=!0})(e)},{default:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(y))]),_:1}),t[36]||(t[36]=ie(" 添加项 ",-1))]),_:1},8,["onClick"]),ee(c,{text:"",type:"warning",size:"small",onClick:a=>(e=>{R.value="edit",q.value={category_id:e.category_id,category_name:e.category_name,category_code:e.category_code,category_description:e.category_description||"",category_order:e.category_order||999},O.value=!0})(e)},{default:ae(()=>[...t[37]||(t[37]=[ie(" 编辑 ",-1)])]),_:1},8,["onClick"]),ee(c,{text:"",type:"danger",size:"small",onClick:t=>(async e=>{try{await N.confirm(`确定要删除分类 "${e.category_name}" 吗？此操作将同时删除该分类下的所有项目。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${ca}/product-categories/${e.category_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功",o.message),await $a()):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:ae(()=>[...t[38]||(t[38]=[ie(" 删除 ",-1)])]),_:1},8,["onClick"])])])]),default:ae(()=>[Z("div",ta,[ee(H,{data:e.items,stripe:""},{default:ae(()=>[ee(A,{prop:"item_name",label:"项目名称",width:"200"}),ee(A,{prop:"item_code",label:"代码",width:"180"}),ee(A,{prop:"item_description",label:"描述","show-overflow-tooltip":""}),ee(A,{prop:"item_order",label:"排序",width:"80",align:"center"}),ee(A,{label:"操作",width:"180",fixed:"right"},{default:ae(({row:o})=>[ee(c,{text:"",type:"warning",size:"small",onClick:a=>((e,a)=>{J.value=e,I.value="edit",W.value={item_id:a.item_id,item_name:a.item_name,item_code:a.item_code||"",item_description:a.item_description||"",item_order:a.item_order||999},F.value=!0})(e,o)},{default:ae(()=>[...t[39]||(t[39]=[ie(" 编辑 ",-1)])]),_:1},8,["onClick"]),ee(c,{text:"",type:"danger",size:"small",onClick:e=>(async(e,t)=>{try{await N.confirm(`确定要删除项目 "${t.item_name}" 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const e=await fetch(`${ca}/product-category-items/${t.item_id}`,{method:"DELETE"}),o=await e.json();o.success?(a("删除成功",o.message),await $a()):l("删除失败",o.error||"未知错误")}catch(o){l("删除失败",o instanceof Error?o.message:"未知错误")}})(0,o)},{default:ae(()=>[...t[40]||(t[40]=[ie(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])):(X(),oe(le(pe),{key:1,type:"no-data",description:"暂无产品分类"}))]),_:1}),ee(Ka,{label:"产品能力",name:"capabilities"},{default:ae(()=>[ee(Wa,{gutter:20},{default:ae(()=>[ee(Ja,{span:8},{default:ae(()=>[ee(le(me),{title:"能力标签"},{extra:ae(()=>[ee(c,{type:"primary",size:"small",onClick:Aa},{default:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(y))]),_:1}),t[41]||(t[41]=ie(" 新建标签 ",-1))]),_:1})]),default:ae(()=>[Ue.value?(X(),oe(le(ue),{key:0,text:"加载中..."})):$e.value.length?(X(),oe(Ia,{key:2,data:$e.value,props:ze,"node-key":"tag_id","default-expand-all":"","highlight-current":"",onNodeClick:La},{default:ae(({node:e,data:t})=>[Z("div",oa,[Z("span",ia,te(e.label),1),Z("span",ra,[ee(c,{link:"",type:"primary",size:"small",onClick:de(e=>{return a=t,ba.value="create",ka.value={tag_id:null,tag_name:"",tag_code:"",parent_tag_id:a.tag_id,description:"",example_keywords:""},void(ha.value=!0);var a},["stop"])},{default:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(y))]),_:1})]),_:1},8,["onClick"]),ee(c,{link:"",type:"warning",size:"small",onClick:de(e=>{return a=t,ba.value="edit",ka.value={tag_id:a.tag_id,tag_name:a.tag_name,tag_code:a.tag_code,parent_tag_id:a.parent_tag_id,description:a.description||"",example_keywords:a.example_keywords||""},void(ha.value=!0);var a},["stop"])},{default:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(g))]),_:1})]),_:1},8,["onClick"]),ee(c,{link:"",type:"danger",size:"small",onClick:de(e=>(async e=>{try{await N.confirm(`确定要删除标签 "${e.tag_name}" 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${ua}/tags/${e.tag_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功"),await Ta(),Oe.value===e.tag_id&&(Oe.value=null,pa.value="",Pa())):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(t),["stop"])},{default:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(h))]),_:1})]),_:1},8,["onClick"])])])]),_:1},8,["data"])):(X(),oe(le(pe),{key:1,type:"no-data",description:"暂无标签"}))]),_:1})]),_:1}),ee(Ja,{span:16},{default:ae(()=>[ee(le(me),{title:pa.value?`${pa.value} - 能力列表`:"全部能力"},{extra:ae(()=>[Z("div",sa,[ee(Ha,{modelValue:_a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>_a.value=e),placeholder:"搜索能力名称...",clearable:"",style:{width:"200px"},onKeyup:ce(Ma,["enter"])},{prefix:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(C))]),_:1})]),_:1},8,["modelValue"]),ee(c,{type:"primary",onClick:Ba},{default:ae(()=>[ee(o,null,{default:ae(()=>[ee(le(x))]),_:1}),t[42]||(t[42]=ie(" 从文档提取 ",-1))]),_:1})])]),default:ae(()=>[ma.value?(X(),oe(le(ue),{key:0,text:"加载中..."})):va.value.length?(X(),oe(H,{key:2,data:va.value,stripe:"","max-height":"500"},{default:ae(()=>[ee(A,{prop:"capability_name",label:"能力名称",width:"180","show-overflow-tooltip":""}),ee(A,{prop:"capability_type",label:"类型",width:"100"},{default:ae(({row:e})=>{return[ee(L,{type:(a=e.capability_type,{"功能":"primary","接口":"success","服务":"warning","支持能力":"info"}[a]||"info"),size:"small"},{default:ae(()=>[ie(te(e.capability_type||"未分类"),1)]),_:2},1032,["type"])];var a}),_:1}),ee(A,{prop:"capability_description",label:"描述","show-overflow-tooltip":""}),ee(A,{prop:"doc_name",label:"来源文档",width:"150","show-overflow-tooltip":""}),ee(A,{prop:"confidence_score",label:"置信度",width:"80",align:"center"},{default:ae(({row:e})=>{return[ee(Ga,{percentage:Math.round(100*(e.confidence_score||0)),"stroke-width":6,"show-text":!1,color:(a=e.confidence_score,a>=.8?"#67c23a":a>=.6?"#e6a23c":"#f56c6c")},null,8,["percentage","color"])];var a}),_:1}),ee(A,{prop:"verified",label:"验证",width:"70",align:"center"},{default:ae(({row:e})=>[e.verified?(X(),oe(o,{key:0,color:"#67c23a"},{default:ae(()=>[ee(le(b))]),_:1})):(X(),oe(o,{key:1,color:"#909399"},{default:ae(()=>[ee(le(k))]),_:1}))]),_:1}),ee(A,{label:"操作",width:"150",fixed:"right"},{default:ae(({row:e})=>[ee(c,{link:"",type:"primary",size:"small",onClick:a=>{return l=e,Va.value=l,void(xa.value=!0);var l}},{default:ae(()=>[...t[43]||(t[43]=[ie(" 详情 ",-1)])]),_:1},8,["onClick"]),ee(c,{link:"",type:e.verified?"warning":"success",size:"small",onClick:a=>qa(e)},{default:ae(()=>[ie(te(e.verified?"取消验证":"验证"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])):(X(),oe(le(pe),{key:1,type:"no-data",description:"暂无能力数据"})),ga.value>ya.value?(X(),Y("div",da,[ee(Qa,{"current-page":fa.value,"onUpdate:currentPage":t[3]||(t[3]=e=>fa.value=e),"page-size":ya.value,"onUpdate:pageSize":t[4]||(t[4]=e=>ya.value=e),total:ga.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:Pa,onCurrentChange:Pa},null,8,["current-page","page-size","total"])])):ne("",!0)]),_:1},8,["title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),ee(al,{modelValue:O.value,"onUpdate:modelValue":t[11]||(t[11]=e=>O.value=e),title:"create"===R.value?"新建分类":"编辑分类",width:"500px"},{footer:ae(()=>[ee(c,{onClick:t[10]||(t[10]=e=>O.value=!1)},{default:ae(()=>[...t[44]||(t[44]=[ie("取消",-1)])]),_:1}),ee(c,{type:"primary",onClick:Oa,loading:s.value},{default:ae(()=>[...t[45]||(t[45]=[ie(" 保存 ",-1)])]),_:1},8,["loading"])]),default:ae(()=>[ee(el,{model:q.value,rules:B,ref_key:"categoryFormRef",ref:D,"label-width":"100px"},{default:ae(()=>[ee(Xa,{label:"分类名称",prop:"category_name"},{default:ae(()=>[ee(Ha,{modelValue:q.value.category_name,"onUpdate:modelValue":t[6]||(t[6]=e=>q.value.category_name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),ee(Xa,{label:"分类代码",prop:"category_code"},{default:ae(()=>[ee(Ha,{modelValue:q.value.category_code,"onUpdate:modelValue":t[7]||(t[7]=e=>q.value.category_code=e),placeholder:"请输入分类代码（英文）",disabled:"edit"===R.value},null,8,["modelValue","disabled"])]),_:1}),ee(Xa,{label:"分类描述",prop:"category_description"},{default:ae(()=>[ee(Ha,{modelValue:q.value.category_description,"onUpdate:modelValue":t[8]||(t[8]=e=>q.value.category_description=e),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),ee(Xa,{label:"排序",prop:"category_order"},{default:ae(()=>[ee(Za,{modelValue:q.value.category_order,"onUpdate:modelValue":t[9]||(t[9]=e=>q.value.category_order=e),min:1,max:999},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),ee(al,{modelValue:F.value,"onUpdate:modelValue":t[17]||(t[17]=e=>F.value=e),title:"create"===I.value?"新建项目":"编辑项目",width:"500px"},{footer:ae(()=>[ee(c,{onClick:t[16]||(t[16]=e=>F.value=!1)},{default:ae(()=>[...t[46]||(t[46]=[ie("取消",-1)])]),_:1}),ee(c,{type:"primary",onClick:Sa,loading:s.value},{default:ae(()=>[...t[47]||(t[47]=[ie(" 保存 ",-1)])]),_:1},8,["loading"])]),default:ae(()=>[ee(el,{model:W.value,rules:je,ref_key:"itemFormRef",ref:he,"label-width":"100px"},{default:ae(()=>[ee(Xa,{label:"项目名称",prop:"item_name"},{default:ae(()=>[ee(Ha,{modelValue:W.value.item_name,"onUpdate:modelValue":t[12]||(t[12]=e=>W.value.item_name=e),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),ee(Xa,{label:"项目代码",prop:"item_code"},{default:ae(()=>[ee(Ha,{modelValue:W.value.item_code,"onUpdate:modelValue":t[13]||(t[13]=e=>W.value.item_code=e),placeholder:"请输入项目代码（英文）"},null,8,["modelValue"])]),_:1}),ee(Xa,{label:"项目描述",prop:"item_description"},{default:ae(()=>[ee(Ha,{modelValue:W.value.item_description,"onUpdate:modelValue":t[14]||(t[14]=e=>W.value.item_description=e),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),ee(Xa,{label:"排序",prop:"item_order"},{default:ae(()=>[ee(Za,{modelValue:W.value.item_order,"onUpdate:modelValue":t[15]||(t[15]=e=>W.value.item_order=e),min:1,max:999},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),ee(al,{modelValue:ha.value,"onUpdate:modelValue":t[24]||(t[24]=e=>ha.value=e),title:"create"===ba.value?"新建标签":"编辑标签",width:"500px"},{footer:ae(()=>[ee(c,{onClick:t[23]||(t[23]=e=>ha.value=!1)},{default:ae(()=>[...t[48]||(t[48]=[ie("取消",-1)])]),_:1}),ee(c,{type:"primary",onClick:Ra,loading:s.value},{default:ae(()=>[...t[49]||(t[49]=[ie(" 保存 ",-1)])]),_:1},8,["loading"])]),default:ae(()=>[ee(el,{model:ka.value,rules:Ca,ref_key:"tagFormRef",ref:wa,"label-width":"100px"},{default:ae(()=>[ee(Xa,{label:"标签名称",prop:"tag_name"},{default:ae(()=>[ee(Ha,{modelValue:ka.value.tag_name,"onUpdate:modelValue":t[18]||(t[18]=e=>ka.value.tag_name=e),placeholder:"如：风控产品、实修能力"},null,8,["modelValue"])]),_:1}),ee(Xa,{label:"标签代码",prop:"tag_code"},{default:ae(()=>[ee(Ha,{modelValue:ka.value.tag_code,"onUpdate:modelValue":t[19]||(t[19]=e=>ka.value.tag_code=e),placeholder:"英文代码，如: risk_control",disabled:"edit"===ba.value},null,8,["modelValue","disabled"])]),_:1}),ee(Xa,{label:"父级标签",prop:"parent_tag_id"},{default:ae(()=>[ee(ll,{modelValue:ka.value.parent_tag_id,"onUpdate:modelValue":t[20]||(t[20]=e=>ka.value.parent_tag_id=e),data:$e.value,props:{label:"tag_name",value:"tag_id",children:"children"},placeholder:"选择父级标签（可选）","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),ee(Xa,{label:"描述",prop:"description"},{default:ae(()=>[ee(Ha,{modelValue:ka.value.description,"onUpdate:modelValue":t[21]||(t[21]=e=>ka.value.description=e),type:"textarea",rows:3,placeholder:"标签的详细描述"},null,8,["modelValue"])]),_:1}),ee(Xa,{label:"示例关键词",prop:"example_keywords"},{default:ae(()=>[ee(Ha,{modelValue:ka.value.example_keywords,"onUpdate:modelValue":t[22]||(t[22]=e=>ka.value.example_keywords=e),type:"textarea",rows:2,placeholder:"逗号分隔的关键词，用于AI匹配"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),ee(al,{modelValue:xa.value,"onUpdate:modelValue":t[26]||(t[26]=e=>xa.value=e),title:"能力详情",width:"600px"},{footer:ae(()=>{var e;return[ee(c,{onClick:t[25]||(t[25]=e=>xa.value=!1)},{default:ae(()=>[...t[50]||(t[50]=[ie("关闭",-1)])]),_:1}),ee(c,{type:(null==(e=Va.value)?void 0:e.verified)?"warning":"success",onClick:Da},{default:ae(()=>{var e;return[ie(te((null==(e=Va.value)?void 0:e.verified)?"取消验证":"标记为已验证"),1)]}),_:1},8,["type"])]}),default:ae(()=>[Va.value?(X(),oe(ol,{key:0,column:2,border:""},{default:ae(()=>[ee(tl,{label:"能力名称",span:2},{default:ae(()=>[ie(te(Va.value.capability_name),1)]),_:1}),ee(tl,{label:"能力类型"},{default:ae(()=>[ie(te(Va.value.capability_type||"未分类"),1)]),_:1}),ee(tl,{label:"置信度"},{default:ae(()=>[ie(te(Math.round(100*(Va.value.confidence_score||0)))+"% ",1)]),_:1}),ee(tl,{label:"关联标签"},{default:ae(()=>[ie(te(Va.value.tag_name||"无"),1)]),_:1}),ee(tl,{label:"验证状态"},{default:ae(()=>[ee(L,{type:Va.value.verified?"success":"info"},{default:ae(()=>[ie(te(Va.value.verified?"已验证":"待验证"),1)]),_:1},8,["type"])]),_:1}),ee(tl,{label:"来源文档",span:2},{default:ae(()=>[ie(te(Va.value.doc_name||"未知"),1)]),_:1}),ee(tl,{label:"能力描述",span:2},{default:ae(()=>[ie(te(Va.value.capability_description||"无描述"),1)]),_:1}),ee(tl,{label:"原文摘录",span:2},{default:ae(()=>[Z("div",na,te(Va.value.original_text||"无"),1)]),_:1})]),_:1})):ne("",!0)]),_:1},8,["modelValue"]),ee(al,{modelValue:ja.value,"onUpdate:modelValue":t[30]||(t[30]=e=>ja.value=e),title:"从文档提取能力",width:"600px"},{footer:ae(()=>[ee(c,{onClick:t[29]||(t[29]=e=>ja.value=!1)},{default:ae(()=>[...t[51]||(t[51]=[ie("取消",-1)])]),_:1}),ee(c,{type:"primary",onClick:Fa,loading:Ua.value,disabled:!Ea.doc_ids.length},{default:ae(()=>[...t[52]||(t[52]=[ie(" 开始提取 ",-1)])]),_:1},8,["loading","disabled"])]),default:ae(()=>[ee(el,{"label-width":"100px"},{default:ae(()=>[ee(Xa,{label:"选择文档"},{default:ae(()=>[ee(rl,{modelValue:Ea.doc_ids,"onUpdate:modelValue":t[27]||(t[27]=e=>Ea.doc_ids=e),multiple:"",filterable:"",placeholder:"选择要提取能力的文档",style:{width:"100%"}},{default:ae(()=>[(X(!0),Y(re,null,se(Na.value,e=>(X(),oe(il,{key:e.doc_id,label:e.doc_name,value:e.doc_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),ee(Xa,{label:"关联标签"},{default:ae(()=>[ee(ll,{modelValue:Ea.tag_id,"onUpdate:modelValue":t[28]||(t[28]=e=>Ea.tag_id=e),data:$e.value,props:{label:"tag_name",value:"tag_id",children:"children"},placeholder:"选择要关联的标签（可选）","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-fff930ea"]]);export{pa as default};
