import{C as e,r as a,c as t}from"./vendor-CDDpMtwV.js";import"./index.js";import{t as l}from"./tender-ZYcn_VXM.js";const u=e("project",()=>{const e=a(null),u=a([]),n=a(!1),r=a(null),c=a({page:1,pageSize:10,total:0}),o=t(()=>{var a,t;return(null==(a=e.value)?void 0:a.id)||(null==(t=e.value)?void 0:t.project_id)||null}),v=t(()=>{var a,t;return(null==(a=e.value)?void 0:a.name)||(null==(t=e.value)?void 0:t.project_name)||""}),s=t(()=>{var a,t;return(null==(a=e.value)?void 0:a.number)||(null==(t=e.value)?void 0:t.project_number)||""}),i=t(()=>{var a;return(null==(a=e.value)?void 0:a.status)||null}),g=t(()=>!!e.value),d=t(()=>u.value.length),p=t(()=>u.value.map(e=>({label:`${e.name} (${e.project_number})`,value:e.id}))),j=t(()=>Math.ceil(c.value.total/c.value.pageSize));function m(a){e.value=a,h()}function f(){e.value=null,localStorage.removeItem("current_project")}async function y(e){n.value=!0,r.value=null,(null==e?void 0:e.page)&&(c.value.page=e.page),(null==e?void 0:e.page_size)&&(c.value.pageSize=e.page_size);try{const e=await l.getProjects({page:c.value.page,page_size:c.value.pageSize});e.success&&e.data&&(u.value=e.data.items||e.data,c.value.total=e.data.total||u.value.length)}catch(a){r.value=a.message||"获取项目列表失败"}finally{n.value=!1}}async function P(e){n.value=!0,r.value=null;try{const a=await l.getProject(e);if(a.success&&a.data){const t=u.value.findIndex(a=>a.id===e);return-1!==t&&Object.assign(u.value[t],{name:a.data.name,status:a.data.status,project_number:a.data.project_number}),a.data}return r.value=a.message||"获取项目详情失败",null}catch(a){return r.value=a.message||"获取项目详情失败",null}finally{n.value=!1}}function h(){try{e.value&&localStorage.setItem("current_project",JSON.stringify(e.value))}catch(a){}}return{currentProject:e,projects:u,loading:n,error:r,pagination:c,projectId:o,projectName:v,projectNumber:s,projectStatus:i,hasCurrentProject:g,projectsCount:d,projectsOptions:p,totalPages:j,setCurrentProject:m,setCurrentProjectById:async function(e){n.value=!0,r.value=null;try{const a=await l.getProject(e);return a.success&&a.data?(m(a.data),!0):(r.value=a.message||"获取项目详情失败",!1)}catch(a){return r.value=a.message||"获取项目详情失败",!1}finally{n.value=!1}},clearCurrentProject:f,fetchProjects:y,fetchProject:P,createProject:async function(e){n.value=!0,r.value=null;try{const a=await l.createProject(e);return a.success&&a.data?(u.value.unshift(a.data),c.value.total+=1,a.data):(r.value=a.message||"创建项目失败",null)}catch(a){return r.value=a.message||"创建项目失败",null}finally{n.value=!1}},updateProject:async function(a,t){var c;n.value=!0,r.value=null;try{const n=await l.updateProject(a,t);if(n.success&&n.data){const t=u.value.findIndex(e=>e.id===a);return-1!==t&&Object.assign(u.value[t],n.data),(null==(c=e.value)?void 0:c.id)===a&&(Object.assign(e.value,n.data),h()),!0}return r.value=n.message||"更新项目失败",!1}catch(o){return r.value=o.message||"更新项目失败",!1}finally{n.value=!1}},deleteProject:async function(a){var t;n.value=!0,r.value=null;try{const n=await l.deleteProject(a);return n.success?(u.value=u.value.filter(e=>e.id!==a),c.value.total=Math.max(0,c.value.total-1),(null==(t=e.value)?void 0:t.id)===a&&f(),!0):(r.value=n.message||"删除项目失败",!1)}catch(o){return r.value=o.message||"删除项目失败",!1}finally{n.value=!1}},refreshCurrentProject:async function(){var a;if(!(null==(a=e.value)?void 0:a.id))return;const t=await P(e.value.id);t&&(e.value=t,h())},setPagination:function(e,a){c.value.page=e,c.value.pageSize=a},nextPage:async function(){c.value.page<j.value&&(c.value.page+=1,await y())},prevPage:async function(){c.value.page>1&&(c.value.page-=1,await y())},restoreFromStorage:function(){try{const a=localStorage.getItem("current_project");a&&(e.value=JSON.parse(a))}catch(a){}},saveToStorage:h,$reset:function(){e.value=null,u.value=[],n.value=!1,r.value=null,c.value={page:1,pageSize:10,total:0},localStorage.removeItem("current_project")}}});export{u};
