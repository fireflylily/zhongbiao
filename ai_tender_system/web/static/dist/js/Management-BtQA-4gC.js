import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";import{I as a,E as t}from"./IconButton-DRztSxV_.js";/* empty css               */import"./el-select-BSk6f2dL.js";/* empty css                   *//* empty css                 *//* empty css                             *//* empty css                    */import{E as l}from"./el-link-BN2G44Li.js";import{d as s,r as i,a as r,L as o,c as n,g as p,w as c,F as m,o as u,B as d,a0 as _,k as f,t as y,e as g,l as v,i as b}from"./index.js";import{L as j}from"./Loading-Bhd5IqAX.js";import{E as h}from"./Empty-DGG2bPYG.js";import"./HistoryFilesPanel.vue_vue_type_style_index_0_scoped_8037c805_lang-DZHVYQUE.js";import{C as w}from"./Card-C1SaukE4.js";/* empty css                */import"./DocumentPreview.vue_vue_type_style_index_0_scoped_3e333bda_lang-DmpRfM6z.js";/* empty css                 *//* empty css                */import{d as k}from"./el-form-item-CVdTmnJr.js";import{t as z}from"./tender-lE9zOws1.js";import{c as x}from"./company-B-7v0ZEP.js";import{a as C,E}from"./index-QKZXHMAQ.js";import{E as D}from"./strings-DBU9TC1F.js";import"./castArray-COSn9LfO.js";import"./index-DVu1qCus.js";import"./_commonjsHelpers-lGe4XDVY.js";import"./_baseClone-BxWT40wp.js";import"./omit-CX340h9Z.js";import"./index-Csos-qsJ.js";import"./raf-D3yCAO_k.js";const P={class:"tender-management"},M={key:3,class:"pagination-wrapper"},I=e(s({__name:"Management",setup(e){const s=i(!1),I=i(!1),Y=i([]),H=i(1),L=i(10),$=i(0),B=b(),{success:S,error:A}=r(),F=async()=>{var e,a;s.value=!0;try{const t=await z.getProjects({page:H.value,page_size:L.value}),l=(null==(e=t.data)?void 0:e.items)||t.data||[];Y.value=l.map(e=>({id:e.project_id,name:e.project_name,number:e.project_number,company_name:e.company_name,status:e.status,created_at:e.created_at,...e})),$.value=(null==(a=t.data)?void 0:a.total)||Y.value.length}catch(t){A("加载失败",t instanceof Error?t.message:"未知错误")}finally{s.value=!1}},R=e=>{B.push({name:"TenderManagementDetail",params:{id:e.id}})},T=async()=>{I.value=!0;try{const e=(await x.getCompanies()).data||[];if(0===e.length)return void A("无法创建项目：请先添加公司信息");const a=(await z.createProject({project_name:"新项目",project_number:`PRJ-${Date.now()}`,company_id:e[0].company_id})).project_id;S("创建成功"),B.push({name:"TenderManagementDetail",params:{id:a}})}catch(e){const a=e instanceof Error?e.message:"未知错误";A(`创建项目失败：${a}`)}finally{I.value=!1}},U=e=>{L.value=e,H.value=1,F()},q=e=>{H.value=e,F()};return o(()=>{F()}),(e,i)=>{const r=v,o=C,b=l,x=D,B=E,J=t;return u(),n("div",P,[p(m(w),{title:"项目列表"},{actions:c(()=>[p(r,{type:"primary",loading:I.value,onClick:T},{default:c(()=>[...i[2]||(i[2]=[g("i",{class:"bi bi-plus-lg"},null,-1),f(" 新建项目 ",-1)])]),_:1},8,["loading"])]),default:c(()=>[s.value?(u(),d(m(j),{key:0,text:"加载中..."})):Y.value.length?(u(),d(B,{key:2,data:Y.value,stripe:"",style:{width:"100%"}},{default:c(()=>[p(o,{prop:"id",label:"ID",width:"70",fixed:""}),p(o,{prop:"name",label:"项目名称","min-width":"200",fixed:""},{default:c(({row:e})=>[p(b,{type:"primary",onClick:a=>R(e)},{default:c(()=>[f(y(e.name),1)]),_:2},1032,["onClick"])]),_:1}),p(o,{prop:"company_name",label:"公司名称","min-width":"180","show-overflow-tooltip":""}),p(o,{prop:"authorized_person_name",label:"被授权人",width:"100"}),p(o,{label:"商务应答",width:"100",align:"center"},{default:c(({row:e})=>{return[(a=e,a.business_response_file||"completed"===a.business_response_status?(u(),d(x,{key:0,type:"success",size:"small"},{default:c(()=>[...i[3]||(i[3]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),f(" 已生成 ",-1)])]),_:1})):(u(),d(x,{key:1,type:"info",size:"small"},{default:c(()=>[...i[4]||(i[4]=[g("i",{class:"bi bi-dash-circle"},null,-1),f(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),p(o,{label:"技术点对点",width:"110",align:"center"},{default:c(({row:e})=>{return[(a=e,a.point_to_point_file||"completed"===a.point_to_point_status?(u(),d(x,{key:0,type:"success",size:"small"},{default:c(()=>[...i[5]||(i[5]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),f(" 已生成 ",-1)])]),_:1})):(u(),d(x,{key:1,type:"info",size:"small"},{default:c(()=>[...i[6]||(i[6]=[g("i",{class:"bi bi-dash-circle"},null,-1),f(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),p(o,{label:"技术方案",width:"100",align:"center"},{default:c(({row:e})=>{return[(a=e,a.tech_proposal_file||"completed"===a.tech_proposal_status||a.technical_data?(u(),d(x,{key:0,type:"success",size:"small"},{default:c(()=>[...i[7]||(i[7]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),f(" 已生成 ",-1)])]),_:1})):(u(),d(x,{key:1,type:"info",size:"small"},{default:c(()=>[...i[8]||(i[8]=[g("i",{class:"bi bi-dash-circle"},null,-1),f(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),p(o,{label:"最后融合",width:"100",align:"center"},{default:c(({row:e})=>{return[(a=e,a.final_merge_file||"completed"===a.merge_status?(u(),d(x,{key:0,type:"success",size:"small"},{default:c(()=>[...i[9]||(i[9]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),f(" 已融合 ",-1)])]),_:1})):(u(),d(x,{key:1,type:"info",size:"small"},{default:c(()=>[...i[10]||(i[10]=[g("i",{class:"bi bi-dash-circle"},null,-1),f(" 未融合 ",-1)])]),_:1})))];var a}),_:1}),p(o,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:c(({row:e})=>["active"===e.status?(u(),d(x,{key:0,type:"success"},{default:c(()=>[...i[11]||(i[11]=[f("进行中",-1)])]),_:1})):"completed"===e.status?(u(),d(x,{key:1,type:"primary"},{default:c(()=>[...i[12]||(i[12]=[f("已完成",-1)])]),_:1})):(u(),d(x,{key:2,type:"info"},{default:c(()=>[...i[13]||(i[13]=[f("草稿",-1)])]),_:1}))]),_:1}),p(o,{prop:"created_at",label:"创建时间",width:"160"},{default:c(({row:e})=>{return[f(y((a=e.created_at,a?k(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),p(o,{label:"操作",width:"120",fixed:"right"},{default:c(({row:e})=>[p(m(a),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:a=>R(e)},null,8,["onClick"]),p(m(a),{icon:"bi-trash",type:"danger",tooltip:"删除项目",onClick:a=>(async e=>{try{if(!confirm(`确定要删除项目 "${e.name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`))return;await z.deleteProject(e.id),S("删除成功",`已删除项目: ${e.name}`),await F()}catch(a){A("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])):(u(),d(m(h),{key:1,type:"no-data",description:"暂无项目"})),Y.value.length>0?(u(),n("div",M,[p(J,{"current-page":H.value,"onUpdate:currentPage":i[0]||(i[0]=e=>H.value=e),"page-size":L.value,"onUpdate:pageSize":i[1]||(i[1]=e=>L.value=e),total:$.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:q},null,8,["current-page","page-size","total"])])):_("",!0)]),_:1})])}}}),[["__scopeId","data-v-aca97e9b"]]);export{I as default};
