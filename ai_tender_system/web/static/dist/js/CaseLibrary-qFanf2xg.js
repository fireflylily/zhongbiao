import{C as a,M as e,d as t,e as l,h as s,p as o,n as r,a as c,H as d,I as n,o as u}from"./vendor-element-plus-CEQaQHNc.js";import{d as i,b7 as p,r as v,a as _,b as y,P as m,M as f,O as w,c as b,N as h,I as g,R as C,L as k,H as x}from"./vendor-vue-DnBj6vzG.js";import{L as j}from"./Loading-fOFG7xAl.js";import{E as V}from"./Empty-BzPBqxja.js";/* empty css                                                                          */import{C as z}from"./Card-CKMHDauo.js";import{dB as L,cY as E,eP as $,ey as F,eG as I,dn as T}from"./vendor-other-CxXkF0Pk.js";import"./vendor-editor-CGvuleas.js";/* empty css                                                                        */import"./vendor-dayjs-CeOjnJlt.js";import{a as P,_ as U}from"./index.js";import{k as D,f as H}from"./formatters-D-henrcx.js";import{c as B}from"./company-DX6fQVXW.js";import"./vendor-echarts-C00rBISf.js";import"./vendor-axios-BG7aBJwU.js";const G={class:"case-library"},M={class:"stats-bar"},N={class:"stat-content"},O={class:"stat-icon"},Q={class:"stat-info"},R={class:"stat-value"},Y={class:"stat-content"},q={class:"stat-icon"},A={class:"stat-info"},J={class:"stat-value"},K={class:"stat-content"},S={class:"stat-icon"},W={class:"stat-info"},X={class:"stat-value"},Z={class:"filter-section"},aa={key:1,style:{color:"#909399"}},ea=U(i({__name:"CaseLibrary",setup(i){const U=p(),{success:ea,error:ta}=P(),la=v(!1),sa=v(!1),oa=v([]),ra=v([]),ca=v(),da=v({keyword:"",productCategory:"",industry:"",contractType:""}),na=_(()=>{let a=[...oa.value];if(da.value.keyword){const e=da.value.keyword.toLowerCase();a=a.filter(a=>{var t,l,s;return(null==(t=a.case_title)?void 0:t.toLowerCase().includes(e))||(null==(l=a.customer_name)?void 0:l.toLowerCase().includes(e))||(null==(s=a.case_number)?void 0:s.toLowerCase().includes(e))})}return da.value.productCategory&&(a=a.filter(a=>a.product_category===da.value.productCategory)),da.value.industry&&(a=a.filter(a=>a.industry===da.value.industry)),da.value.contractType&&(a=a.filter(a=>a.contract_type===da.value.contractType)),a}),ua=_(()=>oa.value.filter(a=>"合同"===a.contract_type).length),ia=_(()=>{let a=0;return oa.value.forEach(e=>{if(e.contract_amount){const t=e.contract_amount.match(/[\d.]+/);if(t){const l=parseFloat(t[0]);e.contract_amount.includes("万")?a+=1e4*l:e.contract_amount.includes("亿")?a+=1e8*l:a+=l}}}),a>=1e8?`${(a/1e8).toFixed(2)}亿`:a>=1e4?`${(a/1e4).toFixed(2)}万`:a.toFixed(2)}),pa=async()=>{la.value=!0;try{const a=await D.getCases({company_id:ca.value});a.success&&a.data&&(oa.value=a.data.map(a=>({...a,contract_start_date:a.contract_start_date?H(a.contract_start_date,"date"):"-",contract_end_date:a.contract_end_date?H(a.contract_end_date,"date"):"-",created_at:a.created_at?H(a.created_at):"-"})))}catch(a){ta("加载失败",a instanceof Error?a.message:"未知错误")}finally{la.value=!1}},va=()=>{},_a=()=>{da.value.keyword="",da.value.productCategory="",da.value.industry="",da.value.contractType=""},ya=async()=>{var a;if(0!==ra.value.length){sa.value=!0;try{const e=ca.value||(null==(a=ra.value[0])?void 0:a.company_id),t=await D.createCase({company_id:e,case_title:"新建案例",customer_name:"待完善",industry:"金融",contract_type:"合同"});t.success&&t.data?(ea("创建成功","正在跳转到编辑页面..."),U.push(`/knowledge/case/${t.data.case_id}`)):ta("创建失败",t.error||"未知错误")}catch(e){ta("创建失败",e instanceof Error?e.message:"未知错误")}finally{sa.value=!1}}else ta("无法创建","请先添加企业信息")};return y(async()=>{await(async()=>{try{const a=await B.getCompanies();a.success&&a.data&&(ra.value=a.data,ra.value.length>0&&!ca.value&&(ca.value=ra.value[0].company_id,await pa()))}catch(a){}})()}),(i,p)=>{const v=a,_=e,y=c,P=s,H=l,B=r,ra=o,ca=t,ma=n,fa=u,wa=d;return f(),m("div",G,[w("div",M,[b(_,{class:"stat-card"},{default:h(()=>[w("div",N,[w("div",O,[b(v,{size:32,color:"#409eff"},{default:h(()=>[b(g(L))]),_:1})]),w("div",Q,[p[4]||(p[4]=w("div",{class:"stat-label"},"总案例数",-1)),w("div",R,C(oa.value.length),1)])])]),_:1}),b(_,{class:"stat-card"},{default:h(()=>[w("div",Y,[w("div",q,[b(v,{size:32,color:"#67c23a"},{default:h(()=>[b(g(E))]),_:1})]),w("div",A,[p[5]||(p[5]=w("div",{class:"stat-label"},"合同案例",-1)),w("div",J,C(ua.value),1)])])]),_:1}),b(_,{class:"stat-card"},{default:h(()=>[w("div",K,[w("div",S,[b(v,{size:32,color:"#e6a23c"},{default:h(()=>[b(g($))]),_:1})]),w("div",W,[p[6]||(p[6]=w("div",{class:"stat-label"},"合同总额",-1)),w("div",X,C(ia.value),1)])])]),_:1})]),b(g(z),{title:"案例列表"},{actions:h(()=>[b(y,{type:"primary",loading:sa.value,onClick:ya},{default:h(()=>[b(v,null,{default:h(()=>[b(g(T))]),_:1}),p[7]||(p[7]=x(" 新建案例 ",-1))]),_:1},8,["loading"])]),default:h(()=>[w("div",Z,[b(ca,{inline:!0,model:da.value},{default:h(()=>[b(H,{label:"搜索"},{default:h(()=>[b(P,{modelValue:da.value.keyword,"onUpdate:modelValue":p[0]||(p[0]=a=>da.value.keyword=a),placeholder:"搜索案例标题、客户名称...",clearable:"",style:{width:"300px"},onInput:va},{prefix:h(()=>[b(v,null,{default:h(()=>[b(g(F))]),_:1})]),_:1},8,["modelValue"])]),_:1}),b(H,{label:"产品分类"},{default:h(()=>[b(ra,{modelValue:da.value.productCategory,"onUpdate:modelValue":p[1]||(p[1]=a=>da.value.productCategory=a),placeholder:"全部产品",clearable:"",style:{width:"130px"},onChange:va},{default:h(()=>[b(B,{label:"全部产品",value:""}),b(B,{label:"风控产品",value:"风控产品"}),b(B,{label:"实修",value:"实修"}),b(B,{label:"免密",value:"免密"}),b(B,{label:"风控位置",value:"风控位置"})]),_:1},8,["modelValue"])]),_:1}),b(H,{label:"行业"},{default:h(()=>[b(ra,{modelValue:da.value.industry,"onUpdate:modelValue":p[2]||(p[2]=a=>da.value.industry=a),placeholder:"全部行业",clearable:"",style:{width:"120px"},onChange:va},{default:h(()=>[b(B,{label:"全部行业",value:""}),b(B,{label:"科技",value:"科技"}),b(B,{label:"制造业",value:"制造业"}),b(B,{label:"金融",value:"金融"}),b(B,{label:"教育",value:"教育"}),b(B,{label:"医疗",value:"医疗"}),b(B,{label:"建筑",value:"建筑"}),b(B,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),b(H,{label:"合同类型"},{default:h(()=>[b(ra,{modelValue:da.value.contractType,"onUpdate:modelValue":p[3]||(p[3]=a=>da.value.contractType=a),placeholder:"全部类型",clearable:"",style:{width:"120px"},onChange:va},{default:h(()=>[b(B,{label:"全部类型",value:""}),b(B,{label:"合同",value:"合同"}),b(B,{label:"订单",value:"订单"})]),_:1},8,["modelValue"])]),_:1}),b(H,null,{default:h(()=>[b(y,{onClick:_a},{default:h(()=>[b(v,null,{default:h(()=>[b(g(I))]),_:1}),p[8]||(p[8]=x(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),la.value?(f(),k(g(j),{key:0,text:"加载中..."})):na.value.length?(f(),k(wa,{key:2,data:na.value,stripe:"",style:{width:"100%"}},{default:h(()=>[b(ma,{prop:"case_id",label:"ID",width:"70",fixed:""}),b(ma,{prop:"case_title",label:"案例标题","min-width":"200",fixed:"","show-overflow-tooltip":""}),b(ma,{prop:"customer_name",label:"客户名称",width:"180","show-overflow-tooltip":""}),b(ma,{prop:"product_category",label:"产品分类",width:"110",align:"center"},{default:h(({row:a})=>[a.product_category?(f(),k(fa,{key:0,type:"primary",size:"small"},{default:h(()=>[x(C(a.product_category),1)]),_:2},1024)):(f(),m("span",aa,"-"))]),_:1}),b(ma,{prop:"industry",label:"所属行业",width:"100"}),b(ma,{prop:"contract_type",label:"合同类型",width:"100",align:"center"},{default:h(({row:a})=>[b(fa,{type:"合同"===a.contract_type?"primary":"success",size:"small"},{default:h(()=>[x(C(a.contract_type),1)]),_:2},1032,["type"])]),_:1}),b(ma,{prop:"contract_amount",label:"合同金额",width:"120",align:"right"}),b(ma,{prop:"contract_start_date",label:"合同开始日期",width:"120"}),b(ma,{prop:"contract_end_date",label:"合同结束日期",width:"120"}),b(ma,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),b(ma,{label:"操作",width:"220",fixed:"right"},{default:h(({row:a})=>[b(y,{text:"",type:"primary",size:"small",onClick:e=>(a=>{U.push(`/knowledge/case/${a.case_id}`)})(a)},{default:h(()=>[...p[9]||(p[9]=[x(" 查看详情 ",-1)])]),_:1},8,["onClick"]),b(y,{text:"",type:"warning",size:"small",onClick:e=>(a=>{U.push(`/knowledge/case/${a.case_id}`)})(a)},{default:h(()=>[...p[10]||(p[10]=[x(" 编辑 ",-1)])]),_:1},8,["onClick"]),b(y,{text:"",type:"danger",size:"small",onClick:e=>(async a=>{try{if(!confirm(`确定要删除案例 "${a.case_title}" 吗？此操作不可恢复。`))return;const e=await D.deleteCase(a.case_id);e.success?(ea("删除成功",`已删除案例: ${a.case_title}`),await pa()):ta("删除失败",e.error||"未知错误")}catch(e){ta("删除失败",e instanceof Error?e.message:"未知错误")}})(a)},{default:h(()=>[...p[11]||(p[11]=[x(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(f(),k(g(V),{key:1,type:"no-data",description:"暂无案例数据"}))]),_:1})])}}}),[["__scopeId","data-v-f9e054aa"]]);export{ea as default};
