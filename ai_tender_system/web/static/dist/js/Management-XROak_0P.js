import{aK as e,av as a,bE as t,bG as l,be as i,aL as s,aN as r,aY as n,aS as o,aR as c,aM as p,aU as u,a$ as d,aX as m,aQ as _,b0 as f,bN as y,aZ as b}from"./index.js";import{I as g,E as v}from"./IconButton-BUgQpjlL.js";/* empty css               */import"./el-select-JVjgICbv.js";/* empty css                             *//* empty css                    *//* empty css                */import{L as h}from"./Loading-DiM5rrv-.js";import{E as j}from"./Empty-Cym7PiOz.js";/* empty css                                                                          */import{C as w}from"./Card-CuExVMRy.js";/* empty css                   */import"./DocumentPreview.vue_vue_type_style_index_0_scoped_056f7814_lang-Cvhffcax.js";import{t as k}from"./tender-B2_G1CPt.js";import{c as z}from"./company-CDLBTJzM.js";import{E as x,a as C}from"./index-YEioaD_d.js";import{E}from"./index-D28500cA.js";import{E as M}from"./index-DwbH8caQ.js";import"./toNumber-CM6xia4s.js";import"./_baseIteratee-chHnNCKt.js";import"./index-CiTGQxVM.js";import"./flatMap-BtkQY1kY.js";import"./map-Dt0HIbty.js";import"./_baseEach-B8o-eFGg.js";import"./index-DQuz_84T.js";import"./raf-p9A-23_P.js";const P={class:"tender-management"},D={key:3,class:"pagination-wrapper"},Y=b(e({__name:"Management",setup(e){const b=a(!1),Y=a(!1),I=a([]),$=a(1),N=a(10),U=a(0),H=t(),{success:L,error:S}=l(),J=async()=>{var e,a;b.value=!0;try{const t=await k.getProjects({page:$.value,page_size:N.value}),l=(null==(e=t.data)?void 0:e.items)||t.data||[];I.value=l.map(e=>({id:e.project_id,name:e.project_name,number:e.project_number,company_name:e.company_name,status:e.status,created_at:e.created_at,...e})),U.value=(null==(a=t.data)?void 0:a.total)||I.value.length}catch(t){S("加载失败",t instanceof Error?t.message:"未知错误")}finally{b.value=!1}},K=e=>{H.push({name:"TenderManagementDetail",params:{id:e.id}})},R=async()=>{Y.value=!0;try{const e=(await z.getCompanies()).data||[];if(0===e.length)return void S("无法创建项目：请先添加公司信息");const a=(await k.createProject({project_name:"新项目",project_number:`PRJ-${Date.now()}`,company_id:e[0].company_id})).project_id;L("创建成功"),H.push({name:"TenderManagementDetail",params:{id:a}})}catch(e){const a=e instanceof Error?e.message:"未知错误";S(`创建项目失败：${a}`)}finally{Y.value=!1}},T=e=>{N.value=e,$.value=1,J()},X=e=>{$.value=e,J()};return i(()=>{J()}),(e,a)=>{const t=f,l=C,i=E,z=M,H=x,Z=v;return r(),s("div",P,[n(u(w),{title:"项目列表"},{actions:o(()=>[n(t,{type:"primary",loading:Y.value,onClick:R},{default:o(()=>[...a[2]||(a[2]=[_("i",{class:"bi bi-plus-lg"},null,-1),d(" 新建项目 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[b.value?(r(),c(u(h),{key:0,text:"加载中..."})):I.value.length?(r(),c(H,{key:2,data:I.value,stripe:"",style:{width:"100%"}},{default:o(()=>[n(l,{prop:"id",label:"ID",width:"70",fixed:""}),n(l,{prop:"name",label:"项目名称","min-width":"200",fixed:""},{default:o(({row:e})=>[n(i,{type:"primary",onClick:a=>K(e)},{default:o(()=>[d(m(e.name),1)]),_:2},1032,["onClick"])]),_:1}),n(l,{prop:"company_name",label:"公司名称","min-width":"180","show-overflow-tooltip":""}),n(l,{prop:"authorized_person_name",label:"被授权人",width:"100"}),n(l,{label:"商务应答",width:"100",align:"center"},{default:o(({row:e})=>{return[(t=e,t.business_response_file||"completed"===t.business_response_status?(r(),c(z,{key:0,type:"success",size:"small"},{default:o(()=>[...a[3]||(a[3]=[_("i",{class:"bi bi-check-circle-fill"},null,-1),d(" 已生成 ",-1)])]),_:1})):(r(),c(z,{key:1,type:"info",size:"small"},{default:o(()=>[...a[4]||(a[4]=[_("i",{class:"bi bi-dash-circle"},null,-1),d(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),n(l,{label:"技术点对点",width:"110",align:"center"},{default:o(({row:e})=>{return[(t=e,t.point_to_point_file||"completed"===t.point_to_point_status?(r(),c(z,{key:0,type:"success",size:"small"},{default:o(()=>[...a[5]||(a[5]=[_("i",{class:"bi bi-check-circle-fill"},null,-1),d(" 已生成 ",-1)])]),_:1})):(r(),c(z,{key:1,type:"info",size:"small"},{default:o(()=>[...a[6]||(a[6]=[_("i",{class:"bi bi-dash-circle"},null,-1),d(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),n(l,{label:"技术方案",width:"100",align:"center"},{default:o(({row:e})=>{return[(t=e,t.tech_proposal_file||"completed"===t.tech_proposal_status||t.technical_data?(r(),c(z,{key:0,type:"success",size:"small"},{default:o(()=>[...a[7]||(a[7]=[_("i",{class:"bi bi-check-circle-fill"},null,-1),d(" 已生成 ",-1)])]),_:1})):(r(),c(z,{key:1,type:"info",size:"small"},{default:o(()=>[...a[8]||(a[8]=[_("i",{class:"bi bi-dash-circle"},null,-1),d(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),n(l,{label:"最后融合",width:"100",align:"center"},{default:o(({row:e})=>{return[(t=e,t.final_merge_file||"completed"===t.merge_status?(r(),c(z,{key:0,type:"success",size:"small"},{default:o(()=>[...a[9]||(a[9]=[_("i",{class:"bi bi-check-circle-fill"},null,-1),d(" 已融合 ",-1)])]),_:1})):(r(),c(z,{key:1,type:"info",size:"small"},{default:o(()=>[...a[10]||(a[10]=[_("i",{class:"bi bi-dash-circle"},null,-1),d(" 未融合 ",-1)])]),_:1})))];var t}),_:1}),n(l,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:o(({row:e})=>["active"===e.status?(r(),c(z,{key:0,type:"success"},{default:o(()=>[...a[11]||(a[11]=[d("进行中",-1)])]),_:1})):"completed"===e.status?(r(),c(z,{key:1,type:"primary"},{default:o(()=>[...a[12]||(a[12]=[d("已完成",-1)])]),_:1})):(r(),c(z,{key:2,type:"info"},{default:o(()=>[...a[13]||(a[13]=[d("草稿",-1)])]),_:1}))]),_:1}),n(l,{prop:"created_at",label:"创建时间",width:"160"},{default:o(({row:e})=>{return[d(m((a=e.created_at,a?y(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),n(l,{label:"操作",width:"120",fixed:"right"},{default:o(({row:e})=>[n(u(g),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:a=>K(e)},null,8,["onClick"]),n(u(g),{icon:"bi-trash",type:"danger",tooltip:"删除项目",onClick:a=>(async e=>{try{if(!confirm(`确定要删除项目 "${e.name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`))return;await k.deleteProject(e.id),L("删除成功",`已删除项目: ${e.name}`),await J()}catch(a){S("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])):(r(),c(u(j),{key:1,type:"no-data",description:"暂无项目"})),I.value.length>0?(r(),s("div",D,[n(Z,{"current-page":$.value,"onUpdate:currentPage":a[0]||(a[0]=e=>$.value=e),"page-size":N.value,"onUpdate:pageSize":a[1]||(a[1]=e=>N.value=e),total:U.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T,onCurrentChange:X},null,8,["current-page","page-size","total"])])):p("",!0)]),_:1})])}}}),[["__scopeId","data-v-aca97e9b"]]);export{Y as default};
