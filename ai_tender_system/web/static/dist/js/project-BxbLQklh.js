import{d as e}from"./index.js";import{t as a}from"./tender-ZYcn_VXM.js";import{am as t,an as l}from"./editor-DXll0Hem.js";const u=e("project",()=>{const e=t(null),u=t([]),n=t(!1),r=t(null),c=t({page:1,pageSize:10,total:0}),o=l(()=>{var a,t;return(null==(a=e.value)?void 0:a.id)||(null==(t=e.value)?void 0:t.project_id)||null}),s=l(()=>{var a,t;return(null==(a=e.value)?void 0:a.name)||(null==(t=e.value)?void 0:t.project_name)||""}),v=l(()=>{var a,t;return(null==(a=e.value)?void 0:a.number)||(null==(t=e.value)?void 0:t.project_number)||""}),i=l(()=>{var a;return(null==(a=e.value)?void 0:a.status)||null}),d=l(()=>!!e.value),g=l(()=>u.value.length),p=l(()=>u.value.map(e=>({label:`${e.name} (${e.project_number})`,value:e.id}))),j=l(()=>Math.ceil(c.value.total/c.value.pageSize));function m(a){e.value=a,h()}function f(){e.value=null,localStorage.removeItem("current_project")}async function y(e){n.value=!0,r.value=null,(null==e?void 0:e.page)&&(c.value.page=e.page),(null==e?void 0:e.page_size)&&(c.value.pageSize=e.page_size);try{const e=await a.getProjects({page:c.value.page,page_size:c.value.pageSize});e.success&&e.data&&(u.value=e.data.items||e.data,c.value.total=e.data.total||u.value.length)}catch(t){r.value=t.message||"获取项目列表失败"}finally{n.value=!1}}async function P(e){n.value=!0,r.value=null;try{const t=await a.getProject(e);if(t.success&&t.data){const a=u.value.findIndex(a=>a.id===e);return-1!==a&&Object.assign(u.value[a],{name:t.data.name,status:t.data.status,project_number:t.data.project_number}),t.data}return r.value=t.message||"获取项目详情失败",null}catch(t){return r.value=t.message||"获取项目详情失败",null}finally{n.value=!1}}function h(){try{e.value&&localStorage.setItem("current_project",JSON.stringify(e.value))}catch(a){}}return{currentProject:e,projects:u,loading:n,error:r,pagination:c,projectId:o,projectName:s,projectNumber:v,projectStatus:i,hasCurrentProject:d,projectsCount:g,projectsOptions:p,totalPages:j,setCurrentProject:m,setCurrentProjectById:async function(e){n.value=!0,r.value=null;try{const t=await a.getProject(e);return t.success&&t.data?(m(t.data),!0):(r.value=t.message||"获取项目详情失败",!1)}catch(t){return r.value=t.message||"获取项目详情失败",!1}finally{n.value=!1}},clearCurrentProject:f,fetchProjects:y,fetchProject:P,createProject:async function(e){n.value=!0,r.value=null;try{const t=await a.createProject(e);return t.success&&t.data?(u.value.unshift(t.data),c.value.total+=1,t.data):(r.value=t.message||"创建项目失败",null)}catch(t){return r.value=t.message||"创建项目失败",null}finally{n.value=!1}},updateProject:async function(t,l){var c;n.value=!0,r.value=null;try{const n=await a.updateProject(t,l);if(n.success&&n.data){const a=u.value.findIndex(e=>e.id===t);return-1!==a&&Object.assign(u.value[a],n.data),(null==(c=e.value)?void 0:c.id)===t&&(Object.assign(e.value,n.data),h()),!0}return r.value=n.message||"更新项目失败",!1}catch(o){return r.value=o.message||"更新项目失败",!1}finally{n.value=!1}},deleteProject:async function(t){var l;n.value=!0,r.value=null;try{const n=await a.deleteProject(t);return n.success?(u.value=u.value.filter(e=>e.id!==t),c.value.total=Math.max(0,c.value.total-1),(null==(l=e.value)?void 0:l.id)===t&&f(),!0):(r.value=n.message||"删除项目失败",!1)}catch(o){return r.value=o.message||"删除项目失败",!1}finally{n.value=!1}},refreshCurrentProject:async function(){var a;if(!(null==(a=e.value)?void 0:a.id))return;const t=await P(e.value.id);t&&(e.value=t,h())},setPagination:function(e,a){c.value.page=e,c.value.pageSize=a},nextPage:async function(){c.value.page<j.value&&(c.value.page+=1,await y())},prevPage:async function(){c.value.page>1&&(c.value.page-=1,await y())},restoreFromStorage:function(){try{const a=localStorage.getItem("current_project");a&&(e.value=JSON.parse(a))}catch(a){}},saveToStorage:h,$reset:function(){e.value=null,u.value=[],n.value=!1,r.value=null,c.value={page:1,pageSize:10,total:0},localStorage.removeItem("current_project")}}});export{u};
