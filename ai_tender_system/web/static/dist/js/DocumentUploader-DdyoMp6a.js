import{N as e,j as a,C as t,Z as s,a as l}from"./vendor-element-plus-CEQaQHNc.js";import{dB as o,c$ as r,c_ as i,cV as u,es as p,eu as d}from"./vendor-other-CxXkF0Pk.js";import{s as c}from"./imageCompressor-CTkRt5bg.js";import{d as m,r as n,a as f,P as g,M as v,c as x,m as y,N as _,X as h,O as w,L as k,Q as V,I as $,R as b,H as j}from"./vendor-vue-DnBj6vzG.js";/* empty css                                                                          */import{_ as z}from"./index.js";const F={class:"document-uploader"},T={key:1,class:"upload-drag-area"},B={key:0,class:"upload-hint"},C={key:0,class:"upload-tip"},L={class:"upload-file-item"},q={class:"file-name"},D=z(m({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(m,{expose:z,emit:D}){const H=m,I=D,R=n(),S=f({get:()=>H.modelValue||[],set:e=>I("update:modelValue",e)}),U=async e=>{var t;if(H.maxSize&&e.size/1024/1024>H.maxSize)return a.error(`文件大小不能超过 ${H.maxSize}MB`),!1;if(H.accept){const s=H.accept.split(",").map(e=>e.trim()),l="."+(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase());if(!s.some(e=>l===e.toLowerCase()))return a.error(`不支持的文件格式：${l}`),!1}if(H.autoCompressImage&&e.type.startsWith("image/"))try{const a=await c(e,H.imageType),t=e.size,s=a.size;((t-s)/t*100).toFixed(1);if(s<t)return a}catch(s){a.warning("图片压缩失败，将上传原文件")}return!0},M=(e,a,t)=>{},N=(e,a,t)=>{I("success",a,t),I("update:modelValue",t)},O=(e,t,s)=>{a.error("文件上传失败："+e.message),I("error",e,t,s)},P=(e,t)=>{a.warning(`最多只能上传 ${H.limit} 个文件`),I("exceed",e,t)},Q=(e,a)=>{I("remove",e,a),I("update:modelValue",a)};return z({clearFiles:()=>{var e;null==(e=R.value)||e.clearFiles(),I("update:modelValue",[])},submit:()=>{var e;null==(e=R.value)||e.submit()},abort:e=>{var a;null==(a=R.value)||a.abort(e)}}),(a,c)=>{const n=l,f=t,z=s,D=e;return v(),g("div",F,[x(D,y({ref_key:"uploadRef",ref:R,action:m.uploadUrl,"http-request":m.httpRequest,headers:m.uploadHeaders,data:m.uploadData,accept:m.accept,limit:m.limit,multiple:m.multiple,drag:m.drag,"show-file-list":m.showFileList,"before-upload":U,"on-progress":M,"on-success":N,"on-error":O,"on-exceed":P,"on-remove":Q,"file-list":S.value},a.$attrs),{default:_(()=>[h(a.$slots,"trigger",{},()=>[m.drag?(v(),g("div",T,[x(f,{class:"upload-icon"},{default:_(()=>[x($(d))]),_:1}),c[0]||(c[0]=w("div",{class:"upload-text"},[j(" 将文件拖到此处，或"),w("em",null,"点击上传")],-1)),m.accept?(v(),g("div",B," 支持的文件格式："+b(m.accept),1)):V("",!0)])):(v(),k(n,{key:0,type:"primary",icon:$(p)},{default:_(()=>[j(b(m.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:_(()=>[h(a.$slots,"tip",{},()=>[m.tipText?(v(),g("div",C,[x(f,null,{default:_(()=>[x($(u))]),_:1}),j(" "+b(m.tipText),1)])):V("",!0)],!0)]),file:_(({file:e})=>[h(a.$slots,"file",{file:e},()=>[w("div",L,[x(f,{class:"file-icon"},{default:_(()=>[x($(o))]),_:1}),w("span",q,b(e.name),1),"uploading"===e.status?(v(),k(z,{key:0,percentage:e.percentage,"stroke-width":2},null,8,["percentage"])):V("",!0),"success"===e.status?(v(),k(f,{key:1,class:"status-icon success"},{default:_(()=>[x($(r))]),_:1})):V("",!0),"fail"===e.status?(v(),k(f,{key:2,class:"status-icon error"},{default:_(()=>[x($(i))]),_:1})):V("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),[["__scopeId","data-v-7c33a36b"]]);export{D};
