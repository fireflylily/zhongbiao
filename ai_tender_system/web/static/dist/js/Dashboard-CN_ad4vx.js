import{aN as e,e as a,p as t,aO as l,q as i,K as s,M as o,d as r,P as c,N as n,O as d,h as u,G as p}from"./index.js";/* empty css                    *//* empty css                          *//* empty css               */import{E as m,a as f}from"./el-select-BJBcYONu.js";/* empty css                     */import{E as _}from"./el-pagination-MlW_urNO.js";/* empty css                             *//* empty css                */import{u as g}from"./project-B4EXd33R.js";import{u as y}from"./company-CwGwL1q9.js";import{t as v}from"./tender-DY5X_q7i.js";import{am as b,ao as h,aq as k,ar as j,as as w,ax as x,aw as C,au as I,aT as z,ay as P,aS as T,aB as V,an as M,bt as D,aW as E,aC as N,aD as U,az as q,av as B,aA as $,bc as S}from"./editor-DIU3HkCl.js";import{L as Y}from"./Loading-BaeFx9Sd.js";import{E as O}from"./Empty-BzFzMpvB.js";/* empty css                */import{C as R}from"./Card-CP4xfKgW.js";/* empty css                                                        *//* empty css                                                                            *//* empty css                *//* empty css                   */import{a as F,E as A}from"./index-CBo-fVzc.js";import{E as G,a as H}from"./index-BNNUloTG.js";import{E as L}from"./index-CSfbAfoQ.js";import{E as J}from"./strings-BtUgbwSu.js";import{a as K,E as Q}from"./index-8o1yQINi.js";import{k as W}from"./knowledge-BR5smuxz.js";import"./index-E3rjqy71.js";import"./toNumber-D3tTWSp1.js";import"./_baseIteratee-DHzWGqJL.js";import"./company-CHa0NuIL.js";import"./index-DUONv1q7.js";import"./flatMap-2JDpzW_x.js";import"./map-BGIEIDPF.js";import"./_baseEach-BByE8SyV.js";import"./raf-BZHcGSIv.js";const X=["disabled"],Z=i(b({__name:"IconButton",props:{icon:{default:"bi-question-circle"},tooltip:{default:""},tooltipPlacement:{default:"top"},type:{default:"default"},size:{default:"default"},circle:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},badge:{default:""},badgeMax:{default:99},badgeType:{default:"danger"}},emits:["click"],setup(i,{emit:s}){const o=i,r=s,c=h(()=>({[`icon-button--${o.type}`]:!0,[`icon-button--${o.size}`]:!0,"icon-button--circle":o.circle,"is-disabled":o.disabled,"is-loading":o.loading})),n=h(()=>({large:20,default:18,small:16}[o.size])),d=h(()=>({fontSize:`${n.value}px`}));function u(e){o.disabled||o.loading||r("click",e)}return(s,o)=>{const r=a,p=e,m=l;return j(),k(m,{content:i.tooltip,placement:i.tooltipPlacement,disabled:!i.tooltip},{default:w(()=>[x(p,{value:i.badge,hidden:!i.badge,max:i.badgeMax,type:i.badgeType},{default:w(()=>[C("button",{class:V(["icon-button",c.value]),disabled:i.disabled||i.loading,onClick:u},[i.loading?(j(),k(r,{key:0,class:"is-loading",size:n.value},{default:w(()=>[(j(),k(z(P(t))))]),_:1},8,["size"])):(j(),I("i",{key:1,class:V([i.icon,"icon-button-icon"]),style:T(d.value)},null,6))],10,X)]),_:1},8,["value","hidden","max","type"])]),_:1},8,["content","placement","disabled"])}}}),[["__scopeId","data-v-628ec5f8"]]),ee={class:"dashboard-page"},ae={class:"kpi-card"},te={class:"kpi-info"},le={class:"kpi-value"},ie={class:"kpi-card"},se={class:"kpi-info"},oe={class:"kpi-value"},re={class:"kpi-card"},ce={class:"kpi-info"},ne={class:"kpi-value"},de={class:"kpi-card"},ue={class:"kpi-info"},pe={class:"kpi-value"},me={class:"pagination-wrapper"},fe=i(b({__name:"Dashboard",setup(e){const a=s(),t=g(),l=y(),{success:i,error:b}=o(),z=M(!1),T=M(!1),V=M(!1),X=M({totalProjects:0,inProgressProjects:0,wonThisMonth:0,pendingTasks:0}),fe=M([]),_e=M(1),ge=M(10),ye=M(0),ve=M(!1),be=M(),he=D({companyId:null,projectName:"",productCategoryId:null,productItems:[]}),ke={companyId:[{required:!0,message:"请选择公司",trigger:"change"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],productCategoryId:[{required:!0,message:"请选择产品分类",trigger:"change"}]},je=h(()=>l.companiesOptions),we=M([]),xe=h(()=>{if(!he.productCategoryId)return[];const e=we.value.find(e=>e.category_id===he.productCategoryId);return(null==e?void 0:e.items)||[]});async function Ce(){T.value=!0;try{const e=await v.getProjects({page:_e.value,page_size:ge.value});if(e.success&&e.data){const a=e.data.items||e.data||[];fe.value=a.map(e=>({id:e.project_id,project_name:e.project_name,project_number:e.project_number,company_name:e.company_name,tenderer:e.tenderer,authorized_person_name:e.authorized_person_name,status:e.status,created_at:e.created_at,...e})),ye.value=e.data.total||fe.value.length}}catch(e){b("加载项目列表失败: "+e.message)}finally{T.value=!1}}async function Ie(){await Ce(),i("刷新成功")}function ze(){he.productItems=[]}async function Pe(){var e;(0===je.value.length&&await l.fetchCompanies(),0!==je.value.length)?(0===we.value.length&&await async function(){try{const e=await W.getProductCategories();e.success&&e.data&&(we.value=e.data)}catch(e){}}(),he.companyId=null,he.projectName="",he.productCategoryId=null,he.productItems=[],null==(e=be.value)||e.resetFields(),je.value.length>0&&(he.companyId=je.value[0].id),ve.value=!0):b("无法创建项目：请先添加公司信息")}async function Te(){var e;if(await(null==(e=be.value)?void 0:e.validate().catch(()=>!1))){V.value=!0;try{const e=(await v.createProject({project_name:he.projectName,project_number:`PRJ-${Date.now()}`,company_id:he.companyId,product_category_id:he.productCategoryId||void 0,product_items:he.productItems.length>0?he.productItems:void 0})).project_id;i("项目创建成功"),ve.value=!1,a.push({name:"TenderManagementDetail",params:{id:e}})}catch(t){b("创建项目失败: "+t.message)}finally{V.value=!1}}}function Ve(e){t.setCurrentProject(e),a.push({name:"TenderManagementDetail",params:{id:e.id}})}function Me(e){ge.value=e,_e.value=1,Ce()}function De(e){_e.value=e,Ce()}return E(()=>{!async function(){z.value=!0;try{const e=await v.getDashboardStatistics();e.success&&e.data&&(X.value={totalProjects:e.data.totalProjects,inProgressProjects:e.data.inProgressProjects,wonThisMonth:e.data.wonThisMonth,pendingTasks:e.data.pendingTasks})}catch(e){b("加载统计数据失败: "+e.message)}finally{z.value=!1}}(),Ce()}),(e,a)=>{const t=F,l=A,s=r,o=H,g=L,y=J,h=G,z=_,M=f,D=m,E=n,W=d,Ee=Q,Ne=K,Ue=c,qe=u;return j(),I("div",ee,[x(l,{gutter:12,class:"kpi-cards"},{default:w(()=>[x(t,{xs:12,sm:6,md:6,lg:6},{default:w(()=>[C("div",ae,[a[9]||(a[9]=C("div",{class:"kpi-icon",style:{background:"#ecf5ff",color:"#409eff"}},[C("i",{class:"bi bi-folder-fill"})],-1)),C("div",te,[C("div",le,N(X.value.totalProjects),1),a[8]||(a[8]=C("div",{class:"kpi-label"},"总项目数",-1))])])]),_:1}),x(t,{xs:12,sm:6,md:6,lg:6},{default:w(()=>[C("div",ie,[a[11]||(a[11]=C("div",{class:"kpi-icon",style:{background:"#fdf6ec",color:"#e6a23c"}},[C("i",{class:"bi bi-clock-fill"})],-1)),C("div",se,[C("div",oe,N(X.value.inProgressProjects),1),a[10]||(a[10]=C("div",{class:"kpi-label"},"进行中",-1))])])]),_:1}),x(t,{xs:12,sm:6,md:6,lg:6},{default:w(()=>[C("div",re,[a[13]||(a[13]=C("div",{class:"kpi-icon",style:{background:"#f0f9eb",color:"#67c23a"}},[C("i",{class:"bi bi-trophy-fill"})],-1)),C("div",ce,[C("div",ne,N(X.value.wonThisMonth),1),a[12]||(a[12]=C("div",{class:"kpi-label"},"本月中标",-1))])])]),_:1}),x(t,{xs:12,sm:6,md:6,lg:6},{default:w(()=>[C("div",de,[a[15]||(a[15]=C("div",{class:"kpi-icon",style:{background:"#fef0f0",color:"#f56c6c"}},[C("i",{class:"bi bi-list-task"})],-1)),C("div",ue,[C("div",pe,N(X.value.pendingTasks),1),a[14]||(a[14]=C("div",{class:"kpi-label"},"待处理",-1))])])]),_:1})]),_:1}),x(P(R),{title:"项目列表",class:"projects-card"},{actions:w(()=>[x(s,{type:"primary",loading:V.value,onClick:Pe},{default:w(()=>[...a[16]||(a[16]=[C("i",{class:"bi bi-plus-lg"},null,-1),U(" 新建项目 ",-1)])]),_:1},8,["loading"]),x(P(Z),{icon:"bi-arrow-clockwise",tooltip:"刷新",onClick:Ie})]),default:w(()=>[T.value?(j(),k(P(Y),{key:0,visible:!0,fullscreen:!1,text:"加载项目列表..."})):0===fe.value.length?(j(),k(P(O),{key:1,type:"no-data",description:"暂无项目"},{action:w(()=>[x(s,{type:"primary",onClick:Pe},{default:w(()=>[...a[17]||(a[17]=[U("创建第一个项目",-1)])]),_:1})]),_:1})):(j(),I(q,{key:2},[x(h,{data:fe.value,stripe:"",style:{width:"100%"}},{default:w(()=>[x(o,{prop:"id",label:"ID",width:"70",fixed:""}),x(o,{prop:"project_name",label:"项目名称","min-width":"200",fixed:""},{default:w(({row:e})=>[x(g,{type:"primary",onClick:a=>Ve(e)},{default:w(()=>[U(N(e.project_name),1)]),_:2},1032,["onClick"])]),_:1}),x(o,{prop:"tenderer",label:"招标人","min-width":"180","show-overflow-tooltip":""}),x(o,{prop:"authorized_person_name",label:"被授权人",width:"100"}),x(o,{label:"商务应答",width:"100",align:"center"},{default:w(({row:e})=>{return[(t=e,t.business_response_file||"completed"===t.business_response_status?(j(),k(y,{key:0,type:"success",size:"small"},{default:w(()=>[...a[18]||(a[18]=[C("i",{class:"bi bi-check-circle-fill"},null,-1),U(" 已生成 ",-1)])]),_:1})):(j(),k(y,{key:1,type:"info",size:"small"},{default:w(()=>[...a[19]||(a[19]=[C("i",{class:"bi bi-dash-circle"},null,-1),U(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),x(o,{label:"技术点对点",width:"110",align:"center"},{default:w(({row:e})=>{return[(t=e,t.point_to_point_file||"completed"===t.point_to_point_status?(j(),k(y,{key:0,type:"success",size:"small"},{default:w(()=>[...a[20]||(a[20]=[C("i",{class:"bi bi-check-circle-fill"},null,-1),U(" 已生成 ",-1)])]),_:1})):(j(),k(y,{key:1,type:"info",size:"small"},{default:w(()=>[...a[21]||(a[21]=[C("i",{class:"bi bi-dash-circle"},null,-1),U(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),x(o,{label:"技术方案",width:"100",align:"center"},{default:w(({row:e})=>{return[(t=e,t.tech_proposal_file||"completed"===t.tech_proposal_status||t.technical_data?(j(),k(y,{key:0,type:"success",size:"small"},{default:w(()=>[...a[22]||(a[22]=[C("i",{class:"bi bi-check-circle-fill"},null,-1),U(" 已生成 ",-1)])]),_:1})):(j(),k(y,{key:1,type:"info",size:"small"},{default:w(()=>[...a[23]||(a[23]=[C("i",{class:"bi bi-dash-circle"},null,-1),U(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),x(o,{label:"最后融合",width:"100",align:"center"},{default:w(({row:e})=>{return[(t=e,t.final_merge_file||"completed"===t.merge_status?(j(),k(y,{key:0,type:"success",size:"small"},{default:w(()=>[...a[24]||(a[24]=[C("i",{class:"bi bi-check-circle-fill"},null,-1),U(" 已融合 ",-1)])]),_:1})):(j(),k(y,{key:1,type:"info",size:"small"},{default:w(()=>[...a[25]||(a[25]=[C("i",{class:"bi bi-dash-circle"},null,-1),U(" 未融合 ",-1)])]),_:1})))];var t}),_:1}),x(o,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:w(({row:e})=>["active"===e.status?(j(),k(y,{key:0,type:"success"},{default:w(()=>[...a[26]||(a[26]=[U("进行中",-1)])]),_:1})):"completed"===e.status?(j(),k(y,{key:1,type:"primary"},{default:w(()=>[...a[27]||(a[27]=[U("已完成",-1)])]),_:1})):"archived"===e.status?(j(),k(y,{key:2,type:"info"},{default:w(()=>[...a[28]||(a[28]=[U("已归档",-1)])]),_:1})):(j(),k(y,{key:3,type:"info"},{default:w(()=>[...a[29]||(a[29]=[U("草稿",-1)])]),_:1}))]),_:1}),x(o,{prop:"created_at",label:"创建时间",width:"160"},{default:w(({row:e})=>{return[U(N((a=e.created_at,a?S(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),x(o,{label:"操作",width:"120",fixed:"right"},{default:w(({row:e})=>[x(P(Z),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:a=>Ve(e)},null,8,["onClick"]),x(P(Z),{icon:"bi-trash",type:"danger",tooltip:"删除项目",onClick:a=>async function(e){try{await p.confirm(`确定要删除项目 "${e.project_name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await v.deleteProject(e.id),i(`已删除项目: ${e.project_name}`),await Ce()}catch(a){"cancel"!==a&&b("删除失败: "+(a.message||"未知错误"))}}(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),C("div",me,[x(z,{"current-page":_e.value,"onUpdate:currentPage":a[0]||(a[0]=e=>_e.value=e),"page-size":ge.value,"onUpdate:pageSize":a[1]||(a[1]=e=>ge.value=e),total:ye.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Me,onCurrentChange:De},null,8,["current-page","page-size","total"])])],64))]),_:1}),x(qe,{modelValue:ve.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ve.value=e),title:"新建项目",width:"520px","close-on-click-modal":!1},{footer:w(()=>[x(s,{onClick:a[6]||(a[6]=e=>ve.value=!1)},{default:w(()=>[...a[31]||(a[31]=[U("取消",-1)])]),_:1}),x(s,{type:"primary",loading:V.value,onClick:Te},{default:w(()=>[...a[32]||(a[32]=[U(" 创建项目 ",-1)])]),_:1},8,["loading"])]),default:w(()=>[x(Ue,{ref_key:"createFormRef",ref:be,model:he,rules:ke,"label-width":"100px","label-position":"left"},{default:w(()=>[x(E,{label:"所属公司",prop:"companyId"},{default:w(()=>[x(D,{modelValue:he.companyId,"onUpdate:modelValue":a[2]||(a[2]=e=>he.companyId=e),placeholder:"选择公司",style:{width:"100%"},filterable:""},{default:w(()=>[(j(!0),I(q,null,$(je.value,e=>(j(),k(M,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),x(E,{label:"项目名称",prop:"projectName"},{default:w(()=>[x(W,{modelValue:he.projectName,"onUpdate:modelValue":a[3]||(a[3]=e=>he.projectName=e),placeholder:"请输入项目名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),x(E,{label:"产品分类",prop:"productCategoryId"},{default:w(()=>[x(D,{modelValue:he.productCategoryId,"onUpdate:modelValue":a[4]||(a[4]=e=>he.productCategoryId=e),placeholder:"选择产品分类",style:{width:"100%"},onChange:ze},{default:w(()=>[(j(!0),I(q,null,$(we.value,e=>(j(),k(M,{key:e.category_id,label:e.category_name,value:e.category_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),xe.value.length>0?(j(),k(E,{key:0,label:"具体产品"},{default:w(()=>[x(Ne,{modelValue:he.productItems,"onUpdate:modelValue":a[5]||(a[5]=e=>he.productItems=e)},{default:w(()=>[(j(!0),I(q,null,$(xe.value,e=>(j(),k(Ee,{key:e.item_id,label:e.item_name,style:{"margin-right":"16px","margin-bottom":"8px"}},null,8,["label"]))),128))]),_:1},8,["modelValue"]),a[30]||(a[30]=C("div",{class:"form-item-tip"},"可选择一个或多个具体产品项",-1))]),_:1})):B("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-6a4062de"]]);export{fe as default};
