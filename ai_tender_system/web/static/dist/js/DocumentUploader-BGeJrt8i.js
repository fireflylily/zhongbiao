import{aL as e,av as a,aw as t,aM as s,aO as i,aZ as l,bh as o,aT as r,a$ as u,bk as d,aR as p,aS as n,aN as c,aX as m,aV as f,c2 as g,aY as y,b_ as h,b$ as x,b0 as v,c3 as w,b1 as _,c4 as j,c5 as T,a_ as b}from"./index.js";/* empty css                                                                          *//* empty css                */import{E as F}from"./index-C3XccYQN.js";import{E as q}from"./index-CbEdxjaG.js";const z={license:{maxWidth:1500,quality:.8,mimeType:"image/jpeg"},qualification:{maxWidth:1200,quality:.75,mimeType:"image/jpeg"},id_card:{maxWidth:1e3,quality:.7,mimeType:"image/jpeg"},seal:{maxWidth:800,quality:.85,mimeType:"image/jpeg"},photo:{maxWidth:800,quality:.75,mimeType:"image/jpeg"},default:{maxWidth:1200,quality:.75,mimeType:"image/jpeg"}},k=307200,$=1200,W=1200,V=102400,B=.1;async function R(e,a=z.default){try{const t=await function(e){return new Promise((a,t)=>{const s=new FileReader;s.onload=e=>{var s;const i=new Image;i.onload=()=>a(i),i.onerror=()=>t(new Error("图片加载失败")),i.src=null==(s=e.target)?void 0:s.result},s.onerror=()=>t(new Error("文件读取失败")),s.readAsDataURL(e)})}(e);if(!function(e,a){const{size:t,type:s}=e,{width:i,height:l}=a;return!(t<102400)&&(t>k||i>$||l>W||"image/png"===s&&t>V)}(e,t))return e;let{width:s,height:i}=t;const l=a.maxWidth||1200,o=a.maxHeight||l;if(s>l||i>o){const e=Math.min(l/s,o/i);s=Math.round(s*e),i=Math.round(i*e)}const r=document.createElement("canvas");r.width=s,r.height=i;const u=r.getContext("2d");u.fillStyle="#FFFFFF",u.fillRect(0,0,s,i),u.drawImage(t,0,0,s,i);const d=await new Promise((e,t)=>{r.toBlob(a=>{a?e(a):t(new Error("Canvas转Blob失败"))},a.mimeType||"image/jpeg",a.quality||.75)}),p=new File([d],e.name.replace(/\.(png|jpg|jpeg|gif|bmp)$/i,".jpg"),{type:a.mimeType||"image/jpeg",lastModified:Date.now()});return(e.size-p.size)/e.size<B?e:p}catch(t){return e}}const C={class:"document-uploader"},D={key:1,class:"upload-drag-area"},E={key:0,class:"upload-hint"},L={key:0,class:"upload-tip"},M={class:"upload-file-item"},S={class:"file-name"},I=b(e({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(e,{expose:b,emit:k}){const $=e,W=k,V=a(),B=t({get:()=>$.modelValue||[],set:e=>W("update:modelValue",e)}),I=async e=>{var a;if($.maxSize&&e.size/1024/1024>$.maxSize)return d.error(`文件大小不能超过 ${$.maxSize}MB`),!1;if($.accept){const t=$.accept.split(",").map(e=>e.trim()),s="."+(null==(a=e.name.split(".").pop())?void 0:a.toLowerCase());if(!t.some(e=>s===e.toLowerCase()))return d.error(`不支持的文件格式：${s}`),!1}if($.autoCompressImage&&e.type.startsWith("image/"))try{const a=await async function(e,a="default"){return e.type.startsWith("image/")?R(e,z[a]||z.default):e}(e,$.imageType),t=e.size,s=a.size;((t-s)/t*100).toFixed(1);if(s<t)return a}catch(t){d.warning("图片压缩失败，将上传原文件")}return!0},H=(e,a,t)=>{},U=(e,a,t)=>{W("success",a,t),W("update:modelValue",t)},P=(e,a,t)=>{d.error("文件上传失败："+e.message),W("error",e,a,t)},X=(e,a)=>{d.warning(`最多只能上传 ${$.limit} 个文件`),W("exceed",e,a)},Y=(e,a)=>{W("remove",e,a),W("update:modelValue",a)};return b({clearFiles:()=>{var e;null==(e=V.value)||e.clearFiles(),W("update:modelValue",[])},submit:()=>{var e;null==(e=V.value)||e.submit()},abort:e=>{var a;null==(a=V.value)||a.abort(e)}}),(a,t)=>{const d=_,b=m,z=q,k=F;return i(),s("div",C,[l(k,o({ref_key:"uploadRef",ref:V,action:e.uploadUrl,"http-request":e.httpRequest,headers:e.uploadHeaders,data:e.uploadData,accept:e.accept,limit:e.limit,multiple:e.multiple,drag:e.drag,"show-file-list":e.showFileList,"before-upload":I,"on-progress":H,"on-success":U,"on-error":P,"on-exceed":X,"on-remove":Y,"file-list":B.value},a.$attrs),{default:r(()=>[u(a.$slots,"trigger",{},()=>[e.drag?(i(),s("div",D,[l(b,{class:"upload-icon"},{default:r(()=>[l(f(T))]),_:1}),t[0]||(t[0]=p("div",{class:"upload-text"},[v(" 将文件拖到此处，或"),p("em",null,"点击上传")],-1)),e.accept?(i(),s("div",E," 支持的文件格式："+y(e.accept),1)):c("",!0)])):(i(),n(d,{key:0,type:"primary",icon:f(j)},{default:r(()=>[v(y(e.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:r(()=>[u(a.$slots,"tip",{},()=>[e.tipText?(i(),s("div",L,[l(b,null,{default:r(()=>[l(f(w))]),_:1}),v(" "+y(e.tipText),1)])):c("",!0)],!0)]),file:r(({file:e})=>[u(a.$slots,"file",{file:e},()=>[p("div",M,[l(b,{class:"file-icon"},{default:r(()=>[l(f(g))]),_:1}),p("span",S,y(e.name),1),"uploading"===e.status?(i(),n(z,{key:0,percentage:e.percentage,"stroke-width":2},null,8,["percentage"])):c("",!0),"success"===e.status?(i(),n(b,{key:1,class:"status-icon success"},{default:r(()=>[l(f(h))]),_:1})):c("",!0),"fail"===e.status?(i(),n(b,{key:2,class:"status-icon error"},{default:r(()=>[l(f(x))]),_:1})):c("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),[["__scopeId","data-v-7c33a36b"]]);export{I as D};
