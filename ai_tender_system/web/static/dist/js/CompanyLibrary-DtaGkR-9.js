import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";import{E as a}from"./el-overlay-WbHDJpPR.js";import{a as l,E as t}from"./el-table-column-BD7A42cI.js";import"./el-checkbox-BGKkTKtQ.js";/* empty css                   */import"./el-scrollbar-CIZTQeWR.js";import{E as o}from"./el-tag-Bqv51Q1S.js";/* empty css                */import{E as i,a as r}from"./el-form-item-36bfcgrq.js";import{E as s,a as n}from"./el-select-DifvCuS7.js";/* empty css                 */import{d as c,a as d,r as u,x as p,L as m,c as y,g as _,e as v,w as f,F as w,o as b,l as h,k as g,H as C,b8 as j,t as k,b9 as x,B as V,E,aZ as q,ba as D,i as L}from"./index.js";import{L as N}from"./Loading-CAB1YVrd.js";import{E as U}from"./Empty-zwxEoS1s.js";import{P as z}from"./PageHeader-BjzQIq6-.js";import{C as T}from"./Card-DZyKkX6c.js";import"./DocumentUploader.vue_vue_type_style_index_0_scoped_1530a3ce_lang-kpO4p46J.js";import{c as F}from"./company-DPT6r5J2.js";import{E as I}from"./index-C4gi5RAB.js";import{E as P}from"./index-2qkNUAPG.js";import"./refs-Cw5r5QN8.js";import"./_baseClone-DjpDAVKO.js";import"./omit-CrzxF80D.js";import"./castArray-Bpm97oyT.js";import"./raf-C3W2Tojd.js";import"./index-C9x2piTf.js";import"./strings-DTR7aduZ.js";const $={class:"company-library"},H={class:"stats-bar"},A={class:"stat-content"},B={class:"stat-icon"},M={class:"stat-info"},R={class:"stat-value"},G={class:"stat-content"},J={class:"stat-icon"},K={class:"stat-info"},O={class:"stat-value"},Q={class:"filter-section"},Z={class:"qualification-progress"},S={class:"progress-text"},W=e(c({__name:"CompanyLibrary",setup(e){const c=L(),{success:W,error:X}=d(),Y=u(!1),ee=u([]),ae=u({keyword:"",industry:""}),le=u(!1),te=u(!1),oe=u(),ie=u({companyName:"",companyCode:"",industryType:"",companyDescription:""}),re={companyName:[{required:!0,message:"请输入企业名称",trigger:"blur"},{min:2,max:100,message:"企业名称长度在 2 到 100 个字符",trigger:"blur"}]},se=p(()=>{let e=[...ee.value];if(ae.value.keyword){const a=ae.value.keyword.toLowerCase();e=e.filter(e=>{var l,t,o;return(null==(l=e.company_name)?void 0:l.toLowerCase().includes(a))||(null==(t=e.social_credit_code)?void 0:t.toLowerCase().includes(a))||(null==(o=e.company_code)?void 0:o.toLowerCase().includes(a))})}return ae.value.industry&&(e=e.filter(e=>e.industry_type===ae.value.industry)),e}),ne=async()=>{Y.value=!0;try{const e=(await F.getCompanies()).data||[],a=await Promise.all(e.map(async e=>{let a=0;try{const l=await F.getCompanyQualifications(e.company_id);l.data&&(a=Object.keys(l.data).length)}catch(t){}const l=Math.round(a/17*100);return{company_id:e.company_id,company_name:e.company_name||"未命名",company_code:e.company_code||"",social_credit_code:e.social_credit_code||"-",legal_representative:e.legal_representative||"-",registered_capital:e.registered_capital||"-",employee_count:e.employee_count||"-",industry_type:e.industry_type||"",product_count:e.product_count||0,document_count:e.document_count||0,qualification_completed:a,qualification_total:17,qualification_progress:l,created_at:e.created_at||"-",updated_at:e.updated_at||"-",...e}}));ee.value=a}catch(e){X("加载失败",e instanceof Error?e.message:"未知错误")}finally{Y.value=!1}},ce=()=>{},de=()=>{ae.value.keyword="",ae.value.industry=""},ue=()=>{le.value=!0},pe=async()=>{oe.value&&await oe.value.validate(async e=>{if(e){te.value=!0;try{(await F.createCompany({name:ie.value.companyName,code:ie.value.companyCode||void 0,description:ie.value.companyDescription||void 0})).success&&(W("创建成功","企业创建成功"),le.value=!1,await ne())}catch(a){X("创建失败",a instanceof Error?a.message:"未知错误")}finally{te.value=!1}}})},me=()=>{var e;ie.value={companyName:"",companyCode:"",industryType:"",companyDescription:""},null==(e=oe.value)||e.resetFields()};return m(()=>{ne()}),(e,d)=>{const u=h,p=C,m=I,L=E,ye=r,_e=n,ve=s,fe=i,we=l,be=P,he=o,ge=t,Ce=a;return b(),y("div",$,[_(w(z),{title:"企业库",description:"管理企业基本信息和资质证书"},{actions:f(()=>[_(u,{type:"primary",icon:"Plus",onClick:ue},{default:f(()=>[...d[8]||(d[8]=[g("新增企业",-1)])]),_:1})]),_:1}),v("div",H,[_(m,{class:"stat-card"},{default:f(()=>[v("div",A,[v("div",B,[_(p,{size:32,color:"#409eff"},{default:f(()=>[_(w(j))]),_:1})]),v("div",M,[d[9]||(d[9]=v("div",{class:"stat-label"},"总企业数",-1)),v("div",R,k(ee.value.length),1)])])]),_:1}),_(m,{class:"stat-card"},{default:f(()=>[v("div",G,[v("div",J,[_(p,{size:32,color:"#67c23a"},{default:f(()=>[_(w(x))]),_:1})]),v("div",K,[d[10]||(d[10]=v("div",{class:"stat-label"},"筛选结果",-1)),v("div",O,k(se.value.length),1)])])]),_:1})]),_(w(T),{title:"企业列表"},{default:f(()=>[v("div",Q,[_(fe,{inline:!0,model:ae.value},{default:f(()=>[_(ye,{label:"搜索"},{default:f(()=>[_(L,{modelValue:ae.value.keyword,"onUpdate:modelValue":d[0]||(d[0]=e=>ae.value.keyword=e),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:ce},{prefix:f(()=>[_(p,null,{default:f(()=>[_(w(q))]),_:1})]),_:1},8,["modelValue"])]),_:1}),_(ye,{label:"行业类型"},{default:f(()=>[_(ve,{modelValue:ae.value.industry,"onUpdate:modelValue":d[1]||(d[1]=e=>ae.value.industry=e),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:ce},{default:f(()=>[_(_e,{label:"全部行业",value:""}),_(_e,{label:"科技",value:"technology"}),_(_e,{label:"制造业",value:"manufacturing"}),_(_e,{label:"金融",value:"finance"}),_(_e,{label:"教育",value:"education"}),_(_e,{label:"医疗",value:"healthcare"}),_(_e,{label:"零售",value:"retail"}),_(_e,{label:"建筑",value:"construction"}),_(_e,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),_(ye,null,{default:f(()=>[_(u,{onClick:de},{default:f(()=>[_(p,null,{default:f(()=>[_(w(D))]),_:1}),d[11]||(d[11]=g(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),Y.value?(b(),V(w(N),{key:0,text:"加载中..."})):se.value.length?(b(),V(ge,{key:2,data:se.value,stripe:"",style:{width:"100%"}},{default:f(()=>[_(we,{prop:"company_id",label:"ID",width:"70",fixed:""}),_(we,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),_(we,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),_(we,{prop:"legal_representative",label:"法定代表人",width:"120"}),_(we,{prop:"registered_capital",label:"注册资本",width:"120"}),_(we,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),_(we,{label:"资质完成度",width:"180",align:"center"},{default:f(({row:e})=>{return[v("div",Z,[_(be,{percentage:e.qualification_progress||0,color:(a=e.qualification_progress||0,a<30?"#f56c6c":a<70?"#e6a23c":"#67c23a"),"stroke-width":8},null,8,["percentage","color"]),v("span",S,k(e.qualification_completed||0)+"/"+k(e.qualification_total||17),1)])];var a}),_:1}),_(we,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:f(({row:e})=>[_(he,{size:"small",type:"info"},{default:f(()=>[g(k(e.product_count||0),1)]),_:2},1024)]),_:1}),_(we,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:f(({row:e})=>[_(he,{size:"small",type:"success"},{default:f(()=>[g(k(e.document_count||0),1)]),_:2},1024)]),_:1}),_(we,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),_(we,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),_(we,{label:"操作",width:"220",fixed:"right"},{default:f(({row:e})=>[_(u,{text:"",type:"primary",size:"small",onClick:a=>(e=>{c.push(`/knowledge/company/${e.company_id}`)})(e)},{default:f(()=>[...d[12]||(d[12]=[g(" 查看详情 ",-1)])]),_:1},8,["onClick"]),_(u,{text:"",type:"warning",size:"small",onClick:a=>(e=>{c.push(`/knowledge/company/${e.company_id}`)})(e)},{default:f(()=>[...d[13]||(d[13]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"]),_(u,{text:"",type:"danger",size:"small",onClick:a=>(async e=>{try{if(!confirm(`确定要删除企业 "${e.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`))return;await F.deleteCompany(e.company_id),W("删除成功",`已删除企业: ${e.company_name}`),await ne()}catch(a){X("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:f(()=>[...d[14]||(d[14]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(b(),V(w(U),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1}),_(Ce,{modelValue:le.value,"onUpdate:modelValue":d[7]||(d[7]=e=>le.value=e),title:"新建企业",width:"500px",onClose:me},{footer:f(()=>[_(u,{onClick:d[6]||(d[6]=e=>le.value=!1)},{default:f(()=>[...d[15]||(d[15]=[g("取消",-1)])]),_:1}),_(u,{type:"primary",loading:te.value,onClick:pe},{default:f(()=>[...d[16]||(d[16]=[g(" 确定 ",-1)])]),_:1},8,["loading"])]),default:f(()=>[_(fe,{ref_key:"createFormRef",ref:oe,model:ie.value,rules:re,"label-width":"120px"},{default:f(()=>[_(ye,{label:"企业名称",prop:"companyName"},{default:f(()=>[_(L,{modelValue:ie.value.companyName,"onUpdate:modelValue":d[2]||(d[2]=e=>ie.value.companyName=e),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),_(ye,{label:"企业代码",prop:"companyCode"},{default:f(()=>[_(L,{modelValue:ie.value.companyCode,"onUpdate:modelValue":d[3]||(d[3]=e=>ie.value.companyCode=e),placeholder:"请输入企业代码（可选）"},null,8,["modelValue"])]),_:1}),_(ye,{label:"行业类型",prop:"industryType"},{default:f(()=>[_(ve,{modelValue:ie.value.industryType,"onUpdate:modelValue":d[4]||(d[4]=e=>ie.value.industryType=e),placeholder:"请选择行业类型",style:{width:"100%"}},{default:f(()=>[_(_e,{label:"科技",value:"technology"}),_(_e,{label:"制造业",value:"manufacturing"}),_(_e,{label:"金融",value:"finance"}),_(_e,{label:"教育",value:"education"}),_(_e,{label:"医疗",value:"healthcare"}),_(_e,{label:"零售",value:"retail"}),_(_e,{label:"建筑",value:"construction"}),_(_e,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),_(ye,{label:"企业简介",prop:"companyDescription"},{default:f(()=>[_(L,{modelValue:ie.value.companyDescription,"onUpdate:modelValue":d[5]||(d[5]=e=>ie.value.companyDescription=e),type:"textarea",rows:3,placeholder:"请输入企业简介（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-d35af7f2"]]);export{W as default};
