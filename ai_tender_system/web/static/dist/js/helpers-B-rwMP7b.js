import{a2 as e,T as t,ax as a,av as s,a1 as l,aY as i,bI as o,u as n,X as r,aJ as c,p as d,bq as u,U as p,bN as f,g as m,w as y,b1 as v,E as h,_ as b,s as _,n as g,q as w,a5 as x,bO as k,D as F,F as C,M as I}from"./index.js";import{bB as j,bL as E,am as $,aH as T,an as H,bT as z,cg as S,ap as B,av as K,ar as U,aM as L,az as R,ax as A,bS as M,au as N,at as O,aR as P,aQ as Y,as as V,aq as D,aw as q,bv as J,aS as W,aI as Q,aT as G,bc as X,aJ as Z,aU as ee,aV as te,bI as ae}from"./editor-CW41Mq4b.js";/* empty css               */import{E as se}from"./strings-CI1rj266.js";/* empty css                                                                          *//* empty css                   *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                */import{a as le,E as ie}from"./index-Jb4BHfA3.js";import{E as oe}from"./index-Bksm3dTX.js";import{E as ne}from"./index-BjikXUqk.js";import{E as re,a as ce}from"./index-CdDG5CTk.js";import{E as de}from"./index-DlKNcsVH.js";import{E as ue}from"./index-CiL5Ucqq.js";import{E as pe,a as fe}from"./index-Fgx7eeaB.js";import{v as me}from"./directive-Dc_2LKDx.js";import{E as ye}from"./index-CqpIP0RU.js";const ve=t=>e(t)||j(t)||E(t),he=t({accordion:Boolean,modelValue:{type:l([Array,String,Number]),default:()=>i([])},expandIconPosition:{type:l([String]),default:"right"},beforeCollapse:{type:l(Function)}}),be={[s]:ve,[a]:ve},_e=Symbol("collapseContextKey"),ge=B({name:"ElCollapse"});var we=d(B({...ge,props:he,emits:be,setup(e,{expose:t,emit:l}){const i=e,{activeNames:d,setActiveNames:u}=((e,t)=>{const l=$(o(e.modelValue)),i=i=>{l.value=i;const o=e.accordion?l.value[0]:l.value;t(s,o),t(a,o)},n=t=>{if(e.accordion)i([l.value[0]===t?"":t]);else{const e=[...l.value],a=e.indexOf(t);a>-1?e.splice(a,1):e.push(t),i(e)}};return T(()=>e.modelValue,()=>l.value=o(e.modelValue),{deep:!0}),z(_e,{activeNames:l,handleItemClick:async t=>{const{beforeCollapse:a}=e;if(!a)return void n(t);const s=a(t);[S(s),r(s)].includes(!0)||c("ElCollapse","beforeCollapse must return type `Promise<boolean>` or `boolean`"),S(s)?s.then(e=>{!1!==e&&n(t)}).catch(e=>{}):s&&n(t)}}),{activeNames:l,setActiveNames:i}})(i,l),{rootKls:p}=(e=>{const t=n("collapse");return{rootKls:H(()=>[t.b(),t.b(`icon-position-${e.expandIconPosition}`)])}})(i);return t({activeNames:d,setActiveNames:u}),(e,t)=>(U(),K("div",{class:R(A(p))},[L(e.$slots,"default")],2))}}),[["__file","collapse.vue"]]);const xe=t({title:{type:String,default:""},name:{type:l([String,Number]),default:void 0},icon:{type:p,default:u},disabled:Boolean}),ke=B({name:"ElCollapseItem"});var Fe=d(B({...ke,props:xe,setup(e,{expose:t}){const a=e,{focusing:s,id:l,isActive:i,handleFocus:o,handleHeaderClick:r,handleEnterClick:c}=(e=>{const t=M(_e),{namespace:a}=n("collapse"),s=$(!1),l=$(!1),i=f(),o=H(()=>i.current++),r=H(()=>{var t;return null!=(t=e.name)?t:`${a.value}-id-${i.prefix}-${A(o)}`}),c=H(()=>null==t?void 0:t.activeNames.value.includes(A(r)));return{focusing:s,id:o,isActive:c,handleFocus:()=>{setTimeout(()=>{l.value?l.value=!1:s.value=!0},50)},handleHeaderClick:a=>{if(e.disabled)return;const i=a.target;(null==i?void 0:i.closest("input, textarea, select"))||(null==t||t.handleItemClick(A(r)),s.value=!1,l.value=!0)},handleEnterClick:e=>{const a=e.target;(null==a?void 0:a.closest("input, textarea, select"))||(e.preventDefault(),null==t||t.handleItemClick(A(r)))}}})(a),{arrowKls:d,headKls:u,rootKls:p,itemTitleKls:y,itemWrapperKls:v,itemContentKls:h,scopedContentId:b,scopedHeadId:_}=((e,{focusing:t,isActive:a,id:s})=>{const l=n("collapse"),i=H(()=>[l.b("item"),l.is("active",A(a)),l.is("disabled",e.disabled)]),o=H(()=>[l.be("item","header"),l.is("active",A(a)),{focusing:A(t)&&!e.disabled}]),r=H(()=>[l.be("item","arrow"),l.is("active",A(a))]);return{itemTitleKls:H(()=>[l.be("item","title")]),arrowKls:r,headKls:o,rootKls:i,itemWrapperKls:H(()=>l.be("item","wrap")),itemContentKls:H(()=>l.be("item","content")),scopedContentId:H(()=>l.b(`content-${A(s)}`)),scopedHeadId:H(()=>l.b(`head-${A(s)}`))}})(a,{focusing:s,isActive:i,id:l});return t({isActive:i}),(e,t)=>(U(),K("div",{class:R(A(p))},[N("div",{id:A(_),class:R(A(u)),"aria-expanded":A(i),"aria-controls":A(b),"aria-describedby":A(b),tabindex:e.disabled?-1:0,role:"button",onClick:A(r),onKeydown:J(W(A(c),["stop"]),["space","enter"]),onFocus:A(o),onBlur:e=>s.value=!1},[N("span",{class:R(A(y))},[L(e.$slots,"title",{isActive:A(i)},()=>[P(Y(e.title),1)])],2),L(e.$slots,"icon",{isActive:A(i)},()=>[O(A(m),{class:R(A(d))},{default:V(()=>[(U(),D(q(e.icon)))]),_:1},8,["class"])])],42,["id","aria-expanded","aria-controls","aria-describedby","tabindex","onClick","onKeydown","onFocus","onBlur"]),O(A(ue),null,{default:V(()=>[Q(N("div",{id:A(b),role:"region",class:R(A(v)),"aria-hidden":!A(i),"aria-labelledby":A(_)},[N("div",{class:R(A(h))},[L(e.$slots,"default")],2)],10,["id","aria-hidden","aria-labelledby"]),[[G,A(i)]])]),_:3})],2))}}),[["__file","collapse-item.vue"]]);const Ce=y(we,{CollapseItem:Fe}),Ie=v(Fe);function je(e={}){const{onFileLoaded:t,onFileCancelled:a,onSyncSuccess:s}=e,l=$(!1),i=$(null),o=$(!1),n=$(!1),r=H(()=>!!i.value),c=e=>({technicalFile:"æŠ€æœ¯éœ€æ±‚æ–‡ä»¶",tenderFile:"æ‹›æ ‡æ–‡æ¡£",templateFile:"åº”ç­”æ¨¡æ¿",businessResponseFile:"å•†åŠ¡åº”ç­”æ–‡ä»¶",p2pResponseFile:"ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶",techProposalFile:"æŠ€æœ¯æ–¹æ¡ˆæ–‡ä»¶"}[e]||"æ–‡ä»¶");return{useHitlFile:l,hitlFileInfo:i,hasHitlFile:r,syncing:o,synced:n,loadFromHITL:(e,a="technicalFile")=>{const s=e[a];return s?(i.value={filename:s.filename||s.name||"æœªçŸ¥æ–‡ä»¶",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},l.value=!0,n.value=!1,h.success({message:`å·²åŠ è½½HITL${c(a)}: ${i.value.filename}`,duration:3e3}),t&&t(i.value),!0):(h.warning(`å½“å‰é¡¹ç›®æ²¡æœ‰${c(a)}`),!1)},cancelHitlFile:()=>{l.value=!1,i.value=null,n.value=!1,h.info("å·²å–æ¶ˆä½¿ç”¨HITLæ–‡ä»¶"),a&&a()},syncToHitl:async(e,t,a)=>{if(!e)return h.error("é¡¹ç›®IDæ— æ•ˆ"),!1;if(!t)return h.error("æ–‡ä»¶è·¯å¾„æ— æ•ˆ"),!1;o.value=!0;try{const l=await fetch(`/api/tender-processing/sync-file/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,file_type:a})}),i=l.headers.get("content-type");if(!(null==i?void 0:i.includes("application/json"))){await l.text();throw new Error(`æœåŠ¡å™¨è¿”å›å¼‚å¸¸å“åº” (${l.status}): ${l.statusText}ã€‚å¯èƒ½æ˜¯åç«¯é…ç½®é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚`)}const o=await l.json();if(o.success||l.ok)return n.value=!0,h.success({message:o.message||"å·²æˆåŠŸåŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›®",duration:3e3}),s&&await s(),!0;throw new Error(o.error||o.message||"åŒæ­¥å¤±è´¥")}catch(l){let e="åŒæ­¥åˆ°é¡¹ç›®å¤±è´¥";return l.message?e=l.message:"TypeError"===l.name&&(e="ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"),h.error({message:e,duration:5e3}),!1}finally{o.value=!1}},resetSyncStatus:()=>{n.value=!1}}}function Ee(e,t="YYYY-MM-DD"){return e?X(e).format(t):""}function $e(e,t=2){if(null==e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,a)).toFixed(t)} ${["B","KB","MB","GB","TB","PB"][a]}`}const Te={class:"stats-card"},He={key:0,class:"stats-title"},ze={class:"stat-item"},Se={class:"stat-prefix"},Be={class:"stat-suffix"},Ke=b(B({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,a=[{key:"total_replacements",label:"æ–‡æœ¬æ›¿æ¢",suffix:"å¤„"},{key:"tables_processed",label:"è¡¨æ ¼å¤„ç†",suffix:"ä¸ª"},{key:"cells_filled",label:"å•å…ƒæ ¼å¡«å……",suffix:"ä¸ª"},{key:"images_inserted",label:"å›¾ç‰‡æ’å…¥",suffix:"å¼ "}],s=H(()=>t.statItems||a),l=e=>{const a=e.split(".");let s=t.stats;for(const t of a)if(s=null==s?void 0:s[t],null==s)break;return"number"==typeof s?s:0};return(t,a)=>{const i=oe,o=ie,n=le;return U(),K("div",Te,[e.title?(U(),K("h4",He,Y(e.title),1)):Z("",!0),O(n,{gutter:e.gutter},{default:V(()=>[(U(!0),K(ee,null,te(s.value,t=>(U(),D(o,{key:t.key,span:e.span},{default:V(()=>[N("div",ze,[O(i,{title:t.label,value:l(t.key),precision:t.precision,"value-style":e.valueStyle},ae({_:2},[t.prefix?{name:"prefix",fn:V(()=>[N("span",Se,Y(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:V(()=>[N("span",Be,Y(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),Ue={class:"alert-content"},Le={class:"file-info"},Re={class:"file-details"},Ae={class:"file-label"},Me={class:"file-name"},Ne={key:0,class:"file-size"},Oe={class:"alert-actions"},Pe=b(B({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"ä½¿ç”¨HITLæ–‡ä»¶:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"å–æ¶ˆä½¿ç”¨"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:t}){const a=t,s=()=>{a("cancel")};return(t,a)=>{const l=m,i=se,o=w,n=g;return e.fileInfo?(U(),D(n,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:V(()=>[N("div",Ue,[N("div",Le,[O(l,{class:"file-icon"},{default:V(()=>[O(A(_))]),_:1}),N("div",Re,[N("span",Ae,Y(e.label),1),N("span",Me,Y(e.fileInfo.filename),1),e.fileInfo.file_size?(U(),K("span",Ne," ("+Y(A($e)(e.fileInfo.file_size))+") ",1)):Z("",!0),e.showTag?(U(),D(i,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:V(()=>[...a[0]||(a[0]=[P(" å·²ä»æŠ•æ ‡é¡¹ç›®åŠ è½½ ",-1)])]),_:1})):Z("",!0)])]),N("div",Oe,[L(t.$slots,"actions",{},()=>[e.showCancel?(U(),D(o,{key:0,type:"text",size:"small",onClick:s},{default:V(()=>[O(l,null,{default:V(()=>[O(A(x))]),_:1}),P(" "+Y(e.cancelText),1)]),_:1})):Z("",!0)],!0)])])]),_:3},8,["type"])):Z("",!0)}}}),[["__scopeId","data-v-1a132715"]]),Ye={class:"history-files-panel"},Ve={class:"card-header"},De={class:"header-title"},qe={class:"current-file-content"},Je={class:"history-actions"},We={class:"collapse-header"},Qe={class:"filename-cell"},Ge=b(B({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"è¯¥é¡¹ç›®å·²æœ‰ç”Ÿæˆæ–‡ä»¶"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const t=$([]),a=e=>{if(!e)return"-";let t=e;try{t=decodeURIComponent(e)}catch{}const a=t.split("/");return a[a.length-1]||"-"};return(s,l)=>{const i=se,o=g,n=ce,r=de,c=re,d=m,u=w,p=ne,f=fe,y=pe,v=ye,h=Ie,b=Ce,x=me;return U(),K("div",Ye,[e.currentFile?(U(),D(p,{key:0,shadow:"never",class:"current-file-card"},{header:V(()=>[N("div",Ve,[N("div",De,[N("span",null,Y(e.title||"ğŸ“„ è¯¥é¡¹ç›®çš„ç”Ÿæˆæ–‡ä»¶"),1),O(i,{type:"info"},{default:V(()=>[...l[6]||(l[6]=[P("å†å²æ–‡ä»¶",-1)])]),_:1})])])]),default:V(()=>[N("div",qe,[O(o,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(U(),D(Ke,{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):Z("",!0),O(c,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:V(()=>[O(n,{label:"æ–‡ä»¶å"},{default:V(()=>[P(Y(a(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),O(n,{label:"ä¸‹è½½åœ°å€"},{default:V(()=>[O(r,{href:e.currentFile.downloadUrl,type:"primary"},{default:V(()=>[P(Y(a(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),N("div",Je,[e.showEditorOpen?(U(),D(u,{key:0,type:"primary",size:"large",onClick:l[0]||(l[0]=t=>s.$emit("openInEditor",e.currentFile))},{default:V(()=>[O(d,null,{default:V(()=>[O(A(k))]),_:1}),l[7]||(l[7]=P(" åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ",-1))]),_:1})):Z("",!0),O(u,{type:"primary",size:"large",icon:A(F),onClick:l[1]||(l[1]=t=>s.$emit("preview",e.currentFile))},{default:V(()=>[...l[8]||(l[8]=[P(" é¢„è§ˆWord ",-1)])]),_:1},8,["icon"]),O(u,{type:"success",size:"large",icon:A(C),onClick:l[2]||(l[2]=t=>s.$emit("download",e.currentFile))},{default:V(()=>[...l[9]||(l[9]=[P(" ä¸‹è½½ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(U(),D(u,{key:1,size:"large",icon:A(I),onClick:l[3]||(l[3]=e=>s.$emit("regenerate"))},{default:V(()=>[...l[10]||(l[10]=[P(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])):Z("",!0)])])]),_:1})):Z("",!0),e.historyFiles.length>0?(U(),D(b,{key:1,modelValue:t.value,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value=e),class:"history-collapse"},{default:V(()=>[O(h,{name:"history"},{title:V(()=>[N("div",We,[N("span",null,"ğŸ“‚ æŸ¥çœ‹æ‰€æœ‰å†å²å¤„ç†æ–‡ä»¶ ("+Y(e.historyFiles.length)+")",1),t.value.includes("history")?(U(),D(u,{key:0,type:"primary",size:"small",loading:e.loading,onClick:l[4]||(l[4]=W(e=>s.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:V(()=>[...l[11]||(l[11]=[P(" åˆ·æ–°åˆ—è¡¨ ",-1)])]),_:1},8,["loading"])):Z("",!0)])]),default:V(()=>[O(p,{shadow:"never",style:{border:"none"}},{default:V(()=>[Q((U(),D(y,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:V(()=>[O(f,{type:"index",label:"åºå·",width:"60"}),O(f,{prop:"filename",label:"æ–‡ä»¶å","min-width":"300"},{default:V(({row:e})=>[N("div",Qe,[O(d,null,{default:V(()=>[O(A(_))]),_:1}),N("span",null,Y(e.filename),1)])]),_:1}),O(f,{prop:"size",label:"æ–‡ä»¶å¤§å°",width:"120"},{default:V(({row:e})=>[P(Y(A($e)(e.size)),1)]),_:1}),O(f,{prop:"process_time",label:"å¤„ç†æ—¶é—´",width:"180"},{default:V(({row:e})=>[P(Y(A(Ee)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),O(f,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:V(({row:e})=>[O(u,{type:"primary",size:"small",onClick:t=>s.$emit("preview",e)},{default:V(()=>[...l[12]||(l[12]=[P(" é¢„è§ˆ ",-1)])]),_:1},8,["onClick"]),O(u,{type:"success",size:"small",onClick:t=>s.$emit("download",e)},{default:V(()=>[...l[13]||(l[13]=[P(" ä¸‹è½½ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,e.loading]]),e.loading||0!==e.historyFiles.length?Z("",!0):(U(),D(v,{key:0,description:"æš‚æ— å†å²æ–‡ä»¶","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):Z("",!0)])}}}),[["__scopeId","data-v-6814751e"]]);async function Xe(e,t){if("string"!=typeof e){const a=URL.createObjectURL(e),s=document.createElement("a");return s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),void URL.revokeObjectURL(a)}try{const a=await fetch(e);if(!a.ok){const e=a.headers.get("content-type");if(e&&e.includes("application/json")){const e=await a.json();throw new Error(e.error||e.message||"æ–‡ä»¶ä¸‹è½½å¤±è´¥")}throw new Error(`æ–‡ä»¶ä¸‹è½½å¤±è´¥: HTTP ${a.status}`)}const s=a.headers.get("content-type");if(s&&(s.includes("text/html")||s.includes("application/json")))throw new Error("æœåŠ¡å™¨è¿”å›äº†é”™è¯¯é¡µé¢ï¼Œè€Œä¸æ˜¯æ–‡ä»¶");const l=await a.blob(),i=URL.createObjectURL(l),o=document.createElement("a");o.href=i,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(a){throw a}}export{Ie as E,Pe as H,Ke as S,Ce as a,Ge as b,Xe as d,je as u};
