import{Y as e,O as t,as as a,aq as s,X as l,aT as i,bA as o,u as n,S as r,aF as c,l as d,bn as u,P as p,bB as f,n as m,w as y,aW as v,E as h,_ as b,q as _,h as g,o as w,a0 as x,bC as k,z as F,A as C,H as I}from"./index.js";import{bB as j,bL as E,am as $,ax as T,an as z,bS as B,cc as H,aw as S,aC as K,az as R,aI as A,aN as L,aF as U,bR as N,aO as O,aE as P,aR as M,aQ as V,aA as Y,ay as D,aP as W,bv as q,aS as Q,aB as G,aT as J,bc as X,aD as Z,aU as ee,aV as te,bI as ae}from"./editor-CksRIowP.js";/* empty css               */import{E as se}from"./strings-Bn-6jhOp.js";/* empty css                                                                          *//* empty css                   *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                */import{a as le,E as ie}from"./index-Bh1dRiX1.js";import{E as oe}from"./index-B-GFiNcd.js";import{E as ne}from"./index-Bx44ChEh.js";import{E as re,a as ce}from"./index-B77X2HEQ.js";import{E as de}from"./index-DqCqAz0A.js";import{E as ue}from"./index-CO40g4NF.js";import{E as pe,a as fe}from"./index-TCK3w3yx.js";import{v as me}from"./directive-Cf71rdav.js";import{E as ye}from"./index-CQzNhylW.js";const ve=t=>e(t)||j(t)||E(t),he=t({accordion:Boolean,modelValue:{type:l([Array,String,Number]),default:()=>i([])},expandIconPosition:{type:l([String]),default:"right"},beforeCollapse:{type:l(Function)}}),be={[s]:ve,[a]:ve},_e=Symbol("collapseContextKey"),ge=S({name:"ElCollapse"});var we=d(S({...ge,props:he,emits:be,setup(e,{expose:t,emit:l}){const i=e,{activeNames:d,setActiveNames:u}=((e,t)=>{const l=$(o(e.modelValue)),i=i=>{l.value=i;const o=e.accordion?l.value[0]:l.value;t(s,o),t(a,o)},n=t=>{if(e.accordion)i([l.value[0]===t?"":t]);else{const e=[...l.value],a=e.indexOf(t);a>-1?e.splice(a,1):e.push(t),i(e)}};return T(()=>e.modelValue,()=>l.value=o(e.modelValue),{deep:!0}),B(_e,{activeNames:l,handleItemClick:async t=>{const{beforeCollapse:a}=e;if(!a)return void n(t);const s=a(t);[H(s),r(s)].includes(!0)||c("ElCollapse","beforeCollapse must return type `Promise<boolean>` or `boolean`"),H(s)?s.then(e=>{!1!==e&&n(t)}).catch(e=>{}):s&&n(t)}}),{activeNames:l,setActiveNames:i}})(i,l),{rootKls:p}=(e=>{const t=n("collapse");return{rootKls:z(()=>[t.b(),t.b(`icon-position-${e.expandIconPosition}`)])}})(i);return t({activeNames:d,setActiveNames:u}),(e,t)=>(R(),K("div",{class:L(U(p))},[A(e.$slots,"default")],2))}}),[["__file","collapse.vue"]]);const xe=t({title:{type:String,default:""},name:{type:l([String,Number]),default:void 0},icon:{type:p,default:u},disabled:Boolean}),ke=S({name:"ElCollapseItem"});var Fe=d(S({...ke,props:xe,setup(e,{expose:t}){const a=e,{focusing:s,id:l,isActive:i,handleFocus:o,handleHeaderClick:r,handleEnterClick:c}=(e=>{const t=N(_e),{namespace:a}=n("collapse"),s=$(!1),l=$(!1),i=f(),o=z(()=>i.current++),r=z(()=>{var t;return null!=(t=e.name)?t:`${a.value}-id-${i.prefix}-${U(o)}`}),c=z(()=>null==t?void 0:t.activeNames.value.includes(U(r)));return{focusing:s,id:o,isActive:c,handleFocus:()=>{setTimeout(()=>{l.value?l.value=!1:s.value=!0},50)},handleHeaderClick:a=>{if(e.disabled)return;const i=a.target;(null==i?void 0:i.closest("input, textarea, select"))||(null==t||t.handleItemClick(U(r)),s.value=!1,l.value=!0)},handleEnterClick:e=>{const a=e.target;(null==a?void 0:a.closest("input, textarea, select"))||(e.preventDefault(),null==t||t.handleItemClick(U(r)))}}})(a),{arrowKls:d,headKls:u,rootKls:p,itemTitleKls:y,itemWrapperKls:v,itemContentKls:h,scopedContentId:b,scopedHeadId:_}=((e,{focusing:t,isActive:a,id:s})=>{const l=n("collapse"),i=z(()=>[l.b("item"),l.is("active",U(a)),l.is("disabled",e.disabled)]),o=z(()=>[l.be("item","header"),l.is("active",U(a)),{focusing:U(t)&&!e.disabled}]),r=z(()=>[l.be("item","arrow"),l.is("active",U(a))]);return{itemTitleKls:z(()=>[l.be("item","title")]),arrowKls:r,headKls:o,rootKls:i,itemWrapperKls:z(()=>l.be("item","wrap")),itemContentKls:z(()=>l.be("item","content")),scopedContentId:z(()=>l.b(`content-${U(s)}`)),scopedHeadId:z(()=>l.b(`head-${U(s)}`))}})(a,{focusing:s,isActive:i,id:l});return t({isActive:i}),(e,t)=>(R(),K("div",{class:L(U(p))},[O("div",{id:U(_),class:L(U(u)),"aria-expanded":U(i),"aria-controls":U(b),"aria-describedby":U(b),tabindex:e.disabled?-1:0,role:"button",onClick:U(r),onKeydown:q(Q(U(c),["stop"]),["space","enter"]),onFocus:U(o),onBlur:e=>s.value=!1},[O("span",{class:L(U(y))},[A(e.$slots,"title",{isActive:U(i)},()=>[M(V(e.title),1)])],2),A(e.$slots,"icon",{isActive:U(i)},()=>[P(U(m),{class:L(U(d))},{default:Y(()=>[(R(),D(W(e.icon)))]),_:1},8,["class"])])],42,["id","aria-expanded","aria-controls","aria-describedby","tabindex","onClick","onKeydown","onFocus","onBlur"]),P(U(ue),null,{default:Y(()=>[G(O("div",{id:U(b),role:"region",class:L(U(v)),"aria-hidden":!U(i),"aria-labelledby":U(_)},[O("div",{class:L(U(h))},[A(e.$slots,"default")],2)],10,["id","aria-hidden","aria-labelledby"]),[[J,U(i)]])]),_:3})],2))}}),[["__file","collapse-item.vue"]]);const Ce=y(we,{CollapseItem:Fe}),Ie=v(Fe);function je(e={}){const{onFileLoaded:t,onFileCancelled:a,onSyncSuccess:s}=e,l=$(!1),i=$(null),o=$(!1),n=$(!1),r=z(()=>!!i.value),c=e=>({technicalFile:"æŠ€æœ¯éœ€æ±‚æ–‡ä»¶",tenderFile:"æ‹›æ ‡æ–‡æ¡£",templateFile:"åº”ç­”æ¨¡æ¿",businessResponseFile:"å•†åŠ¡åº”ç­”æ–‡ä»¶",p2pResponseFile:"ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶",techProposalFile:"æŠ€æœ¯æ–¹æ¡ˆæ–‡ä»¶"}[e]||"æ–‡ä»¶");return{useHitlFile:l,hitlFileInfo:i,hasHitlFile:r,syncing:o,synced:n,loadFromHITL:(e,a="technicalFile")=>{const s=e[a];return s?(i.value={filename:s.filename||s.name||"æœªçŸ¥æ–‡ä»¶",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},l.value=!0,n.value=!1,h.success({message:`å·²åŠ è½½HITL${c(a)}: ${i.value.filename}`,duration:3e3}),t&&t(i.value),!0):(h.warning(`å½“å‰é¡¹ç›®æ²¡æœ‰${c(a)}`),!1)},cancelHitlFile:()=>{l.value=!1,i.value=null,n.value=!1,h.info("å·²å–æ¶ˆä½¿ç”¨HITLæ–‡ä»¶"),a&&a()},syncToHitl:async(e,t,a)=>{if(!e)return h.error("é¡¹ç›®IDæ— æ•ˆ"),!1;if(!t)return h.error("æ–‡ä»¶è·¯å¾„æ— æ•ˆ"),!1;o.value=!0;try{const l=await fetch(`/api/tender-processing/sync-file/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,file_type:a})}),i=l.headers.get("content-type");if(!(null==i?void 0:i.includes("application/json"))){await l.text();throw new Error(`æœåŠ¡å™¨è¿”å›å¼‚å¸¸å“åº” (${l.status}): ${l.statusText}ã€‚å¯èƒ½æ˜¯åç«¯é…ç½®é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚`)}const o=await l.json();if(o.success||l.ok)return n.value=!0,h.success({message:o.message||"å·²æˆåŠŸåŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›®",duration:3e3}),s&&await s(),!0;throw new Error(o.error||o.message||"åŒæ­¥å¤±è´¥")}catch(l){let e="åŒæ­¥åˆ°é¡¹ç›®å¤±è´¥";return l.message?e=l.message:"TypeError"===l.name&&(e="ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"),h.error({message:e,duration:5e3}),!1}finally{o.value=!1}},resetSyncStatus:()=>{n.value=!1}}}function Ee(e,t="YYYY-MM-DD"){return e?X(e).format(t):""}function $e(e,t=2){if(null==e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,a)).toFixed(t)} ${["B","KB","MB","GB","TB","PB"][a]}`}const Te={class:"stats-card"},ze={key:0,class:"stats-title"},Be={class:"stat-item"},He={class:"stat-prefix"},Se={class:"stat-suffix"},Ke=b(S({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,a=[{key:"total_replacements",label:"æ–‡æœ¬æ›¿æ¢",suffix:"å¤„"},{key:"tables_processed",label:"è¡¨æ ¼å¤„ç†",suffix:"ä¸ª"},{key:"cells_filled",label:"å•å…ƒæ ¼å¡«å……",suffix:"ä¸ª"},{key:"images_inserted",label:"å›¾ç‰‡æ’å…¥",suffix:"å¼ "}],s=z(()=>t.statItems||a),l=e=>{const a=e.split(".");let s=t.stats;for(const t of a)if(s=null==s?void 0:s[t],null==s)break;return"number"==typeof s?s:0};return(t,a)=>{const i=oe,o=ie,n=le;return R(),K("div",Te,[e.title?(R(),K("h4",ze,V(e.title),1)):Z("",!0),P(n,{gutter:e.gutter},{default:Y(()=>[(R(!0),K(ee,null,te(s.value,t=>(R(),D(o,{key:t.key,span:e.span},{default:Y(()=>[O("div",Be,[P(i,{title:t.label,value:l(t.key),precision:t.precision,"value-style":e.valueStyle},ae({_:2},[t.prefix?{name:"prefix",fn:Y(()=>[O("span",He,V(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:Y(()=>[O("span",Se,V(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),Re={class:"alert-content"},Ae={class:"file-info"},Le={class:"file-details"},Ue={class:"file-label"},Ne={class:"file-name"},Oe={key:0,class:"file-size"},Pe={class:"alert-actions"},Me=b(S({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"ä½¿ç”¨HITLæ–‡ä»¶:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"å–æ¶ˆä½¿ç”¨"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:t}){const a=t,s=()=>{a("cancel")};return(t,a)=>{const l=m,i=se,o=w,n=g;return e.fileInfo?(R(),D(n,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:Y(()=>[O("div",Re,[O("div",Ae,[P(l,{class:"file-icon"},{default:Y(()=>[P(U(_))]),_:1}),O("div",Le,[O("span",Ue,V(e.label),1),O("span",Ne,V(e.fileInfo.filename),1),e.fileInfo.file_size?(R(),K("span",Oe," ("+V(U($e)(e.fileInfo.file_size))+") ",1)):Z("",!0),e.showTag?(R(),D(i,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:Y(()=>[...a[0]||(a[0]=[M(" å·²ä»æŠ•æ ‡é¡¹ç›®åŠ è½½ ",-1)])]),_:1})):Z("",!0)])]),O("div",Pe,[A(t.$slots,"actions",{},()=>[e.showCancel?(R(),D(o,{key:0,type:"text",size:"small",onClick:s},{default:Y(()=>[P(l,null,{default:Y(()=>[P(U(x))]),_:1}),M(" "+V(e.cancelText),1)]),_:1})):Z("",!0)],!0)])])]),_:3},8,["type"])):Z("",!0)}}}),[["__scopeId","data-v-1a132715"]]),Ve={class:"history-files-panel"},Ye={class:"card-header"},De={class:"header-title"},We={class:"current-file-content"},qe={class:"history-actions"},Qe={class:"collapse-header"},Ge={class:"filename-cell"},Je=b(S({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"è¯¥é¡¹ç›®å·²æœ‰ç”Ÿæˆæ–‡ä»¶"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const t=$([]),a=e=>{if(!e)return"-";let t=e;try{t=decodeURIComponent(e)}catch{}const a=t.split("/");return a[a.length-1]||"-"};return(s,l)=>{const i=se,o=g,n=ce,r=de,c=re,d=m,u=w,p=ne,f=fe,y=pe,v=ye,h=Ie,b=Ce,x=me;return R(),K("div",Ve,[e.currentFile?(R(),D(p,{key:0,shadow:"never",class:"current-file-card"},{header:Y(()=>[O("div",Ye,[O("div",De,[O("span",null,V(e.title||"ğŸ“„ è¯¥é¡¹ç›®çš„ç”Ÿæˆæ–‡ä»¶"),1),P(i,{type:"info"},{default:Y(()=>[...l[6]||(l[6]=[M("å†å²æ–‡ä»¶",-1)])]),_:1})])])]),default:Y(()=>[O("div",We,[P(o,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(R(),D(Ke,{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):Z("",!0),P(c,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:Y(()=>[P(n,{label:"æ–‡ä»¶å"},{default:Y(()=>[M(V(a(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),P(n,{label:"ä¸‹è½½åœ°å€"},{default:Y(()=>[P(r,{href:e.currentFile.downloadUrl,type:"primary"},{default:Y(()=>[M(V(a(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),O("div",qe,[e.showEditorOpen?(R(),D(u,{key:0,type:"primary",size:"large",onClick:l[0]||(l[0]=t=>s.$emit("openInEditor",e.currentFile))},{default:Y(()=>[P(d,null,{default:Y(()=>[P(U(k))]),_:1}),l[7]||(l[7]=M(" åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ",-1))]),_:1})):Z("",!0),P(u,{type:"primary",size:"large",icon:U(F),onClick:l[1]||(l[1]=t=>s.$emit("preview",e.currentFile))},{default:Y(()=>[...l[8]||(l[8]=[M(" é¢„è§ˆWord ",-1)])]),_:1},8,["icon"]),P(u,{type:"success",size:"large",icon:U(C),onClick:l[2]||(l[2]=t=>s.$emit("download",e.currentFile))},{default:Y(()=>[...l[9]||(l[9]=[M(" ä¸‹è½½ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(R(),D(u,{key:1,size:"large",icon:U(I),onClick:l[3]||(l[3]=e=>s.$emit("regenerate"))},{default:Y(()=>[...l[10]||(l[10]=[M(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])):Z("",!0)])])]),_:1})):Z("",!0),e.historyFiles.length>0?(R(),D(b,{key:1,modelValue:t.value,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value=e),class:"history-collapse"},{default:Y(()=>[P(h,{name:"history"},{title:Y(()=>[O("div",Qe,[O("span",null,"ğŸ“‚ æŸ¥çœ‹æ‰€æœ‰å†å²å¤„ç†æ–‡ä»¶ ("+V(e.historyFiles.length)+")",1),t.value.includes("history")?(R(),D(u,{key:0,type:"primary",size:"small",loading:e.loading,onClick:l[4]||(l[4]=Q(e=>s.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:Y(()=>[...l[11]||(l[11]=[M(" åˆ·æ–°åˆ—è¡¨ ",-1)])]),_:1},8,["loading"])):Z("",!0)])]),default:Y(()=>[P(p,{shadow:"never",style:{border:"none"}},{default:Y(()=>[G((R(),D(y,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:Y(()=>[P(f,{type:"index",label:"åºå·",width:"60"}),P(f,{prop:"filename",label:"æ–‡ä»¶å","min-width":"300"},{default:Y(({row:e})=>[O("div",Ge,[P(d,null,{default:Y(()=>[P(U(_))]),_:1}),O("span",null,V(e.filename),1)])]),_:1}),P(f,{prop:"size",label:"æ–‡ä»¶å¤§å°",width:"120"},{default:Y(({row:e})=>[M(V(U($e)(e.size)),1)]),_:1}),P(f,{prop:"process_time",label:"å¤„ç†æ—¶é—´",width:"180"},{default:Y(({row:e})=>[M(V(U(Ee)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),P(f,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:Y(({row:e})=>[P(u,{type:"primary",size:"small",onClick:t=>s.$emit("preview",e)},{default:Y(()=>[...l[12]||(l[12]=[M(" é¢„è§ˆ ",-1)])]),_:1},8,["onClick"]),P(u,{type:"success",size:"small",onClick:t=>s.$emit("download",e)},{default:Y(()=>[...l[13]||(l[13]=[M(" ä¸‹è½½ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,e.loading]]),e.loading||0!==e.historyFiles.length?Z("",!0):(R(),D(v,{key:0,description:"æš‚æ— å†å²æ–‡ä»¶","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):Z("",!0)])}}}),[["__scopeId","data-v-6814751e"]]);async function Xe(e,t){if("string"!=typeof e){const a=URL.createObjectURL(e),s=document.createElement("a");return s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),void URL.revokeObjectURL(a)}try{const a=await fetch(e);if(!a.ok){const e=a.headers.get("content-type");if(e&&e.includes("application/json")){const e=await a.json();throw new Error(e.error||e.message||"æ–‡ä»¶ä¸‹è½½å¤±è´¥")}throw new Error(`æ–‡ä»¶ä¸‹è½½å¤±è´¥: HTTP ${a.status}`)}const s=a.headers.get("content-type");if(s&&(s.includes("text/html")||s.includes("application/json")))throw new Error("æœåŠ¡å™¨è¿”å›äº†é”™è¯¯é¡µé¢ï¼Œè€Œä¸æ˜¯æ–‡ä»¶");const l=await a.blob(),i=URL.createObjectURL(l),o=document.createElement("a");o.href=i,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(a){throw a}}export{Ie as E,Me as H,Ke as S,Ce as a,Je as b,Xe as d,je as u};
