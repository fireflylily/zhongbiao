import{M as e,e as a,al as t,am as l,d as o,ae as r,P as i,N as s,O as d,h as c,G as n,q as u}from"./index.js";import{E as m}from"./el-input-number-2mbv5o4I.js";/* empty css                                                                          *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                */import{am as p,an as _,ao as y,aX as g,au as v,ar as f,aw as h,ax as j,as as w,ay as x,aC as V,aq as b,az as k,aA as C,aD as E,aV as U}from"./editor-CkQC1Uq_.js";import{L as $}from"./Loading-BVHBNKFx.js";import{E as T}from"./Empty-D5VnJphi.js";/* empty css                */import{C as z}from"./Card-DjWxEjgq.js";/* empty css                                                        *//* empty css                   *//* empty css                */import{E as P}from"./index-CPjPqG6g.js";import{a as O,E as q}from"./index-MMbAUZZE.js";import{E as B,a as D}from"./index-Ct_FIOsr.js";import{E as L}from"./index-Jdk3-L3D.js";import"./index-B_fegSBy.js";import"./index-DzllSHb7.js";import"./index-DE7eCqN4.js";import"./index-DO7-lxyV.js";import"./flatMap-D7uPVDtS.js";import"./map-B_SlaKiF.js";import"./_baseIteratee-CwtmDzoV.js";import"./_baseEach-V8knk74i.js";import"./index-C1LY3n9p.js";import"./toNumber-B_atpBHU.js";import"./index-lVhqCxeU.js";import"./raf-BZHcGSIv.js";const N={class:"product-categories"},S={class:"stats-bar"},F={class:"stat-content"},R={class:"stat-icon"},A={class:"stat-info"},G={class:"stat-value"},H={class:"stat-content"},I={class:"stat-icon"},J={class:"stat-info"},M={class:"stat-value"},Q={key:2,class:"categories-list"},X={class:"category-header"},K={class:"category-info"},W={class:"category-name"},Y={class:"items-container"},Z="/api",ee=u(p({__name:"ProductCategories",setup(u){const{success:p,error:ee}=e(),ae=_(!1),te=_(!1),le=_([]),oe=_([]),re=_(!1),ie=_("create"),se=_({category_id:null,category_name:"",category_code:"",category_description:"",category_order:999}),de=_(),ce={category_name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],category_code:[{required:!0,message:"请输入分类代码",trigger:"blur"}]},ne=_(!1),ue=_("create"),me=_(null),pe=_({item_id:null,item_name:"",item_code:"",item_description:"",item_order:999}),_e=_(),ye={item_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},ge=y(()=>le.value.reduce((e,a)=>e+a.items.length,0)),ve=async()=>{ae.value=!0;try{const e=await fetch(`${Z}/product-categories`),a=await e.json();a.success?le.value=a.data||[]:ee("加载失败",a.error||"未知错误")}catch(e){ee("加载失败",e instanceof Error?e.message:"未知错误")}finally{ae.value=!1}},fe=()=>{ie.value="create",se.value={category_id:null,category_name:"",category_code:"",category_description:"",category_order:999},re.value=!0},he=async()=>{de.value&&await de.value.validate(async e=>{if(e){te.value=!0;try{const e="edit"===ie.value,a=e?`${Z}/product-categories/${se.value.category_id}`:`${Z}/product-categories`,t=await fetch(a,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(se.value)}),l=await t.json();l.success?(p(e?"更新成功":"创建成功",l.message),re.value=!1,await ve()):ee(e?"更新失败":"创建失败",l.error||"未知错误")}catch(a){ee("保存失败",a instanceof Error?a.message:"未知错误")}finally{te.value=!1}}})},je=async()=>{_e.value&&me.value&&await _e.value.validate(async e=>{if(e){te.value=!0;try{const e="edit"===ue.value,a=e?`${Z}/product-category-items/${pe.value.item_id}`:`${Z}/product-categories/${me.value.category_id}/items`,t=await fetch(a,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pe.value)}),l=await t.json();l.success?(p(e?"更新成功":"创建成功",l.message),ne.value=!1,await ve()):ee(e?"更新失败":"创建失败",l.error||"未知错误")}catch(a){ee("保存失败",a instanceof Error?a.message:"未知错误")}finally{te.value=!1}}})};return g(()=>{ve()}),(e,u)=>{const _=a,y=P,g=o,we=L,xe=D,Ve=B,be=q,ke=O,Ce=d,Ee=s,Ue=m,$e=i,Te=c;return f(),v("div",N,[h("div",S,[j(y,{class:"stat-card"},{default:w(()=>[h("div",F,[h("div",R,[j(_,{size:32,color:"#409eff"},{default:w(()=>[j(x(t))]),_:1})]),h("div",A,[u[14]||(u[14]=h("div",{class:"stat-label"},"产品分类",-1)),h("div",G,V(le.value.length),1)])])]),_:1}),j(y,{class:"stat-card"},{default:w(()=>[h("div",H,[h("div",I,[j(_,{size:32,color:"#67c23a"},{default:w(()=>[j(x(l))]),_:1})]),h("div",J,[u[15]||(u[15]=h("div",{class:"stat-label"},"总项目数",-1)),h("div",M,V(ge.value),1)])])]),_:1})]),j(x(z),{title:"产品分类管理"},{extra:w(()=>[j(g,{type:"primary",onClick:fe},{default:w(()=>[j(_,null,{default:w(()=>[j(x(r))]),_:1}),u[16]||(u[16]=E(" 新建分类 ",-1))]),_:1})]),default:w(()=>[ae.value?(f(),b(x($),{key:0,text:"加载中..."})):le.value.length?(f(),v("div",Q,[j(ke,{modelValue:oe.value,"onUpdate:modelValue":u[1]||(u[1]=e=>oe.value=e),accordion:""},{default:w(()=>[(f(!0),v(k,null,C(le.value,e=>(f(),b(be,{key:e.category_id,name:e.category_id},{title:w(()=>[h("div",X,[h("div",K,[h("span",W,V(e.category_name),1),j(we,{size:"small",type:"info",class:"category-tag"},{default:w(()=>[E(V(e.items.length)+" 项 ",1)]),_:2},1024)]),h("div",{class:"category-actions",onClick:u[0]||(u[0]=U(()=>{},["stop"]))},[j(g,{text:"",type:"primary",size:"small",onClick:a=>(e=>{me.value=e,ue.value="create",pe.value={item_id:null,item_name:"",item_code:"",item_description:"",item_order:999},ne.value=!0})(e)},{default:w(()=>[j(_,null,{default:w(()=>[j(x(r))]),_:1}),u[17]||(u[17]=E(" 添加项 ",-1))]),_:1},8,["onClick"]),j(g,{text:"",type:"warning",size:"small",onClick:a=>(e=>{ie.value="edit",se.value={category_id:e.category_id,category_name:e.category_name,category_code:e.category_code,category_description:e.category_description||"",category_order:e.category_order||999},re.value=!0})(e)},{default:w(()=>[...u[18]||(u[18]=[E(" 编辑 ",-1)])]),_:1},8,["onClick"]),j(g,{text:"",type:"danger",size:"small",onClick:a=>(async e=>{try{await n.confirm(`确定要删除分类 "${e.category_name}" 吗？此操作将同时删除该分类下的所有项目。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const a=await fetch(`${Z}/product-categories/${e.category_id}`,{method:"DELETE"}),t=await a.json();t.success?(p("删除成功",t.message),await ve()):ee("删除失败",t.error||"未知错误")}catch(a){ee("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:w(()=>[...u[19]||(u[19]=[E(" 删除 ",-1)])]),_:1},8,["onClick"])])])]),default:w(()=>[h("div",Y,[j(Ve,{data:e.items,stripe:""},{default:w(()=>[j(xe,{prop:"item_name",label:"项目名称",width:"200"}),j(xe,{prop:"item_code",label:"代码",width:"180"}),j(xe,{prop:"item_description",label:"描述","show-overflow-tooltip":""}),j(xe,{prop:"item_order",label:"排序",width:"80",align:"center"}),j(xe,{label:"操作",width:"180",fixed:"right"},{default:w(({row:a})=>[j(g,{text:"",type:"warning",size:"small",onClick:t=>((e,a)=>{me.value=e,ue.value="edit",pe.value={item_id:a.item_id,item_name:a.item_name,item_code:a.item_code||"",item_description:a.item_description||"",item_order:a.item_order||999},ne.value=!0})(e,a)},{default:w(()=>[...u[20]||(u[20]=[E(" 编辑 ",-1)])]),_:1},8,["onClick"]),j(g,{text:"",type:"danger",size:"small",onClick:e=>(async(e,a)=>{try{await n.confirm(`确定要删除项目 "${a.item_name}" 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const e=await fetch(`${Z}/product-category-items/${a.item_id}`,{method:"DELETE"}),t=await e.json();t.success?(p("删除成功",t.message),await ve()):ee("删除失败",t.error||"未知错误")}catch(t){ee("删除失败",t instanceof Error?t.message:"未知错误")}})(0,a)},{default:w(()=>[...u[21]||(u[21]=[E(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])):(f(),b(x(T),{key:1,type:"no-data",description:"暂无产品分类"}))]),_:1}),j(Te,{modelValue:re.value,"onUpdate:modelValue":u[7]||(u[7]=e=>re.value=e),title:"create"===ie.value?"新建分类":"编辑分类",width:"500px"},{footer:w(()=>[j(g,{onClick:u[6]||(u[6]=e=>re.value=!1)},{default:w(()=>[...u[22]||(u[22]=[E("取消",-1)])]),_:1}),j(g,{type:"primary",onClick:he,loading:te.value},{default:w(()=>[...u[23]||(u[23]=[E(" 保存 ",-1)])]),_:1},8,["loading"])]),default:w(()=>[j($e,{model:se.value,rules:ce,ref_key:"categoryFormRef",ref:de,"label-width":"100px"},{default:w(()=>[j(Ee,{label:"分类名称",prop:"category_name"},{default:w(()=>[j(Ce,{modelValue:se.value.category_name,"onUpdate:modelValue":u[2]||(u[2]=e=>se.value.category_name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),j(Ee,{label:"分类代码",prop:"category_code"},{default:w(()=>[j(Ce,{modelValue:se.value.category_code,"onUpdate:modelValue":u[3]||(u[3]=e=>se.value.category_code=e),placeholder:"请输入分类代码（英文）",disabled:"edit"===ie.value},null,8,["modelValue","disabled"])]),_:1}),j(Ee,{label:"分类描述",prop:"category_description"},{default:w(()=>[j(Ce,{modelValue:se.value.category_description,"onUpdate:modelValue":u[4]||(u[4]=e=>se.value.category_description=e),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),j(Ee,{label:"排序",prop:"category_order"},{default:w(()=>[j(Ue,{modelValue:se.value.category_order,"onUpdate:modelValue":u[5]||(u[5]=e=>se.value.category_order=e),min:1,max:999},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),j(Te,{modelValue:ne.value,"onUpdate:modelValue":u[13]||(u[13]=e=>ne.value=e),title:"create"===ue.value?"新建项目":"编辑项目",width:"500px"},{footer:w(()=>[j(g,{onClick:u[12]||(u[12]=e=>ne.value=!1)},{default:w(()=>[...u[24]||(u[24]=[E("取消",-1)])]),_:1}),j(g,{type:"primary",onClick:je,loading:te.value},{default:w(()=>[...u[25]||(u[25]=[E(" 保存 ",-1)])]),_:1},8,["loading"])]),default:w(()=>[j($e,{model:pe.value,rules:ye,ref_key:"itemFormRef",ref:_e,"label-width":"100px"},{default:w(()=>[j(Ee,{label:"项目名称",prop:"item_name"},{default:w(()=>[j(Ce,{modelValue:pe.value.item_name,"onUpdate:modelValue":u[8]||(u[8]=e=>pe.value.item_name=e),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),j(Ee,{label:"项目代码",prop:"item_code"},{default:w(()=>[j(Ce,{modelValue:pe.value.item_code,"onUpdate:modelValue":u[9]||(u[9]=e=>pe.value.item_code=e),placeholder:"请输入项目代码（英文）"},null,8,["modelValue"])]),_:1}),j(Ee,{label:"项目描述",prop:"item_description"},{default:w(()=>[j(Ce,{modelValue:pe.value.item_description,"onUpdate:modelValue":u[10]||(u[10]=e=>pe.value.item_description=e),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),j(Ee,{label:"排序",prop:"item_order"},{default:w(()=>[j(Ue,{modelValue:pe.value.item_order,"onUpdate:modelValue":u[11]||(u[11]=e=>pe.value.item_order=e),min:1,max:999},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-ae3f2d74"]]);export{ee as default};
