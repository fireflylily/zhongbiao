import{R as C,k as m,D as R,F as w,a4 as F,a5 as I,a6 as q,a7 as L,a as N,a0 as K,a8 as P}from"./element-plus-IkZgpaz4.js";import{s as H}from"./imageCompressor-D9CndpqW.js";import{bT as M,bt as W,bu as X,bU as h,bV as n,c8 as r,bX as Y,c0 as d,bW as _,bY as x,b$ as y,c3 as f,bv as p,c6 as b,c5 as k}from"./vendor-CdA3MjAt.js";/* empty css                                                                          */import{_ as j}from"./index.js";const A={class:"document-uploader"},G={key:1,class:"upload-drag-area"},J={key:0,class:"upload-hint"},O={key:0,class:"upload-tip"},Q={class:"upload-file-item"},Z={class:"file-name"},ee=M({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(a,{expose:B,emit:$}){const l=a,u=$,g=W(),V=X({get:()=>l.modelValue||[],set:e=>u("update:modelValue",e)}),D=async e=>{var t;if(l.maxSize&&e.size/1024/1024>l.maxSize)return m.error(`文件大小不能超过 ${l.maxSize}MB`),!1;if(l.accept){const s=l.accept.split(",").map(c=>c.trim()),o="."+((t=e.name.split(".").pop())==null?void 0:t.toLowerCase());if(!s.some(c=>o===c.toLowerCase()))return m.error(`不支持的文件格式：${o}`),!1}if(l.autoCompressImage&&e.type.startsWith("image/"))try{console.log(`[DocumentUploader] 检测到图片文件，开始压缩: ${e.name}, ${(e.size/1024).toFixed(0)}KB`);const s=await H(e,l.imageType),o=e.size,c=s.size,v=((o-c)/o*100).toFixed(1);if(c<o)return console.log(`[DocumentUploader] ✅ 图片已压缩: ${(o/1024).toFixed(0)}KB → ${(c/1024).toFixed(0)}KB (节省${v}%)`),s;console.log("[DocumentUploader] 图片无需压缩，使用原文件")}catch(s){console.error("[DocumentUploader] 图片压缩失败:",s),m.warning("图片压缩失败，将上传原文件")}return!0},U=(e,t,s)=>{},z=(e,t,s)=>{u("success",t,s),u("update:modelValue",s)},T=(e,t,s)=>{m.error("文件上传失败："+e.message),u("error",e,t,s)},E=(e,t)=>{m.warning(`最多只能上传 ${l.limit} 个文件`),u("exceed",e,t)},S=(e,t)=>{u("remove",e,t),u("update:modelValue",t)};return B({clearFiles:()=>{var e;(e=g.value)==null||e.clearFiles(),u("update:modelValue",[])},submit:()=>{var e;(e=g.value)==null||e.submit()},abort:e=>{var t;(t=g.value)==null||t.abort(e)}}),(e,t)=>{const s=N,o=R,c=F,v=C;return n(),h("div",A,[r(v,Y({ref_key:"uploadRef",ref:g,action:a.uploadUrl,"http-request":a.httpRequest,headers:a.uploadHeaders,data:a.uploadData,accept:a.accept,limit:a.limit,multiple:a.multiple,drag:a.drag,"show-file-list":a.showFileList,"before-upload":D,"on-progress":U,"on-success":z,"on-error":T,"on-exceed":E,"on-remove":S,"file-list":V.value},e.$attrs),{default:d(()=>[_(e.$slots,"trigger",{},()=>[a.drag?(n(),h("div",G,[r(o,{class:"upload-icon"},{default:d(()=>[r(p(P))]),_:1}),t[0]||(t[0]=x("div",{class:"upload-text"},[k(" 将文件拖到此处，或"),x("em",null,"点击上传")],-1)),a.accept?(n(),h("div",J," 支持的文件格式："+b(a.accept),1)):f("",!0)])):(n(),y(s,{key:0,type:"primary",icon:p(K)},{default:d(()=>[k(b(a.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:d(()=>[_(e.$slots,"tip",{},()=>[a.tipText?(n(),h("div",O,[r(o,null,{default:d(()=>[r(p(L))]),_:1}),k(" "+b(a.tipText),1)])):f("",!0)],!0)]),file:d(({file:i})=>[_(e.$slots,"file",{file:i},()=>[x("div",Q,[r(o,{class:"file-icon"},{default:d(()=>[r(p(w))]),_:1}),x("span",Z,b(i.name),1),i.status==="uploading"?(n(),y(c,{key:0,percentage:i.percentage,"stroke-width":2},null,8,["percentage"])):f("",!0),i.status==="success"?(n(),y(o,{key:1,class:"status-icon success"},{default:d(()=>[r(p(I))]),_:1})):f("",!0),i.status==="fail"?(n(),y(o,{key:2,class:"status-icon error"},{default:d(()=>[r(p(q))]),_:1})):f("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),ue=j(ee,[["__scopeId","data-v-7c33a36b"]]);export{ue as D};
