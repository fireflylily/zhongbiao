import{M as e,P as a,N as l,O as t,d as i,e as n,aT as o,q as s,aQ as u,s as r,F as d,aP as c,y as p,am as m,i as _,ab as f,h as v,bI as y,G as g,bX as h,ag as k,bY as b,R as w,aS as x,aU as V,K as z,ad as q,a8 as C,bE as j,bZ as I}from"./index.js";/* empty css                */import{a as U,E}from"./el-tab-pane-BkbgISyh.js";/* empty css               */import{L as D}from"./Loading-BeReBNvy.js";/* empty css                                                                            *//* empty css                                                        *//* empty css                */import{am as $,ao as T,an as M,ap as B,au as P,ar as F,ax as S,ay as N,as as R,aD as O,aC as Q,aq as L,aw as A,av as G,aT as Y,az as J,aA as W,aB as K,aW as X}from"./editor-TazJhAAN.js";/* empty css                             *//* empty css                   *//* empty css                     *//* empty css                    *//* empty css                */import{c as Z}from"./company-CHa0NuIL.js";import{C as H}from"./CompanyInfoExtractorDialog-CXw7XUuk.js";import{E as ee}from"./el-input-number-CAtnpcDf.js";import{E as ae,a as le}from"./el-select-OYnihe3P.js";import{E as te}from"./el-date-picker-panel-De6Fsy_B.js";import{C as ie}from"./Card-Cv-82T4J.js";import{E as ne,a as oe}from"./index-BDJETU77.js";import{E as se}from"./el-text-CWjtNXXZ.js";import{D as ue}from"./DocumentUploader-CsPmZp_4.js";import{E as re}from"./strings-X7bymAdO.js";import{E as de}from"./index-ByYpZ62U.js";import{E as ce}from"./index-IM9EhOrM.js";import{a as pe,E as me}from"./index-CEGNKDhc.js";import{E as _e}from"./index-BIDBuuPD.js";import"./raf-BZHcGSIv.js";import"./clamp-CoUBliBS.js";import"./toNumber-C9XTs0cM.js";import"./index-U-yLLGnn.js";import"./cloneDeep-syPWYH98.js";import"./index-ChK61zXh.js";import"./index-DYIGgvz_.js";import"./index-EpWc9ZRp.js";import"./_baseIteratee-DK-XCWub.js";import"./advancedFormat-B_RJiIbm.js";import"./imageCompressor-CTkRt5bg.js";import"./flatMap-B556EPsX.js";import"./map-DlvCx75E.js";import"./_baseEach-uBBvXMMp.js";const fe={class:"basic-info-tab"},ve=s($({__name:"BasicInfoTab",props:{companyId:{},companyData:{},isNewMode:{type:Boolean}},emits:["update","created"],setup(s,{emit:u}){const r=s,d=u,{success:c,error:p}=e(),m=T(()=>r.isNewMode||!1),_=M(),f=M(!1),v=M({company_name:"",establish_date:"",legal_representative:"",legal_representative_position:"",legal_representative_gender:"",legal_representative_age:void 0,social_credit_code:"",registered_capital:"",company_type:"",registered_address:"",fixed_phone:"",fax:"",postal_code:"",email:"",business_scope:"",description:""}),y={company_name:[{required:!0,message:"请输入企业名称",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],postal_code:[{pattern:/^\d{6}$/,message:"邮政编码必须是6位数字",trigger:"blur"}]};B(()=>r.companyData,e=>{e&&(v.value={company_name:e.company_name||"",establish_date:e.establish_date||"",legal_representative:e.legal_representative||"",legal_representative_position:e.legal_representative_position||"",legal_representative_gender:e.legal_representative_gender||"",legal_representative_age:e.legal_representative_age||void 0,social_credit_code:e.social_credit_code||"",registered_capital:e.registered_capital||"",company_type:e.company_type||"",registered_address:e.registered_address||"",fixed_phone:e.fixed_phone||"",fax:e.fax||"",postal_code:e.postal_code||"",email:e.email||"",business_scope:e.business_scope||"",description:e.description||""})},{immediate:!0,deep:!0});const g=async()=>{_.value&&await _.value.validate(async e=>{if(e){f.value=!0;try{if(m.value){const e=await Z.createCompany({companyName:v.value.company_name,registeredAddress:v.value.registered_address,fixedPhone:v.value.fixed_phone,email:v.value.email,companyDescription:v.value.description});e.success&&e.data&&(c("创建成功","企业创建成功"),d("created",e.data.company_id))}else{(await Z.updateCompany(r.companyId,{companyName:v.value.company_name,establishDate:v.value.establish_date,legalRepresentative:v.value.legal_representative,legalRepresentativePosition:v.value.legal_representative_position,legalRepresentativeGender:v.value.legal_representative_gender,legalRepresentativeAge:v.value.legal_representative_age,socialCreditCode:v.value.social_credit_code,registeredCapital:v.value.registered_capital,companyType:v.value.company_type,registeredAddress:v.value.registered_address,fixedPhone:v.value.fixed_phone,fax:v.value.fax,postalCode:v.value.postal_code,email:v.value.email,businessScope:v.value.business_scope,companyDescription:v.value.description})).success&&(c("保存成功","基础信息已更新"),d("update"))}}catch(a){p(m.value?"创建失败":"保存失败",a instanceof Error?a.message:"未知错误")}finally{f.value=!1}}})};return(e,s)=>{const u=t,r=l,d=oe,c=te,p=ne,h=le,k=ae,b=ee,w=n,x=i,V=a;return F(),P("div",fe,[S(N(ie),{title:"基础信息"},{default:R(()=>[S(V,{ref_key:"formRef",ref:_,model:v.value,rules:y,"label-width":"140px",class:"basic-form"},{default:R(()=>[S(p,{gutter:20},{default:R(()=>[S(d,{span:12},{default:R(()=>[S(r,{label:"企业名称",prop:"company_name"},{default:R(()=>[S(u,{modelValue:v.value.company_name,"onUpdate:modelValue":s[0]||(s[0]=e=>v.value.company_name=e),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1})]),_:1}),S(d,{span:12},{default:R(()=>[S(r,{label:"成立日期",prop:"establish_date"},{default:R(()=>[S(c,{modelValue:v.value.establish_date,"onUpdate:modelValue":s[1]||(s[1]=e=>v.value.establish_date=e),type:"date",placeholder:"选择日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,{gutter:20},{default:R(()=>[S(d,{span:12},{default:R(()=>[S(r,{label:"法定代表人",prop:"legal_representative"},{default:R(()=>[S(u,{modelValue:v.value.legal_representative,"onUpdate:modelValue":s[2]||(s[2]=e=>v.value.legal_representative=e),placeholder:"请输入法定代表人"},null,8,["modelValue"])]),_:1})]),_:1}),S(d,{span:12},{default:R(()=>[S(r,{label:"法定代表人职务",prop:"legal_representative_position"},{default:R(()=>[S(u,{modelValue:v.value.legal_representative_position,"onUpdate:modelValue":s[3]||(s[3]=e=>v.value.legal_representative_position=e),placeholder:"请输入职务"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,{gutter:20},{default:R(()=>[S(d,{span:12},{default:R(()=>[S(r,{label:"法定代表人性别",prop:"legal_representative_gender"},{default:R(()=>[S(k,{modelValue:v.value.legal_representative_gender,"onUpdate:modelValue":s[4]||(s[4]=e=>v.value.legal_representative_gender=e),placeholder:"请选择性别",style:{width:"100%"}},{default:R(()=>[S(h,{label:"男",value:"男"}),S(h,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),S(d,{span:12},{default:R(()=>[S(r,{label:"法定代表人年龄",prop:"legal_representative_age"},{default:R(()=>[S(b,{modelValue:v.value.legal_representative_age,"onUpdate:modelValue":s[5]||(s[5]=e=>v.value.legal_representative_age=e),min:18,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,{gutter:20},{default:R(()=>[S(d,{span:12},{default:R(()=>[S(r,{label:"统一社会信用代码",prop:"social_credit_code"},{default:R(()=>[S(u,{modelValue:v.value.social_credit_code,"onUpdate:modelValue":s[6]||(s[6]=e=>v.value.social_credit_code=e),placeholder:"请输入统一社会信用代码"},null,8,["modelValue"])]),_:1})]),_:1}),S(d,{span:12},{default:R(()=>[S(r,{label:"注册资本",prop:"registered_capital"},{default:R(()=>[S(u,{modelValue:v.value.registered_capital,"onUpdate:modelValue":s[7]||(s[7]=e=>v.value.registered_capital=e),placeholder:"如：1000万元"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,{gutter:20},{default:R(()=>[S(d,{span:12},{default:R(()=>[S(r,{label:"企业类型",prop:"company_type"},{default:R(()=>[S(u,{modelValue:v.value.company_type,"onUpdate:modelValue":s[8]||(s[8]=e=>v.value.company_type=e),placeholder:"如：有限责任公司"},null,8,["modelValue"])]),_:1})]),_:1}),S(d,{span:12},{default:R(()=>[S(r,{label:"注册地址",prop:"registered_address"},{default:R(()=>[S(u,{modelValue:v.value.registered_address,"onUpdate:modelValue":s[9]||(s[9]=e=>v.value.registered_address=e),placeholder:"请输入注册地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,{gutter:20},{default:R(()=>[S(d,{span:12},{default:R(()=>[S(r,{label:"联系电话",prop:"fixed_phone"},{default:R(()=>[S(u,{modelValue:v.value.fixed_phone,"onUpdate:modelValue":s[10]||(s[10]=e=>v.value.fixed_phone=e),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),S(d,{span:12},{default:R(()=>[S(r,{label:"传真",prop:"fax"},{default:R(()=>[S(u,{modelValue:v.value.fax,"onUpdate:modelValue":s[11]||(s[11]=e=>v.value.fax=e),placeholder:"请输入传真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,{gutter:20},{default:R(()=>[S(d,{span:12},{default:R(()=>[S(r,{label:"邮政编码",prop:"postal_code"},{default:R(()=>[S(u,{modelValue:v.value.postal_code,"onUpdate:modelValue":s[12]||(s[12]=e=>v.value.postal_code=e),placeholder:"请输入邮政编码",maxlength:"6"},null,8,["modelValue"])]),_:1})]),_:1}),S(d,{span:12},{default:R(()=>[S(r,{label:"电子邮箱",prop:"email"},{default:R(()=>[S(u,{modelValue:v.value.email,"onUpdate:modelValue":s[13]||(s[13]=e=>v.value.email=e),placeholder:"请输入电子邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,null,{default:R(()=>[S(d,{span:24},{default:R(()=>[S(r,{label:"经营范围",prop:"business_scope"},{default:R(()=>[S(u,{modelValue:v.value.business_scope,"onUpdate:modelValue":s[14]||(s[14]=e=>v.value.business_scope=e),type:"textarea",rows:5,placeholder:"请输入经营范围"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,null,{default:R(()=>[S(d,{span:24},{default:R(()=>[S(r,{label:"企业简介",prop:"description"},{default:R(()=>[S(u,{modelValue:v.value.description,"onUpdate:modelValue":s[15]||(s[15]=e=>v.value.description=e),type:"textarea",rows:5,placeholder:"请输入企业简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(p,null,{default:R(()=>[S(d,{span:24},{default:R(()=>[S(r,null,{default:R(()=>[S(x,{type:"primary",loading:f.value,onClick:g},{default:R(()=>[S(w,null,{default:R(()=>[S(N(o))]),_:1}),O(" "+Q(m.value?"创建企业":"保存基础信息"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),[["__scopeId","data-v-be990e00"]]),ye={class:"card-header"},ge={class:"qual-info"},he={class:"qual-name"},ke={class:"badges"},be={key:0,class:"file-status"},we={key:0,class:"single-file"},xe={class:"file-item"},Ve={class:"file-details"},ze={class:"file-name"},qe={class:"file-meta"},Ce={class:"file-actions"},je={key:1,class:"multiple-files"},Ie={class:"file-details"},Ue={class:"file-name"},Ee={class:"file-meta"},De={class:"file-actions"},$e={key:1,class:"no-file"},Te={key:2,class:"upload-progress"},Me={class:"card-footer"},Be={class:"upload-section"},Pe={class:"upload-tips"},Fe=s($({__name:"QualificationCard",props:{qualification:{},fileInfo:{},isCustom:{type:Boolean},onUpload:{type:Function},companyName:{}},emits:["upload","download","delete","remove-custom"],setup(e,{emit:a}){const l=e,t=a,o=M(),s=M(!1),f=M(0),v=T(()=>!!l.fileInfo&&(l.fileInfo.allow_multiple_files?l.fileInfo.files&&l.fileInfo.files.length>0:!!l.fileInfo.original_filename)),y=T(()=>{var e,a;return(null==(e=l.fileInfo)?void 0:e.allow_multiple_files)&&(null==(a=l.fileInfo)?void 0:a.files)}),g=T(()=>"financial_audit_report"===l.qualification.key?".pdf,.xls,.xlsx,.jpg,.jpeg,.png":".pdf,.jpg,.jpeg,.png"),h=T(()=>{const e=l.qualification.key;return"business_license"===e?"license":e.includes("id")||"legal_id_front"===e||"legal_id_back"===e?"id_card":e.includes("seal")?"seal":e.includes("iso")||e.includes("cmmi")||e.includes("certificate")||e.includes("qualification")||e.includes("认证")?"qualification":"default"}),k=async e=>{const{file:a,onSuccess:i,onError:n}=e;try{s.value=!0,f.value=0;const e=(a.size/1024/1024).toFixed(1);_.info(`正在上传 ${a.name} (${e}MB)，请耐心等待...`);const n=setInterval(()=>{f.value<90&&(f.value+=5)},500);l.onUpload?await l.onUpload(a):t("upload",a),clearInterval(n),f.value=100,i({success:!0})}catch(o){n(o)}finally{s.value=!1,f.value=0}},b=()=>{t("download",l.qualification.key)},w=()=>{t("delete",l.qualification.key)},x=e=>{if(!e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["B","KB","MB","GB"][a]},V=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},z={dishonest_executor:"https://zxgk.court.gov.cn/shixin/",tax_violation_check:"https://www.creditchina.gov.cn/zhuanxiangchaxun/zhongdashuishouweifaanjian/",gov_procurement_creditchina:"https://www.creditchina.gov.cn/zhuanxiangchaxun/zhengfucaigouyanzhongweifashixinmingdan/",creditchina_blacklist:"https://www.creditchina.gov.cn/xinxigongshi/shixinheimingdan/",creditchina_credit_report:"https://www.creditchina.gov.cn/xybgxzzn/",enterprise_credit_report:"https://www.gsxt.gov.cn/",gov_procurement_ccgp:"http://www.ccgp.gov.cn/search/cr/"},q=T(()=>l.qualification.key in z),C=()=>{const e=z[l.qualification.key];e&&(window.open(e,"_blank"),_.success("已在新窗口打开查询网站,请手动查询后截图上传"))};return(a,_)=>{const z=n,j=re,I=i,U=se,E=de,D=ce;return F(),L(D,{class:K(["qualification-card",{required:e.qualification.required,"has-file":v.value}])},{default:R(()=>[A("div",ye,[A("div",ge,[S(z,{class:"qual-icon",size:20},{default:R(()=>[(F(),L(Y(e.qualification.icon)))]),_:1}),A("span",he,Q(e.qualification.name),1)]),A("div",ke,[e.qualification.required?(F(),L(j,{key:0,type:"warning",size:"small"},{default:R(()=>[..._[1]||(_[1]=[O("必需",-1)])]),_:1})):G("",!0),e.qualification.allowMultiple?(F(),L(j,{key:1,type:"info",size:"small"},{default:R(()=>[S(z,null,{default:R(()=>[S(N(u))]),_:1}),_[2]||(_[2]=O(" 多文件 ",-1))]),_:1})):G("",!0)])]),v.value?(F(),P("div",be,[y.value?(F(),P("div",je,[(F(!0),P(J,null,W(e.fileInfo.files,e=>(F(),P("div",{key:e.qualification_id,class:"file-item"},[S(z,{class:"file-icon"},{default:R(()=>[S(N(r))]),_:1}),A("div",Ie,[A("div",Ue,Q(e.original_filename),1),A("div",Ee,[A("span",null,Q(x(e.file_size)),1),_[4]||(_[4]=A("span",{class:"divider"},"•",-1)),A("span",null,Q(V(e.upload_time)),1)])]),A("div",De,[S(I,{text:"",type:"primary",size:"small",onClick:a=>{return i=e.qualification_id,void t("download",l.qualification.key,i);var i}},{default:R(()=>[S(z,null,{default:R(()=>[S(N(d))]),_:1})]),_:1},8,["onClick"]),S(I,{text:"",type:"danger",size:"small",onClick:a=>{return i=e.qualification_id,void t("delete",l.qualification.key,i);var i}},{default:R(()=>[S(z,null,{default:R(()=>[S(N(c))]),_:1})]),_:1},8,["onClick"])])]))),128))])):(F(),P("div",we,[A("div",xe,[S(z,{class:"file-icon"},{default:R(()=>[S(N(r))]),_:1}),A("div",Ve,[A("div",ze,Q(e.fileInfo.original_filename),1),A("div",qe,[A("span",null,Q(x(e.fileInfo.file_size)),1),_[3]||(_[3]=A("span",{class:"divider"},"•",-1)),A("span",null,Q(V(e.fileInfo.upload_time)),1)])]),A("div",Ce,[S(I,{text:"",type:"primary",size:"small",onClick:b},{default:R(()=>[S(z,null,{default:R(()=>[S(N(d))]),_:1})]),_:1}),S(I,{text:"",type:"danger",size:"small",onClick:w},{default:R(()=>[S(z,null,{default:R(()=>[S(N(c))]),_:1})]),_:1})])])]))])):(F(),P("div",$e,[S(U,{type:"info",size:"small"},{default:R(()=>[..._[5]||(_[5]=[O("未上传文件",-1)])]),_:1})])),s.value?(F(),P("div",Te,[S(E,{percentage:f.value,"stroke-width":6},null,8,["percentage"]),S(U,{type:"info",size:"small"},{default:R(()=>[O("上传中... "+Q(f.value)+"%",1)]),_:1})])):G("",!0),A("div",Me,[A("div",Be,[S(N(ue),{ref_key:"uploaderRef",ref:o,accept:g.value,multiple:e.qualification.allowMultiple,"show-file-list":!1,"http-request":k,"max-size":100,"auto-compress-image":!0,"image-type":h.value},{trigger:R(()=>[S(I,{type:"primary",size:"small",loading:s.value,disabled:s.value},{default:R(()=>[S(z,null,{default:R(()=>[S(N(p))]),_:1}),O(" "+Q(s.value?"上传中...":e.qualification.allowMultiple?"批量上传":"上传文件"),1)]),_:1},8,["loading","disabled"])]),_:1},8,["accept","multiple","image-type"]),q.value?(F(),L(I,{key:0,type:"success",size:"small",onClick:C},{default:R(()=>[S(z,null,{default:R(()=>[S(N(m))]),_:1}),_[6]||(_[6]=O(" 打开查询网站 ",-1))]),_:1})):G("",!0),e.isCustom?(F(),L(I,{key:1,type:"danger",size:"small",onClick:_[0]||(_[0]=e=>a.$emit("remove-custom"))},{default:R(()=>[S(z,null,{default:R(()=>[S(N(c))]),_:1}),_[7]||(_[7]=O(" 移除 ",-1))]),_:1})):G("",!0)]),A("div",Pe,[S(U,{type:"info",size:"small"},{default:R(()=>[..._[8]||(_[8]=[O(" 支持JPG、PNG、PDF格式，最大100MB ",-1),A("span",{class:"pdf-tip"},"（PDF将自动转换为图片，大文件请耐心等待）",-1)])]),_:1})])])]),_:1},8,["class"])}}}),[["__scopeId","data-v-56cc4271"]]),Se={class:"qualification-tab"},Ne={key:1},Re={class:"qualification-category"},Oe={class:"category-title text-secondary"},Qe=s($({__name:"QualificationTab",props:{companyId:{},companyData:{}},emits:["update"],setup(o,{emit:s}){const u=o,r=s,{success:d,error:c}=e(),p=M(!1),m=M({}),_=M([]),h=M(!1),k=M({name:""}),b=[{key:"basic",name:"基本证件资质",color:"primary"},{key:"iso",name:"ISO体系认证",color:"success"},{key:"credit",name:"信用资质证明",color:"info"},{key:"industry",name:"行业专业资质",color:"danger"}],w=[{key:"business_license",name:"营业执照",icon:"Document",category:"basic",required:!0},{key:"legal_id_front",name:"法人身份证(正面)",icon:"CreditCard",category:"basic",required:!0},{key:"legal_id_back",name:"法人身份证(反面)",icon:"CreditCard",category:"basic",required:!0},{key:"iso9001",name:"ISO 9001质量管理体系认证",icon:"Medal",category:"iso"},{key:"iso14001",name:"ISO 14001环境管理体系认证",icon:"Medal",category:"iso"},{key:"iso27001",name:"ISO 27001信息安全管理体系认证",icon:"Lock",category:"iso"},{key:"iso20000",name:"ISO 20000 IT服务管理体系认证",icon:"Monitor",category:"iso"},{key:"dishonest_executor",name:"失信被执行人名单（信用中国）",icon:"WarningFilled",category:"credit"},{key:"tax_violation_check",name:"重大税收违法失信主体（信用中国）",icon:"WarningFilled",category:"credit"},{key:"gov_procurement_creditchina",name:"政府采购严重违法失信行为（信用中国）",icon:"Flag",category:"credit"},{key:"creditchina_blacklist",name:"严重失信主体（信用中国）",icon:"WarnTriangleFilled",category:"credit"},{key:"creditchina_credit_report",name:"信用报告（信用中国）",icon:"DocumentChecked",category:"credit"},{key:"enterprise_credit_report",name:"国家企业信用信息公示系统信息报告",icon:"Tickets",category:"credit"},{key:"gov_procurement_ccgp",name:"政府采购严重违法失信行为信息记录（政府采购网）",icon:"CircleCheck",category:"credit"},{key:"basic_telecom_permit",name:"基础电信业务许可证",icon:"PhoneFilled",category:"industry"},{key:"value_added_telecom_permit",name:"增值电信业务许可证",icon:"PhoneFilled",category:"industry"},{key:"software_copyright",name:"软件著作权登记证书",icon:"Document",category:"industry",allowMultiple:!0},{key:"patent_certificate",name:"专利证书",icon:"TrophyBase",category:"industry",allowMultiple:!0},{key:"high_tech",name:"高新技术企业证书",icon:"Star",category:"industry"},{key:"software_enterprise",name:"软件企业认定证书",icon:"Monitor",category:"industry"},{key:"cmmi",name:"CMMI成熟度等级证书",icon:"Trophy",category:"industry"},{key:"level_protection",name:"等保三级认证",icon:"Lock",category:"industry"}],x=async()=>{p.value=!0;try{const e=await Z.getCompanyQualifications(u.companyId);e.success&&e.data&&(m.value=e.data)}catch(e){c("加载失败",e instanceof Error?e.message:"未知错误")}finally{p.value=!1}},V=e=>a=>(async(e,a)=>{const l=w.find(a=>a.key===e)||_.value.find(a=>a.key===e);try{const t=await Z.uploadQualification(u.companyId,e,a,{});if(!t.success)throw new Error(t.message||"上传失败");d("上传成功",`${(null==l?void 0:l.name)||"资质文件"}上传成功`),await x(),r("update")}catch(t){const e=t instanceof Error?t.message:"未知错误";throw c("上传失败",e),t}})(e,a),z=async(e,a)=>{try{a?await Z.downloadQualification(a,""):window.open(`/api/companies/${u.companyId}/qualifications/${e}/download`)}catch(l){c("下载失败",l instanceof Error?l.message:"未知错误")}},q=async(e,a)=>{try{if(await g.confirm("确定要删除此资质文件吗？","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),a)await Z.deleteQualification(a);else{if(!(await fetch(`/api/companies/${u.companyId}/qualifications/${e}`,{method:"DELETE"})).ok)throw new Error("删除失败")}d("删除成功","资质文件已删除"),await x(),r("update")}catch(l){c("删除失败",l instanceof Error?l.message:"未知错误")}},C=()=>{k.value.name="",h.value=!0},j=()=>{if(!k.value.name.trim())return void c("错误","请输入资质名称");const e=`custom_${Date.now()}`;_.value.push({key:e,name:k.value.name.trim(),icon:"Document",category:"custom"}),h.value=!1,d("添加成功","自定义资质已添加")};return X(()=>{x()}),(e,s)=>{const u=n,r=oe,c=ne,x=i,I=t,U=l,E=a,$=v;return F(),P("div",Se,[S(N(ie),{title:"资质信息管理"},{default:R(()=>[p.value?(F(),L(N(D),{key:0,text:"加载资质信息..."})):(F(),P("div",Ne,[(F(),P(J,null,W(b,e=>A("div",{key:e.key,class:"qualification-category"},[A("h6",{class:K(["category-title",`text-${e.color}`])},[S(u,null,{default:R(()=>[S(N(y))]),_:1}),O(" "+Q(e.name),1)],2),S(c,{gutter:16},{default:R(()=>{return[(F(!0),P(J,null,W((a=e.key,w.filter(e=>e.category===a)),e=>(F(),L(r,{key:e.key,span:12},{default:R(()=>{var a;return[S(Fe,{qualification:e,"file-info":m.value[e.key],"company-name":null==(a=o.companyData)?void 0:a.company_name,"on-upload":V(e.key),onDownload:z,onDelete:q},null,8,["qualification","file-info","company-name","on-upload"])]}),_:2},1024))),128))];var a}),_:2},1024)])),64)),A("div",Re,[A("h6",Oe,[S(u,null,{default:R(()=>[S(N(f))]),_:1}),s[3]||(s[3]=O(" 自定义资质 ",-1))]),S(x,{type:"primary",onClick:C},{default:R(()=>[S(u,null,{default:R(()=>[S(N(f))]),_:1}),s[4]||(s[4]=O(" 添加自定义资质 ",-1))]),_:1}),_.value.length>0?(F(),L(c,{key:0,gutter:16,class:"mt-3"},{default:R(()=>[(F(!0),P(J,null,W(_.value,(e,a)=>(F(),L(r,{key:e.key,span:12},{default:R(()=>[S(Fe,{qualification:e,"file-info":m.value[e.key],"is-custom":!0,"on-upload":V(e.key),onDownload:z,onDelete:q,onRemoveCustom:e=>(async e=>{try{await g.confirm("确定要移除此自定义资质吗？","移除确认",{confirmButtonText:"确定移除",cancelButtonText:"取消",type:"warning"}),_.value.splice(e,1),d("移除成功","自定义资质已移除")}catch{}})(a)},null,8,["qualification","file-info","on-upload","onRemoveCustom"])]),_:2},1024))),128))]),_:1})):G("",!0)])]))]),_:1}),S($,{modelValue:h.value,"onUpdate:modelValue":s[2]||(s[2]=e=>h.value=e),title:"添加自定义资质",width:"400px"},{footer:R(()=>[S(x,{onClick:s[1]||(s[1]=e=>h.value=!1)},{default:R(()=>[...s[5]||(s[5]=[O("取消",-1)])]),_:1}),S(x,{type:"primary",onClick:j},{default:R(()=>[...s[6]||(s[6]=[O("确定",-1)])]),_:1})]),default:R(()=>[S(E,{model:k.value,"label-width":"100px"},{default:R(()=>[S(U,{label:"资质名称"},{default:R(()=>[S(I,{modelValue:k.value.name,"onUpdate:modelValue":s[0]||(s[0]=e=>k.value.name=e),placeholder:"请输入资质名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-258d4523"]]),Le={class:"personnel-tab"},Ae={class:"attachments-grid"},Ge={class:"attachment-item"},Ye={class:"attachment-header"},Je={key:0,class:"file-info"},We={class:"file-name"},Ke={class:"file-actions"},Xe={key:1,class:"no-file"},Ze={class:"attachment-item"},He={class:"attachment-header"},ea={key:0,class:"file-info"},aa={class:"file-name"},la={class:"file-actions"},ta={key:1,class:"no-file"},ia={class:"attachment-item"},na={class:"attachment-header"},oa={key:0,class:"file-info"},sa={class:"file-name"},ua={class:"file-actions"},ra={key:1,class:"no-file"},da={class:"attachment-item"},ca={class:"attachment-header"},pa={key:0,class:"file-info"},ma={class:"file-name"},_a={class:"file-actions"},fa={key:1,class:"no-file"},va=s($({__name:"PersonnelTab",props:{companyId:{},companyData:{}},emits:["update"],setup(s,{emit:u}){const m=s,_=u,{success:f,error:v}=e(),y=M(),w=M(!1),x=M({authorized_person_name:"",authorized_person_id:"",authorized_person_gender:"",authorized_person_age:void 0,authorized_person_position:"",authorized_person_title:""}),V=M({auth_id_front:null,auth_id_back:null,manager_resume:null,social_security:null}),z={authorized_person_id:[{pattern:/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/,message:"请输入正确的身份证号",trigger:"blur"}]};B(()=>m.companyData,e=>{e&&(x.value={authorized_person_name:e.authorized_person_name||"",authorized_person_id:e.authorized_person_id||"",authorized_person_gender:e.authorized_person_gender||"",authorized_person_age:e.authorized_person_age||void 0,authorized_person_position:e.authorized_person_position||"",authorized_person_title:e.authorized_person_title||""})},{immediate:!0,deep:!0});const q=async()=>{y.value&&await y.value.validate(async e=>{if(e){w.value=!0;try{(await Z.updateCompany(m.companyId,{authorizedPersonName:x.value.authorized_person_name,authorizedPersonId:x.value.authorized_person_id,authorizedPersonGender:x.value.authorized_person_gender,authorizedPersonAge:x.value.authorized_person_age,authorizedPersonPosition:x.value.authorized_person_position,authorizedPersonTitle:x.value.authorized_person_title})).success&&(f("保存成功","被授权人信息已更新"),_("update"))}catch(a){const e=(null==a?void 0:a.message)||(a instanceof Error?a.message:"未知错误");v("保存失败",e)}finally{w.value=!1}}})},C=e=>async a=>{const{file:l,onSuccess:t,onError:i}=a;try{const a=await Z.uploadQualification(m.companyId,e,l,{});if(!a.success)throw new Error(a.error||"上传失败");f("上传成功","附件上传成功"),U(),_("update"),t(a)}catch(n){const e=(null==n?void 0:n.message)||(n instanceof Error?n.message:"未知错误");v("上传失败",e),i(n)}},j=e=>{window.open(`/api/companies/${m.companyId}/qualifications/${e}/download`)},I=async e=>{try{await g.confirm("确定要删除此附件吗？","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{if(!(await fetch(`/api/companies/${m.companyId}/qualifications/${e}`,{method:"DELETE"})).ok)throw new Error("删除失败");f("删除成功","附件已删除"),U(),_("update")}catch(a){const e=(null==a?void 0:a.message)||(a instanceof Error?a.message:"未知错误");v("删除失败",e)}},U=async()=>{try{const e=await Z.getCompanyQualifications(m.companyId);if(e.success&&e.data){const a=e.data;V.value={auth_id_front:a.auth_id_front?{name:a.auth_id_front.original_filename}:null,auth_id_back:a.auth_id_back?{name:a.auth_id_back.original_filename}:null,manager_resume:a.manager_resume?{name:a.manager_resume.original_filename}:null,social_security:a.social_security?{name:a.social_security.original_filename}:null}}}catch(e){}};return X(()=>{U()}),(e,s)=>{const u=t,m=l,_=oe,f=ne,v=le,g=ae,U=ee,E=n,D=i,$=a;return F(),P("div",Le,[S(N(ie),{title:"被授权人基本信息"},{default:R(()=>[S($,{ref_key:"formRef",ref:y,model:x.value,rules:z,"label-width":"140px",class:"personnel-form"},{default:R(()=>[S(f,{gutter:20},{default:R(()=>[S(_,{span:12},{default:R(()=>[S(m,{label:"姓名",prop:"authorized_person_name"},{default:R(()=>[S(u,{modelValue:x.value.authorized_person_name,"onUpdate:modelValue":s[0]||(s[0]=e=>x.value.authorized_person_name=e),placeholder:"请输入被授权人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),S(_,{span:12},{default:R(()=>[S(m,{label:"身份证号",prop:"authorized_person_id"},{default:R(()=>[S(u,{modelValue:x.value.authorized_person_id,"onUpdate:modelValue":s[1]||(s[1]=e=>x.value.authorized_person_id=e),placeholder:"请输入身份证号",maxlength:"18"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(f,{gutter:20},{default:R(()=>[S(_,{span:12},{default:R(()=>[S(m,{label:"性别",prop:"authorized_person_gender"},{default:R(()=>[S(g,{modelValue:x.value.authorized_person_gender,"onUpdate:modelValue":s[2]||(s[2]=e=>x.value.authorized_person_gender=e),placeholder:"请选择性别",style:{width:"100%"}},{default:R(()=>[S(v,{label:"男",value:"男"}),S(v,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),S(_,{span:12},{default:R(()=>[S(m,{label:"年龄",prop:"authorized_person_age"},{default:R(()=>[S(U,{modelValue:x.value.authorized_person_age,"onUpdate:modelValue":s[3]||(s[3]=e=>x.value.authorized_person_age=e),min:18,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(f,{gutter:20},{default:R(()=>[S(_,{span:12},{default:R(()=>[S(m,{label:"职位",prop:"authorized_person_position"},{default:R(()=>[S(u,{modelValue:x.value.authorized_person_position,"onUpdate:modelValue":s[4]||(s[4]=e=>x.value.authorized_person_position=e),placeholder:"请输入职位"},null,8,["modelValue"])]),_:1})]),_:1}),S(_,{span:12},{default:R(()=>[S(m,{label:"职称",prop:"authorized_person_title"},{default:R(()=>[S(u,{modelValue:x.value.authorized_person_title,"onUpdate:modelValue":s[5]||(s[5]=e=>x.value.authorized_person_title=e),placeholder:"请输入职称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(f,null,{default:R(()=>[S(_,{span:24},{default:R(()=>[S(m,null,{default:R(()=>[S(D,{type:"primary",loading:w.value,onClick:q},{default:R(()=>[S(E,null,{default:R(()=>[S(N(o))]),_:1}),s[14]||(s[14]=O(" 保存被授权人信息 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),S(N(ie),{title:"相关附件",class:"mt-4"},{default:R(()=>[A("div",Ae,[A("div",Ge,[A("div",Ye,[S(E,{class:"icon"},{default:R(()=>[S(N(h))]),_:1}),s[15]||(s[15]=A("span",{class:"title"},"被授权人身份证（正面）",-1))]),V.value.auth_id_front?(F(),P("div",Je,[S(E,{class:"file-icon"},{default:R(()=>[S(N(r))]),_:1}),A("span",We,Q(V.value.auth_id_front.name),1),A("div",Ke,[S(D,{text:"",type:"primary",size:"small",onClick:s[6]||(s[6]=e=>j("auth_id_front"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(d))]),_:1})]),_:1}),S(D,{text:"",type:"danger",size:"small",onClick:s[7]||(s[7]=e=>I("auth_id_front"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(c))]),_:1})]),_:1})])])):(F(),P("div",Xe,"未上传")),S(N(ue),{accept:".jpg,.jpeg,.png,.pdf","show-file-list":!1,"http-request":C("auth_id_front"),"auto-compress-image":!0,"image-type":"id_card","max-size":10},{trigger:R(()=>[S(D,{size:"small"},{default:R(()=>[S(E,null,{default:R(()=>[S(N(p))]),_:1}),s[16]||(s[16]=O(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),A("div",Ze,[A("div",He,[S(E,{class:"icon"},{default:R(()=>[S(N(h))]),_:1}),s[17]||(s[17]=A("span",{class:"title"},"被授权人身份证（反面）",-1))]),V.value.auth_id_back?(F(),P("div",ea,[S(E,{class:"file-icon"},{default:R(()=>[S(N(r))]),_:1}),A("span",aa,Q(V.value.auth_id_back.name),1),A("div",la,[S(D,{text:"",type:"primary",size:"small",onClick:s[8]||(s[8]=e=>j("auth_id_back"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(d))]),_:1})]),_:1}),S(D,{text:"",type:"danger",size:"small",onClick:s[9]||(s[9]=e=>I("auth_id_back"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(c))]),_:1})]),_:1})])])):(F(),P("div",ta,"未上传")),S(N(ue),{accept:".jpg,.jpeg,.png,.pdf","show-file-list":!1,"http-request":C("auth_id_back"),"auto-compress-image":!0,"image-type":"id_card","max-size":10},{trigger:R(()=>[S(D,{size:"small"},{default:R(()=>[S(E,null,{default:R(()=>[S(N(p))]),_:1}),s[18]||(s[18]=O(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),A("div",ia,[A("div",na,[S(E,{class:"icon"},{default:R(()=>[S(N(k))]),_:1}),s[19]||(s[19]=A("span",{class:"title"},"项目经理简历",-1))]),V.value.manager_resume?(F(),P("div",oa,[S(E,{class:"file-icon"},{default:R(()=>[S(N(r))]),_:1}),A("span",sa,Q(V.value.manager_resume.name),1),A("div",ua,[S(D,{text:"",type:"primary",size:"small",onClick:s[10]||(s[10]=e=>j("manager_resume"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(d))]),_:1})]),_:1}),S(D,{text:"",type:"danger",size:"small",onClick:s[11]||(s[11]=e=>I("manager_resume"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(c))]),_:1})]),_:1})])])):(F(),P("div",ra,"未上传")),S(N(ue),{accept:".pdf,.doc,.docx","show-file-list":!1,"http-request":C("manager_resume"),"auto-compress-image":!1,"max-size":20},{trigger:R(()=>[S(D,{size:"small"},{default:R(()=>[S(E,null,{default:R(()=>[S(N(p))]),_:1}),s[20]||(s[20]=O(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),A("div",da,[A("div",ca,[S(E,{class:"icon"},{default:R(()=>[S(N(b))]),_:1}),s[21]||(s[21]=A("span",{class:"title"},"社保证明",-1))]),V.value.social_security?(F(),P("div",pa,[S(E,{class:"file-icon"},{default:R(()=>[S(N(r))]),_:1}),A("span",ma,Q(V.value.social_security.name),1),A("div",_a,[S(D,{text:"",type:"primary",size:"small",onClick:s[12]||(s[12]=e=>j("social_security"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(d))]),_:1})]),_:1}),S(D,{text:"",type:"danger",size:"small",onClick:s[13]||(s[13]=e=>I("social_security"))},{default:R(()=>[S(E,null,{default:R(()=>[S(N(c))]),_:1})]),_:1})])])):(F(),P("div",fa,"未上传")),S(N(ue),{accept:".pdf,.jpg,.jpeg,.png","show-file-list":!1,"http-request":C("social_security"),"auto-compress-image":!0,"image-type":"default","max-size":20},{trigger:R(()=>[S(D,{size:"small"},{default:R(()=>[S(E,null,{default:R(()=>[S(N(p))]),_:1}),s[22]||(s[22]=O(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])])])]),_:1})])}}}),[["__scopeId","data-v-9938d5bf"]]),ya={class:"financial-tab"},ga={class:"shareholders-section"},ha={class:"section-header"},ka={class:"save-section"},ba=s($({__name:"FinancialTab",props:{companyId:{},companyData:{}},emits:["update"],setup(s,{emit:u}){const d=s,c=u,{success:p,error:m}=e(),_=M(),y=M(),h=M(),k=M(),b=M(!1),V=M(!1),z=M([{key:"audit_report",name:"财务审计报告",icon:r,required:!1,allowMultiple:!0},{key:"taxpayer_certificate",name:"纳税人资格证明",icon:x,required:!1,allowMultiple:!1}]),q=M({}),C=M({bank_name:"",bank_account:""}),j=M({actual_controller:"",controlling_shareholder:""}),I=M({managing_unit_name:"",managed_unit_name:""}),U=M([]),E=M(-1),D=M(-1),$=M(!1),T=M(-1),Q=M({name:"",type:"",ratio:""}),G={name:[{required:!0,message:"请输入股东名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],ratio:[{required:!0,message:"请输入出资比例",trigger:"blur"}]};B(()=>d.companyData,e=>{if(e){C.value={bank_name:e.bank_name||"",bank_account:e.bank_account||""},j.value={actual_controller:e.actual_controller||"",controlling_shareholder:e.controlling_shareholder||""},I.value={managing_unit_name:e.managing_unit_name||"",managed_unit_name:e.managed_unit_name||""};try{const a=e.shareholders_info;a?(U.value="string"==typeof a?JSON.parse(a):a,E.value=U.value.findIndex(e=>!0===e.is_controlling),D.value=U.value.findIndex(e=>!0===e.is_actual_controller)):(U.value=[],E.value=-1,D.value=-1)}catch(a){U.value=[],E.value=-1,D.value=-1}}},{immediate:!0,deep:!0});const Y=()=>{T.value=-1,Q.value={name:"",type:"",ratio:""},$.value=!0},K=()=>{U.value.forEach(e=>{e.is_controlling=!1}),-1!==E.value&&(U.value[E.value].is_controlling=!0)},H=()=>{U.value.forEach(e=>{e.is_actual_controller=!1}),-1!==D.value&&(U.value[D.value].is_actual_controller=!0)},ee=async()=>{k.value&&await k.value.validate(e=>{if(e){if(-1===T.value)U.value.push({...Q.value,is_controlling:!1,is_actual_controller:!1}),p("添加成功","股东已添加，请点击保存按钮保存更改");else{const e=U.value[T.value];U.value[T.value]={...Q.value,is_controlling:e.is_controlling||!1,is_actual_controller:e.is_actual_controller||!1},p("编辑成功","股东信息已更新，请点击保存按钮保存更改")}$.value=!1}})},te=async()=>{try{V.value=!0;const e=await Z.getCompanyQualifications(d.companyId);e.success&&(q.value=e.data||{})}catch(e){}finally{V.value=!1}},se=async(e,a)=>{try{let l;l=a?`/api/qualifications/${a}/download`:`/api/companies/${d.companyId}/qualifications/${e}/download`,window.open(l,"_blank")}catch(l){m("下载失败",l instanceof Error?l.message:"未知错误")}},ue=async(e,a)=>{try{if(await g.confirm("确定要删除此资质文件吗？","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),a)await Z.deleteQualification(a);else{if(!(await fetch(`/api/companies/${d.companyId}/qualifications/${e}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("删除失败")}p("删除成功","资质文件已删除"),await te(),c("update")}catch(l){m("删除失败",l instanceof Error?l.message:"未知错误")}},re=async()=>{b.value=!0;try{(await Z.updateCompany(d.companyId,{bank_name:C.value.bank_name,bank_account:C.value.bank_account,actual_controller:j.value.actual_controller,controlling_shareholder:j.value.controlling_shareholder,shareholders_info:JSON.stringify(U.value),managing_unit_name:I.value.managing_unit_name,managed_unit_name:I.value.managed_unit_name})).success&&(p("保存成功","财务信息已更新"),c("update"))}catch(e){m("保存失败",e instanceof Error?e.message:"未知错误")}finally{b.value=!1}};return X(()=>{te()}),(e,s)=>{const u=oe,r=ne,x=t,V=l,M=a,B=n,X=i,Z=pe,de=w,ce=me,fe=_e,ve=le,ye=ae,ge=v;return F(),P("div",ya,[S(N(ie),{title:"财务资质文件",class:"mb-4"},{default:R(()=>[S(r,{gutter:20},{default:R(()=>[(F(!0),P(J,null,W(z.value,e=>(F(),L(u,{key:e.key,span:12},{default:R(()=>[S(Fe,{qualification:e,"file-info":q.value[e.key],onUpload:a=>(async(e,a)=>{try{const l=z.value.find(a=>a.key===e);let t=null;if(null==l?void 0:l.allowMultiple){if(t=prompt(`请输入 "${a.name}" 的年份:\n例如：2023、2024`),null===t)return;if(!t.trim())return void m("上传失败","年份不能为空")}const i=new FormData;i.append(`qualifications[${e}]`,a),i.append("qualification_names",JSON.stringify({[e]:(null==l?void 0:l.name)||e})),t&&i.append("file_versions",JSON.stringify({[e]:t.trim()}));const n=await fetch(`/api/companies/${d.companyId}/qualifications/upload`,{method:"POST",body:i,credentials:"include",headers:{}});if(!n.ok){const e=n.headers.get("content-type");if(e&&e.includes("application/json")){const e=await n.json();throw new Error(e.error||`服务器错误: ${n.status}`)}throw new Error(`上传失败: 服务器返回错误 ${n.status}`)}const o=await n.json();if(!o.success)throw new Error(o.error||"上传失败");p("上传成功",`${(null==l?void 0:l.name)||"资质文件"}上传成功`),await te(),c("update")}catch(l){m("上传失败",l instanceof Error?l.message:"未知错误")}})(e.key,a),onDownload:se,onDelete:ue},null,8,["qualification","file-info","onUpload"])]),_:2},1024))),128))]),_:1})]),_:1}),S(N(ie),{title:"银行账户信息"},{default:R(()=>[S(M,{ref_key:"bankFormRef",ref:_,model:C.value,"label-width":"140px",class:"bank-form"},{default:R(()=>[S(r,{gutter:20},{default:R(()=>[S(u,{span:12},{default:R(()=>[S(V,{label:"开户行全称"},{default:R(()=>[S(x,{modelValue:C.value.bank_name,"onUpdate:modelValue":s[0]||(s[0]=e=>C.value.bank_name=e),placeholder:"请输入开户行全称"},null,8,["modelValue"])]),_:1})]),_:1}),S(u,{span:12},{default:R(()=>[S(V,{label:"银行账号"},{default:R(()=>[S(x,{modelValue:C.value.bank_account,"onUpdate:modelValue":s[1]||(s[1]=e=>C.value.bank_account=e),placeholder:"请输入银行账号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),S(N(ie),{title:"股权结构信息",class:"mt-4"},{default:R(()=>[S(M,{ref_key:"equityFormRef",ref:y,model:j.value,"label-width":"140px",class:"equity-form"},{default:R(()=>[S(r,{gutter:20},{default:R(()=>[S(u,{span:12},{default:R(()=>[S(V,{label:"实际控制人"},{default:R(()=>[S(x,{modelValue:j.value.actual_controller,"onUpdate:modelValue":s[2]||(s[2]=e=>j.value.actual_controller=e),placeholder:"请输入实际控制人"},null,8,["modelValue"])]),_:1})]),_:1}),S(u,{span:12},{default:R(()=>[S(V,{label:"控股股东"},{default:R(()=>[S(x,{modelValue:j.value.controlling_shareholder,"onUpdate:modelValue":s[3]||(s[3]=e=>j.value.controlling_shareholder=e),placeholder:"请输入控股股东"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),A("div",ga,[A("div",ha,[s[14]||(s[14]=A("h6",null,"股东/投资人列表",-1)),S(X,{type:"primary",size:"small",onClick:Y},{default:R(()=>[S(B,null,{default:R(()=>[S(N(f))]),_:1}),s[13]||(s[13]=O(" 添加股东 ",-1))]),_:1})]),U.value.length>0?(F(),L(ce,{key:0,data:U.value,stripe:""},{default:R(()=>[S(Z,{prop:"name",label:"股东名称","min-width":"150"}),S(Z,{prop:"type",label:"类型",width:"100"}),S(Z,{prop:"ratio",label:"出资比例",width:"120"}),S(Z,{label:"控股股东",width:"100",align:"center"},{default:R(({$index:e})=>[S(de,{modelValue:E.value,"onUpdate:modelValue":s[4]||(s[4]=e=>E.value=e),label:e,onChange:K},{default:R(()=>[...s[15]||(s[15]=[A("span",null,null,-1)])]),_:1},8,["modelValue","label"])]),_:1}),S(Z,{label:"实际控制人",width:"110",align:"center"},{default:R(({$index:e})=>[S(de,{modelValue:D.value,"onUpdate:modelValue":s[5]||(s[5]=e=>D.value=e),label:e,onChange:H},{default:R(()=>[...s[16]||(s[16]=[A("span",null,null,-1)])]),_:1},8,["modelValue","label"])]),_:1}),S(Z,{label:"操作",width:"150"},{default:R(({row:e,$index:a})=>[S(X,{text:"",type:"primary",size:"small",onClick:e=>(e=>{T.value=e;const a=U.value[e];Q.value={name:a.name,type:a.type,ratio:a.ratio},$.value=!0})(a)},{default:R(()=>[...s[17]||(s[17]=[O(" 编辑 ",-1)])]),_:1},8,["onClick"]),S(X,{text:"",type:"danger",size:"small",onClick:e=>(async e=>{try{await g.confirm("确定要删除此股东吗？","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),e===E.value&&(E.value=-1),e===D.value&&(D.value=-1),U.value.splice(e,1),e<E.value&&E.value--,e<D.value&&D.value--,p("删除成功","股东已删除，请点击保存按钮保存更改")}catch{}})(a)},{default:R(()=>[...s[18]||(s[18]=[O(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(F(),L(fe,{key:1,description:"暂无股东信息","image-size":100}))])]),_:1}),S(N(ie),{title:"管理关系信息",class:"mt-4"},{default:R(()=>[S(M,{ref_key:"managementFormRef",ref:h,model:I.value,"label-width":"140px",class:"management-form"},{default:R(()=>[S(r,{gutter:20},{default:R(()=>[S(u,{span:12},{default:R(()=>[S(V,{label:"管理单位名称"},{default:R(()=>[S(x,{modelValue:I.value.managing_unit_name,"onUpdate:modelValue":s[6]||(s[6]=e=>I.value.managing_unit_name=e),placeholder:"如有管理单位请输入"},null,8,["modelValue"])]),_:1})]),_:1}),S(u,{span:12},{default:R(()=>[S(V,{label:"被管理单位名称"},{default:R(()=>[S(x,{modelValue:I.value.managed_unit_name,"onUpdate:modelValue":s[7]||(s[7]=e=>I.value.managed_unit_name=e),placeholder:"如有被管理单位请输入"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),A("div",ka,[S(X,{type:"primary",size:"large",loading:b.value,onClick:re},{default:R(()=>[S(B,null,{default:R(()=>[S(N(o))]),_:1}),s[19]||(s[19]=O(" 保存财务信息 ",-1))]),_:1},8,["loading"])]),S(ge,{modelValue:$.value,"onUpdate:modelValue":s[12]||(s[12]=e=>$.value=e),title:-1===T.value?"添加股东":"编辑股东",width:"500px"},{footer:R(()=>[S(X,{onClick:s[11]||(s[11]=e=>$.value=!1)},{default:R(()=>[...s[20]||(s[20]=[O("取消",-1)])]),_:1}),S(X,{type:"primary",onClick:ee},{default:R(()=>[...s[21]||(s[21]=[O("确定",-1)])]),_:1})]),default:R(()=>[S(M,{ref_key:"shareholderFormRef",ref:k,model:Q.value,rules:G,"label-width":"100px"},{default:R(()=>[S(V,{label:"股东名称",prop:"name"},{default:R(()=>[S(x,{modelValue:Q.value.name,"onUpdate:modelValue":s[8]||(s[8]=e=>Q.value.name=e),placeholder:"请输入股东名称"},null,8,["modelValue"])]),_:1}),S(V,{label:"类型",prop:"type"},{default:R(()=>[S(ye,{modelValue:Q.value.type,"onUpdate:modelValue":s[9]||(s[9]=e=>Q.value.type=e),placeholder:"请选择类型",style:{width:"100%"}},{default:R(()=>[S(ve,{label:"企业",value:"企业"}),S(ve,{label:"自然人",value:"自然人"})]),_:1},8,["modelValue"])]),_:1}),S(V,{label:"出资比例",prop:"ratio"},{default:R(()=>[S(x,{modelValue:Q.value.ratio,"onUpdate:modelValue":s[10]||(s[10]=e=>Q.value.ratio=e),placeholder:"如：30%"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-ecc1d87d"]]),wa={class:"company-detail"},xa={class:"detail-header"},Va={class:"header-title"},za={key:0,class:"header-actions"},qa={key:1,class:"detail-content"},Ca={class:"tab-label"},ja={class:"tab-label"},Ia={class:"tab-label"},Ua={class:"tab-label"},Ea=s($({__name:"CompanyDetail",setup(a){const l=V(),t=z(),{error:o}=e(),s=M(!1),u=M("basic"),r=M(0),d=M({}),c=M(!1),p=M(!1),m={technology:"科技",manufacturing:"制造业",finance:"金融",education:"教育",healthcare:"医疗",retail:"零售",construction:"建筑",other:"其他"},_=async()=>{s.value=!0;try{const e=await Z.getCompany(r.value);e.success&&e.data?d.value=e.data:(o("加载失败","无法获取企业信息"),h())}catch(e){o("加载失败",e instanceof Error?e.message:"未知错误"),h()}finally{s.value=!1}},f=e=>{},v=async()=>{await _()},y=e=>{c.value=!1,r.value=e,t.replace(`/knowledge/company/${e}`),_()},g=e=>{_()},h=()=>{t.push("/knowledge/company-library")};return X(()=>{const e=l.params.id;if("new"===e)c.value=!0,r.value=0;else if(e){if(r.value=parseInt(e,10),isNaN(r.value))return o("参数错误","无效的企业ID"),void h();_()}else o("参数错误","缺少企业ID"),h()}),(e,a)=>{const l=i,t=re,o=n,_=U,b=E;return F(),P("div",wa,[A("div",xa,[S(l,{onClick:h,icon:"ArrowLeft"},{default:R(()=>[...a[3]||(a[3]=[O("返回列表",-1)])]),_:1}),A("div",Va,[A("h2",null,Q(c.value?"新建企业":d.value.company_name||"企业详情"),1),!c.value&&d.value.industry_type?(F(),L(t,{key:0,type:"info"},{default:R(()=>{return[O(Q((e=d.value.industry_type,m[e]||e)),1)];var e}),_:1})):G("",!0)]),c.value?G("",!0):(F(),P("div",za,[S(l,{type:"primary",onClick:a[0]||(a[0]=e=>p.value=!0)},{default:R(()=>[S(o,null,{default:R(()=>[S(N(q))]),_:1}),a[4]||(a[4]=O(" 从标书提取信息 ",-1))]),_:1})]))]),S(H,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),"company-id":r.value,onSuccess:g},null,8,["modelValue","company-id"]),s.value?(F(),L(N(D),{key:0,text:"加载企业信息中..."})):(F(),P("div",qa,[S(b,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),class:"company-tabs",onTabChange:f},{default:R(()=>[S(_,{name:"basic"},{label:R(()=>[A("span",Ca,[S(o,null,{default:R(()=>[S(N(C))]),_:1}),a[5]||(a[5]=O(" 基础信息 ",-1))])]),default:R(()=>[S(ve,{"company-id":r.value,"company-data":d.value,"is-new-mode":c.value,onUpdate:v,onCreated:y},null,8,["company-id","company-data","is-new-mode"])]),_:1}),S(_,{name:"qualification"},{label:R(()=>[A("span",ja,[S(o,null,{default:R(()=>[S(N(j))]),_:1}),a[6]||(a[6]=O(" 资质信息 ",-1))])]),default:R(()=>[S(Qe,{"company-id":r.value,"company-data":d.value,onUpdate:v},null,8,["company-id","company-data"])]),_:1}),S(_,{name:"personnel"},{label:R(()=>[A("span",Ia,[S(o,null,{default:R(()=>[S(N(k))]),_:1}),a[7]||(a[7]=O(" 被授权人信息 ",-1))])]),default:R(()=>[S(va,{"company-id":r.value,"company-data":d.value,onUpdate:v},null,8,["company-id","company-data"])]),_:1}),S(_,{name:"financial"},{label:R(()=>[A("span",Ua,[S(o,null,{default:R(()=>[S(N(I))]),_:1}),a[8]||(a[8]=O(" 财务信息 ",-1))])]),default:R(()=>[S(ba,{"company-id":r.value,"company-data":d.value,onUpdate:v},null,8,["company-id","company-data"])]),_:1})]),_:1},8,["modelValue"])]))])}}}),[["__scopeId","data-v-28630113"]]);export{Ea as default};
