import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";/* empty css                             */import{E as a}from"./el-link-BN2G44Li.js";/* empty css               *//* empty css                */import"./el-form-item-CVdTmnJr.js";/* empty css                 */import{c as l,d as t}from"./el-select-BSk6f2dL.js";/* empty css                   *//* empty css                 */import{aT as s,d as o,r,x as n,L as u,c as i,g as d,B as c,a0 as p,w as m,F as v,aA as _,o as f,k as j,a6 as y,aB as w,E as h,e as g,l as b,t as F,aU as I,aV as x,aW as V,aX as S}from"./index.js";import"./HistoryFilesPanel.vue_vue_type_style_index_0_scoped_8037c805_lang-DZHVYQUE.js";import"./DocumentPreview.vue_vue_type_style_index_0_scoped_3e333bda_lang-DmpRfM6z.js";import{S as D}from"./SSEStreamViewer-B_dDjhsA.js";import{D as E}from"./DocumentUploader-Bped4RWX.js";import{D as k}from"./DocumentPreview-DtQSW7TM.js";/* empty css                */import{S as P}from"./StatsCard-DmyvkCdH.js";import{u as C,a as U,H as R}from"./HitlFileAlert-DkebuoPV.js";/* empty css                    */import{t as H}from"./tender-lE9zOws1.js";import{c as N}from"./company-B-7v0ZEP.js";import{u as $}from"./project-BvI9efyp.js";import{d as B}from"./helpers-De3g06u1.js";import{E as J}from"./index-CnzisJd6.js";import{E as L}from"./index-CNz3qB3a.js";import{E as T,a as z}from"./index-ZXEwf31d.js";import{E as A,a as W}from"./index-CLnWWCfK.js";import{E as q}from"./index-DVu1qCus.js";import{E as M,a as G}from"./index-B6s8Nnm3.js";import{E as K}from"./strings-DBU9TC1F.js";import"./_commonjsHelpers-lGe4XDVY.js";import"./castArray-COSn9LfO.js";import"./index-C50U0V8Z.js";import"./_baseClone-BxWT40wp.js";import"./index-Cjozyviu.js";import"./index-C0O2dFA5.js";const O={async processBusinessResponse(e){const a=new FormData;return a.append("company_id",e.company_id.toString()),a.append("project_name",e.project_name),e.tender_no&&a.append("tender_no",e.tender_no),e.date_text&&a.append("date_text",e.date_text),a.append("hitl_file_path",e.hitl_file_path),a.append("use_mcp",!1!==e.use_mcp?"true":"false"),s.post("/process-business-response",a,{headers:{"Content-Type":"multipart/form-data"}})}},X={class:"business-response"},Y={class:"upload-item"},Q={class:"upload-item"},Z={class:"generation-controls"},ee={class:"card-header"},ae={class:"card-header"},le={class:"header-actions"},te={class:"result-content"},se={class:"file-info-section"},oe=e(o({__name:"Response",setup(e){$();const{projects:s,selectedProject:o,loadProjects:oe,handleProjectChange:re,restoreProjectFromStore:ne}=C(),{useHitlFile:ue,hitlFileInfo:ie,syncing:de,synced:ce,loadFromHITL:pe,cancelHitlFile:me,syncToHitl:ve}=U({onFileLoaded:()=>{_e.value.templateFiles=[]}}),_e=r({projectId:null,companyId:null,projectName:"æ–°é¡¹ç›®",projectNumber:`PRJ-${Date.now()}`,tenderFiles:[],templateFiles:[]}),fe=r([]);n(()=>fe.value.find(e=>e.company_id===_e.value.companyId));const je=n(()=>_e.value.projectId&&(_e.value.templateFiles.length>0||ue.value)),ye=r(!1),we=r(0),he=r(""),ge=r(null),be=r(!1),Fe=async e=>{var a;const{file:l,onSuccess:t,onError:s}=e;try{if(!_e.value.projectId){if(!_e.value.companyId)throw new Error("è¯·å…ˆé€‰æ‹©å…¬å¸");_.info("æ­£åœ¨åˆ›å»ºæ–°é¡¹ç›®...");const e=await H.createProject({company_id:_e.value.companyId,project_name:_e.value.projectName||"æ–°é¡¹ç›®",project_number:_e.value.projectNumber||`PRJ-${Date.now()}`});_e.value.projectId=e.project_id,await oe(),_.success("æ–°é¡¹ç›®å·²åˆ›å»º"),await Ve()}const e=null==(a=o.value)?void 0:a.company_id;if(!e)throw new Error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸");const s=new FormData;s.append("file",l),s.append("company_id",e.toString()),s.append("project_id",_e.value.projectId.toString());const r=await H.parseDocumentStructure(s);if(!r.success)throw new Error(r.message||"ä¸Šä¼ å¤±è´¥");t(r.data),_.success("å•†åŠ¡åº”ç­”æ¨¡æ¿ä¸Šä¼ æˆåŠŸ")}catch(r){s(r),_.error(r.message||"æ¨¡æ¿ä¸Šä¼ å¤±è´¥")}},Ie=async e=>{var a;const{file:l,onSuccess:t,onError:s}=e;try{if(!_e.value.projectId){if(!_e.value.companyId)throw new Error("è¯·å…ˆé€‰æ‹©å…¬å¸");_.info("æ­£åœ¨åˆ›å»ºæ–°é¡¹ç›®...");const e=await H.createProject({company_id:_e.value.companyId,project_name:_e.value.projectName||"æ–°é¡¹ç›®",project_number:_e.value.projectNumber||`PRJ-${Date.now()}`});_e.value.projectId=e.project_id,await oe(),_.success("æ–°é¡¹ç›®å·²åˆ›å»º"),await Ve()}const e=null==(a=o.value)?void 0:a.company_id;if(!e)throw new Error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸");const s=new FormData;s.append("file",l),s.append("company_id",e.toString()),s.append("project_id",_e.value.projectId.toString());const r=await H.parseDocumentStructure(s);if(!r.success)throw new Error(r.message||"ä¸Šä¼ å¤±è´¥");t(r.data),_.success("æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ æˆåŠŸ")}catch(r){s(r),_.error(r.message||"æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ å¤±è´¥")}},xe=async()=>{try{const e=await N.getCompanies();fe.value=e.data||[]}catch(e){_.error("åŠ è½½å…¬å¸åˆ—è¡¨å¤±è´¥")}},Ve=async()=>{await re(_e.value.projectId,{onClear:()=>{ge.value=null,he.value="",_e.value.tenderFiles=[],_e.value.templateFiles=[]},onDocumentsLoaded:e=>{e.tenderFile&&(_e.value.tenderFiles=[e.tenderFile]),e.templateFile&&pe(e,"templateFile"),e.businessResponseFile&&(ge.value=e.businessResponseFile)}}),_e.value.projectId||(_e.value.projectNumber=`PRJ-${Date.now()}`)},Se=()=>{_.success("æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ æˆåŠŸ")},De=()=>{_.success("å•†åŠ¡åº”ç­”æ¨¡æ¿ä¸Šä¼ æˆåŠŸ")},Ee=async()=>{var e;if(_e.value.projectId)if(0!==_e.value.templateFiles.length){ye.value=!0,we.value=0,he.value="",ge.value=null;try{he.value="æ­£åœ¨åŠ è½½é¡¹ç›®ä¿¡æ¯...\n";const a=(await H.getProject(_e.value.projectId)).data,l=null==(e=a.step1_data)?void 0:e.response_file_path;if(!l)throw new Error("æœªæ‰¾åˆ°å•†åŠ¡åº”ç­”æ¨¡æ¿æ–‡ä»¶è·¯å¾„ï¼Œè¯·å…ˆåœ¨æ ‡ä¹¦ç®¡ç†ä¸­ä¸Šä¼ æ¨¡æ¿");he.value+="æ­£åœ¨å¤„ç†å•†åŠ¡åº”ç­”æ–‡æ¡£...\n",we.value=30;const t=await O.processBusinessResponse({company_id:a.company_id,project_name:a.project_name,tender_no:a.project_number||"",date_text:a.bidding_time||"",hitl_file_path:l,use_mcp:!0});we.value=80,he.value+="å¤„ç†å®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆç»“æœ...\n";const s=t.data?t.data:t;if(!s.success)throw new Error(s.message||s.error||"å¤„ç†å¤±è´¥");we.value=100,he.value+=s.message+"\n",ge.value={success:!0,outputFile:s.output_file,downloadUrl:s.download_url,stats:s.stats||{},message:s.message},_.success("å•†åŠ¡åº”ç­”ç”Ÿæˆå®Œæˆï¼"),s.output_file&&_e.value.projectId&&await ve(_e.value.projectId,s.output_file,"business_response")}catch(a){he.value+=`\nâŒ é”™è¯¯: ${a.message}\n`,_.error(a.message||"ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{ye.value=!1,we.value<100&&(we.value=0)}}else _.warning("è¯·å…ˆä¸Šä¼ å•†åŠ¡åº”ç­”æ¨¡æ¿");else _.warning("è¯·å…ˆé€‰æ‹©é¡¹ç›®")},ke=()=>{ye.value=!1,_.info("å·²åœæ­¢ç”Ÿæˆ")},Pe=()=>{ge.value?ge.value.downloadUrl?be.value=!0:_.warning("æ–‡æ¡£åœ°å€æ— æ•ˆ"):_.warning("æš‚æ— æ–‡æ¡£å¯é¢„è§ˆ")},Ce=()=>{var e;if(ge.value)try{const a=ge.value.downloadUrl,l=`å•†åŠ¡åº”ç­”-${(null==(e=o.value)?void 0:e.project_name)||"æ–‡æ¡£"}-${Date.now()}.docx`;B(a,l),_.success("Wordæ–‡æ¡£ä¸‹è½½æˆåŠŸ")}catch(a){_.error("æ–‡æ¡£ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}else _.warning("æš‚æ— æ–‡æ¡£å¯ä¸‹è½½")},Ue=async()=>{var e;(null==(e=ge.value)?void 0:e.outputFile)?_e.value.projectId?await ve(_e.value.projectId,ge.value.outputFile,"business_response"):_.error("é¡¹ç›®IDæ— æ•ˆ"):_.warning("æ²¡æœ‰å¯åŒæ­¥çš„æ–‡ä»¶")};return u(async()=>{await Promise.all([oe(),xe()]);const e=await ne({onClear:()=>{ge.value=null,he.value="",_e.value.tenderFiles=[],_e.value.templateFiles=[],ue.value&&me()},onDocumentsLoaded:e=>{e.tenderFile&&(_e.value.tenderFiles=[e.tenderFile]),e.templateFile&&pe(e,"templateFile"),e.businessResponseFile&&(ge.value=e.businessResponseFile)}});e&&(_e.value.projectId=e)}),(e,r)=>{var n,u;const _=L,C=t,U=l,H=z,N=W,$=h,B=A,O=T,oe=J,re=b,ne=q,pe=K,ve=M,xe=a,Re=G;return f(),i("div",X,[d(oe,{class:"project-section",shadow:"never"},{header:m(()=>[...r[7]||(r[7]=[g("div",{class:"card-header"},[g("span",null,"Step 1: é€‰æ‹©é¡¹ç›®")],-1)])]),default:m(()=>[d(_,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:m(()=>[...r[8]||(r[8]=[j(" ğŸ’¡ æç¤ºï¼šå¯é€‰æ‹©ç°æœ‰é¡¹ç›®ï¼Œæˆ–é€‰æ‹©å…¬å¸åæ–°å»ºé¡¹ç›®å¹¶ä¸Šä¼ æ–‡æ¡£ ",-1)])]),_:1}),d(O,{model:_e.value,"label-width":"100px"},{default:m(()=>[d(B,{gutter:20},{default:m(()=>[d(N,{span:12},{default:m(()=>[d(H,{label:"é¡¹ç›®"},{default:m(()=>[d(U,{modelValue:_e.value.projectId,"onUpdate:modelValue":r[0]||(r[0]=e=>_e.value.projectId=e),placeholder:"è¯·é€‰æ‹©é¡¹ç›®æˆ–ç›´æ¥æ–°å»º",filterable:"",clearable:"",onChange:Ve,style:{width:"100%"}},{default:m(()=>[(f(!0),i(y,null,w(v(s),e=>(f(),c(C,{key:e.id,label:`${e.project_name} (${e.project_number||"-"})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),d(N,{span:12},{default:m(()=>[d(H,{label:"å…¬å¸"},{default:m(()=>{var e;return[_e.value.projectId?(f(),c($,{key:0,value:(null==(e=v(o))?void 0:e.company_name)||"-",disabled:""},null,8,["value"])):(f(),c(U,{key:1,modelValue:_e.value.companyId,"onUpdate:modelValue":r[1]||(r[1]=e=>_e.value.companyId=e),placeholder:"è¯·é€‰æ‹©å…¬å¸ï¼ˆå¿…å¡«ï¼‰",filterable:"",style:{width:"100%"}},{default:m(()=>[(f(!0),i(y,null,w(fe.value,e=>(f(),c(C,{key:e.company_id,label:e.company_name,value:e.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]}),_:1})]),_:1})]),_:1}),_e.value.projectId?p("",!0):(f(),c(B,{key:0,gutter:20},{default:m(()=>[d(N,{span:12},{default:m(()=>[d(H,{label:"é¡¹ç›®åç§°"},{default:m(()=>[d($,{modelValue:_e.value.projectName,"onUpdate:modelValue":r[2]||(r[2]=e=>_e.value.projectName=e),placeholder:"æ–°é¡¹ç›®"},null,8,["modelValue"])]),_:1})]),_:1}),d(N,{span:12},{default:m(()=>[d(H,{label:"é¡¹ç›®ç¼–å·"},{default:m(()=>[d($,{modelValue:_e.value.projectNumber,"onUpdate:modelValue":r[3]||(r[3]=e=>_e.value.projectNumber=e),placeholder:"PRJ-..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}))]),_:1},8,["model"])]),_:1}),d(oe,{class:"upload-section",shadow:"never"},{header:m(()=>[...r[9]||(r[9]=[g("div",{class:"card-header"},[g("span",null,"Step 2: ä¸Šä¼ ç›¸å…³æ–‡æ¡£")],-1)])]),default:m(()=>[d(B,{gutter:20},{default:m(()=>[d(N,{span:12},{default:m(()=>[g("div",Y,[r[10]||(r[10]=g("h4",null,[j("å•†åŠ¡åº”ç­”æ¨¡æ¿ "),g("span",{class:"required"},"*")],-1)),v(ue)?(f(),c(v(R),{key:0,"file-info":v(ie),label:"ä½¿ç”¨HITLå•†åŠ¡åº”ç­”æ¨¡æ¿:",onCancel:v(me)},null,8,["file-info","onCancel"])):p("",!0),v(ue)?p("",!0):(f(),c(v(E),{key:1,modelValue:_e.value.templateFiles,"onUpdate:modelValue":r[4]||(r[4]=e=>_e.value.templateFiles=e),"http-request":Fe,accept:".doc,.docx",limit:1,"max-size":20,drag:"","tip-text":"å¿…é¡»ä¸Šä¼ å•†åŠ¡åº”ç­”æ¨¡æ¿ï¼Œç”¨äºç”Ÿæˆåº”ç­”æ–‡æ¡£",onSuccess:De},null,8,["modelValue"]))])]),_:1}),d(N,{span:12},{default:m(()=>[g("div",Q,[r[11]||(r[11]=g("h4",null,"æ‹›æ ‡æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰",-1)),d(v(E),{modelValue:_e.value.tenderFiles,"onUpdate:modelValue":r[5]||(r[5]=e=>_e.value.tenderFiles=e),"http-request":Ie,accept:".pdf,.doc,.docx",limit:5,"max-size":50,drag:"","tip-text":"å¯é€‰ä¸Šä¼ æ‹›æ ‡æ–‡æ¡£ä½œä¸ºå‚è€ƒï¼Œæ”¯æŒPDFã€Wordæ ¼å¼ï¼Œæœ€å¤§50MB",onSuccess:Se},null,8,["modelValue"])])]),_:1})]),_:1}),g("div",Z,[d(re,{type:"primary",size:"large",disabled:!je.value,loading:ye.value,onClick:Ee},{default:m(()=>[...r[12]||(r[12]=[j(" å¼€å§‹ç”Ÿæˆå•†åŠ¡åº”ç­” ",-1)])]),_:1},8,["disabled","loading"])])]),_:1}),ye.value?(f(),c(oe,{key:0,class:"generation-output",shadow:"never"},{header:m(()=>[g("div",ee,[r[13]||(r[13]=g("span",null,"AIæ­£åœ¨ç”Ÿæˆå•†åŠ¡åº”ç­”...",-1)),d(ne,{percentage:we.value,status:100===we.value?"success":void 0,style:{width:"300px"}},null,8,["percentage","status"])])]),default:m(()=>[d(v(D),{content:he.value,"is-streaming":ye.value,onStop:ke,onRegenerate:Ee},null,8,["content","is-streaming"])]),_:1})):p("",!0),ge.value?(f(),c(oe,{key:1,class:"result-section",shadow:"never"},{header:m(()=>[g("div",ae,[g("span",null,F(ge.value.isHistory?"ğŸ“„ å†å²åº”ç­”æ–‡ä»¶":"âœ… ç”Ÿæˆç»“æœ"),1),g("div",le,[d(re,{type:"primary",icon:v(I),onClick:Pe},{default:m(()=>[...r[14]||(r[14]=[j(" é¢„è§ˆæ–‡æ¡£ ",-1)])]),_:1},8,["icon"]),d(re,{type:"success",icon:v(x),onClick:Ce},{default:m(()=>[...r[15]||(r[15]=[j(" ä¸‹è½½Wordæ–‡æ¡£ ",-1)])]),_:1},8,["icon"]),v(ce)?(f(),c(pe,{key:1,type:"success",size:"large"},{default:m(()=>[...r[17]||(r[17]=[j(" å·²åŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›® ",-1)])]),_:1})):(f(),c(re,{key:0,type:"info",icon:v(V),loading:v(de),onClick:Ue},{default:m(()=>[...r[16]||(r[16]=[j(" åŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›® ",-1)])]),_:1},8,["icon","loading"])),d(re,{type:"primary",icon:v(S),onClick:Ee},{default:m(()=>[...r[18]||(r[18]=[j(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])])])]),default:m(()=>[g("div",te,[d(_,{type:ge.value.isHistory?"info":"success",title:ge.value.message,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["type","title"]),d(v(P),{title:"å¤„ç†ç»Ÿè®¡",stats:ge.value.stats},null,8,["stats"]),g("div",se,[r[20]||(r[20]=g("h4",null,"ç”Ÿæˆæ–‡ä»¶",-1)),d(Re,{column:2,border:""},{default:m(()=>[d(ve,{label:"æ–‡ä»¶è·¯å¾„"},{default:m(()=>[j(F(ge.value.outputFile),1)]),_:1}),d(ve,{label:"ä¸‹è½½åœ°å€"},{default:m(()=>[d(xe,{href:ge.value.downloadUrl,type:"primary"},{default:m(()=>[...r[19]||(r[19]=[j(" ç‚¹å‡»ä¸‹è½½ ",-1)])]),_:1},8,["href"])]),_:1})]),_:1})])])]),_:1})):p("",!0),d(v(k),{modelValue:be.value,"onUpdate:modelValue":r[6]||(r[6]=e=>be.value=e),"file-url":null==(n=ge.value)?void 0:n.downloadUrl,"file-name":`å•†åŠ¡åº”ç­”-${(null==(u=v(o))?void 0:u.project_name)||"æ–‡æ¡£"}.docx`},null,8,["modelValue","file-url","file-name"])])}}}),[["__scopeId","data-v-ac5c74cf"]]);export{oe as default};
