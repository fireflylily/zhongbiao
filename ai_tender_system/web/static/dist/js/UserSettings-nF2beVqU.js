import{ax as s,am as a,bu as e,aD as l,aA as o,aP as r,aF as d,aT as i,aO as n,aS as t,aE as c,aC as u,bJ as w,aR as m,aG as p}from"./editor-6w6Zv5fp.js";import{E as v,p as b,I as P,aH as f,_ as y}from"./index.js";import{P as g}from"./PageHeader-DbQlj86k.js";/* empty css               */import"./index-Cdh5ckaS.js";/* empty css                                                                   */const x={success(s,a=3e3){v.success({message:s,duration:a})},error(s,a=3e3){v.error({message:s,duration:a})},warning(s,a=3e3){v.warning({message:s,duration:a})},info(s,a=3e3){v.info({message:s,duration:a})}},k={class:"user-settings-page"},h={class:"container py-4"},_={class:"row mt-4"},j={class:"col-md-3"},C={class:"card"},U={class:"list-group list-group-flush"},q={class:"col-md-9"},H={key:0,class:"card"},S={class:"card-body"},V={class:"mb-3"},E={class:"input-group"},I=["type"],R={key:0,class:"invalid-feedback"},T={class:"mb-3"},A={class:"input-group"},D=["type"],F={key:0,class:"invalid-feedback"},G={class:"mb-3"},J={class:"input-group"},O=["type"],W={key:0,class:"invalid-feedback"},z={class:"d-flex justify-content-end gap-2"},B=["disabled"],K={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},L={key:1,class:"bi bi-check-circle me-1"},M={key:1,class:"card"},N={class:"card-body"},Q={class:"row mb-3"},X={class:"col-sm-9"},Y=["value"],Z={class:"row mb-3"},$={class:"col-sm-9"},ss=["value"],as={class:"row mb-3"},es={class:"col-sm-9"},ls=["value"],os=y(s({__name:"UserSettings",setup(s){const v=b(),y=P(),os=a("password"),rs=e({oldPassword:"",newPassword:"",confirmPassword:""}),ds=a(!1),is=a(!1),ns=a(!1),ts=e({oldPassword:"",newPassword:"",confirmPassword:""}),cs=a(!1);function us(){rs.oldPassword="",rs.newPassword="",rs.confirmPassword="",ts.oldPassword="",ts.newPassword="",ts.confirmPassword="",ds.value=!1,is.value=!1,ns.value=!1}async function ws(){var s,a,e,l;if(function(){ts.oldPassword="",ts.newPassword="",ts.confirmPassword="";let s=!0;return rs.oldPassword||(ts.oldPassword="请输入当前密码",s=!1),rs.newPassword?rs.newPassword.length<6&&(ts.newPassword="新密码长度至少为6个字符",s=!1):(ts.newPassword="请输入新密码",s=!1),rs.confirmPassword?rs.newPassword!==rs.confirmPassword&&(ts.confirmPassword="两次输入的密码不一致",s=!1):(ts.confirmPassword="请确认新密码",s=!1),rs.oldPassword&&rs.newPassword&&rs.oldPassword===rs.newPassword&&(ts.newPassword="新密码不能与当前密码相同",s=!1),s}()){cs.value=!0;try{const s=await f.changePassword({old_password:rs.oldPassword,new_password:rs.newPassword,confirm_password:rs.confirmPassword});s.success?(x.success("密码修改成功，请重新登录"),us(),setTimeout(async()=>{await y.logout(),v.push("/login")},2e3)):x.error(s.message||"修改密码失败")}catch(o){401===(null==(s=o.response)?void 0:s.status)?(null==(a=o.response.data)?void 0:a.message)?ts.oldPassword=o.response.data.message:ts.oldPassword="当前密码错误":x.error((null==(l=null==(e=o.response)?void 0:e.data)?void 0:l.message)||"修改密码失败，请稍后重试")}finally{cs.value=!1}}}return(s,a)=>{var e,v,b;return o(),l("div",k,[r("div",h,[d(g,{title:"用户设置",icon:"bi-gear"}),r("div",_,[r("div",j,[r("div",C,[r("div",U,[r("a",{href:"#",class:n(["list-group-item","list-group-item-action",{active:"password"===os.value}]),onClick:a[0]||(a[0]=i(s=>os.value="password",["prevent"]))},[...a[8]||(a[8]=[r("i",{class:"bi bi-key me-2"},null,-1),t(" 修改密码 ",-1)])],2),r("a",{href:"#",class:n(["list-group-item","list-group-item-action",{active:"profile"===os.value}]),onClick:a[1]||(a[1]=i(s=>os.value="profile",["prevent"]))},[...a[9]||(a[9]=[r("i",{class:"bi bi-person me-2"},null,-1),t(" 基本信息 ",-1)])],2)])])]),r("div",q,["password"===os.value?(o(),l("div",H,[a[16]||(a[16]=r("div",{class:"card-header"},[r("h5",{class:"mb-0"},[r("i",{class:"bi bi-key me-2"}),t(" 修改密码 ")])],-1)),r("div",S,[r("form",{onSubmit:i(ws,["prevent"])},[r("div",V,[a[10]||(a[10]=r("label",{for:"oldPassword",class:"form-label"},[t("当前密码 "),r("span",{class:"text-danger"},"*")],-1)),r("div",E,[u(r("input",{id:"oldPassword","onUpdate:modelValue":a[2]||(a[2]=s=>rs.oldPassword=s),type:ds.value?"text":"password",class:n(["form-control",{"is-invalid":ts.oldPassword}]),placeholder:"请输入当前密码",required:""},null,10,I),[[w,rs.oldPassword]]),r("button",{class:"btn btn-outline-secondary",type:"button",onClick:a[3]||(a[3]=s=>ds.value=!ds.value)},[r("i",{class:n(ds.value?"bi bi-eye-slash":"bi bi-eye")},null,2)]),ts.oldPassword?(o(),l("div",R,m(ts.oldPassword),1)):c("",!0)])]),r("div",T,[a[11]||(a[11]=r("label",{for:"newPassword",class:"form-label"},[t("新密码 "),r("span",{class:"text-danger"},"*")],-1)),r("div",A,[u(r("input",{id:"newPassword","onUpdate:modelValue":a[4]||(a[4]=s=>rs.newPassword=s),type:is.value?"text":"password",class:n(["form-control",{"is-invalid":ts.newPassword}]),placeholder:"请输入新密码（至少6个字符）",required:""},null,10,D),[[w,rs.newPassword]]),r("button",{class:"btn btn-outline-secondary",type:"button",onClick:a[5]||(a[5]=s=>is.value=!is.value)},[r("i",{class:n(is.value?"bi bi-eye-slash":"bi bi-eye")},null,2)]),ts.newPassword?(o(),l("div",F,m(ts.newPassword),1)):c("",!0)]),a[12]||(a[12]=r("small",{class:"form-text text-muted"},"密码长度至少为6个字符",-1))]),r("div",G,[a[13]||(a[13]=r("label",{for:"confirmPassword",class:"form-label"},[t("确认新密码 "),r("span",{class:"text-danger"},"*")],-1)),r("div",J,[u(r("input",{id:"confirmPassword","onUpdate:modelValue":a[6]||(a[6]=s=>rs.confirmPassword=s),type:ns.value?"text":"password",class:n(["form-control",{"is-invalid":ts.confirmPassword}]),placeholder:"请再次输入新密码",required:""},null,10,O),[[w,rs.confirmPassword]]),r("button",{class:"btn btn-outline-secondary",type:"button",onClick:a[7]||(a[7]=s=>ns.value=!ns.value)},[r("i",{class:n(ns.value?"bi bi-eye-slash":"bi bi-eye")},null,2)]),ts.confirmPassword?(o(),l("div",W,m(ts.confirmPassword),1)):c("",!0)])]),r("div",z,[r("button",{type:"button",class:"btn btn-secondary",onClick:us},[...a[14]||(a[14]=[r("i",{class:"bi bi-x-circle me-1"},null,-1),t(" 重置 ",-1)])]),r("button",{type:"submit",class:"btn btn-primary",disabled:cs.value},[cs.value?(o(),l("span",K)):(o(),l("i",L)),a[15]||(a[15]=t(" 确认修改 ",-1))],8,B)])],32)])])):c("",!0),"profile"===os.value?(o(),l("div",M,[a[20]||(a[20]=r("div",{class:"card-header"},[r("h5",{class:"mb-0"},[r("i",{class:"bi bi-person me-2"}),t(" 基本信息 ")])],-1)),r("div",N,[r("div",Q,[a[17]||(a[17]=r("label",{class:"col-sm-3 col-form-label"},"用户名",-1)),r("div",X,[r("input",{type:"text",readonly:"",class:"form-control-plaintext",value:(null==(e=p(y).user)?void 0:e.username)||"-"},null,8,Y)])]),r("div",Z,[a[18]||(a[18]=r("label",{class:"col-sm-3 col-form-label"},"邮箱",-1)),r("div",$,[r("input",{type:"text",readonly:"",class:"form-control-plaintext",value:(null==(v=p(y).user)?void 0:v.email)||"-"},null,8,ss)])]),r("div",as,[a[19]||(a[19]=r("label",{class:"col-sm-3 col-form-label"},"角色",-1)),r("div",es,[r("input",{type:"text",readonly:"",class:"form-control-plaintext",value:(null==(b=p(y).user)?void 0:b.role)||"-"},null,8,ls)])])])])):c("",!0)])])])])}}}),[["__scopeId","data-v-dd4a1392"]]);export{os as default};
