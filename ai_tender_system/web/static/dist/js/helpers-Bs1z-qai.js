import{E as e,_ as t,g as a,s,n as l,q as i,$ as n,b5 as r,D as o,F as c,M as d}from"./index.js";import{am as u,an as f,bd as p,aq as m,aw as y,as as h,aK as _,au as g,aR as v,at as w,aV as b,aW as k,ar as F,av as x,bL as j,ay as E,aS as I,aN as C,aJ as z,aT as $}from"./editor-DXll0Hem.js";/* empty css               */import{E as T}from"./index-DtcGpiaq.js";/* empty css                                                                          *//* empty css                   *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                */import{a as H,E as R}from"./index-Dhbgm4Y3.js";import{E as L}from"./index-D4Vbn-ec.js";import{E as B}from"./index-B8i2o-55.js";import{E as S,a as U}from"./index-DCqGfqcs.js";import{E as M}from"./index-C8_y6pAz.js";import{a as O,E as Y}from"./index-6pa43YtE.js";import{E as P,a as D}from"./index-mB33K0OK.js";import{v as V}from"./directive-Dw4PSiFE.js";import{E as W}from"./index-CLrB1tvP.js";function q(t={}){const{onFileLoaded:a,onFileCancelled:s,onSyncSuccess:l}=t,i=u(!1),n=u(null),r=u(!1),o=u(!1),c=f(()=>!!n.value),d=e=>({technicalFile:"æŠ€æœ¯éœ€æ±‚æ–‡ä»¶",tenderFile:"æ‹›æ ‡æ–‡æ¡£",templateFile:"åº”ç­”æ¨¡æ¿",businessResponseFile:"å•†åŠ¡åº”ç­”æ–‡ä»¶",p2pResponseFile:"ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶",techProposalFile:"æŠ€æœ¯æ–¹æ¡ˆæ–‡ä»¶"}[e]||"æ–‡ä»¶");return{useHitlFile:i,hitlFileInfo:n,hasHitlFile:c,syncing:r,synced:o,loadFromHITL:(t,s="technicalFile")=>{const l=t[s];return l?(n.value={filename:l.filename||l.name||"æœªçŸ¥æ–‡ä»¶",file_path:l.file_path||l.url||"",file_size:l.file_size||l.size,file_url:l.file_url||l.url},i.value=!0,o.value=!1,e.success({message:`å·²åŠ è½½HITL${d(s)}: ${n.value.filename}`,duration:3e3}),a&&a(n.value),!0):(e.warning(`å½“å‰é¡¹ç›®æ²¡æœ‰${d(s)}`),!1)},cancelHitlFile:()=>{i.value=!1,n.value=null,o.value=!1,e.info("å·²å–æ¶ˆä½¿ç”¨HITLæ–‡ä»¶"),s&&s()},syncToHitl:async(t,a,s)=>{if(!t)return e.error("é¡¹ç›®IDæ— æ•ˆ"),!1;if(!a)return e.error("æ–‡ä»¶è·¯å¾„æ— æ•ˆ"),!1;r.value=!0;try{const i=await fetch(`/api/tender-processing/sync-file/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:a,file_type:s})}),n=i.headers.get("content-type");if(!(null==n?void 0:n.includes("application/json"))){await i.text();throw new Error(`æœåŠ¡å™¨è¿”å›å¼‚å¸¸å“åº” (${i.status}): ${i.statusText}ã€‚å¯èƒ½æ˜¯åç«¯é…ç½®é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚`)}const r=await i.json();if(r.success||i.ok)return o.value=!0,e.success({message:r.message||"å·²æˆåŠŸåŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›®",duration:3e3}),l&&await l(),!0;throw new Error(r.error||r.message||"åŒæ­¥å¤±è´¥")}catch(i){let t="åŒæ­¥åˆ°é¡¹ç›®å¤±è´¥";return i.message?t=i.message:"TypeError"===i.name&&(t="ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"),e.error({message:t,duration:5e3}),!1}finally{r.value=!1}},resetSyncStatus:()=>{o.value=!1}}}function G(e,t="YYYY-MM-DD"){return e?p(e).format(t):""}function J(e,t=2){if(null==e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,a)).toFixed(t)} ${["B","KB","MB","GB","TB","PB"][a]}`}const K={class:"stats-card"},N={key:0,class:"stats-title"},A={class:"stat-item"},Q={class:"stat-prefix"},X={class:"stat-suffix"},Z=t(m({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,a=[{key:"total_replacements",label:"æ–‡æœ¬æ›¿æ¢",suffix:"å¤„"},{key:"tables_processed",label:"è¡¨æ ¼å¤„ç†",suffix:"ä¸ª"},{key:"cells_filled",label:"å•å…ƒæ ¼å¡«å……",suffix:"ä¸ª"},{key:"images_inserted",label:"å›¾ç‰‡æ’å…¥",suffix:"å¼ "}],s=f(()=>t.statItems||a),l=e=>{const a=e.split(".");let s=t.stats;for(const t of a)if(s=null==s?void 0:s[t],null==s)break;return"number"==typeof s?s:0};return(t,a)=>{const i=L,n=R,r=H;return h(),y("div",K,[e.title?(h(),y("h4",N,v(e.title),1)):_("",!0),g(r,{gutter:e.gutter},{default:w(()=>[(h(!0),y(b,null,k(s.value,t=>(h(),F(n,{key:t.key,span:e.span},{default:w(()=>[x("div",A,[g(i,{title:t.label,value:l(t.key),precision:t.precision,"value-style":e.valueStyle},j({_:2},[t.prefix?{name:"prefix",fn:w(()=>[x("span",Q,v(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:w(()=>[x("span",X,v(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),ee={class:"alert-content"},te={class:"file-info"},ae={class:"file-details"},se={class:"file-label"},le={class:"file-name"},ie={key:0,class:"file-size"},ne={class:"alert-actions"},re=t(m({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"ä½¿ç”¨HITLæ–‡ä»¶:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"å–æ¶ˆä½¿ç”¨"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:t}){const r=t,o=()=>{r("cancel")};return(t,r)=>{const c=a,d=T,u=i,f=l;return e.fileInfo?(h(),F(f,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:w(()=>[x("div",ee,[x("div",te,[g(c,{class:"file-icon"},{default:w(()=>[g(E(s))]),_:1}),x("div",ae,[x("span",se,v(e.label),1),x("span",le,v(e.fileInfo.filename),1),e.fileInfo.file_size?(h(),y("span",ie," ("+v(E(J)(e.fileInfo.file_size))+") ",1)):_("",!0),e.showTag?(h(),F(d,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:w(()=>[...r[0]||(r[0]=[I(" å·²ä»æŠ•æ ‡é¡¹ç›®åŠ è½½ ",-1)])]),_:1})):_("",!0)])]),x("div",ne,[C(t.$slots,"actions",{},()=>[e.showCancel?(h(),F(u,{key:0,type:"text",size:"small",onClick:o},{default:w(()=>[g(c,null,{default:w(()=>[g(E(n))]),_:1}),I(" "+v(e.cancelText),1)]),_:1})):_("",!0)],!0)])])]),_:3},8,["type"])):_("",!0)}}}),[["__scopeId","data-v-1a132715"]]),oe={class:"history-files-panel"},ce={class:"card-header"},de={class:"header-title"},ue={class:"current-file-content"},fe={class:"history-actions"},pe={class:"collapse-header"},me={class:"filename-cell"},ye=t(m({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"è¯¥é¡¹ç›®å·²æœ‰ç”Ÿæˆæ–‡ä»¶"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const t=u([]),n=e=>{if(!e)return"-";let t=e;try{t=decodeURIComponent(e)}catch{}const a=t.split("/");return a[a.length-1]||"-"};return(u,f)=>{const p=T,m=l,b=U,k=M,j=S,C=a,H=i,R=B,L=D,q=P,K=W,N=Y,A=O,Q=V;return h(),y("div",oe,[e.currentFile?(h(),F(R,{key:0,shadow:"never",class:"current-file-card"},{header:w(()=>[x("div",ce,[x("div",de,[x("span",null,v(e.title||"ğŸ“„ è¯¥é¡¹ç›®çš„ç”Ÿæˆæ–‡ä»¶"),1),g(p,{type:"info"},{default:w(()=>[...f[6]||(f[6]=[I("å†å²æ–‡ä»¶",-1)])]),_:1})])])]),default:w(()=>[x("div",ue,[g(m,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(h(),F(Z,{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):_("",!0),g(j,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:w(()=>[g(b,{label:"æ–‡ä»¶å"},{default:w(()=>[I(v(n(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),g(b,{label:"ä¸‹è½½åœ°å€"},{default:w(()=>[g(k,{href:e.currentFile.downloadUrl,type:"primary"},{default:w(()=>[I(v(n(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),x("div",fe,[e.showEditorOpen?(h(),F(H,{key:0,type:"primary",size:"large",onClick:f[0]||(f[0]=t=>u.$emit("openInEditor",e.currentFile))},{default:w(()=>[g(C,null,{default:w(()=>[g(E(r))]),_:1}),f[7]||(f[7]=I(" åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ",-1))]),_:1})):_("",!0),g(H,{type:"primary",size:"large",icon:E(o),onClick:f[1]||(f[1]=t=>u.$emit("preview",e.currentFile))},{default:w(()=>[...f[8]||(f[8]=[I(" é¢„è§ˆWord ",-1)])]),_:1},8,["icon"]),g(H,{type:"success",size:"large",icon:E(c),onClick:f[2]||(f[2]=t=>u.$emit("download",e.currentFile))},{default:w(()=>[...f[9]||(f[9]=[I(" ä¸‹è½½ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(h(),F(H,{key:1,size:"large",icon:E(d),onClick:f[3]||(f[3]=e=>u.$emit("regenerate"))},{default:w(()=>[...f[10]||(f[10]=[I(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])):_("",!0)])])]),_:1})):_("",!0),e.historyFiles.length>0?(h(),F(A,{key:1,modelValue:t.value,"onUpdate:modelValue":f[5]||(f[5]=e=>t.value=e),class:"history-collapse"},{default:w(()=>[g(N,{name:"history"},{title:w(()=>[x("div",pe,[x("span",null,"ğŸ“‚ æŸ¥çœ‹æ‰€æœ‰å†å²å¤„ç†æ–‡ä»¶ ("+v(e.historyFiles.length)+")",1),t.value.includes("history")?(h(),F(H,{key:0,type:"primary",size:"small",loading:e.loading,onClick:f[4]||(f[4]=$(e=>u.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:w(()=>[...f[11]||(f[11]=[I(" åˆ·æ–°åˆ—è¡¨ ",-1)])]),_:1},8,["loading"])):_("",!0)])]),default:w(()=>[g(R,{shadow:"never",style:{border:"none"}},{default:w(()=>[z((h(),F(q,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:w(()=>[g(L,{type:"index",label:"åºå·",width:"60"}),g(L,{prop:"filename",label:"æ–‡ä»¶å","min-width":"300"},{default:w(({row:e})=>[x("div",me,[g(C,null,{default:w(()=>[g(E(s))]),_:1}),x("span",null,v(e.filename),1)])]),_:1}),g(L,{prop:"size",label:"æ–‡ä»¶å¤§å°",width:"120"},{default:w(({row:e})=>[I(v(E(J)(e.size)),1)]),_:1}),g(L,{prop:"process_time",label:"å¤„ç†æ—¶é—´",width:"180"},{default:w(({row:e})=>[I(v(E(G)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),g(L,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:w(({row:e})=>[g(H,{type:"primary",size:"small",onClick:t=>u.$emit("preview",e)},{default:w(()=>[...f[12]||(f[12]=[I(" é¢„è§ˆ ",-1)])]),_:1},8,["onClick"]),g(H,{type:"success",size:"small",onClick:t=>u.$emit("download",e)},{default:w(()=>[...f[13]||(f[13]=[I(" ä¸‹è½½ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,e.loading]]),e.loading||0!==e.historyFiles.length?_("",!0):(h(),F(K,{key:0,description:"æš‚æ— å†å²æ–‡ä»¶","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):_("",!0)])}}}),[["__scopeId","data-v-6814751e"]]);async function he(e,t){if("string"!=typeof e){const a=URL.createObjectURL(e),s=document.createElement("a");return s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),void URL.revokeObjectURL(a)}try{const a=await fetch(e);if(!a.ok){const e=a.headers.get("content-type");if(e&&e.includes("application/json")){const e=await a.json();throw new Error(e.error||e.message||"æ–‡ä»¶ä¸‹è½½å¤±è´¥")}throw new Error(`æ–‡ä»¶ä¸‹è½½å¤±è´¥: HTTP ${a.status}`)}const s=a.headers.get("content-type");if(s&&(s.includes("text/html")||s.includes("application/json")))throw new Error("æœåŠ¡å™¨è¿”å›äº†é”™è¯¯é¡µé¢ï¼Œè€Œä¸æ˜¯æ–‡ä»¶");const l=await a.blob(),i=URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}catch(a){throw a}}export{re as H,Z as S,ye as a,he as d,q as u};
