import{f as e,I as a,G as l,g as t,j as i,ai as n,t as o,u as s,W as u,c as d,D as r,aj as c,v as p,ak as _,F as m,_ as f,al as v,X as y,$ as g,am as h,P as k,k as b,an as w,a as V,a8 as z,ao as x,ap as q,aq as C,K as I,i as U,J as D,O as E,ar as j,U as $,af as M,as as P,at as F,T}from"./element-plus-ZLeSHaWT.js";import{v as S,r as R,w as O,x as N,O as B,u as Q,F as L,K as J,y as G,c as A,E as W,B as Y,J as K,L as H,I as X,M as Z,aa as ee,H as ae,j as le,aJ as te,aP as ie}from"./vue-core-CiAVTOOY.js";import{L as ne}from"./Loading-BvtdKuLc.js";/* empty css                                                                          */import"./vendor-ZqVwfHSb.js";import"./umo-editor-zkeZL3VF.js";/* empty css                                                                        */import"./utils-CTJnFPw-.js";import{a as oe,_ as se}from"./index.js";import{c as ue}from"./company-DX6fQVXW.js";import{C as de}from"./Card-Dwkx9QfB.js";import{D as re}from"./DocumentUploader-CIZaBxgJ.js";import"./imageCompressor-CTkRt5bg.js";const ce={class:"basic-info-tab"},pe=se(S({__name:"BasicInfoTab",props:{companyId:{},companyData:{}},emits:["update"],setup(p,{emit:_}){const m=p,f=_,{success:v,error:y}=oe(),g=R(),h=R(!1),k=R({company_name:"",establish_date:"",legal_representative:"",legal_representative_position:"",legal_representative_gender:"",legal_representative_age:void 0,social_credit_code:"",registered_capital:"",company_type:"",registered_address:"",fixed_phone:"",fax:"",postal_code:"",email:"",business_scope:"",description:""}),b={company_name:[{required:!0,message:"请输入企业名称",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],postal_code:[{pattern:/^\d{6}$/,message:"邮政编码必须是6位数字",trigger:"blur"}]};O(()=>m.companyData,e=>{e&&(k.value={company_name:e.company_name||"",establish_date:e.establish_date||"",legal_representative:e.legal_representative||"",legal_representative_position:e.legal_representative_position||"",legal_representative_gender:e.legal_representative_gender||"",legal_representative_age:e.legal_representative_age||void 0,social_credit_code:e.social_credit_code||"",registered_capital:e.registered_capital||"",company_type:e.company_type||"",registered_address:e.registered_address||"",fixed_phone:e.fixed_phone||"",fax:e.fax||"",postal_code:e.postal_code||"",email:e.email||"",business_scope:e.business_scope||"",description:e.description||""})},{immediate:!0,deep:!0});const w=async()=>{g.value&&await g.value.validate(async e=>{if(e){h.value=!0;try{(await ue.updateCompany(m.companyId,{companyName:k.value.company_name,establishDate:k.value.establish_date,legalRepresentative:k.value.legal_representative,legalRepresentativePosition:k.value.legal_representative_position,legalRepresentativeGender:k.value.legal_representative_gender,legalRepresentativeAge:k.value.legal_representative_age,socialCreditCode:k.value.social_credit_code,registeredCapital:k.value.registered_capital,companyType:k.value.company_type,registeredAddress:k.value.registered_address,fixedPhone:k.value.fixed_phone,fax:k.value.fax,postalCode:k.value.postal_code,email:k.value.email,businessScope:k.value.business_scope,companyDescription:k.value.description})).success&&(v("保存成功","基础信息已更新"),f("update"))}catch(a){y("保存失败",a instanceof Error?a.message:"未知错误")}finally{h.value=!1}}})};return(p,_)=>{const m=i,f=t,v=l,y=n,V=a,z=s,x=o,q=u,C=r,I=d,U=e;return G(),N("div",ce,[B(Q(de),{title:"基础信息"},{default:L(()=>[B(U,{ref_key:"formRef",ref:g,model:k.value,rules:b,"label-width":"140px",class:"basic-form"},{default:L(()=>[B(V,{gutter:20},{default:L(()=>[B(v,{span:12},{default:L(()=>[B(f,{label:"企业名称",prop:"company_name"},{default:L(()=>[B(m,{modelValue:k.value.company_name,"onUpdate:modelValue":_[0]||(_[0]=e=>k.value.company_name=e),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1})]),_:1}),B(v,{span:12},{default:L(()=>[B(f,{label:"成立日期",prop:"establish_date"},{default:L(()=>[B(y,{modelValue:k.value.establish_date,"onUpdate:modelValue":_[1]||(_[1]=e=>k.value.establish_date=e),type:"date",placeholder:"选择日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,{gutter:20},{default:L(()=>[B(v,{span:12},{default:L(()=>[B(f,{label:"法定代表人",prop:"legal_representative"},{default:L(()=>[B(m,{modelValue:k.value.legal_representative,"onUpdate:modelValue":_[2]||(_[2]=e=>k.value.legal_representative=e),placeholder:"请输入法定代表人"},null,8,["modelValue"])]),_:1})]),_:1}),B(v,{span:12},{default:L(()=>[B(f,{label:"法定代表人职务",prop:"legal_representative_position"},{default:L(()=>[B(m,{modelValue:k.value.legal_representative_position,"onUpdate:modelValue":_[3]||(_[3]=e=>k.value.legal_representative_position=e),placeholder:"请输入职务"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,{gutter:20},{default:L(()=>[B(v,{span:12},{default:L(()=>[B(f,{label:"法定代表人性别",prop:"legal_representative_gender"},{default:L(()=>[B(x,{modelValue:k.value.legal_representative_gender,"onUpdate:modelValue":_[4]||(_[4]=e=>k.value.legal_representative_gender=e),placeholder:"请选择性别",style:{width:"100%"}},{default:L(()=>[B(z,{label:"男",value:"男"}),B(z,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),B(v,{span:12},{default:L(()=>[B(f,{label:"法定代表人年龄",prop:"legal_representative_age"},{default:L(()=>[B(q,{modelValue:k.value.legal_representative_age,"onUpdate:modelValue":_[5]||(_[5]=e=>k.value.legal_representative_age=e),min:18,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,{gutter:20},{default:L(()=>[B(v,{span:12},{default:L(()=>[B(f,{label:"统一社会信用代码",prop:"social_credit_code"},{default:L(()=>[B(m,{modelValue:k.value.social_credit_code,"onUpdate:modelValue":_[6]||(_[6]=e=>k.value.social_credit_code=e),placeholder:"请输入统一社会信用代码"},null,8,["modelValue"])]),_:1})]),_:1}),B(v,{span:12},{default:L(()=>[B(f,{label:"注册资本",prop:"registered_capital"},{default:L(()=>[B(m,{modelValue:k.value.registered_capital,"onUpdate:modelValue":_[7]||(_[7]=e=>k.value.registered_capital=e),placeholder:"如：1000万元"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,{gutter:20},{default:L(()=>[B(v,{span:12},{default:L(()=>[B(f,{label:"企业类型",prop:"company_type"},{default:L(()=>[B(m,{modelValue:k.value.company_type,"onUpdate:modelValue":_[8]||(_[8]=e=>k.value.company_type=e),placeholder:"如：有限责任公司"},null,8,["modelValue"])]),_:1})]),_:1}),B(v,{span:12},{default:L(()=>[B(f,{label:"注册地址",prop:"registered_address"},{default:L(()=>[B(m,{modelValue:k.value.registered_address,"onUpdate:modelValue":_[9]||(_[9]=e=>k.value.registered_address=e),placeholder:"请输入注册地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,{gutter:20},{default:L(()=>[B(v,{span:12},{default:L(()=>[B(f,{label:"联系电话",prop:"fixed_phone"},{default:L(()=>[B(m,{modelValue:k.value.fixed_phone,"onUpdate:modelValue":_[10]||(_[10]=e=>k.value.fixed_phone=e),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),B(v,{span:12},{default:L(()=>[B(f,{label:"传真",prop:"fax"},{default:L(()=>[B(m,{modelValue:k.value.fax,"onUpdate:modelValue":_[11]||(_[11]=e=>k.value.fax=e),placeholder:"请输入传真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,{gutter:20},{default:L(()=>[B(v,{span:12},{default:L(()=>[B(f,{label:"邮政编码",prop:"postal_code"},{default:L(()=>[B(m,{modelValue:k.value.postal_code,"onUpdate:modelValue":_[12]||(_[12]=e=>k.value.postal_code=e),placeholder:"请输入邮政编码",maxlength:"6"},null,8,["modelValue"])]),_:1})]),_:1}),B(v,{span:12},{default:L(()=>[B(f,{label:"电子邮箱",prop:"email"},{default:L(()=>[B(m,{modelValue:k.value.email,"onUpdate:modelValue":_[13]||(_[13]=e=>k.value.email=e),placeholder:"请输入电子邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,null,{default:L(()=>[B(v,{span:24},{default:L(()=>[B(f,{label:"经营范围",prop:"business_scope"},{default:L(()=>[B(m,{modelValue:k.value.business_scope,"onUpdate:modelValue":_[14]||(_[14]=e=>k.value.business_scope=e),type:"textarea",rows:5,placeholder:"请输入经营范围"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,null,{default:L(()=>[B(v,{span:24},{default:L(()=>[B(f,{label:"企业简介",prop:"description"},{default:L(()=>[B(m,{modelValue:k.value.description,"onUpdate:modelValue":_[15]||(_[15]=e=>k.value.description=e),type:"textarea",rows:5,placeholder:"请输入企业简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(V,null,{default:L(()=>[B(v,{span:24},{default:L(()=>[B(f,null,{default:L(()=>[B(I,{type:"primary",loading:h.value,onClick:w},{default:L(()=>[B(C,null,{default:L(()=>[B(Q(c))]),_:1}),_[16]||(_[16]=J(" 保存基础信息 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),[["__scopeId","data-v-cf1705e1"]]),_e={class:"card-header"},me={class:"qual-info"},fe={class:"qual-name"},ve={class:"badges"},ye={key:0,class:"file-status"},ge={key:0,class:"single-file"},he={class:"file-item"},ke={class:"file-details"},be={class:"file-name"},we={class:"file-meta"},Ve={class:"file-actions"},ze={key:1,class:"multiple-files"},xe={class:"file-details"},qe={class:"file-name"},Ce={class:"file-meta"},Ie={class:"file-actions"},Ue={key:1,class:"no-file"},De={class:"card-footer"},Ee={class:"upload-section"},je={class:"upload-tips"},$e=se(S({__name:"QualificationCard",props:{qualification:{},fileInfo:{},isCustom:{type:Boolean},onUpload:{type:Function},companyName:{}},emits:["upload","download","delete","remove-custom"],setup(e,{emit:a}){const l=e,t=a,i=R(),n=A(()=>!!l.fileInfo&&(l.fileInfo.allow_multiple_files?l.fileInfo.files&&l.fileInfo.files.length>0:!!l.fileInfo.original_filename)),o=A(()=>{var e,a;return(null==(e=l.fileInfo)?void 0:e.allow_multiple_files)&&(null==(a=l.fileInfo)?void 0:a.files)}),s=A(()=>"financial_audit_report"===l.qualification.key?".pdf,.xls,.xlsx,.jpg,.jpeg,.png":".pdf,.jpg,.jpeg,.png"),u=A(()=>{const e=l.qualification.key;return"business_license"===e?"license":e.includes("id")||"legal_id_front"===e||"legal_id_back"===e?"id_card":e.includes("seal")?"seal":e.includes("iso")||e.includes("cmmi")||e.includes("certificate")||e.includes("qualification")||e.includes("认证")?"qualification":"default"}),c=async e=>{const{file:a,onSuccess:i,onError:n}=e;try{l.onUpload?await l.onUpload(a):t("upload",a),i({success:!0})}catch(o){n(o)}},w=()=>{t("download",l.qualification.key)},V=()=>{t("delete",l.qualification.key)},z=e=>{if(!e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["B","KB","MB","GB"][a]},x=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},q={dishonest_executor:"https://zxgk.court.gov.cn/shixin/",tax_violation_check:"https://www.creditchina.gov.cn/zhuanxiangchaxun/zhongdashuishouweifaanjian/",gov_procurement_creditchina:"https://www.creditchina.gov.cn/zhuanxiangchaxun/zhengfucaigouyanzhongweifashixinmingdan/",creditchina_blacklist:"https://www.creditchina.gov.cn/xinxigongshi/shixinheimingdan/",creditchina_credit_report:"https://www.creditchina.gov.cn/xybgxzzn/",enterprise_credit_report:"https://www.gsxt.gov.cn/",gov_procurement_ccgp:"http://www.ccgp.gov.cn/search/cr/"},C=A(()=>l.qualification.key in q),I=()=>{const e=q[l.qualification.key];e&&(window.open(e,"_blank"),b.success("已在新窗口打开查询网站,请手动查询后截图上传"))};return(a,b)=>{const q=r,U=p,D=d,E=y,j=k;return G(),W(j,{class:ae(["qualification-card",{required:e.qualification.required,"has-file":n.value}])},{default:L(()=>[Y("div",_e,[Y("div",me,[B(q,{class:"qual-icon",size:20},{default:L(()=>[(G(),W(K(e.qualification.icon)))]),_:1}),Y("span",fe,H(e.qualification.name),1)]),Y("div",ve,[e.qualification.required?(G(),W(U,{key:0,type:"warning",size:"small"},{default:L(()=>[...b[1]||(b[1]=[J("必需",-1)])]),_:1})):X("",!0),e.qualification.allowMultiple?(G(),W(U,{key:1,type:"info",size:"small"},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(_))]),_:1}),b[2]||(b[2]=J(" 多文件 ",-1))]),_:1})):X("",!0)])]),n.value?(G(),N("div",ye,[o.value?(G(),N("div",ze,[(G(!0),N(Z,null,ee(e.fileInfo.files,e=>(G(),N("div",{key:e.qualification_id,class:"file-item"},[B(q,{class:"file-icon"},{default:L(()=>[B(Q(m))]),_:1}),Y("div",xe,[Y("div",qe,H(e.original_filename),1),Y("div",Ce,[Y("span",null,H(z(e.file_size)),1),b[4]||(b[4]=Y("span",{class:"divider"},"•",-1)),Y("span",null,H(x(e.upload_time)),1)])]),Y("div",Ie,[B(D,{text:"",type:"primary",size:"small",onClick:a=>{return i=e.qualification_id,void t("download",l.qualification.key,i);var i}},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(f))]),_:1})]),_:1},8,["onClick"]),B(D,{text:"",type:"danger",size:"small",onClick:a=>{return i=e.qualification_id,void t("delete",l.qualification.key,i);var i}},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(v))]),_:1})]),_:1},8,["onClick"])])]))),128))])):(G(),N("div",ge,[Y("div",he,[B(q,{class:"file-icon"},{default:L(()=>[B(Q(m))]),_:1}),Y("div",ke,[Y("div",be,H(e.fileInfo.original_filename),1),Y("div",we,[Y("span",null,H(z(e.fileInfo.file_size)),1),b[3]||(b[3]=Y("span",{class:"divider"},"•",-1)),Y("span",null,H(x(e.fileInfo.upload_time)),1)])]),Y("div",Ve,[B(D,{text:"",type:"primary",size:"small",onClick:w},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(f))]),_:1})]),_:1}),B(D,{text:"",type:"danger",size:"small",onClick:V},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(v))]),_:1})]),_:1})])])]))])):(G(),N("div",Ue,[B(E,{type:"info",size:"small"},{default:L(()=>[...b[5]||(b[5]=[J("未上传文件",-1)])]),_:1})])),Y("div",De,[Y("div",Ee,[B(Q(re),{ref_key:"uploaderRef",ref:i,accept:s.value,multiple:e.qualification.allowMultiple,"show-file-list":!1,"http-request":c,"max-size":20,"auto-compress-image":!0,"image-type":u.value},{trigger:L(()=>[B(D,{type:"primary",size:"small"},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(g))]),_:1}),J(" "+H(e.qualification.allowMultiple?"批量上传":"上传文件"),1)]),_:1})]),_:1},8,["accept","multiple","image-type"]),C.value?(G(),W(D,{key:0,type:"success",size:"small",onClick:I},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(h))]),_:1}),b[6]||(b[6]=J(" 打开查询网站 ",-1))]),_:1})):X("",!0),e.isCustom?(G(),W(D,{key:1,type:"danger",size:"small",onClick:b[0]||(b[0]=e=>a.$emit("remove-custom"))},{default:L(()=>[B(q,null,{default:L(()=>[B(Q(v))]),_:1}),b[7]||(b[7]=J(" 移除 ",-1))]),_:1})):X("",!0)]),Y("div",je,[B(E,{type:"info",size:"small"},{default:L(()=>[...b[8]||(b[8]=[J(" 支持JPG、PNG、PDF格式 ",-1),Y("span",{class:"pdf-tip"},"（PDF将自动转换为图片）",-1)])]),_:1})])])]),_:1},8,["class"])}}}),[["__scopeId","data-v-098392f4"]]),Me={class:"qualification-tab"},Pe={key:1},Fe={class:"qualification-category"},Te={class:"category-title text-secondary"},Se=se(S({__name:"QualificationTab",props:{companyId:{},companyData:{}},emits:["update"],setup(n,{emit:o}){const s=n,u=o,{success:c,error:p}=oe(),_=R(!1),m=R({}),f=R([]),v=R(!1),y=R({name:""}),g=[{key:"basic",name:"基本证件资质",color:"primary"},{key:"iso",name:"ISO体系认证",color:"success"},{key:"credit",name:"信用资质证明",color:"info"},{key:"industry",name:"行业专业资质",color:"danger"}],h=[{key:"business_license",name:"营业执照",icon:"Document",category:"basic",required:!0},{key:"legal_id_front",name:"法人身份证(正面)",icon:"CreditCard",category:"basic",required:!0},{key:"legal_id_back",name:"法人身份证(反面)",icon:"CreditCard",category:"basic",required:!0},{key:"iso9001",name:"ISO 9001质量管理体系认证",icon:"Medal",category:"iso"},{key:"iso14001",name:"ISO 14001环境管理体系认证",icon:"Medal",category:"iso"},{key:"iso27001",name:"ISO 27001信息安全管理体系认证",icon:"Lock",category:"iso"},{key:"iso20000",name:"ISO 20000 IT服务管理体系认证",icon:"Monitor",category:"iso"},{key:"dishonest_executor",name:"失信被执行人名单（信用中国）",icon:"WarningFilled",category:"credit"},{key:"tax_violation_check",name:"重大税收违法失信主体（信用中国）",icon:"WarningFilled",category:"credit"},{key:"gov_procurement_creditchina",name:"政府采购严重违法失信行为（信用中国）",icon:"Flag",category:"credit"},{key:"creditchina_blacklist",name:"严重失信主体（信用中国）",icon:"WarnTriangleFilled",category:"credit"},{key:"creditchina_credit_report",name:"信用报告（信用中国）",icon:"DocumentChecked",category:"credit"},{key:"enterprise_credit_report",name:"国家企业信用信息公示系统信息报告",icon:"Tickets",category:"credit"},{key:"gov_procurement_ccgp",name:"政府采购严重违法失信行为信息记录（政府采购网）",icon:"CircleCheck",category:"credit"},{key:"basic_telecom_permit",name:"基础电信业务许可证",icon:"PhoneFilled",category:"industry"},{key:"value_added_telecom_permit",name:"增值电信业务许可证",icon:"PhoneFilled",category:"industry"},{key:"software_copyright",name:"软件著作权登记证书",icon:"Document",category:"industry",allowMultiple:!0},{key:"patent_certificate",name:"专利证书",icon:"TrophyBase",category:"industry",allowMultiple:!0},{key:"high_tech",name:"高新技术企业证书",icon:"Star",category:"industry"},{key:"software_enterprise",name:"软件企业认定证书",icon:"Monitor",category:"industry"},{key:"cmmi",name:"CMMI成熟度等级证书",icon:"Trophy",category:"industry"}],k=async()=>{_.value=!0;try{const e=await ue.getCompanyQualifications(s.companyId);e.success&&e.data&&(m.value=e.data)}catch(e){p("加载失败",e instanceof Error?e.message:"未知错误")}finally{_.value=!1}},b=e=>a=>(async(e,a)=>{const l=h.find(a=>a.key===e)||f.value.find(a=>a.key===e);try{const t=await ue.uploadQualification(s.companyId,e,a,{});if(!t.success)throw new Error(t.message||"上传失败");c("上传成功",`${(null==l?void 0:l.name)||"资质文件"}上传成功`),await k(),u("update")}catch(t){const e=t instanceof Error?t.message:"未知错误";throw p("上传失败",e),t}})(e,a),x=async(e,a)=>{try{a?await ue.downloadQualification(a,""):window.open(`/api/companies/${s.companyId}/qualifications/${e}/download`)}catch(l){p("下载失败",l instanceof Error?l.message:"未知错误")}},q=async(e,a)=>{try{if(!confirm("确定要删除此资质文件吗？"))return;if(a)await ue.deleteQualification(a);else{if(!(await fetch(`/api/companies/${s.companyId}/qualifications/${e}`,{method:"DELETE"})).ok)throw new Error("删除失败")}c("删除成功","资质文件已删除"),await k(),u("update")}catch(l){p("删除失败",l instanceof Error?l.message:"未知错误")}},C=()=>{y.value.name="",v.value=!0},I=()=>{if(!y.value.name.trim())return void p("错误","请输入资质名称");const e=`custom_${Date.now()}`;f.value.push({key:e,name:y.value.name.trim(),icon:"Document",category:"custom"}),v.value=!1,c("添加成功","自定义资质已添加")};return le(()=>{k()}),(o,s)=>{const u=r,p=l,k=a,U=d,D=i,E=t,j=e,$=V;return G(),N("div",Me,[B(Q(de),{title:"资质信息管理"},{default:L(()=>[_.value?(G(),W(Q(ne),{key:0,text:"加载资质信息..."})):(G(),N("div",Pe,[(G(),N(Z,null,ee(g,e=>Y("div",{key:e.key,class:"qualification-category"},[Y("h6",{class:ae(["category-title",`text-${e.color}`])},[B(u,null,{default:L(()=>[B(Q(z))]),_:1}),J(" "+H(e.name),1)],2),B(k,{gutter:16},{default:L(()=>{return[(G(!0),N(Z,null,ee((a=e.key,h.filter(e=>e.category===a)),e=>(G(),W(p,{key:e.key,span:12},{default:L(()=>{var a;return[B($e,{qualification:e,"file-info":m.value[e.key],"company-name":null==(a=n.companyData)?void 0:a.company_name,"on-upload":b(e.key),onDownload:x,onDelete:q},null,8,["qualification","file-info","company-name","on-upload"])]}),_:2},1024))),128))];var a}),_:2},1024)])),64)),Y("div",Fe,[Y("h6",Te,[B(u,null,{default:L(()=>[B(Q(w))]),_:1}),s[3]||(s[3]=J(" 自定义资质 ",-1))]),B(U,{type:"primary",onClick:C},{default:L(()=>[B(u,null,{default:L(()=>[B(Q(w))]),_:1}),s[4]||(s[4]=J(" 添加自定义资质 ",-1))]),_:1}),f.value.length>0?(G(),W(k,{key:0,gutter:16,class:"mt-3"},{default:L(()=>[(G(!0),N(Z,null,ee(f.value,(e,a)=>(G(),W(p,{key:e.key,span:12},{default:L(()=>[B($e,{qualification:e,"file-info":m.value[e.key],"is-custom":!0,"on-upload":b(e.key),onDownload:x,onDelete:q,onRemoveCustom:e=>(e=>{confirm("确定要移除此自定义资质吗？")&&(f.value.splice(e,1),c("移除成功","自定义资质已移除"))})(a)},null,8,["qualification","file-info","on-upload","onRemoveCustom"])]),_:2},1024))),128))]),_:1})):X("",!0)])]))]),_:1}),B($,{modelValue:v.value,"onUpdate:modelValue":s[2]||(s[2]=e=>v.value=e),title:"添加自定义资质",width:"400px"},{footer:L(()=>[B(U,{onClick:s[1]||(s[1]=e=>v.value=!1)},{default:L(()=>[...s[5]||(s[5]=[J("取消",-1)])]),_:1}),B(U,{type:"primary",onClick:I},{default:L(()=>[...s[6]||(s[6]=[J("确定",-1)])]),_:1})]),default:L(()=>[B(j,{model:y.value,"label-width":"100px"},{default:L(()=>[B(E,{label:"资质名称"},{default:L(()=>[B(D,{modelValue:y.value.name,"onUpdate:modelValue":s[0]||(s[0]=e=>y.value.name=e),placeholder:"请输入资质名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b01269c1"]]),Re={class:"personnel-tab"},Oe={class:"attachments-grid"},Ne={class:"attachment-item"},Be={class:"attachment-header"},Qe={key:0,class:"file-info"},Le={class:"file-name"},Je={class:"file-actions"},Ge={key:1,class:"no-file"},Ae={class:"attachment-item"},We={class:"attachment-header"},Ye={key:0,class:"file-info"},Ke={class:"file-name"},He={class:"file-actions"},Xe={key:1,class:"no-file"},Ze={class:"attachment-item"},ea={class:"attachment-header"},aa={key:0,class:"file-info"},la={class:"file-name"},ta={class:"file-actions"},ia={key:1,class:"no-file"},na={class:"attachment-item"},oa={class:"attachment-header"},sa={key:0,class:"file-info"},ua={class:"file-name"},da={class:"file-actions"},ra={key:1,class:"no-file"},ca=se(S({__name:"PersonnelTab",props:{companyId:{},companyData:{}},emits:["update"],setup(n,{emit:p}){const _=n,y=p,{success:h,error:k}=oe(),b=R(),w=R(!1),V=R({authorized_person_name:"",authorized_person_id:"",authorized_person_gender:"",authorized_person_age:void 0,authorized_person_position:"",authorized_person_title:""}),z=R({auth_id_front:null,auth_id_back:null,manager_resume:null,social_security:null}),I={authorized_person_id:[{pattern:/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/,message:"请输入正确的身份证号",trigger:"blur"}]};O(()=>_.companyData,e=>{e&&(V.value={authorized_person_name:e.authorized_person_name||"",authorized_person_id:e.authorized_person_id||"",authorized_person_gender:e.authorized_person_gender||"",authorized_person_age:e.authorized_person_age||void 0,authorized_person_position:e.authorized_person_position||"",authorized_person_title:e.authorized_person_title||""})},{immediate:!0,deep:!0});const U=async()=>{b.value&&await b.value.validate(async e=>{if(e){w.value=!0;try{(await ue.updateCompany(_.companyId,{authorizedPersonName:V.value.authorized_person_name,authorizedPersonId:V.value.authorized_person_id,authorizedPersonGender:V.value.authorized_person_gender,authorizedPersonAge:V.value.authorized_person_age,authorizedPersonPosition:V.value.authorized_person_position,authorizedPersonTitle:V.value.authorized_person_title})).success&&(h("保存成功","被授权人信息已更新"),y("update"))}catch(a){const e=(null==a?void 0:a.message)||(a instanceof Error?a.message:"未知错误");k("保存失败",e)}finally{w.value=!1}}})},D=e=>async a=>{const{file:l,onSuccess:t,onError:i}=a;try{const a=await ue.uploadQualification(_.companyId,e,l,{});if(!a.success)throw new Error(a.error||"上传失败");h("上传成功","附件上传成功"),$(),y("update"),t(a)}catch(n){const e=(null==n?void 0:n.message)||(n instanceof Error?n.message:"未知错误");k("上传失败",e),i(n)}},E=e=>{window.open(`/api/companies/${_.companyId}/qualifications/${e}/download`)},j=async e=>{if(confirm("确定要删除此附件吗？"))try{if(!(await fetch(`/api/companies/${_.companyId}/qualifications/${e}`,{method:"DELETE"})).ok)throw new Error("删除失败");h("删除成功","附件已删除"),$(),y("update")}catch(a){const e=(null==a?void 0:a.message)||(a instanceof Error?a.message:"未知错误");k("删除失败",e)}},$=async()=>{try{const e=await ue.getCompanyQualifications(_.companyId);if(e.success&&e.data){const a=e.data;z.value={auth_id_front:a.auth_id_front?{name:a.auth_id_front.original_filename}:null,auth_id_back:a.auth_id_back?{name:a.auth_id_back.original_filename}:null,manager_resume:a.manager_resume?{name:a.manager_resume.original_filename}:null,social_security:a.social_security?{name:a.social_security.original_filename}:null}}}catch(e){}};return le(()=>{$()}),(n,p)=>{const _=i,y=t,h=l,k=a,$=s,M=o,P=u,F=r,T=d,S=e;return G(),N("div",Re,[B(Q(de),{title:"被授权人基本信息"},{default:L(()=>[B(S,{ref_key:"formRef",ref:b,model:V.value,rules:I,"label-width":"140px",class:"personnel-form"},{default:L(()=>[B(k,{gutter:20},{default:L(()=>[B(h,{span:12},{default:L(()=>[B(y,{label:"姓名",prop:"authorized_person_name"},{default:L(()=>[B(_,{modelValue:V.value.authorized_person_name,"onUpdate:modelValue":p[0]||(p[0]=e=>V.value.authorized_person_name=e),placeholder:"请输入被授权人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),B(h,{span:12},{default:L(()=>[B(y,{label:"身份证号",prop:"authorized_person_id"},{default:L(()=>[B(_,{modelValue:V.value.authorized_person_id,"onUpdate:modelValue":p[1]||(p[1]=e=>V.value.authorized_person_id=e),placeholder:"请输入身份证号",maxlength:"18"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(k,{gutter:20},{default:L(()=>[B(h,{span:12},{default:L(()=>[B(y,{label:"性别",prop:"authorized_person_gender"},{default:L(()=>[B(M,{modelValue:V.value.authorized_person_gender,"onUpdate:modelValue":p[2]||(p[2]=e=>V.value.authorized_person_gender=e),placeholder:"请选择性别",style:{width:"100%"}},{default:L(()=>[B($,{label:"男",value:"男"}),B($,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),B(h,{span:12},{default:L(()=>[B(y,{label:"年龄",prop:"authorized_person_age"},{default:L(()=>[B(P,{modelValue:V.value.authorized_person_age,"onUpdate:modelValue":p[3]||(p[3]=e=>V.value.authorized_person_age=e),min:18,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(k,{gutter:20},{default:L(()=>[B(h,{span:12},{default:L(()=>[B(y,{label:"职位",prop:"authorized_person_position"},{default:L(()=>[B(_,{modelValue:V.value.authorized_person_position,"onUpdate:modelValue":p[4]||(p[4]=e=>V.value.authorized_person_position=e),placeholder:"请输入职位"},null,8,["modelValue"])]),_:1})]),_:1}),B(h,{span:12},{default:L(()=>[B(y,{label:"职称",prop:"authorized_person_title"},{default:L(()=>[B(_,{modelValue:V.value.authorized_person_title,"onUpdate:modelValue":p[5]||(p[5]=e=>V.value.authorized_person_title=e),placeholder:"请输入职称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),B(k,null,{default:L(()=>[B(h,{span:24},{default:L(()=>[B(y,null,{default:L(()=>[B(T,{type:"primary",loading:w.value,onClick:U},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(c))]),_:1}),p[14]||(p[14]=J(" 保存被授权人信息 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),B(Q(de),{title:"相关附件",class:"mt-4"},{default:L(()=>[Y("div",Oe,[Y("div",Ne,[Y("div",Be,[B(F,{class:"icon"},{default:L(()=>[B(Q(x))]),_:1}),p[15]||(p[15]=Y("span",{class:"title"},"被授权人身份证（正面）",-1))]),z.value.auth_id_front?(G(),N("div",Qe,[B(F,{class:"file-icon"},{default:L(()=>[B(Q(m))]),_:1}),Y("span",Le,H(z.value.auth_id_front.name),1),Y("div",Je,[B(T,{text:"",type:"primary",size:"small",onClick:p[6]||(p[6]=e=>E("auth_id_front"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(f))]),_:1})]),_:1}),B(T,{text:"",type:"danger",size:"small",onClick:p[7]||(p[7]=e=>j("auth_id_front"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(v))]),_:1})]),_:1})])])):(G(),N("div",Ge,"未上传")),B(Q(re),{accept:".jpg,.jpeg,.png,.pdf","show-file-list":!1,"http-request":D("auth_id_front"),"auto-compress-image":!0,"image-type":"id_card","max-size":10},{trigger:L(()=>[B(T,{size:"small"},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(g))]),_:1}),p[16]||(p[16]=J(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),Y("div",Ae,[Y("div",We,[B(F,{class:"icon"},{default:L(()=>[B(Q(x))]),_:1}),p[17]||(p[17]=Y("span",{class:"title"},"被授权人身份证（反面）",-1))]),z.value.auth_id_back?(G(),N("div",Ye,[B(F,{class:"file-icon"},{default:L(()=>[B(Q(m))]),_:1}),Y("span",Ke,H(z.value.auth_id_back.name),1),Y("div",He,[B(T,{text:"",type:"primary",size:"small",onClick:p[8]||(p[8]=e=>E("auth_id_back"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(f))]),_:1})]),_:1}),B(T,{text:"",type:"danger",size:"small",onClick:p[9]||(p[9]=e=>j("auth_id_back"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(v))]),_:1})]),_:1})])])):(G(),N("div",Xe,"未上传")),B(Q(re),{accept:".jpg,.jpeg,.png,.pdf","show-file-list":!1,"http-request":D("auth_id_back"),"auto-compress-image":!0,"image-type":"id_card","max-size":10},{trigger:L(()=>[B(T,{size:"small"},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(g))]),_:1}),p[18]||(p[18]=J(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),Y("div",Ze,[Y("div",ea,[B(F,{class:"icon"},{default:L(()=>[B(Q(q))]),_:1}),p[19]||(p[19]=Y("span",{class:"title"},"项目经理简历",-1))]),z.value.manager_resume?(G(),N("div",aa,[B(F,{class:"file-icon"},{default:L(()=>[B(Q(m))]),_:1}),Y("span",la,H(z.value.manager_resume.name),1),Y("div",ta,[B(T,{text:"",type:"primary",size:"small",onClick:p[10]||(p[10]=e=>E("manager_resume"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(f))]),_:1})]),_:1}),B(T,{text:"",type:"danger",size:"small",onClick:p[11]||(p[11]=e=>j("manager_resume"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(v))]),_:1})]),_:1})])])):(G(),N("div",ia,"未上传")),B(Q(re),{accept:".pdf,.doc,.docx","show-file-list":!1,"http-request":D("manager_resume"),"auto-compress-image":!1,"max-size":20},{trigger:L(()=>[B(T,{size:"small"},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(g))]),_:1}),p[20]||(p[20]=J(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),Y("div",na,[Y("div",oa,[B(F,{class:"icon"},{default:L(()=>[B(Q(C))]),_:1}),p[21]||(p[21]=Y("span",{class:"title"},"社保证明",-1))]),z.value.social_security?(G(),N("div",sa,[B(F,{class:"file-icon"},{default:L(()=>[B(Q(m))]),_:1}),Y("span",ua,H(z.value.social_security.name),1),Y("div",da,[B(T,{text:"",type:"primary",size:"small",onClick:p[12]||(p[12]=e=>E("social_security"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(f))]),_:1})]),_:1}),B(T,{text:"",type:"danger",size:"small",onClick:p[13]||(p[13]=e=>j("social_security"))},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(v))]),_:1})]),_:1})])])):(G(),N("div",ra,"未上传")),B(Q(re),{accept:".pdf,.jpg,.jpeg,.png","show-file-list":!1,"http-request":D("social_security"),"auto-compress-image":!0,"image-type":"default","max-size":20},{trigger:L(()=>[B(T,{size:"small"},{default:L(()=>[B(F,null,{default:L(()=>[B(Q(g))]),_:1}),p[22]||(p[22]=J(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])])])]),_:1})])}}}),[["__scopeId","data-v-bc10a0da"]]),pa={class:"financial-tab"},_a={class:"shareholders-section"},ma={class:"section-header"},fa={class:"save-section"},va=se(S({__name:"FinancialTab",props:{companyId:{},companyData:{}},emits:["update"],setup(n,{emit:u}){const p=n,_=u,{success:f,error:v}=oe(),y=R(),g=R(),h=R(),k=R(),b=R(!1),z=R(!1),x=R([{key:"audit_report",name:"财务审计报告",icon:m,required:!1,allowMultiple:!0},{key:"taxpayer_certificate",name:"纳税人资格证明",icon:j,required:!1,allowMultiple:!1}]),q=R({}),C=R({bank_name:"",bank_account:""}),$=R({actual_controller:"",controlling_shareholder:""}),M=R({managing_unit_name:"",managed_unit_name:""}),P=R([]),F=R(-1),T=R(-1),S=R(!1),A=R(-1),K=R({name:"",type:"",ratio:""}),H={name:[{required:!0,message:"请输入股东名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],ratio:[{required:!0,message:"请输入出资比例",trigger:"blur"}]};O(()=>p.companyData,e=>{if(e){C.value={bank_name:e.bank_name||"",bank_account:e.bank_account||""},$.value={actual_controller:e.actual_controller||"",controlling_shareholder:e.controlling_shareholder||""},M.value={managing_unit_name:e.managing_unit_name||"",managed_unit_name:e.managed_unit_name||""};try{const a=e.shareholders_info;a?(P.value="string"==typeof a?JSON.parse(a):a,F.value=P.value.findIndex(e=>!0===e.is_controlling),T.value=P.value.findIndex(e=>!0===e.is_actual_controller)):(P.value=[],F.value=-1,T.value=-1)}catch(a){P.value=[],F.value=-1,T.value=-1}}},{immediate:!0,deep:!0});const X=()=>{A.value=-1,K.value={name:"",type:"",ratio:""},S.value=!0},ae=()=>{P.value.forEach(e=>{e.is_controlling=!1}),-1!==F.value&&(P.value[F.value].is_controlling=!0)},te=()=>{P.value.forEach(e=>{e.is_actual_controller=!1}),-1!==T.value&&(P.value[T.value].is_actual_controller=!0)},ie=async()=>{k.value&&await k.value.validate(e=>{if(e){if(-1===A.value)P.value.push({...K.value,is_controlling:!1,is_actual_controller:!1}),f("添加成功","股东已添加，请点击保存按钮保存更改");else{const e=P.value[A.value];P.value[A.value]={...K.value,is_controlling:e.is_controlling||!1,is_actual_controller:e.is_actual_controller||!1},f("编辑成功","股东信息已更新，请点击保存按钮保存更改")}S.value=!1}})},ne=async()=>{try{z.value=!0;const e=await ue.getCompanyQualifications(p.companyId);e.success&&(q.value=e.data||{})}catch(e){}finally{z.value=!1}},se=async(e,a)=>{try{let l;l=a?`/api/qualifications/${a}/download`:`/api/companies/${p.companyId}/qualifications/${e}/download`,window.open(l,"_blank")}catch(l){v("下载失败",l instanceof Error?l.message:"未知错误")}},re=async(e,a)=>{try{if(!confirm("确定要删除此资质文件吗？"))return;if(a)await ue.deleteQualification(a);else{if(!(await fetch(`/api/companies/${p.companyId}/qualifications/${e}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("删除失败")}f("删除成功","资质文件已删除"),await ne(),_("update")}catch(l){v("删除失败",l instanceof Error?l.message:"未知错误")}},ce=async()=>{b.value=!0;try{(await ue.updateCompany(p.companyId,{bank_name:C.value.bank_name,bank_account:C.value.bank_account,actual_controller:$.value.actual_controller,controlling_shareholder:$.value.controlling_shareholder,shareholders_info:JSON.stringify(P.value),managing_unit_name:M.value.managing_unit_name,managed_unit_name:M.value.managed_unit_name})).success&&(f("保存成功","财务信息已更新"),_("update"))}catch(e){v("保存失败",e instanceof Error?e.message:"未知错误")}finally{b.value=!1}};return le(()=>{ne()}),(n,u)=>{const m=l,z=a,j=i,R=t,O=e,le=r,oe=d,ue=I,pe=U,_e=D,me=E,fe=s,ve=o,ye=V;return G(),N("div",pa,[B(Q(de),{title:"财务资质文件",class:"mb-4"},{default:L(()=>[B(z,{gutter:20},{default:L(()=>[(G(!0),N(Z,null,ee(x.value,e=>(G(),W(m,{key:e.key,span:12},{default:L(()=>[B($e,{qualification:e,"file-info":q.value[e.key],onUpload:a=>(async(e,a)=>{try{const l=x.value.find(a=>a.key===e);let t=null;if(null==l?void 0:l.allowMultiple){if(t=prompt(`请输入 "${a.name}" 的年份:\n例如：2023、2024`),null===t)return;if(!t.trim())return void v("上传失败","年份不能为空")}const i=new FormData;i.append(`qualifications[${e}]`,a),i.append("qualification_names",JSON.stringify({[e]:(null==l?void 0:l.name)||e})),t&&i.append("file_versions",JSON.stringify({[e]:t.trim()}));const n=await fetch(`/api/companies/${p.companyId}/qualifications/upload`,{method:"POST",body:i,credentials:"include",headers:{}});if(!n.ok){const e=n.headers.get("content-type");if(e&&e.includes("application/json")){const e=await n.json();throw new Error(e.error||`服务器错误: ${n.status}`)}throw new Error(`上传失败: 服务器返回错误 ${n.status}`)}const o=await n.json();if(!o.success)throw new Error(o.error||"上传失败");f("上传成功",`${(null==l?void 0:l.name)||"资质文件"}上传成功`),await ne(),_("update")}catch(l){v("上传失败",l instanceof Error?l.message:"未知错误")}})(e.key,a),onDownload:se,onDelete:re},null,8,["qualification","file-info","onUpload"])]),_:2},1024))),128))]),_:1})]),_:1}),B(Q(de),{title:"银行账户信息"},{default:L(()=>[B(O,{ref_key:"bankFormRef",ref:y,model:C.value,"label-width":"140px",class:"bank-form"},{default:L(()=>[B(z,{gutter:20},{default:L(()=>[B(m,{span:12},{default:L(()=>[B(R,{label:"开户行全称"},{default:L(()=>[B(j,{modelValue:C.value.bank_name,"onUpdate:modelValue":u[0]||(u[0]=e=>C.value.bank_name=e),placeholder:"请输入开户行全称"},null,8,["modelValue"])]),_:1})]),_:1}),B(m,{span:12},{default:L(()=>[B(R,{label:"银行账号"},{default:L(()=>[B(j,{modelValue:C.value.bank_account,"onUpdate:modelValue":u[1]||(u[1]=e=>C.value.bank_account=e),placeholder:"请输入银行账号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),B(Q(de),{title:"股权结构信息",class:"mt-4"},{default:L(()=>[B(O,{ref_key:"equityFormRef",ref:g,model:$.value,"label-width":"140px",class:"equity-form"},{default:L(()=>[B(z,{gutter:20},{default:L(()=>[B(m,{span:12},{default:L(()=>[B(R,{label:"实际控制人"},{default:L(()=>[B(j,{modelValue:$.value.actual_controller,"onUpdate:modelValue":u[2]||(u[2]=e=>$.value.actual_controller=e),placeholder:"请输入实际控制人"},null,8,["modelValue"])]),_:1})]),_:1}),B(m,{span:12},{default:L(()=>[B(R,{label:"控股股东"},{default:L(()=>[B(j,{modelValue:$.value.controlling_shareholder,"onUpdate:modelValue":u[3]||(u[3]=e=>$.value.controlling_shareholder=e),placeholder:"请输入控股股东"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),Y("div",_a,[Y("div",ma,[u[14]||(u[14]=Y("h6",null,"股东/投资人列表",-1)),B(oe,{type:"primary",size:"small",onClick:X},{default:L(()=>[B(le,null,{default:L(()=>[B(Q(w))]),_:1}),u[13]||(u[13]=J(" 添加股东 ",-1))]),_:1})]),P.value.length>0?(G(),W(_e,{key:0,data:P.value,stripe:""},{default:L(()=>[B(ue,{prop:"name",label:"股东名称","min-width":"150"}),B(ue,{prop:"type",label:"类型",width:"100"}),B(ue,{prop:"ratio",label:"出资比例",width:"120"}),B(ue,{label:"控股股东",width:"100",align:"center"},{default:L(({$index:e})=>[B(pe,{modelValue:F.value,"onUpdate:modelValue":u[4]||(u[4]=e=>F.value=e),label:e,onChange:ae},{default:L(()=>[...u[15]||(u[15]=[Y("span",null,null,-1)])]),_:1},8,["modelValue","label"])]),_:1}),B(ue,{label:"实际控制人",width:"110",align:"center"},{default:L(({$index:e})=>[B(pe,{modelValue:T.value,"onUpdate:modelValue":u[5]||(u[5]=e=>T.value=e),label:e,onChange:te},{default:L(()=>[...u[16]||(u[16]=[Y("span",null,null,-1)])]),_:1},8,["modelValue","label"])]),_:1}),B(ue,{label:"操作",width:"150"},{default:L(({row:e,$index:a})=>[B(oe,{text:"",type:"primary",size:"small",onClick:e=>(e=>{A.value=e;const a=P.value[e];K.value={name:a.name,type:a.type,ratio:a.ratio},S.value=!0})(a)},{default:L(()=>[...u[17]||(u[17]=[J(" 编辑 ",-1)])]),_:1},8,["onClick"]),B(oe,{text:"",type:"danger",size:"small",onClick:e=>{return l=a,void(confirm("确定要删除此股东吗？")&&(l===F.value&&(F.value=-1),l===T.value&&(T.value=-1),P.value.splice(l,1),l<F.value&&F.value--,l<T.value&&T.value--,f("删除成功","股东已删除，请点击保存按钮保存更改")));var l}},{default:L(()=>[...u[18]||(u[18]=[J(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(G(),W(me,{key:1,description:"暂无股东信息","image-size":100}))])]),_:1}),B(Q(de),{title:"管理关系信息",class:"mt-4"},{default:L(()=>[B(O,{ref_key:"managementFormRef",ref:h,model:M.value,"label-width":"140px",class:"management-form"},{default:L(()=>[B(z,{gutter:20},{default:L(()=>[B(m,{span:12},{default:L(()=>[B(R,{label:"管理单位名称"},{default:L(()=>[B(j,{modelValue:M.value.managing_unit_name,"onUpdate:modelValue":u[6]||(u[6]=e=>M.value.managing_unit_name=e),placeholder:"如有管理单位请输入"},null,8,["modelValue"])]),_:1})]),_:1}),B(m,{span:12},{default:L(()=>[B(R,{label:"被管理单位名称"},{default:L(()=>[B(j,{modelValue:M.value.managed_unit_name,"onUpdate:modelValue":u[7]||(u[7]=e=>M.value.managed_unit_name=e),placeholder:"如有被管理单位请输入"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),Y("div",fa,[B(oe,{type:"primary",size:"large",loading:b.value,onClick:ce},{default:L(()=>[B(le,null,{default:L(()=>[B(Q(c))]),_:1}),u[19]||(u[19]=J(" 保存财务信息 ",-1))]),_:1},8,["loading"])]),B(ye,{modelValue:S.value,"onUpdate:modelValue":u[12]||(u[12]=e=>S.value=e),title:-1===A.value?"添加股东":"编辑股东",width:"500px"},{footer:L(()=>[B(oe,{onClick:u[11]||(u[11]=e=>S.value=!1)},{default:L(()=>[...u[20]||(u[20]=[J("取消",-1)])]),_:1}),B(oe,{type:"primary",onClick:ie},{default:L(()=>[...u[21]||(u[21]=[J("确定",-1)])]),_:1})]),default:L(()=>[B(O,{ref_key:"shareholderFormRef",ref:k,model:K.value,rules:H,"label-width":"100px"},{default:L(()=>[B(R,{label:"股东名称",prop:"name"},{default:L(()=>[B(j,{modelValue:K.value.name,"onUpdate:modelValue":u[8]||(u[8]=e=>K.value.name=e),placeholder:"请输入股东名称"},null,8,["modelValue"])]),_:1}),B(R,{label:"类型",prop:"type"},{default:L(()=>[B(ve,{modelValue:K.value.type,"onUpdate:modelValue":u[9]||(u[9]=e=>K.value.type=e),placeholder:"请选择类型",style:{width:"100%"}},{default:L(()=>[B(fe,{label:"企业",value:"企业"}),B(fe,{label:"自然人",value:"自然人"})]),_:1},8,["modelValue"])]),_:1}),B(R,{label:"出资比例",prop:"ratio"},{default:L(()=>[B(j,{modelValue:K.value.ratio,"onUpdate:modelValue":u[10]||(u[10]=e=>K.value.ratio=e),placeholder:"如：30%"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-5b1f60f2"]]),ya={class:"company-detail"},ga={class:"detail-header"},ha={class:"header-title"},ka={key:1,class:"detail-content"},ba={class:"tab-label"},wa={class:"tab-label"},Va={class:"tab-label"},za={class:"tab-label"},xa=se(S({__name:"CompanyDetail",setup(e){const a=te(),l=ie(),{error:t}=oe(),i=R(!1),n=R("basic"),o=R(0),s=R({}),u={technology:"科技",manufacturing:"制造业",finance:"金融",education:"教育",healthcare:"医疗",retail:"零售",construction:"建筑",other:"其他"},c=async()=>{i.value=!0;try{const e=await ue.getCompany(o.value);e.success&&e.data?s.value=e.data:(t("加载失败","无法获取企业信息"),f())}catch(e){t("加载失败",e instanceof Error?e.message:"未知错误"),f()}finally{i.value=!1}},_=e=>{},m=async()=>{await c()},f=()=>{l.push("/knowledge/company-library")};return le(()=>{const e=a.params.id;if(e){if(o.value=parseInt(e,10),isNaN(o.value))return t("参数错误","无效的企业ID"),void f();c()}else t("参数错误","缺少企业ID"),f()}),(e,a)=>{const l=d,t=p,c=r,v=$,y=T;return G(),N("div",ya,[Y("div",ga,[B(l,{onClick:f,icon:"ArrowLeft"},{default:L(()=>[...a[1]||(a[1]=[J("返回列表",-1)])]),_:1}),Y("div",ha,[Y("h2",null,H(s.value.company_name||"企业详情"),1),s.value.industry_type?(G(),W(t,{key:0,type:"info"},{default:L(()=>{return[J(H((e=s.value.industry_type,u[e]||e)),1)];var e}),_:1})):X("",!0)])]),i.value?(G(),W(Q(ne),{key:0,text:"加载企业信息中..."})):(G(),N("div",ka,[B(y,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),class:"company-tabs",onTabChange:_},{default:L(()=>[B(v,{name:"basic"},{label:L(()=>[Y("span",ba,[B(c,null,{default:L(()=>[B(Q(M))]),_:1}),a[2]||(a[2]=J(" 基础信息 ",-1))])]),default:L(()=>[B(pe,{"company-id":o.value,"company-data":s.value,onUpdate:m},null,8,["company-id","company-data"])]),_:1}),B(v,{name:"qualification"},{label:L(()=>[Y("span",wa,[B(c,null,{default:L(()=>[B(Q(P))]),_:1}),a[3]||(a[3]=J(" 资质信息 ",-1))])]),default:L(()=>[B(Se,{"company-id":o.value,"company-data":s.value,onUpdate:m},null,8,["company-id","company-data"])]),_:1}),B(v,{name:"personnel"},{label:L(()=>[Y("span",Va,[B(c,null,{default:L(()=>[B(Q(q))]),_:1}),a[4]||(a[4]=J(" 被授权人信息 ",-1))])]),default:L(()=>[B(ca,{"company-id":o.value,"company-data":s.value,onUpdate:m},null,8,["company-id","company-data"])]),_:1}),B(v,{name:"financial"},{label:L(()=>[Y("span",za,[B(c,null,{default:L(()=>[B(Q(F))]),_:1}),a[5]||(a[5]=J(" 财务信息 ",-1))])]),default:L(()=>[B(va,{"company-id":o.value,"company-data":s.value,onUpdate:m},null,8,["company-id","company-data"])]),_:1})]),_:1},8,["modelValue"])]))])}}}),[["__scopeId","data-v-8d9df7e4"]]);export{xa as default};
