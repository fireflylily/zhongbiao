import{E as e,n as a,q as t,r as s,s as l,t as o,o as i,v as r,x as u,_ as d}from"./index.js";/* empty css                                                                          *//* empty css                             */import{s as p}from"./imageCompressor-CTkRt5bg.js";import{E as c}from"./index-Nbhr9EpO.js";import{E as m}from"./index-JsWBjt7x.js";import{aw as n,am as f,an as g,aC as x,az as y,aE as v,aJ as _,aA as h,aI as w,aO as k,ay as z,aD as b,aF as j,aQ as F,aR as T}from"./editor-BnIwMfSr.js";const V={class:"document-uploader"},$={key:1,class:"upload-drag-area"},C={key:0,class:"upload-hint"},q={key:0,class:"upload-tip"},B={class:"upload-file-item"},D={class:"file-name"},E=d(n({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(d,{expose:n,emit:E}){const I=d,L=E,R=f(),S=g({get:()=>I.modelValue||[],set:e=>L("update:modelValue",e)}),H=async a=>{var t;if(I.maxSize&&a.size/1024/1024>I.maxSize)return e.error(`文件大小不能超过 ${I.maxSize}MB`),!1;if(I.accept){const s=I.accept.split(",").map(e=>e.trim()),l="."+(null==(t=a.name.split(".").pop())?void 0:t.toLowerCase());if(!s.some(e=>l===e.toLowerCase()))return e.error(`不支持的文件格式：${l}`),!1}if(I.autoCompressImage&&a.type.startsWith("image/"))try{const e=await p(a,I.imageType),t=a.size,s=e.size;((t-s)/t*100).toFixed(1);if(s<t)return e}catch(s){e.warning("图片压缩失败，将上传原文件")}return!0},U=(e,a,t)=>{},A=(e,a,t)=>{L("success",a,t),L("update:modelValue",t)},J=(a,t,s)=>{e.error("文件上传失败："+a.message),L("error",a,t,s)},M=(a,t)=>{e.warning(`最多只能上传 ${I.limit} 个文件`),L("exceed",a,t)},O=(e,a)=>{L("remove",e,a),L("update:modelValue",a)};return n({clearFiles:()=>{var e;null==(e=R.value)||e.clearFiles(),L("update:modelValue",[])},submit:()=>{var e;null==(e=R.value)||e.submit()},abort:e=>{var a;null==(a=R.value)||a.abort(e)}}),(e,p)=>{const n=i,f=a,g=m,E=c;return y(),x("div",V,[v(E,_({ref_key:"uploadRef",ref:R,action:d.uploadUrl,"http-request":d.httpRequest,headers:d.uploadHeaders,data:d.uploadData,accept:d.accept,limit:d.limit,multiple:d.multiple,drag:d.drag,"show-file-list":d.showFileList,"before-upload":H,"on-progress":U,"on-success":A,"on-error":J,"on-exceed":M,"on-remove":O,"file-list":S.value},e.$attrs),{default:h(()=>[w(e.$slots,"trigger",{},()=>[d.drag?(y(),x("div",$,[v(f,{class:"upload-icon"},{default:h(()=>[v(j(u))]),_:1}),p[0]||(p[0]=k("div",{class:"upload-text"},[T(" 将文件拖到此处，或"),k("em",null,"点击上传")],-1)),d.accept?(y(),x("div",C," 支持的文件格式："+F(d.accept),1)):b("",!0)])):(y(),z(n,{key:0,type:"primary",icon:j(r)},{default:h(()=>[T(F(d.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:h(()=>[w(e.$slots,"tip",{},()=>[d.tipText?(y(),x("div",q,[v(f,null,{default:h(()=>[v(j(o))]),_:1}),T(" "+F(d.tipText),1)])):b("",!0)],!0)]),file:h(({file:a})=>[w(e.$slots,"file",{file:a},()=>[k("div",B,[v(f,{class:"file-icon"},{default:h(()=>[v(j(t))]),_:1}),k("span",D,F(a.name),1),"uploading"===a.status?(y(),z(g,{key:0,percentage:a.percentage,"stroke-width":2},null,8,["percentage"])):b("",!0),"success"===a.status?(y(),z(f,{key:1,class:"status-icon success"},{default:h(()=>[v(j(s))]),_:1})):b("",!0),"fail"===a.status?(y(),z(f,{key:2,class:"status-icon error"},{default:h(()=>[v(j(l))]),_:1})):b("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),[["__scopeId","data-v-ddbb8fd4"]]);export{E as D};
