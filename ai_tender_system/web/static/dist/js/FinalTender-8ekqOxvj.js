import{T as e,a1 as l,p as s,u as a,bs as t,a2 as i,at as o,w as u,b1 as c,q as n,n as r,Q as d,bt as p,E as v,J as m,_ as f,aX as _,r as b}from"./index.js";/* empty css                *//* empty css                                                                          *//* empty css               */import{E as y,a as h}from"./el-select-Bw7Pegjc.js";/* empty css                     */import{L as k}from"./Loading-CEGs33jV.js";import{P as g}from"./PageHeader-DuASSBzc.js";/* empty css                                                                        */import{ap as j,av as x,ar as w,aq as z,aJ as V,ax as F,az as I,bC as C,am as P,aW as U,aH as E,bU as $,aM as D,aU as R,aV as S,at as q,aN as N,cc as T,an as B,au as L,aR as W,aQ as J,as as M}from"./editor-CW41Mq4b.js";/* empty css                             *//* empty css                   *//* empty css                *//* empty css                    *//* empty css                */import{E as O}from"./strings-CI1rj266.js";import{E as H}from"./index-BUf4NCen.js";import{E as Q}from"./index-Du5-dQS0.js";import{E as A,a as K}from"./index-CdDG5CTk.js";import{E as X}from"./index-Ch33NOwD.js";import{u as Y}from"./useProjectDocuments-DSeiu0Z1.js";import{u as G}from"./project-MZH6Q0oi.js";import{E as Z}from"./index-CqpIP0RU.js";import{E as ee}from"./index-BjikXUqk.js";import"./index-BxFhwaSO.js";import"./toNumber-BQm7RcjZ.js";import"./_baseIteratee-CQMEzKuW.js";import"./tender-ZYcn_VXM.js";const le=e({animated:Boolean,count:{type:Number,default:1},rows:{type:Number,default:3},loading:{type:Boolean,default:!0},throttle:{type:l([Number,Object])}}),se=e({variant:{type:String,values:["circle","rect","h1","h3","text","caption","p","image","button"],default:"text"}}),ae=j({name:"ElSkeletonItem"});var te=s(j({...ae,props:se,setup(e){const l=a("skeleton");return(e,s)=>(w(),x("div",{class:I([F(l).e("item"),F(l).e(e.variant)])},["image"===e.variant?(w(),z(F(t),{key:0})):V("v-if",!0)],2))}}),[["__file","skeleton-item.vue"]]);const ie=j({name:"ElSkeleton"});const oe=u(s(j({...ie,props:le,setup(e,{expose:l}){const s=e,t=a("skeleton"),u=((e,l=0)=>{if(0===l)return e;const s=C(l)&&Boolean(l.initVal),a=P(s);let t=null;const u=l=>{o(l)?a.value=e.value:(t&&clearTimeout(t),t=setTimeout(()=>{a.value=e.value},l))},c=e=>{"leading"===e?i(l)?u(l):u(l.leading):C(l)?u(l.trailing):a.value=!1};return U(()=>c("leading")),E(()=>e.value,e=>{c(e?"leading":"trailing")}),a})($(s,"loading"),s.throttle);return l({uiLoading:u}),(e,l)=>F(u)?(w(),x("div",N({key:0,class:[F(t).b(),F(t).is("animated",e.animated)]},e.$attrs),[(w(!0),x(R,null,S(e.count,l=>(w(),x(R,{key:l},[F(u)?D(e.$slots,"template",{key:l},()=>[q(te,{class:I(F(t).is("first")),variant:"p"},null,8,["class"]),(w(!0),x(R,null,S(e.rows,l=>(w(),z(te,{key:l,class:I([F(t).e("paragraph"),F(t).is("last",l===e.rows&&e.rows>1)]),variant:"p"},null,8,["class"]))),128))]):V("v-if",!0)],64))),128))],16)):D(e.$slots,"default",T(N({key:1},e.$attrs)))}}),[["__file","skeleton.vue"]]),{SkeletonItem:te});c(te);const ue={class:"document-merge-panel"},ce={class:"merge-section"},ne={class:"files-status"},re={class:"status-icon"},de={key:0,class:"bi bi-check-circle-fill text-success"},pe={key:1,class:"bi bi-x-circle-fill text-danger"},ve={class:"file-info"},me={class:"file-name"},fe={class:"file-meta"},_e={key:1,class:"text-muted"},be={key:0,class:"file-actions"},ye={class:"status-icon"},he={key:0,class:"bi bi-check-circle-fill text-success"},ke={key:1,class:"bi bi-dash-circle text-warning"},ge={class:"file-info"},je={class:"file-name"},xe={class:"file-meta"},we={key:1,class:"text-muted"},ze={key:0,class:"file-actions"},Ve={class:"status-icon"},Fe={key:0,class:"bi bi-check-circle-fill text-success"},Ie={key:1,class:"bi bi-x-circle-fill text-danger"},Ce={class:"file-info"},Pe={class:"file-name"},Ue={class:"file-meta"},Ee={key:1,class:"text-muted"},$e={key:0,class:"file-actions"},De={key:0},Re={key:1},Se={key:0,class:"merge-section"},qe={class:"config-group"},Ne={class:"doc-order-list"},Te={class:"doc-order-item fixed"},Be={key:0,class:"doc-order-item"},Le={class:"doc-order-item"},We={class:"order-number"},Je={class:"config-group"},Me={class:"options-list"},Oe={class:"config-group"},He={class:"index-template-preview"},Qe={class:"score-items-preview"},Ae={class:"config-group"},Ke={key:1,class:"merge-section"},Xe={key:0,class:"action-area"},Ye={key:1,class:"merge-progress"},Ge={class:"progress-message"},Ze={class:"progress-details"},el={key:0,class:"current"},ll={key:2,class:"merge-result"},sl={class:"result-info"},al={class:"stats-list"},tl={key:0},il={key:1},ol={key:2},ul={class:"processing-details"},cl={key:0},nl={key:1},rl={key:2},dl={key:3},pl={class:"action-buttons"},vl=f(j({__name:"DocumentMergePanel",props:{projectId:{},currentDocuments:{}},setup(e){const l=e,s=P(!0),a=P({}),t=P({required:!1,type:"none"}),i=P({include_p2p:!0,doc_order:["business","p2p","tech"],generate_toc:!0,remove_blanks:!0,unify_styles:!0,add_section_breaks:!0,output_filename:""}),o=P(!1),u=P(!1),c=P(0),f=P(""),_=P(""),b=P(""),y=P([]),h=P(null),k=P(!0),g=B(()=>a.value.business&&a.value.tech),j=async()=>{var e,s;try{u.value=!0;const e={business:a.value.business.file_path,tech:a.value.tech.file_path};i.value.include_p2p&&a.value.p2p&&(e.p2p=a.value.p2p.file_path);const s=await p.post(`/api/projects/${l.projectId}/merge-documents`,{file_paths:e,config:{...i.value,index_config:t.value}});if(s.data.success){const e=s.data.task_id||l.projectId;o.value=!0,u.value=!1,F(e)}}catch(c){v.error((null==(s=null==(e=c.response)?void 0:e.data)?void 0:s.error)||"启动整合失败"),u.value=!1}},F=e=>{const l=new EventSource(`/api/merge-status/${e}`);l.onmessage=e=>{try{const s=JSON.parse(e.data);if(c.value=s.progress_percentage||0,_.value=s.current_step||"",s.current_step&&!y.value.includes(s.current_step)&&(b.value&&y.value.push(b.value),b.value=s.current_step),"completed"===s.overall_status){if(f.value="success",c.value=100,s.options){const e="string"==typeof s.options?JSON.parse(s.options):s.options;h.value={filename:i.value.output_filename+".docx",file_path:e.merged_document_path,file_size:e.file_size||0,stats:e.stats,created_at:(new Date).toLocaleString("zh-CN")}}o.value=!1,l.close(),v.success("文档整合完成！")}else"failed"===s.overall_status&&(f.value="exception",o.value=!1,l.close(),v.error("文档整合失败："+s.current_step))}catch(s){}},l.onerror=()=>{l.close(),o.value&&(v.error("进度监听中断"),o.value=!1)}},C=()=>{m.confirm("确定要重新整合吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.value=null,c.value=0,f.value="",_.value="",b.value="",y.value=[]}).catch(()=>{})},E=e=>{if(!e)return"";if(e.startsWith("/api/"))return e;let l=e;const s="/Users/lvhe/Downloads/zhongbiao/zhongbiao/";return l.startsWith(s)&&(l=l.substring(42)),l.startsWith("ai_tender_system/data/")?l=l.substring(22):l.startsWith("data/")&&(l=l.substring(5)),`/api/files/serve/${l}`},$=()=>{var e;if(null==(e=h.value)?void 0:e.file_path){const e=E(h.value.file_path)+"?download=true";window.open(e,"_blank")}},D=()=>{var e;if(null==(e=h.value)?void 0:e.file_path){const e=E(h.value.file_path);window.open(e,"_blank")}},N=()=>{var e;(null==(e=h.value)?void 0:e.file_path)&&(v.success("正在打开编辑器..."),v.info("编辑功能开发中..."))},T=e=>{const l=a.value[e];if(null==l?void 0:l.file_path){const e=E(l.file_path);window.open(e,"_blank")}},Y=e=>e?e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":(e/1048576).toFixed(2)+" MB":"--";return U(()=>{(async()=>{var e,o,u,c,n,r;try{if(s.value=!0,l.currentDocuments){const t=l.currentDocuments;return a.value={},t.businessResponseFile&&(a.value.business={status:"ready",file_path:t.businessResponseFile.outputFile,file_name:(null==(e=t.businessResponseFile.outputFile)?void 0:e.split("/").pop())||"商务应答文件.docx",file_size:(null==(o=t.businessResponseFile.stats)?void 0:o.file_size)||0}),t.p2pResponseFile&&(a.value.p2p={status:"ready",file_path:t.p2pResponseFile.outputFile,file_name:(null==(u=t.p2pResponseFile.outputFile)?void 0:u.split("/").pop())||"点对点应答文件.docx",file_size:(null==(c=t.p2pResponseFile.stats)?void 0:c.file_size)||0}),t.techProposalFile&&(a.value.tech={status:"ready",file_path:t.techProposalFile.outputFile,file_name:(null==(n=t.techProposalFile.outputFile)?void 0:n.split("/").pop())||"技术方案文件.docx",file_size:(null==(r=t.techProposalFile.stats)?void 0:r.file_size)||0}),i.value={include_p2p:!!a.value.p2p,doc_order:a.value.p2p?["business","p2p","tech"]:["business","tech"],generate_toc:!0,remove_blanks:!0,unify_styles:!0,add_section_breaks:!0,output_filename:`项目${l.projectId}_最终标书`},void(s.value=!1)}const d=await p.get(`/api/projects/${l.projectId}/merge-config`);if(d.data.success){const e=d.data.data;a.value=e.files||{},t.value=e.index_requirement||{required:!1,type:"none"},e.default_config&&(i.value={...e.default_config})}}catch(d){v.error("加载配置失败")}finally{s.value=!1}})()}),(e,l)=>{const p=oe,v=n,m=r,F=O,P=H,U=d,E=Q,B=K,G=A,Z=X;return w(),x("div",ue,[s.value?(w(),z(p,{key:0,rows:10,animated:""})):(w(),x(R,{key:1},[L("section",ce,[l[18]||(l[18]=L("div",{class:"section-header"},[L("h3",null,[L("i",{class:"bi bi-file-check"}),W(" 步骤 1/3：文件状态检查")])],-1)),L("div",ne,[L("div",{class:I(["file-status-item",{"file-ready":a.value.business}])},[L("div",re,[a.value.business?(w(),x("i",de)):(w(),x("i",pe))]),L("div",ve,[l[11]||(l[11]=L("h4",null,"商务应答文件",-1)),a.value.business?(w(),x(R,{key:0},[L("p",me,J(a.value.business.file_name),1),L("p",fe,J(Y(a.value.business.file_size)),1)],64)):(w(),x("p",_e,"未生成"))]),a.value.business?(w(),x("div",be,[q(v,{size:"small",onClick:l[0]||(l[0]=e=>T("business"))},{default:M(()=>[...l[12]||(l[12]=[L("i",{class:"bi bi-eye"},null,-1),W(" 预览 ",-1)])]),_:1})])):V("",!0)],2),L("div",{class:I(["file-status-item",{"file-ready":a.value.p2p}])},[L("div",ye,[a.value.p2p?(w(),x("i",he)):(w(),x("i",ke))]),L("div",ge,[l[13]||(l[13]=L("h4",null,"技术点对点应答",-1)),a.value.p2p?(w(),x(R,{key:0},[L("p",je,J(a.value.p2p.file_name),1),L("p",xe,J(Y(a.value.p2p.file_size)),1)],64)):(w(),x("p",we,"未生成（可选）"))]),a.value.p2p?(w(),x("div",ze,[q(v,{size:"small",onClick:l[1]||(l[1]=e=>T("p2p"))},{default:M(()=>[...l[14]||(l[14]=[L("i",{class:"bi bi-eye"},null,-1),W(" 预览 ",-1)])]),_:1})])):V("",!0)],2),L("div",{class:I(["file-status-item",{"file-ready":a.value.tech}])},[L("div",Ve,[a.value.tech?(w(),x("i",Fe)):(w(),x("i",Ie))]),L("div",Ce,[l[15]||(l[15]=L("h4",null,"技术方案文件",-1)),a.value.tech?(w(),x(R,{key:0},[L("p",Pe,J(a.value.tech.file_name),1),L("p",Ue,J(Y(a.value.tech.file_size)),1)],64)):(w(),x("p",Ee,"未生成"))]),a.value.tech?(w(),x("div",$e,[q(v,{size:"small",onClick:l[2]||(l[2]=e=>T("tech"))},{default:M(()=>[...l[16]||(l[16]=[L("i",{class:"bi bi-eye"},null,-1),W(" 预览 ",-1)])]),_:1})])):V("",!0)],2)]),g.value?V("",!0):(w(),z(m,{key:0,type:"warning",closable:!1,"show-icon":"",class:"mt-3"},{title:M(()=>[...l[17]||(l[17]=[W(" 无法整合：缺少必需的文件 ",-1)])]),default:M(()=>[a.value.business?V("",!0):(w(),x("p",De,"• 商务应答文件未生成，请先完成商务应答")),a.value.tech?V("",!0):(w(),x("p",Re,"• 技术方案文件未生成，请先完成技术方案"))]),_:1}))]),g.value?(w(),x("section",Se,[l[42]||(l[42]=L("div",{class:"section-header"},[L("h3",null,[L("i",{class:"bi bi-sliders"}),W(" 步骤 2/3：整合配置")])],-1)),L("div",qe,[l[27]||(l[27]=L("h4",null,[L("i",{class:"bi bi-files"}),W(" 文档组成与顺序")],-1)),L("div",Ne,[L("div",Te,[l[20]||(l[20]=L("span",{class:"order-number"},"1",-1)),l[21]||(l[21]=L("span",{class:"doc-name"},"商务应答",-1)),q(F,{size:"small",type:"info"},{default:M(()=>[...l[19]||(l[19]=[W("固定第一部分",-1)])]),_:1})]),a.value.p2p?(w(),x("div",Be,[l[23]||(l[23]=L("span",{class:"order-number"},"2",-1)),l[24]||(l[24]=L("span",{class:"doc-name"},"点对点应答",-1)),q(P,{modelValue:i.value.include_p2p,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.include_p2p=e)},{default:M(()=>[...l[22]||(l[22]=[W("包含此部分",-1)])]),_:1},8,["modelValue"])])):V("",!0),L("div",Le,[L("span",We,J(a.value.p2p?"3":"2"),1),l[26]||(l[26]=L("span",{class:"doc-name"},"技术方案",-1)),q(F,{size:"small",type:"success"},{default:M(()=>[...l[25]||(l[25]=[W("✓ 包含",-1)])]),_:1})])])]),L("div",Je,[l[32]||(l[32]=L("h4",null,[L("i",{class:"bi bi-palette"}),W(" 格式与目录选项")],-1)),L("div",Me,[q(P,{modelValue:i.value.generate_toc,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.generate_toc=e)},{default:M(()=>[...l[28]||(l[28]=[W(" 自动生成目录（基于1-3级标题，带页码） ",-1)])]),_:1},8,["modelValue"]),q(P,{modelValue:i.value.remove_blanks,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.remove_blanks=e)},{default:M(()=>[...l[29]||(l[29]=[W(" 删除空白页和空白段落 ",-1)])]),_:1},8,["modelValue"]),q(P,{modelValue:i.value.unify_styles,"onUpdate:modelValue":l[6]||(l[6]=e=>i.value.unify_styles=e)},{default:M(()=>[...l[30]||(l[30]=[W(" 统一页眉页脚格式 ",-1)])]),_:1},8,["modelValue"]),q(P,{modelValue:i.value.add_section_breaks,"onUpdate:modelValue":l[7]||(l[7]=e=>i.value.add_section_breaks=e)},{default:M(()=>[...l[31]||(l[31]=[W(" 每部分间添加分节符 ",-1)])]),_:1},8,["modelValue"])])]),L("div",Oe,[l[39]||(l[39]=L("h4",null,[L("i",{class:"bi bi-list-ol"}),W(" 索引设置")],-1)),t.value.required?"fixed_format"===t.value.type?(w(),z(m,{key:1,type:"warning",closable:!1,"show-icon":""},{title:M(()=>[...l[34]||(l[34]=[W(" 招标文件要求提供固定格式索引 ",-1)])]),default:M(()=>[L("div",He,[L("pre",null,J(t.value.template),1)]),q(P,{modelValue:k.value,"onUpdate:modelValue":l[8]||(l[8]=e=>k.value=e),disabled:"",checked:""},{default:M(()=>[...l[35]||(l[35]=[W(" 自动生成索引（必需） ",-1)])]),_:1},8,["modelValue"])]),_:1})):"score_based"===t.value.type?(w(),z(m,{key:2,type:"success",closable:!1,"show-icon":""},{title:M(()=>[...l[36]||(l[36]=[W(" 招标文件要求以评分标准建立索引 ",-1)])]),default:M(()=>[L("div",Qe,[l[37]||(l[37]=L("p",null,"将基于以下评分项生成索引：",-1)),L("ul",null,[(w(!0),x(R,null,S(t.value.score_items,e=>(w(),x("li",{key:e},J(e),1))),128))])]),q(P,{modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=e=>k.value=e),disabled:"",checked:""},{default:M(()=>[...l[38]||(l[38]=[W(" 自动生成评分标准索引（必需） ",-1)])]),_:1},8,["modelValue"])]),_:1})):V("",!0):(w(),z(m,{key:0,type:"info",closable:!1,"show-icon":""},{title:M(()=>[...l[33]||(l[33]=[W(" 招标文件未要求提供索引，无需生成 ",-1)])]),_:1}))]),L("div",Ae,[l[41]||(l[41]=L("h4",null,[L("i",{class:"bi bi-file-earmark-text"}),W(" 文档名称")],-1)),q(U,{modelValue:i.value.output_filename,"onUpdate:modelValue":l[10]||(l[10]=e=>i.value.output_filename=e),placeholder:"请输入最终标书文件名",maxlength:"100","show-word-limit":""},{suffix:M(()=>[...l[40]||(l[40]=[W(".docx",-1)])]),_:1},8,["modelValue"])])])):V("",!0),g.value?(w(),x("section",Ke,[l[58]||(l[58]=L("div",{class:"section-header"},[L("h3",null,[L("i",{class:"bi bi-rocket-takeoff"}),W(" 步骤 3/3：开始整合")])],-1)),o.value||h.value?V("",!0):(w(),x("div",Xe,[q(v,{type:"primary",size:"large",loading:u.value,onClick:j},{default:M(()=>[...l[43]||(l[43]=[L("i",{class:"bi bi-play-fill"},null,-1),W(" 开始整合 ",-1)])]),_:1},8,["loading"])])),o.value?(w(),x("div",Ye,[q(E,{percentage:c.value,status:f.value},null,8,["percentage","status"]),L("p",Ge,J(_.value),1),L("div",Ze,[l[46]||(l[46]=L("h5",null,"处理详情：",-1)),L("ul",null,[(w(!0),x(R,null,S(y.value,(e,s)=>(w(),x("li",{key:s,class:"completed"},[l[44]||(l[44]=L("i",{class:"bi bi-check-circle-fill"},null,-1)),W(" "+J(e),1)]))),128)),b.value?(w(),x("li",el,[l[45]||(l[45]=L("i",{class:"bi bi-arrow-right-circle-fill"},null,-1)),W(" "+J(b.value),1)])):V("",!0)])])])):V("",!0),h.value?(w(),x("div",ll,[q(Z,{icon:"success",title:"整合完成！","sub-title":"您的最终标书已生成"},{extra:M(()=>{var e,s,a,o,u,c;return[L("div",sl,[l[55]||(l[55]=L("h4",null,[L("i",{class:"bi bi-file-earmark-check"}),W(" 文件信息")],-1)),q(G,{column:2,border:""},{default:M(()=>[q(B,{label:"文件名"},{default:M(()=>[W(J(h.value.filename),1)]),_:1}),q(B,{label:"文件大小"},{default:M(()=>[W(J(Y(h.value.file_size)),1)]),_:1}),q(B,{label:"总页数"},{default:M(()=>{var e;return[W(J((null==(e=h.value.stats)?void 0:e.total_pages)||"--")+" 页 ",1)]}),_:1}),q(B,{label:"生成时间"},{default:M(()=>[W(J(h.value.created_at),1)]),_:1})]),_:1}),l[56]||(l[56]=L("h4",{class:"mt-3"},[L("i",{class:"bi bi-bar-chart"}),W(" 文件组成统计")],-1)),L("ul",al,[(null==(e=h.value.stats)?void 0:e.toc_pages)?(w(),x("li",tl," 目录："+J(h.value.stats.toc_pages)+" 页 ",1)):V("",!0),L("li",null,"商务应答："+J((null==(s=h.value.stats)?void 0:s.business_pages)||"--")+" 页",1),i.value.include_p2p?(w(),x("li",il," 点对点应答："+J((null==(a=h.value.stats)?void 0:a.p2p_pages)||"--")+" 页 ",1)):V("",!0),L("li",null,"技术方案："+J((null==(o=h.value.stats)?void 0:o.tech_pages)||"--")+" 页",1),(null==(u=h.value.stats)?void 0:u.index_pages)?(w(),x("li",ol," 索引："+J(h.value.stats.index_pages)+" 页 ",1)):V("",!0)]),l[57]||(l[57]=L("h4",{class:"mt-3"},[L("i",{class:"bi bi-tools"}),W(" 处理详情")],-1)),L("ul",ul,[(null==(c=h.value.stats)?void 0:c.removed_blanks)?(w(),x("li",cl,[l[47]||(l[47]=L("i",{class:"bi bi-check-circle text-success"},null,-1)),W(" 已删除 "+J(h.value.stats.removed_blanks)+" 个空白段落 ",1)])):V("",!0),i.value.generate_toc?(w(),x("li",nl,[...l[48]||(l[48]=[L("i",{class:"bi bi-check-circle text-success"},null,-1),W(" 已生成多级目录 ",-1)])])):V("",!0),t.value.required?(w(),x("li",rl,[l[49]||(l[49]=L("i",{class:"bi bi-check-circle text-success"},null,-1)),W(" 已生成"+J("score_based"===t.value.type?"评分标准":"固定格式")+"索引 ",1)])):V("",!0),i.value.unify_styles?(w(),x("li",dl,[...l[50]||(l[50]=[L("i",{class:"bi bi-check-circle text-success"},null,-1),W(" 已统一页眉页脚 ",-1)])])):V("",!0)]),L("div",pl,[q(v,{type:"primary",size:"large",onClick:$},{default:M(()=>[...l[51]||(l[51]=[L("i",{class:"bi bi-download"},null,-1),W(" 下载Word版 ",-1)])]),_:1}),q(v,{type:"success",size:"large",onClick:D},{default:M(()=>[...l[52]||(l[52]=[L("i",{class:"bi bi-eye"},null,-1),W(" 在线预览 ",-1)])]),_:1}),q(v,{type:"warning",size:"large",onClick:N},{default:M(()=>[...l[53]||(l[53]=[L("i",{class:"bi bi-pencil-square"},null,-1),W(" 在线编辑 ",-1)])]),_:1}),q(v,{size:"large",onClick:C},{default:M(()=>[...l[54]||(l[54]=[L("i",{class:"bi bi-arrow-clockwise"},null,-1),W(" 重新整合 ",-1)])]),_:1})])])]}),_:1})])):V("",!0)])):V("",!0)],64))])}}}),[["__scopeId","data-v-4f5ce16e"]]),ml={class:"final-tender-page"},fl={class:"selector-content"},_l={class:"project-option"},bl={class:"project-name"},yl={class:"project-status"},hl={class:"project-info"},kl={class:"project-header"},gl={class:"project-meta"},jl=f(j({__name:"FinalTender",setup(e){const l=_(),s=b();G();const{projects:a,loading:t,selectedProject:i,currentDocuments:o,hasProjects:u,loadProjects:c,handleProjectChange:r,restoreProjectFromStore:d}=Y(),p=P({projectId:null}),m=async()=>{await r(p.value.projectId,{onClear:()=>{},onDocumentsLoaded:e=>{const l=!!e.businessResponseFile,s=!!e.techProposalFile;l&&s||v.warning("该项目缺少商务应答或技术方案文件，无法整合")}}),p.value.projectId&&s.replace({name:"FinalTender",query:{projectId:p.value.projectId.toString()}})},f=()=>{p.value.projectId=null,s.replace({name:"FinalTender"})},j=()=>{c()};return U(async()=>{await c();const e=await d({onClear:()=>{},onDocumentsLoaded:e=>{}});e&&(p.value.projectId=e);const s=l.query.projectId;if(s&&!e){const e=Number(s);a.value.some(l=>l.id===e)&&(p.value.projectId=e,await m())}}),(e,l)=>{const s=n,c=O,r=h,d=y,v=Z,_=ee;return w(),x("div",ml,[q(F(g),{title:"最终标书","show-back":!1},{actions:M(()=>[q(s,{onClick:j},{default:M(()=>[...l[2]||(l[2]=[L("i",{class:"bi bi-arrow-clockwise"},null,-1),W(" 刷新 ",-1)])]),_:1})]),_:1}),F(t)?(w(),z(F(k),{key:0,text:"加载项目列表..."})):(w(),x(R,{key:1},[p.value.projectId?V("",!0):(w(),z(_,{key:0,class:"project-selector-card",shadow:"never"},{default:M(()=>[L("div",fl,[l[4]||(l[4]=L("div",{class:"selector-icon"},[L("i",{class:"bi bi-folder2-open"})],-1)),l[5]||(l[5]=L("h3",null,"请选择要整合的项目",-1)),l[6]||(l[6]=L("p",{class:"text-muted"}," 从下方列表中选择一个已完成商务应答和技术方案的项目 ",-1)),q(d,{modelValue:p.value.projectId,"onUpdate:modelValue":l[0]||(l[0]=e=>p.value.projectId=e),placeholder:"选择项目",size:"large",filterable:"",class:"project-select",onChange:m},{default:M(()=>[(w(!0),x(R,null,S(F(a),e=>(w(),z(r,{key:e.id,label:`${e.project_name} (${e.project_number||"-"})`,value:e.id},{default:M(()=>[L("div",_l,[L("span",bl,J(e.project_name),1),L("div",yl,[q(c,{type:"info",size:"small"},{default:M(()=>[W(J(e.company_name),1)]),_:2},1024)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),F(u)?V("",!0):(w(),z(v,{key:0,description:"暂无项目","image-size":120},{extra:M(()=>[q(s,{type:"primary",onClick:l[1]||(l[1]=l=>e.$router.push({name:"TenderManagement"}))},{default:M(()=>[...l[3]||(l[3]=[L("i",{class:"bi bi-folder-plus"},null,-1),W(" 前往项目管理 ",-1)])]),_:1})]),_:1}))])]),_:1})),p.value.projectId&&F(i)?(w(),x(R,{key:1},[q(_,{class:"current-project-card",shadow:"never"},{default:M(()=>[L("div",hl,[L("div",kl,[L("h3",null,[l[7]||(l[7]=L("i",{class:"bi bi-folder-check"},null,-1)),W(" "+J(F(i).project_name),1)]),q(s,{size:"small",text:"",onClick:f},{default:M(()=>[...l[8]||(l[8]=[L("i",{class:"bi bi-arrow-left-right"},null,-1),W(" 切换项目 ",-1)])]),_:1})]),L("p",gl," 公司："+J(F(i).company_name)+" | 项目编号："+J(F(i).project_number||"-")+" | 创建时间："+J(F(i).created_at),1)])]),_:1}),(w(),z(vl,{"project-id":p.value.projectId,"current-documents":F(o),key:p.value.projectId},null,8,["project-id","current-documents"]))],64)):V("",!0)],64))])}}}),[["__scopeId","data-v-a7f77f31"]]);export{jl as default};
