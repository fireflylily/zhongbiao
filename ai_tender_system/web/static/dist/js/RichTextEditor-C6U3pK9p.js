import{o as e,C as a,a as l,L as t,j as o}from"./vendor-element-plus-CEQaQHNc.js";import{d as s,r as u,a as i,w as n,b as r,j as d,P as v,M as c,W as m,O as f,L as y,R as p,N as g,c as h,H as _,I as b,f as k,Q as w,v as C,F as T,V as x,m as S,q as I}from"./vendor-vue-DnBj6vzG.js";import{d0 as L,ev as j,d2 as O,er as R,ew as V,dh as z,dj as E}from"./vendor-other-CxXkF0Pk.js";import{m as M}from"./vendor-editor-CGvuleas.js";/* empty css                                                                          */import{_ as B}from"./index.js";const F={class:"editor-header"},H={class:"header-left"},P={class:"header-actions"},W={class:"editor-body"},A={class:"outline-sidebar"},D={class:"outline-header"},$={class:"outline-list"},q=["onClick"],N={class:"outline-text"},Q={class:"outline-footer"},U={class:"editor-main"},G={key:0,class:"streaming-indicator"},J=B(s({__name:"RichTextEditor",props:{modelValue:{},title:{default:"æ–‡æ¡£ç¼–è¾‘"},height:{default:600},readonly:{type:Boolean,default:!1},streaming:{type:Boolean,default:!1}},emits:["update:modelValue","save","preview","export","ready"],setup(s,{expose:B,emit:J}){const K=s,X=J,Y=u(null),Z=u(K.modelValue),ee=u(!1),ae=u(!1),le=u(!1),te=i(()=>K.streaming),oe=i(()=>!!Z.value&&"<p></p>"!==Z.value),se=u(!1),ue=i(()=>({toolbar:{defaultMode:"ribbon"},page:{layouts:["page","web"],defaultMargin:{left:3.18,right:3.18,top:2.54,bottom:2.54},defaultOrientation:"portrait",defaultBackground:"#ffffff",showBreakMarks:!0,showLineNumber:!1,showToc:!0,watermark:{type:"compact",alpha:.2,fontColor:"#000",fontSize:16,fontFamily:"SimSun",fontWeight:"normal",text:""}},document:{enableSpellcheck:!1,readOnly:K.readonly},file:{maxSize:10485760,allowedMimeTypes:["image/jpeg","image/png","image/gif","image/webp"]},onFileUpload:async e=>new Promise((a,l)=>{const t=new FileReader;t.onload=e=>{var l;const t=null==(l=e.target)?void 0:l.result;a({id:`img-${Date.now()}`,url:t})},t.onerror=()=>l(new Error("è¯»å–å¤±è´¥")),t.readAsDataURL(e)}),onFileDelete:e=>!0})),ie=u([]),ne=u(!1),re=u(""),de=u(!1);i(()=>le.value?"calc(100vh - 120px)":"number"==typeof K.height?`${K.height}px`:K.height),n(()=>K.modelValue,e=>{e&&e!==Z.value&&(Z.value=e,ee.value=!1,Y.value&&fe(e))}),n(te,e=>{Y.value&&"function"==typeof Y.value.setReadOnly&&Y.value.setReadOnly(e||K.readonly)});const ve=()=>{setTimeout(()=>{ce()},300),K.modelValue&&setTimeout(()=>{fe(K.modelValue)},100),(K.readonly||K.streaming)&&Y.value&&"function"==typeof Y.value.setReadOnly&&Y.value.setReadOnly(!0),X("ready"),setTimeout(()=>{he()},800)},ce=()=>{if(Y.value)try{"function"==typeof Y.value.setLayout&&(Y.value.setLayout("page"),se.value=!1,setTimeout(()=>{const e=document.querySelector(".umo-editor-container");e&&(e.classList.add("umo-page-mode"),e.classList.remove("umo-continuous-mode"))},500))}catch(e){}},me=()=>{if(Y.value)try{const e=Y.value.getHTML();e!==Z.value&&(Z.value=e,ee.value=!0,X("update:modelValue",e),ge())}catch(e){}},fe=e=>{if(Y.value)try{we(),"function"==typeof Y.value.setContent&&(Y.value.setContent(e),setTimeout(()=>{we()},100))}catch(a){if("QuotaExceededError"===a.name){we();try{Y.value.setContent(e)}catch(l){}}}},ye=()=>{var e;try{const a=null==(e=Y.value)?void 0:e.getEditor();if(a&&a.view){const{dom:e}=a.view;e.scrollTop=e.scrollHeight}}catch(a){}};let pe=null;const ge=()=>{pe&&clearTimeout(pe),pe=window.setTimeout(()=>{he()},500)},he=async()=>{if(Y.value){de.value=!0;try{if("function"==typeof Y.value.getTableOfContents){const e=Y.value.getTableOfContents();ie.value=e||[]}else ie.value=[]}catch(e){ie.value=[]}finally{de.value=!1}}},_e=async()=>{if(ee.value&&!te.value){ae.value=!0;try{X("save",Z.value),await I(),ee.value=!1}catch(e){o.error("ä¿å­˜å¤±è´¥")}finally{ae.value=!1}}},be=()=>{le.value=!le.value,le.value?document.body.style.overflow="hidden":document.body.style.overflow=""},ke=()=>{var e,a;return null==(a=null==(e=Y.value)?void 0:e.getEditor)?void 0:a.call(e)};B({getContent:()=>{try{if(Y.value&&"function"==typeof Y.value.getHTML)return Y.value.getHTML()}catch(e){}return Z.value},setContent:e=>{Z.value=e,fe(e),ee.value=!1,setTimeout(()=>{he()},300)},appendContent:e=>{if(Y.value)try{const a=Y.value.getHTML()+e;Y.value.setContent(a),Z.value=a,I(()=>{ye()}),ge()}catch(a){}else Z.value+=e},clear:()=>{Z.value="",fe(""),ie.value=[],ee.value=!1},refreshOutline:he,setStreaming:e=>{},getEditor:ke,insertPageBreak:()=>{try{let e=ke();return e&&e.__v_isRef&&(e=e.value),!!(e&&e.commands&&e.commands.setPageBreak)&&(e.commands.setPageBreak(),!0)}catch(e){return!1}}});const we=()=>{try{const e=Object.keys(localStorage);for(const a of e)a.startsWith("umo-editor:")&&localStorage.removeItem(a)}catch(e){}},Ce=localStorage.setItem;let Te=!1;return r(()=>{localStorage.setItem=function(e,a){if(!e.startsWith("umo-editor:"))return Ce.call(localStorage,e,a);Te||(Te=!0)},we()}),d(()=>{le.value&&(document.body.style.overflow=""),pe&&clearTimeout(pe),localStorage.setItem=Ce,we()}),(o,u)=>{const i=a,n=e,r=l,d=t;return c(),v("div",{class:m(["rich-text-editor",{fullscreen:le.value,streaming:te.value}])},[f("div",F,[f("div",H,[f("h3",null,"âœï¸ "+p(s.title),1),te.value?(c(),y(n,{key:0,type:"primary",effect:"plain"},{default:g(()=>[h(i,{class:"is-loading"},{default:g(()=>[h(b(L))]),_:1}),u[4]||(u[4]=_(" AIç”Ÿæˆä¸­... ",-1))]),_:1})):ee.value?(c(),y(n,{key:1,type:"warning"},{default:g(()=>[...u[5]||(u[5]=[_("æœ‰æœªä¿å­˜çš„ä¿®æ”¹",-1)])]),_:1})):(c(),y(n,{key:2,type:"success"},{default:g(()=>[...u[6]||(u[6]=[_("å·²ä¿å­˜",-1)])]),_:1}))]),f("div",P,[h(r,{onClick:be,size:"small"},{default:g(()=>[h(i,null,{default:g(()=>[h(b(j))]),_:1}),_(" "+p(le.value?"é€€å‡ºå…¨å±":"å…¨å±ç¼–è¾‘"),1)]),_:1}),h(r,{type:"primary",onClick:u[0]||(u[0]=e=>X("preview")),size:"small",disabled:!oe.value||te.value},{default:g(()=>[h(i,null,{default:g(()=>[h(b(O))]),_:1}),u[7]||(u[7]=_(" é¢„è§ˆWord ",-1))]),_:1},8,["disabled"]),h(r,{type:"success",onClick:u[1]||(u[1]=e=>X("export")),size:"small",disabled:!oe.value||te.value},{default:g(()=>[h(i,null,{default:g(()=>[h(b(R))]),_:1}),u[8]||(u[8]=_(" å¯¼å‡ºWord ",-1))]),_:1},8,["disabled"]),h(r,{type:"primary",loading:ae.value,disabled:!oe.value||te.value,onClick:_e,size:"small"},{default:g(()=>[...u[9]||(u[9]=[_(" ä¿å­˜ ",-1)])]),_:1},8,["loading","disabled"])])]),f("div",W,[k(f("div",A,[f("div",D,[u[10]||(u[10]=f("h4",null,"ğŸ“‘ ç›®å½•",-1)),h(r,{text:"",size:"small",onClick:he,loading:de.value},{default:g(()=>[h(i,null,{default:g(()=>[h(b(V))]),_:1})]),_:1},8,["loading"])]),f("div",$,[(c(!0),v(T,null,x(ie.value,(e,a)=>(c(),v("div",{key:e.id||a,class:m(["outline-item",`level-${e.level}`,{active:re.value===e.id}]),onClick:a=>(e=>{if(e)try{if(e.dom&&"function"==typeof e.dom.scrollIntoView)return e.dom.scrollIntoView({behavior:"smooth",block:"start"}),void(re.value=e.id);if(e.id){const a=document.getElementById(e.id);if(a)return a.scrollIntoView({behavior:"smooth",block:"start"}),void(re.value=e.id)}}catch(a){}})(e)},[f("span",N,p(e.textContent),1)],10,q))),128)),0!==ie.value.length||te.value?w("",!0):(c(),y(d,{key:0,description:"æš‚æ— æ ‡é¢˜","image-size":60}))]),f("div",Q,[h(r,{text:"",size:"small",onClick:u[2]||(u[2]=e=>ne.value=!0)},{default:g(()=>[h(i,null,{default:g(()=>[h(b(z))]),_:1}),u[11]||(u[11]=_(" æŠ˜å ç›®å½• ",-1))]),_:1})])],512),[[C,!ne.value]]),ne.value?(c(),v("div",{key:0,class:"outline-toggle",onClick:u[3]||(u[3]=e=>ne.value=!1)},[h(i,null,{default:g(()=>[h(b(E))]),_:1}),u[12]||(u[12]=f("span",{class:"toggle-text"},"å±•å¼€ç›®å½•",-1))])):w("",!0),f("div",U,[te.value?(c(),v("div",G,[h(i,{class:"is-loading"},{default:g(()=>[h(b(L))]),_:1}),u[13]||(u[13]=f("span",null,"AI æ­£åœ¨ç”Ÿæˆå†…å®¹ï¼Œè¯·ç¨å€™...",-1))])):w("",!0),h(b(M),S({ref_key:"umoEditorRef",ref:Y},ue.value,{onChanged:me,onCreated:ve}),null,16)])])],2)}}}),[["__scopeId","data-v-a3e1a96e"]]);export{J as R};
