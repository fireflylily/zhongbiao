import{E as e,_ as t,g as a,r as s,n as l,q as i,a2 as n}from"./index.js";import{am as o,an as r,aq as c,aw as u,as as f,aK as d,au as p,aR as m,at as y,aX as h,aY as v,ar as _,av as g,bL as w,ay as x,aS as b,aN as k}from"./editor-B2OO2pov.js";/* empty css                             *//* empty css                                                                          */import{a as j,E as F}from"./index-D4leEHxh.js";import{E as T}from"./index-DdajWaCy.js";/* empty css               */import{E as I}from"./index-nzMCCPZ_.js";function L(t={}){const{onFileLoaded:a,onFileCancelled:s,onSyncSuccess:l}=t,i=o(!1),n=o(null),c=o(!1),u=o(!1),f=r(()=>!!n.value),d=e=>({technicalFile:"技术需求文件",tenderFile:"招标文档",templateFile:"应答模板",businessResponseFile:"商务应答文件",p2pResponseFile:"点对点应答文件",techProposalFile:"技术方案文件"}[e]||"文件");return{useHitlFile:i,hitlFileInfo:n,hasHitlFile:f,syncing:c,synced:u,loadFromHITL:(t,s="technicalFile")=>{const l=t[s];return l?(n.value={filename:l.filename||l.name||"未知文件",file_path:l.file_path||l.url||"",file_size:l.file_size||l.size,file_url:l.file_url||l.url},i.value=!0,u.value=!1,e.success({message:`已加载HITL${d(s)}: ${n.value.filename}`,duration:3e3}),a&&a(n.value),!0):(e.warning(`当前项目没有${d(s)}`),!1)},cancelHitlFile:()=>{i.value=!1,n.value=null,u.value=!1,e.info("已取消使用HITL文件"),s&&s()},syncToHitl:async(t,a,s)=>{if(!t)return e.error("项目ID无效"),!1;if(!a)return e.error("文件路径无效"),!1;c.value=!0;try{const i=await fetch(`/api/tender-processing/sync-file/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:a,file_type:s})}),n=i.headers.get("content-type");if(!(null==n?void 0:n.includes("application/json"))){await i.text();throw new Error(`服务器返回异常响应 (${i.status}): ${i.statusText}。可能是后端配置问题，请联系管理员。`)}const o=await i.json();if(o.success||i.ok)return u.value=!0,e.success({message:o.message||"已成功同步到投标项目",duration:3e3}),l&&await l(),!0;throw new Error(o.error||o.message||"同步失败")}catch(i){let t="同步到项目失败";return i.message?t=i.message:"TypeError"===i.name&&(t="网络请求失败，请检查网络连接"),e.error({message:t,duration:5e3}),!1}finally{c.value=!1}},resetSyncStatus:()=>{u.value=!1}}}function E(e,t=2){if(null==e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,a)).toFixed(t)} ${["B","KB","MB","GB","TB","PB"][a]}`}const H={class:"stats-card"},R={key:0,class:"stats-title"},S={class:"stat-item"},C={class:"stat-prefix"},$={class:"stat-suffix"},B=t(c({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,a=[{key:"total_replacements",label:"文本替换",suffix:"处"},{key:"tables_processed",label:"表格处理",suffix:"个"},{key:"cells_filled",label:"单元格填充",suffix:"个"},{key:"images_inserted",label:"图片插入",suffix:"张"}],s=r(()=>t.statItems||a),l=e=>{const a=e.split(".");let s=t.stats;for(const t of a)if(s=null==s?void 0:s[t],null==s)break;return"number"==typeof s?s:0};return(t,a)=>{const i=T,n=F,o=j;return f(),u("div",H,[e.title?(f(),u("h4",R,m(e.title),1)):d("",!0),p(o,{gutter:e.gutter},{default:y(()=>[(f(!0),u(h,null,v(s.value,t=>(f(),_(n,{key:t.key,span:e.span},{default:y(()=>[g("div",S,[p(i,{title:t.label,value:l(t.key),precision:t.precision,"value-style":e.valueStyle},w({_:2},[t.prefix?{name:"prefix",fn:y(()=>[g("span",C,m(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:y(()=>[g("span",$,m(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),z={class:"alert-content"},U={class:"file-info"},O={class:"file-details"},M={class:"file-label"},P={class:"file-name"},q={key:0,class:"file-size"},K={class:"alert-actions"},N=t(c({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"使用HITL文件:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"取消使用"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:t}){const o=t,r=()=>{o("cancel")};return(t,o)=>{const c=a,h=I,v=i,w=l;return e.fileInfo?(f(),_(w,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:y(()=>[g("div",z,[g("div",U,[p(c,{class:"file-icon"},{default:y(()=>[p(x(s))]),_:1}),g("div",O,[g("span",M,m(e.label),1),g("span",P,m(e.fileInfo.filename),1),e.fileInfo.file_size?(f(),u("span",q," ("+m(x(E)(e.fileInfo.file_size))+") ",1)):d("",!0),e.showTag?(f(),_(h,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:y(()=>[...o[0]||(o[0]=[b(" 已从投标项目加载 ",-1)])]),_:1})):d("",!0)])]),g("div",K,[k(t.$slots,"actions",{},()=>[e.showCancel?(f(),_(v,{key:0,type:"text",size:"small",onClick:r},{default:y(()=>[p(c,null,{default:y(()=>[p(x(n))]),_:1}),b(" "+m(e.cancelText),1)]),_:1})):d("",!0)],!0)])])]),_:3},8,["type"])):d("",!0)}}}),[["__scopeId","data-v-1a132715"]]);async function A(e,t){if("string"!=typeof e){const a=URL.createObjectURL(e),s=document.createElement("a");return s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),void URL.revokeObjectURL(a)}try{const a=await fetch(e);if(!a.ok){const e=a.headers.get("content-type");if(e&&e.includes("application/json")){const e=await a.json();throw new Error(e.error||e.message||"文件下载失败")}throw new Error(`文件下载失败: HTTP ${a.status}`)}const s=a.headers.get("content-type");if(s&&(s.includes("text/html")||s.includes("application/json")))throw new Error("服务器返回了错误页面，而不是文件");const l=await a.blob(),i=URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}catch(a){throw a}}export{N as H,B as S,A as d,L as u};
