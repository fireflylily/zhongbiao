import{E as e,d as t,e as l,r as a,f as o,g as n,h as i,i as s}from"./index.js";/* empty css                   *//* empty css                                                        */import{am as u,an as r,ao as v,ap as d,aq as c,ar as m,as as f,at as p,au as h,av as y,aw as g,ax as w,ay as C,az as _,aA as x,aB as k,aC as V,aD as b,aE as T,aF as j}from"./editor-Dt4gYtYt.js";import{E as S}from"./index-rLTqmg7l.js";import{v as U}from"./directive-CBGghap-.js";const E={"element-loading-text":"æ­£åœ¨åŠ è½½æ–‡æ¡£...",class:"preview-container"},q={key:1,class:"preview-body"},z={key:0,class:"outline-sidebar"},A={class:"outline-header"},D={class:"outline-list"},I=["onClick"],N={class:"outline-text"},O={class:"outline-footer"},P={class:"editor-preview-wrapper"},$=u({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"æ–‡æ¡£é¢„è§ˆ"},htmlContent:{default:""}},emits:["update:modelValue"],setup(u,{emit:$}){const B=u,M=$,F=r(!1),H=r(""),L=r(""),J=r(null),R=r([]),W=r(!1),G=r(""),K=r(!1),Q=v({get:()=>B.modelValue,set:e=>M("update:modelValue",e)}),X=v(()=>`æ–‡æ¡£é¢„è§ˆ - ${B.fileName||"æœªå‘½åæ–‡æ¡£"}`),Y=()=>{J.value&&L.value&&setTimeout(()=>{"function"==typeof J.value.setContent&&(J.value.setContent(L.value),setTimeout(()=>{Z()},500))},300)},Z=async()=>{var e,t;if(J.value){K.value=!0;try{const l=(null==(t=(e=J.value).getHTML)?void 0:t.call(e))||L.value;if(!l||"<p></p>"===l)return void(R.value=[]);const a=new DOMParser,o=a.parseFromString(l,"text/html").querySelectorAll("h1, h2, h3, h4, h5, h6");R.value=Array.from(o).map((e,t)=>({id:e.id||`heading-${t}`,level:parseInt(e.tagName[1]),textContent:(e.textContent||"").trim(),dom:null}))}catch(l){R.value=[]}finally{K.value=!1}}},ee=()=>{Q.value=!1};return d(()=>B.modelValue,async e=>{e&&(B.fileUrl||B.htmlContent)?(await j(),(async()=>{if(B.htmlContent)L.value=B.htmlContent;else if(B.fileUrl){F.value=!0,H.value="";try{const e=await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:B.fileUrl})}),t=await e.json();if(!t.success||!t.html_content)throw new Error(t.error||"Wordè½¬HTMLå¤±è´¥");L.value=t.html_content}catch(e){H.value=`æ–‡æ¡£é¢„è§ˆå¤±è´¥: ${e.message||"æœªçŸ¥é”™è¯¯"}`,s.error("æ–‡æ¡£é¢„è§ˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®æˆ–å°è¯•ä¸‹è½½åŽæŸ¥çœ‹")}finally{F.value=!1}}else H.value="æ–‡æ¡£åœ°å€ä¸èƒ½ä¸ºç©º"})()):(H.value="",L.value="",R.value=[],G.value="")}),d(()=>L.value,async e=>{e&&J.value&&(await j(),setTimeout(()=>{J.value&&"function"==typeof J.value.setContent&&(J.value.setContent(e),setTimeout(()=>Z(),500))},300))}),(s,u)=>{const r=e,v=l,d=t,j=S,$=i,B=U;return m(),c($,{modelValue:Q.value,"onUpdate:modelValue":u[2]||(u[2]=e=>Q.value=e),title:X.value,fullscreen:"","before-close":ee,"destroy-on-close":"",class:"document-preview-dialog fullscreen-preview"},{default:f(()=>[p((m(),h("div",E,[H.value?(m(),c(r,{key:0,type:"error",title:H.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):y("",!0),!H.value&&L.value?(m(),h("div",q,[W.value?y("",!0):(m(),h("div",z,[g("div",A,[u[3]||(u[3]=g("h4",null,"ðŸ“‘ ç›®å½•",-1)),w(d,{text:"",size:"small",onClick:Z,loading:K.value},{default:f(()=>[w(v,null,{default:f(()=>[w(C(a))]),_:1})]),_:1},8,["loading"])]),g("div",D,[(m(!0),h(_,null,x(R.value,(e,t)=>(m(),h("div",{key:e.id||t,class:k(["outline-item",`level-${e.level}`,{active:G.value===e.id}]),onClick:t=>(e=>{var t;if(e)try{if(e.id){const t=document.getElementById(e.id);if(t)return t.scrollIntoView({behavior:"smooth",block:"start"}),void(G.value=e.id)}const l=document.querySelector(".editor-preview-wrapper .umo-editor-container");if(l&&e.textContent){const a=l.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const l of a)if((null==(t=l.textContent)?void 0:t.trim())===e.textContent)return l.scrollIntoView({behavior:"smooth",block:"start"}),void(G.value=e.id)}}catch(l){}})(e)},[g("span",N,V(e.textContent),1)],10,I))),128)),0===R.value.length?(m(),c(j,{key:0,description:"æš‚æ— æ ‡é¢˜","image-size":60})):y("",!0)]),g("div",O,[w(d,{text:"",size:"small",onClick:u[0]||(u[0]=e=>W.value=!0)},{default:f(()=>[w(v,null,{default:f(()=>[w(C(o))]),_:1}),u[4]||(u[4]=b(" æŠ˜å ç›®å½• ",-1))]),_:1})])])),W.value?(m(),h("div",{key:1,class:"outline-toggle",onClick:u[1]||(u[1]=e=>W.value=!1)},[w(v,null,{default:f(()=>[w(C(n))]),_:1}),u[5]||(u[5]=g("span",{class:"toggle-text"},"å±•å¼€ç›®å½•",-1))])):y("",!0),g("div",P,[w(C(T),{ref_key:"editorRef",ref:J,document:{readOnly:!0},onCreated:Y},null,512)])])):y("",!0)])),[[B,F.value]])]),_:1},8,["modelValue","title"])}}});export{$ as _};
