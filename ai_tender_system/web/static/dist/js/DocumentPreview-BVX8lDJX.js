import{bU as e,aL as t,bY as a,aS as l,aO as s,aT as o,a$ as n,b6 as i,d4 as r,aV as d,b3 as u,bZ as c,av as v,bJ as g,d5 as m,d6 as p,d7 as f,cP as b,b4 as y,aZ as x,b5 as h,d8 as w,az as _,bq as k,c5 as B,d9 as C,da as T,db as H,dc as P,dd as L,aw as $,be as A,aM as V,aN as E,aR as I,c8 as O,aP as W,ca as z,b7 as N,a_ as U}from"./index.js";import{r as j}from"./DocumentPreview.vue_vue_type_style_index_0_scoped_056f7814_lang-CJRCEOay.js";const D=t({name:"ElCollapseTransition"});const R=c(e(t({...D,setup(e){const t=a("collapse-transition"),c=e=>{e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom},v={beforeEnter(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.height&&(e.dataset.elExistsHeight=e.style.height),e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0},enter(e){requestAnimationFrame(()=>{e.dataset.oldOverflow=e.style.overflow,e.dataset.elExistsHeight?e.style.maxHeight=e.dataset.elExistsHeight:0!==e.scrollHeight?e.style.maxHeight=`${e.scrollHeight}px`:e.style.maxHeight=0,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom,e.style.overflow="hidden"})},afterEnter(e){e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow},enterCancelled(e){c(e)},beforeLeave(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.maxHeight=`${e.scrollHeight}px`,e.style.overflow="hidden"},leave(e){0!==e.scrollHeight&&(e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0)},afterLeave(e){c(e)},leaveCancelled(e){c(e)}};return(e,a)=>(s(),l(u,i({name:d(t).b()},r(v)),{default:o(()=>[n(e.$slots,"default")]),_:3},16,["name"]))}}),[["__file","collapse-transition.vue"]]));function M(e,a){let l;const s=v(!1),n=g({...e,originalPosition:"",originalOverflow:"",visible:!1});function i(){var e,t;null==(t=null==(e=_.$el)?void 0:e.parentNode)||t.removeChild(_.$el)}function r(){if(!s.value)return;const e=n.parent;s.value=!1,e.vLoadingAddClassList=void 0,function(){const e=n.parent,t=_.ns;if(!e.vLoadingAddClassList){let a=e.getAttribute("loading-number");a=Number.parseInt(a)-1,a?e.setAttribute("loading-number",a.toString()):(w(e,t.bm("parent","relative")),e.removeAttribute("loading-number")),w(e,t.bm("parent","hidden"))}i(),c.unmount()}()}const d=t({name:"ElLoading",setup(e,{expose:t}){const{ns:a,zIndex:l}=f("loading");return t({ns:a,zIndex:l}),()=>{const e=n.spinner||n.svg,t=b("svg",{class:"circular",viewBox:n.svgViewBox?n.svgViewBox:"0 0 50 50",...e?{innerHTML:e}:{}},[b("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),l=n.text?b("p",{class:a.b("text")},[n.text]):void 0;return b(u,{name:a.b("fade"),onAfterLeave:r},{default:o(()=>[y(x("div",{style:{backgroundColor:n.background||""},class:[a.b("mask"),n.customClass,n.fullscreen?"is-fullscreen":""]},[b("div",{class:a.b("spinner")},[t,l])]),[[h,n.visible]])])})}}}),c=m(d);Object.assign(c._context,null!=a?a:{});const _=c.mount(document.createElement("div"));return{...p(n),setText:function(e){n.text=e},removeElLoadingChild:i,close:function(){var t;e.beforeClose&&!e.beforeClose()||(s.value=!0,clearTimeout(l),l=setTimeout(r,400),n.visible=!1,null==(t=e.closed)||t.call(e))},handleAfterLeave:r,vm:_,get $el(){return _.$el}}}let S;const q=function(e={},t){if(!_)return;const a=Z(e);if(a.fullscreen&&S)return S;const l=M({...a,closed:()=>{var e;null==(e=a.closed)||e.call(a),a.fullscreen&&(S=void 0)}},null!=t?t:q._context);F(a,a.parent,l),J(a,a.parent,l),a.parent.vLoadingAddClassList=()=>J(a,a.parent,l);let s=a.parent.getAttribute("loading-number");return s=s?`${Number.parseInt(s)+1}`:"1",a.parent.setAttribute("loading-number",s),a.parent.appendChild(l.$el),k(()=>l.visible.value=a.visible),a.fullscreen&&(S=l),l},Z=e=>{var t,a,l,s;let o;return o=B(e.target)?null!=(t=document.querySelector(e.target))?t:document.body:e.target||document.body,{parent:o===document.body||e.body?document.body:o,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:o===document.body&&(null==(a=e.fullscreen)||a),lock:null!=(l=e.lock)&&l,customClass:e.customClass||"",visible:null==(s=e.visible)||s,beforeClose:e.beforeClose,closed:e.closed,target:o}},F=async(e,t,a)=>{const{nextZIndex:l}=a.vm.zIndex||a.vm._.exposed.zIndex,s={};if(e.fullscreen)a.originalPosition.value=C(document.body,"position"),a.originalOverflow.value=C(document.body,"overflow"),s.zIndex=l();else if(e.parent===document.body){a.originalPosition.value=C(document.body,"position"),await k();for(const t of["top","left"]){const a="top"===t?"scrollTop":"scrollLeft";s[t]=e.target.getBoundingClientRect()[t]+document.body[a]+document.documentElement[a]-Number.parseInt(C(document.body,`margin-${t}`),10)+"px"}for(const t of["height","width"])s[t]=`${e.target.getBoundingClientRect()[t]}px`}else a.originalPosition.value=C(t,"position");for(const[o,n]of Object.entries(s))a.$el.style[o]=n},J=(e,t,a)=>{const l=a.vm.ns||a.vm._.exposed.ns;["absolute","fixed","sticky"].includes(a.originalPosition.value)?w(t,l.bm("parent","relative")):T(t,l.bm("parent","relative")),e.fullscreen&&e.lock?T(t,l.bm("parent","hidden")):w(t,l.bm("parent","hidden"))};q._context=null;const X=Symbol("ElLoading"),Y=e=>`element-loading-${L(e)}`,G=(e,t)=>{var a,l,s,o;const n=t.instance,i=e=>H(t.value)?t.value[e]:void 0,r=t=>(e=>{const t=B(e)&&(null==n?void 0:n[e])||e;return v(t)})(i(t)||e.getAttribute(Y(t))),d=null!=(a=i("fullscreen"))?a:t.modifiers.fullscreen,u={text:r("text"),svg:r("svg"),svgViewBox:r("svgViewBox"),spinner:r("spinner"),background:r("background"),customClass:r("customClass"),fullscreen:d,target:null!=(l=i("target"))?l:d?void 0:e,body:null!=(s=i("body"))?s:t.modifiers.body,lock:null!=(o=i("lock"))?o:t.modifiers.lock},c=q(u);c._context=K._context,e[X]={options:u,instance:c}},K={mounted(e,t){t.value&&G(e,t)},updated(e,t){const a=e[X];if(!t.value)return null==a||a.instance.close(),void(e[X]=null);a?((e,t)=>{for(const a of Object.keys(e))P(e[a])&&(e[a].value=t[a])})(a.options,H(t.value)?t.value:{text:e.getAttribute(Y("text")),svg:e.getAttribute(Y("svg")),svgViewBox:e.getAttribute(Y("svgViewBox")),spinner:e.getAttribute(Y("spinner")),background:e.getAttribute(Y("background")),customClass:e.getAttribute(Y("customClass"))}):G(e,t)},unmounted(e){var t;null==(t=e[X])||t.instance.close(),e[X]=null},_context:null},Q={"element-loading-text":"正在加载文档...",class:"preview-container"},ee=U(t({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"文档预览"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,n=t,i=v(!1),r=v(""),d=v(null),u=$({get:()=>a.modelValue,set:e=>n("update:modelValue",e)}),c=$(()=>`文档预览 - ${a.fileName||"未命名文档"}`),g=()=>{u.value=!1};return A(()=>a.modelValue,async e=>{e&&a.fileUrl?(await k(),(async()=>{if(a.fileUrl){i.value=!0,r.value="";try{const e=(e=>{if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/api/"))return e;if(e.startsWith("/download/"))return`/api/files/serve/download/${e.substring(10)}`;let t=e;const a=["/Users/lvhe/Downloads/zhongbiao/zhongbiao/","/var/www/ai-tender-system/"];for(const l of a)if(t.startsWith(l)){t=t.substring(l.length);break}return t.startsWith("ai_tender_system/data/")&&(t=t.substring(22)),t.startsWith("outputs/")&&(t="download/"+t.substring(8)),`/api/files/serve/${t}`})(a.fileUrl),t=await fetch(e);if(!t.ok)throw new Error(`HTTP错误: ${t.status}`);const l=await t.arrayBuffer();if(await k(),!d.value)throw new Error("预览容器未找到");d.value.innerHTML="",await j(l,d.value,void 0,{className:"docx-preview",inWrapper:!0,ignoreWidth:!1,ignoreHeight:!1,ignoreFonts:!1,breakPages:!0,ignoreLastRenderedPageBreak:!0,experimental:!0,trimXmlDeclaration:!0})}catch(e){r.value=`文档预览失败: ${e.message||"未知错误"}`,N.error("文档预览失败，请检查文件是否正确或尝试下载后查看")}finally{i.value=!1}}else r.value="文档地址不能为空"})()):(r.value="",d.value&&(d.value.innerHTML=""))}),(e,t)=>{const a=O,n=z,v=K;return s(),l(n,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),title:c.value,width:"80%","before-close":g,"destroy-on-close":""},{default:o(()=>[y((s(),V("div",Q,[r.value?(s(),l(a,{key:0,type:"error",title:r.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):E("",!0),I("div",{ref_key:"previewContentRef",ref:d,class:"preview-content",style:W({display:r.value?"none":"block"})},null,4)])),[[v,i.value]])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-056f7814"]]);export{ee as D,R as E,K as v};
