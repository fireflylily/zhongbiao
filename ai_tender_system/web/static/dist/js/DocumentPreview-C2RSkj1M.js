import{a5 as e,d as t,a,k as l}from"./element-plus-ZLeSHaWT.js";import{m as o}from"./umo-editor-zkeZL3VF.js";import{v as s,r as n,c as r,w as u,E as i,F as m,G as d,x as v,I as c,O as p,u as f,y,n as _}from"./vue-core-CiAVTOOY.js";/* empty css                                                                        */import{_ as h}from"./index.js";const w={"element-loading-text":"正在加载文档...",class:"preview-container"},C={key:1,class:"editor-preview-wrapper"},V=h(s({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"文档预览"},htmlContent:{default:""}},emits:["update:modelValue"],setup(s,{emit:h}){const V=s,g=h,j=n(!1),b=n(""),x=n(""),U=n(null),k=r({get:()=>V.modelValue,set:e=>g("update:modelValue",e)}),O=r(()=>`文档预览 - ${V.fileName||"未命名文档"}`),T=()=>{U.value&&x.value&&setTimeout(()=>{"function"==typeof U.value.setContent&&U.value.setContent(x.value)},300)},D=()=>{k.value=!1};return u(()=>V.modelValue,async e=>{e&&(V.fileUrl||V.htmlContent)?(await _(),(async()=>{if(V.htmlContent)x.value=V.htmlContent;else if(V.fileUrl){j.value=!0,b.value="";try{const e=await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:V.fileUrl})}),t=await e.json();if(!t.success||!t.html_content)throw new Error(t.error||"Word转HTML失败");x.value=t.html_content}catch(e){b.value=`文档预览失败: ${e.message||"未知错误"}`,l.error("文档预览失败，请检查文件是否正确或尝试下载后查看")}finally{j.value=!1}}else b.value="文档地址不能为空"})()):(b.value="",x.value="")}),(l,s)=>{const n=t,r=a,u=e;return y(),i(r,{modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=e=>k.value=e),title:O.value,width:"90%","before-close":D,"destroy-on-close":"",class:"document-preview-dialog"},{default:m(()=>[d((y(),v("div",w,[b.value?(y(),i(n,{key:0,type:"error",title:b.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):c("",!0),!b.value&&x.value?(y(),v("div",C,[p(f(o),{ref_key:"editorRef",ref:U,document:{readOnly:!0},onCreated:T},null,512)])):c("",!0)])),[[u,j.value]])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-62c282b6"]]);export{V as D};
