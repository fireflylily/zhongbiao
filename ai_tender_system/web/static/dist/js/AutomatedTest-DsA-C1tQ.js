import{e,a6 as a,aR as s,q as l,l as t,am as i,G as r,E as n,J as o,_ as c}from"./index.js";/* empty css                                                                          */import{E as u}from"./el-text--mOnm-pe.js";import{E as d}from"./el-pagination-CtB_7xL3.js";/* empty css               */import"./el-select-Bw7Pegjc.js";/* empty css                     *//* empty css                             *//* empty css                    *//* empty css                *//* empty css                */import{C as v}from"./Card-C2cEsA2A.js";/* empty css                                                                        */import{ap as p,am as m,an as f,aW as g,bO as _,av as h,ar as y,at as w,as as b,au as k,aJ as x,aQ as j,az as C,aR as z,ax as E,aq as T,aL as F}from"./editor-CW41Mq4b.js";/* empty css                   *//* empty css                */import{E as I}from"./index-BjikXUqk.js";import{E as V}from"./index-BUf4NCen.js";import{E as H}from"./strings-CI1rj266.js";import{E as q,a as D}from"./index-Fgx7eeaB.js";import{E as U}from"./index-Du5-dQS0.js";import{E as A}from"./index-CqpIP0RU.js";import"./index-BxFhwaSO.js";import"./toNumber-BQm7RcjZ.js";import"./_baseIteratee-CQMEzKuW.js";import"./flatMap-BD_qzh05.js";import"./map-Be3_7zp7.js";import"./_baseEach-BSLja2hJ.js";import"./raf-B6jWGkGX.js";const P={runTests:(a="unit",s=!0,l=!0)=>e.post("/test/run",{test_type:a,coverage:s,verbose:l}),getTestStatus:a=>e.get(`/test/status/${a}`),getCoverageData:()=>e.get("/test/coverage"),getTestHistory:(a=20)=>e.get("/test/history",{params:{limit:a}}),clearHistory:()=>e.post("/test/clear-history"),getQuickInfo:()=>e.get("/test/quick-info")},Q={class:"automated-test"},S={class:"quick-info-grid"},G={class:"info-content"},J={class:"info-text"},L={class:"info-value"},N={class:"info-content"},O={class:"info-text"},R={class:"info-value"},M={class:"info-content"},W={class:"info-text"},$={class:"info-content"},B={class:"info-text"},K={class:"info-value small"},X={class:"control-panel"},Y={class:"run-options"},Z={key:0,class:"results-panel"},ee={class:"stats-header"},ae={class:"test-stats"},se={class:"stat-item success"},le={class:"stat-content"},te={class:"stat-value"},ie={class:"stat-item danger"},re={class:"stat-content"},ne={class:"stat-value"},oe={class:"stat-item warning"},ce={class:"stat-content"},ue={class:"stat-value"},de={class:"stat-item info"},ve={class:"stat-content"},pe={class:"stat-value"},me={class:"stat-item"},fe={class:"stat-content"},ge={class:"stat-value"},_e={key:1,class:"coverage-section"},he={class:"coverage-header"},ye={class:"coverage-summary"},we={class:"summary-item"},be={class:"summary-value"},ke={class:"summary-item"},xe={class:"summary-value success"},je={class:"summary-item"},Ce={class:"summary-value danger"},ze={class:"pagination-wrapper"},Ee={class:"history-section"},Te={class:"history-header"},Fe={class:"header-actions"},Ie={key:0,class:"result-summary"},Ve={class:"result-item success"},He={class:"result-item danger"},qe={class:"result-item warning"},De={key:1,class:"text-muted"},Ue={key:0},Ae={key:1,class:"text-muted"},Pe={key:0,class:"empty-state"},Qe={key:2,class:"logs-section"},Se={class:"logs-header"},Ge={class:"header-actions"},Je={key:0,class:"logs-content"},Le={key:1,class:"empty-logs"},Ne=c(p({__name:"AutomatedTest",setup(e){const c=m(null),p=m("unit"),Ne=m(!0),Oe=m(!1),Re=m(null),Me=m(null),We=m(null),$e=m(null),Be=m([]),Ke=m(null),Xe=m(1),Ye=m(20),Ze=f(()=>{if(!$e.value)return[];const e=(Xe.value-1)*Ye.value,a=e+Ye.value;return $e.value.files.slice(e,a)}),ea=async()=>{try{const e=await P.getQuickInfo();e.success&&(c.value=e.info)}catch(e){}},aa=async()=>{var e,a;if(!Oe.value)try{const e=await P.runTests(p.value,Ne.value,!0);e.success&&(Me.value=e.task_id,Oe.value=!0,n.success("æµ‹è¯•å·²å¼€å§‹è¿è¡Œ"),sa())}catch(s){n.error((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.error)||"å¯åŠ¨æµ‹è¯•å¤±è´¥")}},sa=()=>{We.value&&clearInterval(We.value),We.value=window.setInterval(async()=>{if(Me.value)try{const e=await P.getTestStatus(Me.value);e.success&&(Re.value=e.task,await F(),Ke.value&&(Ke.value.scrollTop=Ke.value.scrollHeight),"completed"!==Re.value.status&&"failed"!==Re.value.status||(la(),Oe.value=!1,Ne.value&&"completed"===Re.value.status&&await ta(),await ea(),await ia(),"completed"===Re.value.status?n.success("æµ‹è¯•è¿è¡Œå®Œæˆ"):n.error("æµ‹è¯•è¿è¡Œå¤±è´¥")))}catch(e){}},1e3)},la=()=>{We.value&&(clearInterval(We.value),We.value=null)},ta=async()=>{try{const e=await P.getCoverageData();e.success&&($e.value=e.coverage)}catch(e){}},ia=async()=>{try{const e=await P.getTestHistory(20);e.success&&(Be.value=e.history)}catch(e){}},ra=async()=>{try{await o.confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•åŽ†å²è®°å½•å—ï¼Ÿ","ç¡®è®¤æ¸…é™¤",{type:"warning"}),await P.clearHistory(),Be.value=[],n.success("åŽ†å²è®°å½•å·²æ¸…é™¤")}catch(e){}},na=()=>{var e;if(!(null==(e=Re.value)?void 0:e.logs))return;const a=Re.value.logs.join("\n");navigator.clipboard.writeText(a).then(()=>{n.success("æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")})},oa=e=>e>=80?"coverage-excellent":e>=50?"coverage-good":e>=30?"coverage-fair":"coverage-poor",ca=e=>e>=80?"#67C23A":e>=50?"#409EFF":e>=30?"#E6A23C":"#F56C6C",ua=e=>({pending:"ç­‰å¾…ä¸­",running:"è¿è¡Œä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"}[e]||e),da=e=>{Ye.value=e,Xe.value=1},va=e=>{Xe.value=e};return g(async()=>{await ea(),await ia(),await ta()}),_(()=>{la()}),(e,o)=>{const m=l,f=I,g=s,_=a,F=V,P=H,Me=U,We=D,sa=q,la=d,ta=u,pa=A;return y(),h("div",Q,[w(E(v),{title:"ðŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œå™¨"},{extra:b(()=>[w(m,{onClick:ea,icon:E(r),circle:"",size:"small",title:"åˆ·æ–°"},null,8,["icon"])]),default:b(()=>{var e;return[k("div",S,[w(f,{class:"info-card",shadow:"hover"},{default:b(()=>{var e;return[k("div",G,[o[5]||(o[5]=k("i",{class:"bi-list-check info-icon"},null,-1)),k("div",J,[o[4]||(o[4]=k("div",{class:"info-label"},"æ€»æµ‹è¯•æ•°",-1)),k("div",L,j((null==(e=c.value)?void 0:e.total_tests)||0),1)])])]}),_:1}),w(f,{class:"info-card",shadow:"hover"},{default:b(()=>{var e;return[k("div",N,[o[7]||(o[7]=k("i",{class:"bi-file-earmark-code info-icon"},null,-1)),k("div",O,[o[6]||(o[6]=k("div",{class:"info-label"},"æµ‹è¯•æ–‡ä»¶",-1)),k("div",R,j((null==(e=c.value)?void 0:e.test_files)||0),1)])])]}),_:1}),w(f,{class:"info-card",shadow:"hover"},{default:b(()=>{var e,a;return[k("div",M,[o[9]||(o[9]=k("i",{class:"bi-pie-chart info-icon"},null,-1)),k("div",W,[o[8]||(o[8]=k("div",{class:"info-label"},"æµ‹è¯•è¦†ç›–çŽ‡",-1)),k("div",{class:C(["info-value",oa((null==(e=c.value)?void 0:e.coverage_percent)||0)])},j(((null==(a=c.value)?void 0:a.coverage_percent)||0).toFixed(2))+"% ",3)])])]}),_:1}),w(f,{class:"info-card",shadow:"hover"},{default:b(()=>{var e;return[k("div",$,[o[11]||(o[11]=k("i",{class:"bi-clock-history info-icon"},null,-1)),k("div",B,[o[10]||(o[10]=k("div",{class:"info-label"},"æœ€åŽè¿è¡Œ",-1)),k("div",K,j((null==(e=c.value)?void 0:e.last_run)||"æœªè¿è¡Œ"),1)])])]}),_:1})]),k("div",X,[w(f,{shadow:"never"},{header:b(()=>[...o[12]||(o[12]=[k("span",null,"è¿è¡Œæµ‹è¯•",-1)])]),default:b(()=>[k("div",Y,[w(_,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=e=>p.value=e),disabled:Oe.value},{default:b(()=>[w(g,{value:"unit"},{default:b(()=>[...o[13]||(o[13]=[z("å•å…ƒæµ‹è¯•",-1)])]),_:1}),w(g,{value:"integration"},{default:b(()=>[...o[14]||(o[14]=[z("é›†æˆæµ‹è¯•",-1)])]),_:1}),w(g,{value:"all"},{default:b(()=>[...o[15]||(o[15]=[z("å…¨éƒ¨æµ‹è¯•",-1)])]),_:1})]),_:1},8,["modelValue","disabled"]),w(F,{modelValue:Ne.value,"onUpdate:modelValue":o[1]||(o[1]=e=>Ne.value=e),disabled:Oe.value},{default:b(()=>[...o[16]||(o[16]=[z(" ç”Ÿæˆè¦†ç›–çŽ‡æŠ¥å‘Š ",-1)])]),_:1},8,["modelValue","disabled"]),w(m,{type:"primary",icon:Oe.value?E(t):E(i),loading:Oe.value,onClick:aa,size:"large"},{default:b(()=>[z(j(Oe.value?"æµ‹è¯•è¿è¡Œä¸­...":"å¼€å§‹æµ‹è¯•"),1)]),_:1},8,["icon","loading"])])]),_:1})]),(null==(e=Re.value)?void 0:e.result)?(y(),h("div",Z,[w(f,{shadow:"never",class:"stats-card"},{header:b(()=>[k("div",ee,[o[17]||(o[17]=k("span",null,"æµ‹è¯•ç»“æžœ",-1)),w(P,{type:Re.value.result.passed?"success":"danger",effect:"dark"},{default:b(()=>[z(j(Re.value.result.passed?"âœ… é€šè¿‡":"âŒ å¤±è´¥"),1)]),_:1},8,["type"])])]),default:b(()=>{var e;return[k("div",ae,[k("div",se,[o[19]||(o[19]=k("i",{class:"bi-check-circle"},null,-1)),k("div",le,[o[18]||(o[18]=k("div",{class:"stat-label"},"é€šè¿‡",-1)),k("div",te,j(Re.value.result.passed),1)])]),k("div",ie,[o[21]||(o[21]=k("i",{class:"bi-x-circle"},null,-1)),k("div",re,[o[20]||(o[20]=k("div",{class:"stat-label"},"å¤±è´¥",-1)),k("div",ne,j(Re.value.result.failed),1)])]),k("div",oe,[o[23]||(o[23]=k("i",{class:"bi-skip-forward-circle"},null,-1)),k("div",ce,[o[22]||(o[22]=k("div",{class:"stat-label"},"è·³è¿‡",-1)),k("div",ue,j(Re.value.result.skipped),1)])]),k("div",de,[o[25]||(o[25]=k("i",{class:"bi-exclamation-circle"},null,-1)),k("div",ve,[o[24]||(o[24]=k("div",{class:"stat-label"},"é”™è¯¯",-1)),k("div",pe,j(Re.value.result.errors),1)])]),k("div",me,[o[27]||(o[27]=k("i",{class:"bi-stopwatch"},null,-1)),k("div",fe,[o[26]||(o[26]=k("div",{class:"stat-label"},"è€—æ—¶",-1)),k("div",ge,j(null==(e=Re.value.result.duration)?void 0:e.toFixed(2))+"s",1)])])])]}),_:1})])):x("",!0),$e.value?(y(),h("div",_e,[w(f,{shadow:"never"},{header:b(()=>[k("div",he,[o[28]||(o[28]=k("span",null,"æµ‹è¯•è¦†ç›–çŽ‡",-1)),w(Me,{percentage:$e.value.coverage_percent,color:ca($e.value.coverage_percent),"stroke-width":20,"text-inside":""},null,8,["percentage","color"])])]),default:b(()=>[k("div",ye,[k("div",we,[o[29]||(o[29]=k("span",{class:"summary-label"},"æ€»ä»£ç è¡Œæ•°:",-1)),k("span",be,j($e.value.total_statements),1)]),k("div",ke,[o[30]||(o[30]=k("span",{class:"summary-label"},"å·²è¦†ç›–:",-1)),k("span",xe,j($e.value.covered_statements),1)]),k("div",je,[o[31]||(o[31]=k("span",{class:"summary-label"},"æœªè¦†ç›–:",-1)),k("span",Ce,j($e.value.missing_statements),1)])]),w(sa,{data:Ze.value,border:"",stripe:"","max-height":"400"},{default:b(()=>[w(We,{prop:"file",label:"æ–‡ä»¶","min-width":"300","show-overflow-tooltip":""}),w(We,{prop:"statements",label:"æ€»è¡Œæ•°",width:"100",align:"center"}),w(We,{prop:"covered",label:"å·²è¦†ç›–",width:"100",align:"center"}),w(We,{prop:"missing",label:"æœªè¦†ç›–",width:"100",align:"center"}),w(We,{label:"è¦†ç›–çŽ‡",width:"150",align:"center"},{default:b(({row:e})=>[w(Me,{percentage:e.coverage,color:ca(e.coverage),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),k("span",{class:C(oa(e.coverage)),style:{"margin-left":"8px"}},j(e.coverage.toFixed(1))+"% ",3)]),_:1})]),_:1},8,["data"]),k("div",ze,[w(la,{"current-page":Xe.value,"onUpdate:currentPage":o[2]||(o[2]=e=>Xe.value=e),"page-size":Ye.value,"onUpdate:pageSize":o[3]||(o[3]=e=>Ye.value=e),"page-sizes":[10,20,50,100],total:$e.value.files.length,layout:"total, sizes, prev, pager, next",onSizeChange:da,onCurrentChange:va},null,8,["current-page","page-size","total"])])]),_:1})])):x("",!0),k("div",Ee,[w(f,{shadow:"never"},{header:b(()=>[k("div",Te,[o[34]||(o[34]=k("span",null,"æµ‹è¯•åŽ†å²",-1)),k("div",Fe,[w(m,{size:"small",onClick:ia},{default:b(()=>[...o[32]||(o[32]=[z("åˆ·æ–°",-1)])]),_:1}),w(m,{size:"small",type:"danger",onClick:ra},{default:b(()=>[...o[33]||(o[33]=[z("æ¸…é™¤",-1)])]),_:1})])])]),default:b(()=>[w(sa,{data:Be.value,border:"",stripe:""},{default:b(()=>[w(We,{label:"ä»»åŠ¡ID",width:"200","show-overflow-tooltip":""},{default:b(({row:e})=>[w(ta,{size:"small",type:"info"},{default:b(()=>[z(j(e.task_id),1)]),_:2},1024)]),_:1}),w(We,{prop:"test_type",label:"æµ‹è¯•ç±»åž‹",width:"120",align:"center"},{default:b(({row:e})=>[w(P,{size:"small",effect:"plain"},{default:b(()=>{return[z(j((a=e.test_type,{unit:"å•å…ƒæµ‹è¯•",integration:"é›†æˆæµ‹è¯•",all:"å…¨éƒ¨æµ‹è¯•"}[a]||a)),1)];var a}),_:2},1024)]),_:1}),w(We,{label:"çŠ¶æ€",width:"100",align:"center"},{default:b(({row:e})=>{return[w(P,{type:(a=e.status,{pending:"info",running:"warning",completed:"success",failed:"danger"}[a]||"info"),size:"small"},{default:b(()=>[z(j(ua(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),w(We,{label:"ç»“æžœ",width:"200",align:"center"},{default:b(({row:e})=>[e.result?(y(),h("div",Ie,[k("span",Ve,"âœ“ "+j(e.result.passed),1),k("span",He,"âœ— "+j(e.result.failed),1),k("span",qe,"âŠ™ "+j(e.result.skipped),1)])):(y(),h("span",De,"-"))]),_:1}),w(We,{prop:"created_time",label:"åˆ›å»ºæ—¶é—´",width:"180"}),w(We,{label:"è€—æ—¶",width:"100",align:"center"},{default:b(({row:e})=>{var a;return[e.result?(y(),h("span",Ue,j(null==(a=e.result.duration)?void 0:a.toFixed(2))+"s",1)):(y(),h("span",Ae,"-"))]}),_:1}),w(We,{label:"æ“ä½œ",width:"120",fixed:"right",align:"center"},{default:b(({row:e})=>[w(m,{size:"small",onClick:a=>{return s=e,Re.value=s,void n.info("å·²åŠ è½½æµ‹è¯•è¯¦æƒ…");var s}},{default:b(()=>[...o[35]||(o[35]=[z("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),0===Be.value.length?(y(),h("div",Pe,[w(pa,{description:"æš‚æ— æµ‹è¯•åŽ†å²"})])):x("",!0)]),_:1})]),Re.value?(y(),h("div",Qe,[w(f,{shadow:"never",class:"logs-card"},{header:b(()=>[k("div",Se,[o[38]||(o[38]=k("span",null,"ðŸ“ æµ‹è¯•æ—¥å¿—",-1)),k("div",Ge,[Oe.value?(y(),T(P,{key:0,type:"info",effect:"plain"},{default:b(()=>[...o[36]||(o[36]=[k("i",{class:"bi-arrow-clockwise rotating"},null,-1),z(" è¿è¡Œä¸­... ",-1)])]),_:1})):x("",!0),w(m,{size:"small",onClick:na},{default:b(()=>[...o[37]||(o[37]=[z("å¤åˆ¶æ—¥å¿—",-1)])]),_:1})])])]),default:b(()=>[k("div",{class:"logs-container",ref_key:"logsContainer",ref:Ke},[Re.value.logs&&Re.value.logs.length>0?(y(),h("pre",Je,j(Re.value.logs.join("\n")),1)):(y(),h("div",Le,[...o[39]||(o[39]=[k("i",{class:"bi-terminal"},null,-1),k("p",null,"ç­‰å¾…æµ‹è¯•å¼€å§‹...",-1)])]))],512)]),_:1})])):x("",!0)]}),_:1})])}}}),[["__scopeId","data-v-6b29508e"]]);export{Ne as default};
