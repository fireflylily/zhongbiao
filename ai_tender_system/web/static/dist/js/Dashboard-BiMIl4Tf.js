import{M as a,O as e,d as t,_ as i}from"./index.js";import{E as o}from"./el-pagination-Bqdl1fQI.js";/* empty css               */import"./el-select-CEg_eSdx.js";/* empty css                     *//* empty css                             *//* empty css                    *//* empty css                *//* empty css                                                                          */import{u as s}from"./project-DbnoBzyY.js";import{t as r}from"./tender-DY5X_q7i.js";import{am as l,an as n,aX as c,au as d,ar as p,ax as u,as as m,ay as f,aw as g,az as v,aA as b,aJ as _,aB as j,aC as y,aq as h,aD as w,bd as k}from"./editor-DtHwR8yc.js";import{L as x}from"./Loading-CEvPa6xQ.js";import{E as C}from"./Empty-CGgUzHTC.js";/* empty css                */import{C as P}from"./Card-LFFlZQNZ.js";import{I as T}from"./IconButton-7mQ-jX05.js";/* empty css                *//* empty css                   *//* empty css                                                        */import{E as D,a as M}from"./index-BFjCVuqR.js";import{E}from"./index-DFUYL1-3.js";import{E as z,a as I}from"./index-2X3NYXDr.js";import{E as Y}from"./index-witGV_PC.js";import{E as q}from"./index-BkIdrdH2.js";import{c as A}from"./company-CHa0NuIL.js";import"./index-BCSTGAKU.js";import"./strings-BND1Cqg8.js";import"./index-CzeRX9sj.js";import"./toNumber-D7Yc6kTN.js";import"./_baseFindIndex-BTqrMG7V.js";import"./_baseIteratee-ByQT0QPi.js";import"./index-B1D0B4Gf.js";import"./flatMap-BdIFri63.js";import"./map-l56HRvAj.js";import"./_baseEach-Dq22CNAR.js";import"./index-DL_Xf39J.js";import"./raf-BZHcGSIv.js";const H={class:"dashboard-page"},S={class:"quick-actions"},U=["onClick"],$={class:"action-label"},B={class:"pagination-wrapper"},F=i(l({__name:"Dashboard",setup(i){const l=a(),F=s(),{success:J,error:L,confirm:O}=e(),R=n(!1),X=n(!1),G=n({totalProjects:0,inProgressProjects:0,wonThisMonth:0,pendingTasks:0}),N=n([]),Q=n(1),Z=n(10),K=n(0),V=[{name:"start-tender",label:"开始投标",icon:"bi bi-play-circle-fill",color:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",route:"/tender-management"},{name:"business-response",label:"商务应答",icon:"bi bi-briefcase-fill",color:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",route:"/business-response"},{name:"point-to-point",label:"点对点应答",icon:"bi bi-arrow-left-right",color:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",route:"/point-to-point"},{name:"tech-proposal",label:"技术方案",icon:"bi bi-file-code-fill",color:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",route:"/tech-proposal"},{name:"tender-scoring",label:"标书评分",icon:"bi bi-star-fill",color:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",route:"/tender-scoring"},{name:"knowledge",label:"知识中心",icon:"bi bi-book-fill",color:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)",route:"/knowledge/company-library"}];async function W(){X.value=!0;try{const a=await r.getProjects({page:Q.value,page_size:Z.value});a.success&&a.data&&(Array.isArray(a.data)?(N.value=a.data,K.value=a.data.length):a.data.items&&(N.value=a.data.items,K.value=a.data.total||0))}catch(a){L("加载项目列表失败: "+a.message)}finally{X.value=!1}}async function aa(){await W(),J("刷新成功")}async function ea(){try{const a=(await A.getCompanies()).data||[];if(0===a.length)return void L("无法创建项目：请先添加公司信息");const e=(await r.createProject({project_name:"新项目",project_number:`PRJ-${Date.now()}`,company_id:a[0].company_id})).project_id;J("创建成功"),l.push({name:"TenderManagementDetail",params:{id:e}})}catch(a){L("创建项目失败: "+a.message)}}function ta(a){F.setCurrentProject(a),l.push({name:"TenderManagementDetail",params:{id:a.id}})}function ia(a){Z.value=a,Q.value=1,W()}function oa(a){Q.value=a,W()}function sa(a){return{pending:"待处理",in_progress:"进行中",completed:"已完成",won:"已中标",lost:"未中标",archived:"已归档"}[a]||a}return c(()=>{!async function(){R.value=!0;try{const a=await r.getDashboardStatistics();a.success&&a.data&&(G.value={totalProjects:a.data.totalProjects,inProgressProjects:a.data.inProgressProjects,wonThisMonth:a.data.wonThisMonth,pendingTasks:a.data.pendingTasks})}catch(a){L("加载统计数据失败: "+a.message)}finally{R.value=!1}}(),W()}),(a,e)=>{const i=E,s=D,r=M,n=t,c=Y,A=I,ra=q,la=z,na=o;return p(),d("div",H,[u(r,{gutter:16,class:"kpi-cards"},{default:m(()=>[u(s,{xs:12,sm:12,md:6,lg:6},{default:m(()=>[u(f(P),{shadow:"hover",loading:R.value},{default:m(()=>[u(i,{title:"总项目数",value:G.value.totalProjects},{prefix:m(()=>[...e[2]||(e[2]=[g("i",{class:"bi bi-folder-fill statistic-icon",style:{color:"#409eff"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1}),u(s,{xs:12,sm:12,md:6,lg:6},{default:m(()=>[u(f(P),{shadow:"hover",loading:R.value},{default:m(()=>[u(i,{title:"进行中项目",value:G.value.inProgressProjects},{prefix:m(()=>[...e[3]||(e[3]=[g("i",{class:"bi bi-clock-fill statistic-icon",style:{color:"#e6a23c"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1}),u(s,{xs:12,sm:12,md:6,lg:6},{default:m(()=>[u(f(P),{shadow:"hover",loading:R.value},{default:m(()=>[u(i,{title:"本月中标",value:G.value.wonThisMonth},{prefix:m(()=>[...e[4]||(e[4]=[g("i",{class:"bi bi-trophy-fill statistic-icon",style:{color:"#67c23a"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1}),u(s,{xs:12,sm:12,md:6,lg:6},{default:m(()=>[u(f(P),{shadow:"hover",loading:R.value},{default:m(()=>[u(i,{title:"待处理任务",value:G.value.pendingTasks},{prefix:m(()=>[...e[5]||(e[5]=[g("i",{class:"bi bi-list-task statistic-icon",style:{color:"#f56c6c"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1})]),_:1}),u(f(P),{title:"快捷入口",class:"quick-actions-card"},{default:m(()=>[g("div",S,[(p(),d(v,null,b(V,a=>g("div",{key:a.name,class:"action-item",onClick:e=>async function(a){"start-tender"===a.name?await ea():l.push(a.route)}(a)},[g("div",{class:"action-icon",style:_({background:a.color})},[g("i",{class:j(a.icon)},null,2)],4),g("div",$,y(a.label),1)],8,U)),64))])]),_:1}),u(f(P),{title:"进行中的项目",class:"projects-card"},{actions:m(()=>[u(f(T),{icon:"bi-arrow-clockwise",tooltip:"刷新",onClick:aa})]),default:m(()=>[X.value?(p(),h(f(x),{key:0,visible:!0,fullscreen:!1,text:"加载项目列表..."})):0===N.value.length?(p(),h(f(C),{key:1,type:"no-data",description:"暂无进行中的项目"},{action:m(()=>[u(n,{type:"primary",onClick:ea},{default:m(()=>[...e[6]||(e[6]=[w("创建第一个项目",-1)])]),_:1})]),_:1})):(p(),d(v,{key:2},[u(la,{data:N.value,stripe:"",style:{width:"100%"}},{default:m(()=>[u(A,{prop:"project_name",label:"项目名称","min-width":"200"},{default:m(({row:a})=>[u(c,{type:"primary",onClick:e=>ta(a)},{default:m(()=>[w(y(a.project_name),1)]),_:2},1032,["onClick"])]),_:1}),u(A,{prop:"project_number",label:"项目编号",width:"150"}),u(A,{prop:"status",label:"状态",width:"120"},{default:m(({row:a})=>{return[u(ra,{type:(e=a.status,{pending:"info",in_progress:"warning",completed:"success",won:"success",lost:"danger",archived:"info"}[e]||"info")},{default:m(()=>[w(y(sa(a.status)),1)]),_:2},1032,["type"])];var e}),_:1}),u(A,{prop:"company_name",label:"关联企业",width:"200"}),u(A,{prop:"created_at",label:"创建时间",width:"180"},{default:m(({row:a})=>{return[w(y((e=a.created_at,e?k(e).format("YYYY-MM-DD HH:mm"):"-")),1)];var e}),_:1}),u(A,{label:"操作",width:"200",fixed:"right"},{default:m(({row:a})=>[u(f(T),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:e=>ta(a)},null,8,["onClick"]),u(f(T),{icon:"bi-play-circle",type:"success",tooltip:"继续处理",onClick:e=>{return t=a,F.setCurrentProject(t),void l.push({name:"TenderManagementDetail",params:{id:t.id}});var t}},null,8,["onClick"]),u(f(T),{icon:"bi-archive",type:"warning",tooltip:"归档",onClick:e=>async function(a){if(await O(`确定要归档项目"${a.project_name}"吗?`,"归档项目","归档后项目将不再显示在进行中列表"))try{await F.updateProject(a.id,{status:"archived"}),J("项目已归档"),await W()}catch(e){L("归档失败: "+e.message)}}(a)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),g("div",B,[u(na,{"current-page":Q.value,"onUpdate:currentPage":e[0]||(e[0]=a=>Q.value=a),"page-size":Z.value,"onUpdate:pageSize":e[1]||(e[1]=a=>Z.value=a),total:K.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ia,onCurrentChange:oa},null,8,["current-page","page-size","total"])])],64))]),_:1})])}}}),[["__scopeId","data-v-e6e7f962"]]);export{F as default};
