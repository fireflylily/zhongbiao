import{E as e,_ as t}from"./index.js";import{am as a,an as s,aq as l,aw as i,as as n,aK as r,au as o,aR as c,at as u,aX as d,aY as f,ar as p,av as m,bL as y}from"./editor-BksuvsBo.js";/* empty css                             *//* empty css                                                                          */import{a as v,E as h}from"./index-BC8-jPfA.js";import{E as _}from"./index-TaNLZe78.js";function w(t={}){const{onFileLoaded:l,onFileCancelled:i,onSyncSuccess:n}=t,r=a(!1),o=a(null),c=a(!1),u=a(!1),d=s(()=>!!o.value),f=e=>({technicalFile:"技术需求文件",tenderFile:"招标文档",templateFile:"应答模板",businessResponseFile:"商务应答文件",p2pResponseFile:"点对点应答文件",techProposalFile:"技术方案文件"}[e]||"文件");return{useHitlFile:r,hitlFileInfo:o,hasHitlFile:d,syncing:c,synced:u,loadFromHITL:(t,a="technicalFile")=>{const s=t[a];return s?(o.value={filename:s.filename||s.name||"未知文件",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},r.value=!0,u.value=!1,l&&l(o.value),!0):(e.warning(`当前项目没有${f(a)}`),!1)},cancelHitlFile:()=>{r.value=!1,o.value=null,u.value=!1,i&&i()},syncToHitl:async(t,a,s)=>{if(!t)return e.error("项目ID无效"),!1;if(!a)return e.error("文件路径无效"),!1;c.value=!0;try{const l=await fetch(`/api/tender-processing/sync-file/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:a,file_type:s})}),i=l.headers.get("content-type");if(!(null==i?void 0:i.includes("application/json"))){await l.text();throw new Error(`服务器返回异常响应 (${l.status}): ${l.statusText}。可能是后端配置问题，请联系管理员。`)}const r=await l.json();if(r.success||l.ok)return u.value=!0,e.success({message:r.message||"已成功同步到投标项目",duration:3e3}),n&&await n(),!0;throw new Error(r.error||r.message||"同步失败")}catch(l){let t="同步到项目失败";return l.message?t=l.message:"TypeError"===l.name&&(t="网络请求失败，请检查网络连接"),e.error({message:t,duration:5e3}),!1}finally{c.value=!1}},resetSyncStatus:()=>{u.value=!1}}}const b={class:"stats-card"},g={key:0,class:"stats-title"},x={class:"stat-item"},k={class:"stat-prefix"},j={class:"stat-suffix"},F=t(l({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,a=[{key:"total_replacements",label:"文本替换",suffix:"处"},{key:"tables_processed",label:"表格处理",suffix:"个"},{key:"cells_filled",label:"单元格填充",suffix:"个"},{key:"images_inserted",label:"图片插入",suffix:"张"}],l=s(()=>t.statItems||a),w=e=>{const a=e.split(".");let s=t.stats;for(const t of a)if(s=null==s?void 0:s[t],null==s)break;return"number"==typeof s?s:0};return(t,a)=>{const s=_,F=h,E=v;return n(),i("div",b,[e.title?(n(),i("h4",g,c(e.title),1)):r("",!0),o(E,{gutter:e.gutter},{default:u(()=>[(n(!0),i(d,null,f(l.value,t=>(n(),p(F,{key:t.key,span:e.span},{default:u(()=>[m("div",x,[o(s,{title:t.label,value:w(t.key),precision:t.precision,"value-style":e.valueStyle},y({_:2},[t.prefix?{name:"prefix",fn:u(()=>[m("span",k,c(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:u(()=>[m("span",j,c(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]);async function E(e,t){if("string"!=typeof e){const a=URL.createObjectURL(e),s=document.createElement("a");return s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),void URL.revokeObjectURL(a)}try{const a=await fetch(e);if(!a.ok){const e=a.headers.get("content-type");if(e&&e.includes("application/json")){const e=await a.json();throw new Error(e.error||e.message||"文件下载失败")}throw new Error(`文件下载失败: HTTP ${a.status}`)}const s=a.headers.get("content-type");if(s&&(s.includes("text/html")||s.includes("application/json")))throw new Error("服务器返回了错误页面，而不是文件");const l=await a.blob(),i=URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}catch(a){throw a}}export{F as S,E as d,w as u};
