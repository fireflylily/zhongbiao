import{a0 as e,R as t,av as a,at as s,$ as l,aV as i,bH as o,u as n,V as r,aH as c,l as d,bo as u,S as p,bK as f,n as m,w as y,a_ as v,E as h,_ as b,q as _,h as g,o as w,a3 as x,bL as k,B as F,C,K as I}from"./index.js";import{bB as j,bL as E,am as $,ax as H,an as T,bS as z,cf as B,aw as K,aC as S,az as R,aI as L,aN as U,aF as A,bR as N,aO as M,aE as O,aR as P,aQ as V,aA as Y,ay as D,aP as W,bv as Q,aS as q,aB as G,aT as J,bc as X,aD as Z,aU as ee,aV as te,bI as ae}from"./editor-BnIwMfSr.js";/* empty css               */import{E as se}from"./strings-C1SMPKoP.js";/* empty css                                                                          *//* empty css                   *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                */import{a as le,E as ie}from"./index-Dh38pzO-.js";import{E as oe}from"./index-BhsqAqez.js";import{E as ne}from"./index-ar64J6fA.js";import{E as re,a as ce}from"./index-BMxBI-V1.js";import{E as de}from"./index-BINbdg4f.js";import{E as ue}from"./index-CUh-g4N_.js";import{E as pe,a as fe}from"./index-C_g1mHHx.js";import{v as me}from"./directive-B9ITkhAB.js";import{E as ye}from"./index-BfjLEO_7.js";const ve=t=>e(t)||j(t)||E(t),he=t({accordion:Boolean,modelValue:{type:l([Array,String,Number]),default:()=>i([])},expandIconPosition:{type:l([String]),default:"right"},beforeCollapse:{type:l(Function)}}),be={[s]:ve,[a]:ve},_e=Symbol("collapseContextKey"),ge=K({name:"ElCollapse"});var we=d(K({...ge,props:he,emits:be,setup(e,{expose:t,emit:l}){const i=e,{activeNames:d,setActiveNames:u}=((e,t)=>{const l=$(o(e.modelValue)),i=i=>{l.value=i;const o=e.accordion?l.value[0]:l.value;t(s,o),t(a,o)},n=t=>{if(e.accordion)i([l.value[0]===t?"":t]);else{const e=[...l.value],a=e.indexOf(t);a>-1?e.splice(a,1):e.push(t),i(e)}};return H(()=>e.modelValue,()=>l.value=o(e.modelValue),{deep:!0}),z(_e,{activeNames:l,handleItemClick:async t=>{const{beforeCollapse:a}=e;if(!a)return void n(t);const s=a(t);[B(s),r(s)].includes(!0)||c("ElCollapse","beforeCollapse must return type `Promise<boolean>` or `boolean`"),B(s)?s.then(e=>{!1!==e&&n(t)}).catch(e=>{}):s&&n(t)}}),{activeNames:l,setActiveNames:i}})(i,l),{rootKls:p}=(e=>{const t=n("collapse");return{rootKls:T(()=>[t.b(),t.b(`icon-position-${e.expandIconPosition}`)])}})(i);return t({activeNames:d,setActiveNames:u}),(e,t)=>(R(),S("div",{class:U(A(p))},[L(e.$slots,"default")],2))}}),[["__file","collapse.vue"]]);const xe=t({title:{type:String,default:""},name:{type:l([String,Number]),default:void 0},icon:{type:p,default:u},disabled:Boolean}),ke=K({name:"ElCollapseItem"});var Fe=d(K({...ke,props:xe,setup(e,{expose:t}){const a=e,{focusing:s,id:l,isActive:i,handleFocus:o,handleHeaderClick:r,handleEnterClick:c}=(e=>{const t=N(_e),{namespace:a}=n("collapse"),s=$(!1),l=$(!1),i=f(),o=T(()=>i.current++),r=T(()=>{var t;return null!=(t=e.name)?t:`${a.value}-id-${i.prefix}-${A(o)}`}),c=T(()=>null==t?void 0:t.activeNames.value.includes(A(r)));return{focusing:s,id:o,isActive:c,handleFocus:()=>{setTimeout(()=>{l.value?l.value=!1:s.value=!0},50)},handleHeaderClick:a=>{if(e.disabled)return;const i=a.target;(null==i?void 0:i.closest("input, textarea, select"))||(null==t||t.handleItemClick(A(r)),s.value=!1,l.value=!0)},handleEnterClick:e=>{const a=e.target;(null==a?void 0:a.closest("input, textarea, select"))||(e.preventDefault(),null==t||t.handleItemClick(A(r)))}}})(a),{arrowKls:d,headKls:u,rootKls:p,itemTitleKls:y,itemWrapperKls:v,itemContentKls:h,scopedContentId:b,scopedHeadId:_}=((e,{focusing:t,isActive:a,id:s})=>{const l=n("collapse"),i=T(()=>[l.b("item"),l.is("active",A(a)),l.is("disabled",e.disabled)]),o=T(()=>[l.be("item","header"),l.is("active",A(a)),{focusing:A(t)&&!e.disabled}]),r=T(()=>[l.be("item","arrow"),l.is("active",A(a))]);return{itemTitleKls:T(()=>[l.be("item","title")]),arrowKls:r,headKls:o,rootKls:i,itemWrapperKls:T(()=>l.be("item","wrap")),itemContentKls:T(()=>l.be("item","content")),scopedContentId:T(()=>l.b(`content-${A(s)}`)),scopedHeadId:T(()=>l.b(`head-${A(s)}`))}})(a,{focusing:s,isActive:i,id:l});return t({isActive:i}),(e,t)=>(R(),S("div",{class:U(A(p))},[M("div",{id:A(_),class:U(A(u)),"aria-expanded":A(i),"aria-controls":A(b),"aria-describedby":A(b),tabindex:e.disabled?-1:0,role:"button",onClick:A(r),onKeydown:Q(q(A(c),["stop"]),["space","enter"]),onFocus:A(o),onBlur:e=>s.value=!1},[M("span",{class:U(A(y))},[L(e.$slots,"title",{isActive:A(i)},()=>[P(V(e.title),1)])],2),L(e.$slots,"icon",{isActive:A(i)},()=>[O(A(m),{class:U(A(d))},{default:Y(()=>[(R(),D(W(e.icon)))]),_:1},8,["class"])])],42,["id","aria-expanded","aria-controls","aria-describedby","tabindex","onClick","onKeydown","onFocus","onBlur"]),O(A(ue),null,{default:Y(()=>[G(M("div",{id:A(b),role:"region",class:U(A(v)),"aria-hidden":!A(i),"aria-labelledby":A(_)},[M("div",{class:U(A(h))},[L(e.$slots,"default")],2)],10,["id","aria-hidden","aria-labelledby"]),[[J,A(i)]])]),_:3})],2))}}),[["__file","collapse-item.vue"]]);const Ce=y(we,{CollapseItem:Fe}),Ie=v(Fe);function je(e={}){const{onFileLoaded:t,onFileCancelled:a,onSyncSuccess:s}=e,l=$(!1),i=$(null),o=$(!1),n=$(!1),r=T(()=>!!i.value),c=e=>({technicalFile:"æŠ€æœ¯éœ€æ±‚æ–‡ä»¶",tenderFile:"æ‹›æ ‡æ–‡æ¡£",templateFile:"åº”ç­”æ¨¡æ¿",businessResponseFile:"å•†åŠ¡åº”ç­”æ–‡ä»¶",p2pResponseFile:"ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶",techProposalFile:"æŠ€æœ¯æ–¹æ¡ˆæ–‡ä»¶"}[e]||"æ–‡ä»¶");return{useHitlFile:l,hitlFileInfo:i,hasHitlFile:r,syncing:o,synced:n,loadFromHITL:(e,a="technicalFile")=>{const s=e[a];return s?(i.value={filename:s.filename||s.name||"æœªçŸ¥æ–‡ä»¶",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},l.value=!0,n.value=!1,h.success({message:`å·²åŠ è½½HITL${c(a)}: ${i.value.filename}`,duration:3e3}),t&&t(i.value),!0):(h.warning(`å½“å‰é¡¹ç›®æ²¡æœ‰${c(a)}`),!1)},cancelHitlFile:()=>{l.value=!1,i.value=null,n.value=!1,h.info("å·²å–æ¶ˆä½¿ç”¨HITLæ–‡ä»¶"),a&&a()},syncToHitl:async(e,t,a)=>{if(!e)return h.error("é¡¹ç›®IDæ— æ•ˆ"),!1;if(!t)return h.error("æ–‡ä»¶è·¯å¾„æ— æ•ˆ"),!1;o.value=!0;try{const l=await fetch(`/api/tender-processing/sync-file/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,file_type:a})}),i=l.headers.get("content-type");if(!(null==i?void 0:i.includes("application/json"))){await l.text();throw new Error(`æœåŠ¡å™¨è¿”å›å¼‚å¸¸å“åº” (${l.status}): ${l.statusText}ã€‚å¯èƒ½æ˜¯åç«¯é…ç½®é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚`)}const o=await l.json();if(o.success||l.ok)return n.value=!0,h.success({message:o.message||"å·²æˆåŠŸåŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›®",duration:3e3}),s&&await s(),!0;throw new Error(o.error||o.message||"åŒæ­¥å¤±è´¥")}catch(l){let e="åŒæ­¥åˆ°é¡¹ç›®å¤±è´¥";return l.message?e=l.message:"TypeError"===l.name&&(e="ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"),h.error({message:e,duration:5e3}),!1}finally{o.value=!1}},resetSyncStatus:()=>{n.value=!1}}}function Ee(e,t="YYYY-MM-DD"){return e?X(e).format(t):""}function $e(e,t=2){if(null==e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,a)).toFixed(t)} ${["B","KB","MB","GB","TB","PB"][a]}`}const He={class:"stats-card"},Te={key:0,class:"stats-title"},ze={class:"stat-item"},Be={class:"stat-prefix"},Ke={class:"stat-suffix"},Se=b(K({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,a=[{key:"total_replacements",label:"æ–‡æœ¬æ›¿æ¢",suffix:"å¤„"},{key:"tables_processed",label:"è¡¨æ ¼å¤„ç†",suffix:"ä¸ª"},{key:"cells_filled",label:"å•å…ƒæ ¼å¡«å……",suffix:"ä¸ª"},{key:"images_inserted",label:"å›¾ç‰‡æ’å…¥",suffix:"å¼ "}],s=T(()=>t.statItems||a),l=e=>{const a=e.split(".");let s=t.stats;for(const t of a)if(s=null==s?void 0:s[t],null==s)break;return"number"==typeof s?s:0};return(t,a)=>{const i=oe,o=ie,n=le;return R(),S("div",He,[e.title?(R(),S("h4",Te,V(e.title),1)):Z("",!0),O(n,{gutter:e.gutter},{default:Y(()=>[(R(!0),S(ee,null,te(s.value,t=>(R(),D(o,{key:t.key,span:e.span},{default:Y(()=>[M("div",ze,[O(i,{title:t.label,value:l(t.key),precision:t.precision,"value-style":e.valueStyle},ae({_:2},[t.prefix?{name:"prefix",fn:Y(()=>[M("span",Be,V(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:Y(()=>[M("span",Ke,V(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),Re={class:"alert-content"},Le={class:"file-info"},Ue={class:"file-details"},Ae={class:"file-label"},Ne={class:"file-name"},Me={key:0,class:"file-size"},Oe={class:"alert-actions"},Pe=b(K({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"ä½¿ç”¨HITLæ–‡ä»¶:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"å–æ¶ˆä½¿ç”¨"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:t}){const a=t,s=()=>{a("cancel")};return(t,a)=>{const l=m,i=se,o=w,n=g;return e.fileInfo?(R(),D(n,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:Y(()=>[M("div",Re,[M("div",Le,[O(l,{class:"file-icon"},{default:Y(()=>[O(A(_))]),_:1}),M("div",Ue,[M("span",Ae,V(e.label),1),M("span",Ne,V(e.fileInfo.filename),1),e.fileInfo.file_size?(R(),S("span",Me," ("+V(A($e)(e.fileInfo.file_size))+") ",1)):Z("",!0),e.showTag?(R(),D(i,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:Y(()=>[...a[0]||(a[0]=[P(" å·²ä»æŠ•æ ‡é¡¹ç›®åŠ è½½ ",-1)])]),_:1})):Z("",!0)])]),M("div",Oe,[L(t.$slots,"actions",{},()=>[e.showCancel?(R(),D(o,{key:0,type:"text",size:"small",onClick:s},{default:Y(()=>[O(l,null,{default:Y(()=>[O(A(x))]),_:1}),P(" "+V(e.cancelText),1)]),_:1})):Z("",!0)],!0)])])]),_:3},8,["type"])):Z("",!0)}}}),[["__scopeId","data-v-1a132715"]]),Ve={class:"history-files-panel"},Ye={class:"card-header"},De={class:"header-title"},We={class:"current-file-content"},Qe={class:"history-actions"},qe={class:"collapse-header"},Ge={class:"filename-cell"},Je=b(K({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"è¯¥é¡¹ç›®å·²æœ‰ç”Ÿæˆæ–‡ä»¶"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const t=$([]),a=e=>{if(!e)return"-";let t=e;try{t=decodeURIComponent(e)}catch{}const a=t.split("/");return a[a.length-1]||"-"};return(s,l)=>{const i=se,o=g,n=ce,r=de,c=re,d=m,u=w,p=ne,f=fe,y=pe,v=ye,h=Ie,b=Ce,x=me;return R(),S("div",Ve,[e.currentFile?(R(),D(p,{key:0,shadow:"never",class:"current-file-card"},{header:Y(()=>[M("div",Ye,[M("div",De,[M("span",null,V(e.title||"ğŸ“„ è¯¥é¡¹ç›®çš„ç”Ÿæˆæ–‡ä»¶"),1),O(i,{type:"info"},{default:Y(()=>[...l[6]||(l[6]=[P("å†å²æ–‡ä»¶",-1)])]),_:1})])])]),default:Y(()=>[M("div",We,[O(o,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(R(),D(Se,{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):Z("",!0),O(c,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:Y(()=>[O(n,{label:"æ–‡ä»¶å"},{default:Y(()=>[P(V(a(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),O(n,{label:"ä¸‹è½½åœ°å€"},{default:Y(()=>[O(r,{href:e.currentFile.downloadUrl,type:"primary"},{default:Y(()=>[P(V(a(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),M("div",Qe,[e.showEditorOpen?(R(),D(u,{key:0,type:"primary",size:"large",onClick:l[0]||(l[0]=t=>s.$emit("openInEditor",e.currentFile))},{default:Y(()=>[O(d,null,{default:Y(()=>[O(A(k))]),_:1}),l[7]||(l[7]=P(" åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ",-1))]),_:1})):Z("",!0),O(u,{type:"primary",size:"large",icon:A(F),onClick:l[1]||(l[1]=t=>s.$emit("preview",e.currentFile))},{default:Y(()=>[...l[8]||(l[8]=[P(" é¢„è§ˆWord ",-1)])]),_:1},8,["icon"]),O(u,{type:"success",size:"large",icon:A(C),onClick:l[2]||(l[2]=t=>s.$emit("download",e.currentFile))},{default:Y(()=>[...l[9]||(l[9]=[P(" ä¸‹è½½ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(R(),D(u,{key:1,size:"large",icon:A(I),onClick:l[3]||(l[3]=e=>s.$emit("regenerate"))},{default:Y(()=>[...l[10]||(l[10]=[P(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])):Z("",!0)])])]),_:1})):Z("",!0),e.historyFiles.length>0?(R(),D(b,{key:1,modelValue:t.value,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value=e),class:"history-collapse"},{default:Y(()=>[O(h,{name:"history"},{title:Y(()=>[M("div",qe,[M("span",null,"ğŸ“‚ æŸ¥çœ‹æ‰€æœ‰å†å²å¤„ç†æ–‡ä»¶ ("+V(e.historyFiles.length)+")",1),t.value.includes("history")?(R(),D(u,{key:0,type:"primary",size:"small",loading:e.loading,onClick:l[4]||(l[4]=q(e=>s.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:Y(()=>[...l[11]||(l[11]=[P(" åˆ·æ–°åˆ—è¡¨ ",-1)])]),_:1},8,["loading"])):Z("",!0)])]),default:Y(()=>[O(p,{shadow:"never",style:{border:"none"}},{default:Y(()=>[G((R(),D(y,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:Y(()=>[O(f,{type:"index",label:"åºå·",width:"60"}),O(f,{prop:"filename",label:"æ–‡ä»¶å","min-width":"300"},{default:Y(({row:e})=>[M("div",Ge,[O(d,null,{default:Y(()=>[O(A(_))]),_:1}),M("span",null,V(e.filename),1)])]),_:1}),O(f,{prop:"size",label:"æ–‡ä»¶å¤§å°",width:"120"},{default:Y(({row:e})=>[P(V(A($e)(e.size)),1)]),_:1}),O(f,{prop:"process_time",label:"å¤„ç†æ—¶é—´",width:"180"},{default:Y(({row:e})=>[P(V(A(Ee)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),O(f,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:Y(({row:e})=>[O(u,{type:"primary",size:"small",onClick:t=>s.$emit("preview",e)},{default:Y(()=>[...l[12]||(l[12]=[P(" é¢„è§ˆ ",-1)])]),_:1},8,["onClick"]),O(u,{type:"success",size:"small",onClick:t=>s.$emit("download",e)},{default:Y(()=>[...l[13]||(l[13]=[P(" ä¸‹è½½ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,e.loading]]),e.loading||0!==e.historyFiles.length?Z("",!0):(R(),D(v,{key:0,description:"æš‚æ— å†å²æ–‡ä»¶","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):Z("",!0)])}}}),[["__scopeId","data-v-6814751e"]]);async function Xe(e,t){if("string"!=typeof e){const a=URL.createObjectURL(e),s=document.createElement("a");return s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),void URL.revokeObjectURL(a)}try{const a=await fetch(e);if(!a.ok){const e=a.headers.get("content-type");if(e&&e.includes("application/json")){const e=await a.json();throw new Error(e.error||e.message||"æ–‡ä»¶ä¸‹è½½å¤±è´¥")}throw new Error(`æ–‡ä»¶ä¸‹è½½å¤±è´¥: HTTP ${a.status}`)}const s=a.headers.get("content-type");if(s&&(s.includes("text/html")||s.includes("application/json")))throw new Error("æœåŠ¡å™¨è¿”å›äº†é”™è¯¯é¡µé¢ï¼Œè€Œä¸æ˜¯æ–‡ä»¶");const l=await a.blob(),i=URL.createObjectURL(l),o=document.createElement("a");o.href=i,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(a){throw a}}export{Ie as E,Pe as H,Se as S,Ce as a,Je as b,Xe as d,je as u};
