import{D as K,an as W,Q as Y,ao as H,d as X,f as Z,i as ee,af as ae,q as te,o as le,a as oe,ap as ne,J as se,K as ie,a4 as re,p as de,b as ce}from"./element-plus-IkZgpaz4.js";import{bT as ue,gi as pe,bt as y,bu as me,bG as _e,bU as fe,bV as C,bY as r,c8 as e,c0 as t,bv as v,c6 as g,b$ as N,c5 as _}from"./vendor-CdA3MjAt.js";import{L as ye}from"./Loading-CmykbBZp.js";import{E as ve}from"./Empty-BNVBwC0L.js";/* empty css                                                                          */import{C as be}from"./Card-BYP2BB2j.js";import"./umo-editor-BmhDOXHm.js";/* empty css                                                                        */import{a as ge,_ as we}from"./index.js";import{c as k}from"./company-B1QhkZBS.js";import"./onnxruntime-DkHy2lK3.js";import"./mermaid-e-fO57px.js";import"./echarts-Cqw1j_Z-.js";const he={class:"company-library"},Ce={class:"stats-bar"},ke={class:"stat-content"},Ve={class:"stat-icon"},xe={class:"stat-info"},Ee={class:"stat-value"},De={class:"stat-content"},Te={class:"stat-icon"},qe={class:"stat-info"},Ne={class:"stat-value"},Le={class:"filter-section"},$e={class:"qualification-progress"},Fe={class:"progress-text"},Ie=17,Ue=ue({__name:"CompanyLibrary",setup(ze){const L=pe(),{success:$,error:V}=ge(),x=y(!1),E=y([]),u=y({keyword:"",industry:""}),w=y(!1),D=y(!1),h=y(),d=y({companyName:"",companyCode:"",industryType:"",companyDescription:""}),R={companyName:[{required:!0,message:"请输入企业名称",trigger:"blur"},{min:2,max:100,message:"企业名称长度在 2 到 100 个字符",trigger:"blur"}]},T=me(()=>{let l=[...E.value];if(u.value.keyword){const a=u.value.keyword.toLowerCase();l=l.filter(m=>{var n,p,i;return((n=m.company_name)==null?void 0:n.toLowerCase().includes(a))||((p=m.social_credit_code)==null?void 0:p.toLowerCase().includes(a))||((i=m.company_code)==null?void 0:i.toLowerCase().includes(a))})}return u.value.industry&&(l=l.filter(a=>a.industry_type===u.value.industry)),l}),q=async()=>{x.value=!0;try{const a=(await k.getCompanies()).data||[],m=await Promise.all(a.map(async n=>{let p=0;try{const f=await k.getCompanyQualifications(n.company_id);f.data&&(p=Object.keys(f.data).length)}catch(f){console.error(`加载企业${n.company_id}资质信息失败:`,f)}const i=Ie,s=i>0?Math.round(p/i*100):0;return{company_id:n.company_id,company_name:n.company_name||"未命名",company_code:n.company_code||"",social_credit_code:n.social_credit_code||"-",legal_representative:n.legal_representative||"-",registered_capital:n.registered_capital||"-",employee_count:n.employee_count||"-",industry_type:n.industry_type||"",product_count:n.product_count||0,document_count:n.document_count||0,qualification_completed:p,qualification_total:i,qualification_progress:s,created_at:n.created_at||"-",updated_at:n.updated_at||"-",...n}}));E.value=m}catch(l){console.error("加载企业列表失败:",l),V("加载失败",l instanceof Error?l.message:"未知错误")}finally{x.value=!1}},F=()=>{},A=()=>{u.value.keyword="",u.value.industry=""},B=l=>l<30?"#f56c6c":l<70?"#e6a23c":"#67c23a",O=async()=>{h.value&&await h.value.validate(async l=>{if(l){D.value=!0;try{(await k.createCompany({name:d.value.companyName,code:d.value.companyCode||void 0,description:d.value.companyDescription||void 0})).success&&($("创建成功","企业创建成功"),w.value=!1,await q())}catch(a){console.error("创建企业失败:",a),V("创建失败",a instanceof Error?a.message:"未知错误")}finally{D.value=!1}}})},P=()=>{var l;d.value={companyName:"",companyCode:"",industryType:"",companyDescription:""},(l=h.value)==null||l.resetFields()},Q=l=>{L.push(`/knowledge/company/${l.company_id}`)},S=l=>{L.push(`/knowledge/company/${l.company_id}`)},M=async l=>{try{if(!confirm(`确定要删除企业 "${l.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`))return;await k.deleteCompany(l.company_id),$("删除成功",`已删除企业: ${l.company_name}`),await q()}catch(a){console.error("删除企业失败:",a),V("删除失败",a instanceof Error?a.message:"未知错误")}};return _e(()=>{q()}),(l,a)=>{const m=K,n=Y,p=ee,i=Z,s=le,f=te,b=oe,I=X,c=ie,j=re,U=de,G=se,J=ce;return C(),fe("div",he,[r("div",Ce,[e(n,{class:"stat-card"},{default:t(()=>[r("div",ke,[r("div",Ve,[e(m,{size:32,color:"#409eff"},{default:t(()=>[e(v(W))]),_:1})]),r("div",xe,[a[8]||(a[8]=r("div",{class:"stat-label"},"总企业数",-1)),r("div",Ee,g(E.value.length),1)])])]),_:1}),e(n,{class:"stat-card"},{default:t(()=>[r("div",De,[r("div",Te,[e(m,{size:32,color:"#67c23a"},{default:t(()=>[e(v(H))]),_:1})]),r("div",qe,[a[9]||(a[9]=r("div",{class:"stat-label"},"筛选结果",-1)),r("div",Ne,g(T.value.length),1)])])]),_:1})]),e(v(be),{title:"企业列表"},{default:t(()=>[r("div",Le,[e(I,{inline:!0,model:u.value},{default:t(()=>[e(i,{label:"搜索"},{default:t(()=>[e(p,{modelValue:u.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=o=>u.value.keyword=o),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:F},{prefix:t(()=>[e(m,null,{default:t(()=>[e(v(ae))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"行业类型"},{default:t(()=>[e(f,{modelValue:u.value.industry,"onUpdate:modelValue":a[1]||(a[1]=o=>u.value.industry=o),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:F},{default:t(()=>[e(s,{label:"全部行业",value:""}),e(s,{label:"科技",value:"technology"}),e(s,{label:"制造业",value:"manufacturing"}),e(s,{label:"金融",value:"finance"}),e(s,{label:"教育",value:"education"}),e(s,{label:"医疗",value:"healthcare"}),e(s,{label:"零售",value:"retail"}),e(s,{label:"建筑",value:"construction"}),e(s,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(b,{onClick:A},{default:t(()=>[e(m,null,{default:t(()=>[e(v(ne))]),_:1}),a[10]||(a[10]=_(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),x.value?(C(),N(v(ye),{key:0,text:"加载中..."})):T.value.length?(C(),N(G,{key:2,data:T.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(c,{prop:"company_id",label:"ID",width:"70",fixed:""}),e(c,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),e(c,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),e(c,{prop:"legal_representative",label:"法定代表人",width:"120"}),e(c,{prop:"registered_capital",label:"注册资本",width:"120"}),e(c,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),e(c,{label:"资质完成度",width:"180",align:"center"},{default:t(({row:o})=>[r("div",$e,[e(j,{percentage:o.qualification_progress||0,color:B(o.qualification_progress||0),"stroke-width":8},null,8,["percentage","color"]),r("span",Fe,g(o.qualification_completed||0)+"/"+g(o.qualification_total||17),1)])]),_:1}),e(c,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:t(({row:o})=>[e(U,{size:"small",type:"info"},{default:t(()=>[_(g(o.product_count||0),1)]),_:2},1024)]),_:1}),e(c,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:t(({row:o})=>[e(U,{size:"small",type:"success"},{default:t(()=>[_(g(o.document_count||0),1)]),_:2},1024)]),_:1}),e(c,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),e(c,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),e(c,{label:"操作",width:"220",fixed:"right"},{default:t(({row:o})=>[e(b,{text:"",type:"primary",size:"small",onClick:z=>Q(o)},{default:t(()=>[...a[11]||(a[11]=[_(" 查看详情 ",-1)])]),_:1},8,["onClick"]),e(b,{text:"",type:"warning",size:"small",onClick:z=>S(o)},{default:t(()=>[...a[12]||(a[12]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(b,{text:"",type:"danger",size:"small",onClick:z=>M(o)},{default:t(()=>[...a[13]||(a[13]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(C(),N(v(ve),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1}),e(J,{modelValue:w.value,"onUpdate:modelValue":a[7]||(a[7]=o=>w.value=o),title:"新建企业",width:"500px",onClose:P},{footer:t(()=>[e(b,{onClick:a[6]||(a[6]=o=>w.value=!1)},{default:t(()=>[...a[14]||(a[14]=[_("取消",-1)])]),_:1}),e(b,{type:"primary",loading:D.value,onClick:O},{default:t(()=>[...a[15]||(a[15]=[_(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(I,{ref_key:"createFormRef",ref:h,model:d.value,rules:R,"label-width":"120px"},{default:t(()=>[e(i,{label:"企业名称",prop:"companyName"},{default:t(()=>[e(p,{modelValue:d.value.companyName,"onUpdate:modelValue":a[2]||(a[2]=o=>d.value.companyName=o),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"企业代码",prop:"companyCode"},{default:t(()=>[e(p,{modelValue:d.value.companyCode,"onUpdate:modelValue":a[3]||(a[3]=o=>d.value.companyCode=o),placeholder:"请输入企业代码（可选）"},null,8,["modelValue"])]),_:1}),e(i,{label:"行业类型",prop:"industryType"},{default:t(()=>[e(f,{modelValue:d.value.industryType,"onUpdate:modelValue":a[4]||(a[4]=o=>d.value.industryType=o),placeholder:"请选择行业类型",style:{width:"100%"}},{default:t(()=>[e(s,{label:"科技",value:"technology"}),e(s,{label:"制造业",value:"manufacturing"}),e(s,{label:"金融",value:"finance"}),e(s,{label:"教育",value:"education"}),e(s,{label:"医疗",value:"healthcare"}),e(s,{label:"零售",value:"retail"}),e(s,{label:"建筑",value:"construction"}),e(s,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"企业简介",prop:"companyDescription"},{default:t(()=>[e(p,{modelValue:d.value.companyDescription,"onUpdate:modelValue":a[5]||(a[5]=o=>d.value.companyDescription=o),type:"textarea",rows:3,placeholder:"请输入企业简介（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ye=we(Ue,[["__scopeId","data-v-bc300562"]]);export{Ye as default};
