import{ge as T,bt as v,bu as o}from"./vendor-CdA3MjAt.js";import"./index.js";import{t as i}from"./tender-2TSD_jRl.js";const E=T("project",()=>{const t=v(null),n=v([]),r=v(!1),u=v(null),l=v({page:1,pageSize:10,total:0}),P=o(()=>{var e,a;return((e=t.value)==null?void 0:e.id)||((a=t.value)==null?void 0:a.project_id)||null}),h=o(()=>{var e,a;return((e=t.value)==null?void 0:e.name)||((a=t.value)==null?void 0:a.project_name)||""}),S=o(()=>{var e,a;return((e=t.value)==null?void 0:e.number)||((a=t.value)==null?void 0:a.project_number)||""}),_=o(()=>{var e;return((e=t.value)==null?void 0:e.status)||null}),b=o(()=>!!t.value),w=o(()=>n.value.length),z=o(()=>n.value.map(e=>({label:`${e.name} (${e.project_number})`,value:e.id}))),p=o(()=>Math.ceil(l.value.total/l.value.pageSize));function d(e){t.value=e,f()}async function x(e){r.value=!0,u.value=null;try{const a=await i.getProject(e);return a.success&&a.data?(d(a.data),!0):(u.value=a.message||"获取项目详情失败",!1)}catch(a){return u.value=a.message||"获取项目详情失败",!1}finally{r.value=!1}}function j(){t.value=null,localStorage.removeItem("current_project")}async function g(e){r.value=!0,u.value=null,e!=null&&e.page&&(l.value.page=e.page),e!=null&&e.page_size&&(l.value.pageSize=e.page_size);try{const a=await i.getProjects({page:l.value.page,page_size:l.value.pageSize});a.success&&a.data&&(n.value=a.data.items||a.data,l.value.total=a.data.total||n.value.length)}catch(a){u.value=a.message||"获取项目列表失败",console.error("获取项目列表失败:",a)}finally{r.value=!1}}async function m(e){r.value=!0,u.value=null;try{const a=await i.getProject(e);if(a.success&&a.data){const c=n.value.findIndex(s=>s.id===e);return c!==-1&&Object.assign(n.value[c],{name:a.data.name,status:a.data.status,project_number:a.data.project_number}),a.data}return u.value=a.message||"获取项目详情失败",null}catch(a){return u.value=a.message||"获取项目详情失败",null}finally{r.value=!1}}async function C(e){r.value=!0,u.value=null;try{const a=await i.createProject(e);return a.success&&a.data?(n.value.unshift(a.data),l.value.total+=1,a.data):(u.value=a.message||"创建项目失败",null)}catch(a){return u.value=a.message||"创建项目失败",null}finally{r.value=!1}}async function O(e,a){var c;r.value=!0,u.value=null;try{const s=await i.updateProject(e,a);if(s.success&&s.data){const y=n.value.findIndex(F=>F.id===e);return y!==-1&&Object.assign(n.value[y],s.data),((c=t.value)==null?void 0:c.id)===e&&(Object.assign(t.value,s.data),f()),!0}return u.value=s.message||"更新项目失败",!1}catch(s){return u.value=s.message||"更新项目失败",!1}finally{r.value=!1}}async function N(e){var a;r.value=!0,u.value=null;try{const c=await i.deleteProject(e);return c.success?(n.value=n.value.filter(s=>s.id!==e),l.value.total=Math.max(0,l.value.total-1),((a=t.value)==null?void 0:a.id)===e&&j(),!0):(u.value=c.message||"删除项目失败",!1)}catch(c){return u.value=c.message||"删除项目失败",!1}finally{r.value=!1}}async function I(){var a;if(!((a=t.value)!=null&&a.id))return;const e=await m(t.value.id);e&&(t.value=e,f())}function $(e,a){l.value.page=e,l.value.pageSize=a}async function J(){l.value.page<p.value&&(l.value.page+=1,await g())}async function M(){l.value.page>1&&(l.value.page-=1,await g())}function A(){try{const e=localStorage.getItem("current_project");e&&(t.value=JSON.parse(e))}catch(e){console.error("恢复项目状态失败:",e)}}function f(){try{t.value&&localStorage.setItem("current_project",JSON.stringify(t.value))}catch(e){console.error("保存项目状态失败:",e)}}function B(){t.value=null,n.value=[],r.value=!1,u.value=null,l.value={page:1,pageSize:10,total:0},localStorage.removeItem("current_project")}return{currentProject:t,projects:n,loading:r,error:u,pagination:l,projectId:P,projectName:h,projectNumber:S,projectStatus:_,hasCurrentProject:b,projectsCount:w,projectsOptions:z,totalPages:p,setCurrentProject:d,setCurrentProjectById:x,clearCurrentProject:j,fetchProjects:g,fetchProject:m,createProject:C,updateProject:O,deleteProject:N,refreshCurrentProject:I,setPagination:$,nextPage:J,prevPage:M,restoreFromStorage:A,saveToStorage:f,$reset:B}});export{E as u};
