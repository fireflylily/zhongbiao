import{am as e,bt as t,by as n,ap as o,bz as s,bA as l,as as i,aI as r,at as a,aT as u,aP as c,aL as d,bB as b,bC as v,bD as g,bE as m}from"./editor-CZjPbfOV.js";import{Y as f,Z as p,i as x,$ as y,a0 as C}from"./index.js";function A(d,b){let v;const g=e(!1),m=t({...d,originalPosition:"",originalOverflow:"",visible:!1});function x(){var e,t;null==(t=null==(e=k.$el)?void 0:e.parentNode)||t.removeChild(k.$el)}function y(){if(!g.value)return;const e=m.parent;g.value=!1,e.vLoadingAddClassList=void 0,function(){const e=m.parent,t=k.ns;if(!e.vLoadingAddClassList){let n=e.getAttribute("loading-number");n=Number.parseInt(n)-1,n?e.setAttribute("loading-number",n.toString()):(p(e,t.bm("parent","relative")),e.removeAttribute("loading-number")),p(e,t.bm("parent","hidden"))}x(),A.unmount()}()}const C=o({name:"ElLoading",setup(e,{expose:t}){const{ns:n,zIndex:o}=f("loading");return t({ns:n,zIndex:o}),()=>{const e=m.spinner||m.svg,t=l("svg",{class:"circular",viewBox:m.svgViewBox?m.svgViewBox:"0 0 50 50",...e?{innerHTML:e}:{}},[l("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),o=m.text?l("p",{class:n.b("text")},[m.text]):void 0;return l(c,{name:n.b("fade"),onAfterLeave:y},{default:i(()=>[r(a("div",{style:{backgroundColor:m.background||""},class:[n.b("mask"),m.customClass,m.fullscreen?"is-fullscreen":""]},[l("div",{class:n.b("spinner")},[t,o])]),[[u,m.visible]])])})}}}),A=n(C);Object.assign(A._context,null!=b?b:{});const k=A.mount(document.createElement("div"));return{...s(m),setText:function(e){m.text=e},removeElLoadingChild:x,close:function(){var e;d.beforeClose&&!d.beforeClose()||(g.value=!0,clearTimeout(v),v=setTimeout(y,400),m.visible=!1,null==(e=d.closed)||e.call(d))},handleAfterLeave:y,vm:k,get $el(){return k.$el}}}let k;const w=function(e={},t){if(!x)return;const n=L(e);if(n.fullscreen&&k)return k;const o=A({...n,closed:()=>{var e;null==(e=n.closed)||e.call(n),n.fullscreen&&(k=void 0)}},null!=t?t:w._context);B(n,n.parent,o),h(n,n.parent,o),n.parent.vLoadingAddClassList=()=>h(n,n.parent,o);let s=n.parent.getAttribute("loading-number");return s=s?`${Number.parseInt(s)+1}`:"1",n.parent.setAttribute("loading-number",s),n.parent.appendChild(o.$el),d(()=>o.visible.value=n.visible),n.fullscreen&&(k=o),o},L=e=>{var t,n,o,s;let l;return l=b(e.target)?null!=(t=document.querySelector(e.target))?t:document.body:e.target||document.body,{parent:l===document.body||e.body?document.body:l,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:l===document.body&&(null==(n=e.fullscreen)||n),lock:null!=(o=e.lock)&&o,customClass:e.customClass||"",visible:null==(s=e.visible)||s,beforeClose:e.beforeClose,closed:e.closed,target:l}},B=async(e,t,n)=>{const{nextZIndex:o}=n.vm.zIndex||n.vm._.exposed.zIndex,s={};if(e.fullscreen)n.originalPosition.value=y(document.body,"position"),n.originalOverflow.value=y(document.body,"overflow"),s.zIndex=o();else if(e.parent===document.body){n.originalPosition.value=y(document.body,"position"),await d();for(const t of["top","left"]){const n="top"===t?"scrollTop":"scrollLeft";s[t]=e.target.getBoundingClientRect()[t]+document.body[n]+document.documentElement[n]-Number.parseInt(y(document.body,`margin-${t}`),10)+"px"}for(const t of["height","width"])s[t]=`${e.target.getBoundingClientRect()[t]}px`}else n.originalPosition.value=y(t,"position");for(const[l,i]of Object.entries(s))n.$el.style[l]=i},h=(e,t,n)=>{const o=n.vm.ns||n.vm._.exposed.ns;["absolute","fixed","sticky"].includes(n.originalPosition.value)?p(t,o.bm("parent","relative")):C(t,o.bm("parent","relative")),e.fullscreen&&e.lock?C(t,o.bm("parent","hidden")):p(t,o.bm("parent","hidden"))};w._context=null;const $=Symbol("ElLoading"),I=e=>`element-loading-${m(e)}`,V=(t,n)=>{var o,s,l,i;const r=n.instance,a=e=>v(n.value)?n.value[e]:void 0,u=n=>(t=>{const n=b(t)&&(null==r?void 0:r[t])||t;return e(n)})(a(n)||t.getAttribute(I(n))),c=null!=(o=a("fullscreen"))?o:n.modifiers.fullscreen,d={text:u("text"),svg:u("svg"),svgViewBox:u("svgViewBox"),spinner:u("spinner"),background:u("background"),customClass:u("customClass"),fullscreen:c,target:null!=(s=a("target"))?s:c?void 0:t,body:null!=(l=a("body"))?l:n.modifiers.body,lock:null!=(i=a("lock"))?i:n.modifiers.lock},g=w(d);g._context=_._context,t[$]={options:d,instance:g}},_={mounted(e,t){t.value&&V(e,t)},updated(e,t){const n=e[$];if(!t.value)return null==n||n.instance.close(),void(e[$]=null);n?((e,t)=>{for(const n of Object.keys(e))g(e[n])&&(e[n].value=t[n])})(n.options,v(t.value)?t.value:{text:e.getAttribute(I("text")),svg:e.getAttribute(I("svg")),svgViewBox:e.getAttribute(I("svgViewBox")),spinner:e.getAttribute(I("spinner")),background:e.getAttribute(I("background")),customClass:e.getAttribute(I("customClass"))}):V(e,t)},unmounted(e){var t;null==(t=e[$])||t.instance.close(),e[$]=null},_context:null};export{_ as v};
