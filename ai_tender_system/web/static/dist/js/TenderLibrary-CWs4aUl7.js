import{ax as e,T as a,az as l,aB as t,aC as o,aD as u,aV as r,a2 as n,b3 as s,U as d,b4 as i,_ as c,as as p,u as v,b5 as m,e as f,aI as _,aK as y,b6 as b,b7 as h,w as g,j as w,M as V,s as x,aS as C,b8 as j,O as k,S,d as U,y as z,P as T,N as E,Q as I,R as $,h as B,G as D,q as O}from"./index.js";/* empty css                             */import{E as M}from"./el-date-picker-panel-De6Fsy_B.js";/* empty css                     */import{E as P,a as N,b as q}from"./el-select-OYnihe3P.js";/* empty css                                                                            *//* empty css                *//* empty css                    */import{a as F,E as L}from"./el-tab-pane-BkbgISyh.js";import{E as R}from"./el-pagination-B2kZAGN2.js";/* empty css               *//* empty css                */import{am as Y,bO as A,an as H,ao as J,bR as K,bC as Q,bX as G,bB as W,ap as X,au as Z,ar as ee,av as ae,az as le,aA as te,aB as oe,ay as ue,ax as re,as as ne,at as se,aq as de,aT as ie,aV as ce,aS as pe,aC as ve,bt as me,aW as fe,aw as _e,bv as ye,aD as be}from"./editor-TazJhAAN.js";import{L as he}from"./Loading-BeReBNvy.js";import{E as ge}from"./Empty-VlzT6V_U.js";/* empty css                                                        */import{_ as we}from"./DocumentPreview.vue_vue_type_script_setup_true_lang-De9yPCsp.js";/* empty css                   *//* empty css                */import{c as Ve}from"./company-CHa0NuIL.js";import{E as xe}from"./index-IM9EhOrM.js";import{E as Ce,a as je}from"./index-CEGNKDhc.js";import{E as ke}from"./strings-X7bymAdO.js";import{E as Se}from"./index-DYIGgvz_.js";import{c as Ue}from"./clamp-CoUBliBS.js";import{E as ze}from"./index-U-yLLGnn.js";import{E as Te,a as Ee}from"./index-BPxxUWPk.js";import"./advancedFormat-B_RJiIbm.js";import"./index-ChK61zXh.js";import"./index-EpWc9ZRp.js";import"./toNumber-C9XTs0cM.js";import"./_baseIteratee-DK-XCWub.js";import"./raf-BZHcGSIv.js";import"./index-ByYpZ62U.js";import"./index-BIDBuuPD.js";import"./directive-BiPnxfY9.js";import"./flatMap-B556EPsX.js";import"./map-DlvCx75E.js";import"./_baseEach-uBBvXMMp.js";import"./cloneDeep-syPWYH98.js";const Ie=a({modelValue:{type:Number,default:0},id:{type:String,default:void 0},lowThreshold:{type:Number,default:2},highThreshold:{type:Number,default:4},max:{type:Number,default:5},colors:{type:n([Array,Object]),default:()=>r(["","",""])},voidColor:{type:String,default:""},disabledVoidColor:{type:String,default:""},icons:{type:n([Array,Object]),default:()=>[s,s,s]},voidIcon:{type:d,default:()=>i},disabledVoidIcon:{type:d,default:()=>s},disabled:Boolean,allowHalf:Boolean,showText:Boolean,showScore:Boolean,textColor:{type:String,default:""},texts:{type:n(Array),default:()=>r(["Extremely bad","Disappointed","Fair","Satisfied","Surprise"])},scoreTemplate:{type:String,default:"{value}"},size:u,clearable:Boolean,...o(["ariaLabel"])}),$e={[t]:a=>e(a),[l]:a=>e(a)},Be=Y({name:"ElRate"});const De=g(c(Y({...Be,props:Ie,emits:$e,setup(e,{expose:a,emit:o}){const u=e;function r(e,a){const l=e=>Q(e),t=Object.keys(a).map(e=>+e).filter(t=>{const o=a[t];return!!l(o)&&o.excluded?e<t:e<=t}).sort((e,a)=>e-a),o=a[t[0]];return l(o)&&o.value||o}const n=A(b,void 0),s=A(h,void 0),d=p(),i=v("rate"),{inputId:c,isLabeledByFormItem:g}=m(u,{formItemContext:s}),w=H(u.modelValue),V=H(-1),x=H(!0),C=H([]),j=J(()=>C.value.map(e=>e.$el.clientWidth)),k=J(()=>[i.b(),i.m(d.value)]),S=J(()=>u.disabled||(null==n?void 0:n.disabled)),U=J(()=>i.cssVarBlock({"void-color":u.voidColor,"disabled-void-color":u.disabledVoidColor,"fill-color":I.value})),z=J(()=>{let e="";return u.showScore?e=u.scoreTemplate.replace(/\{\s*value\s*\}/,S.value?`${u.modelValue}`:`${w.value}`):u.showText&&(e=u.texts[Math.ceil(w.value)-1]),e}),T=J(()=>100*u.modelValue-100*Math.floor(u.modelValue)),E=J(()=>K(u.colors)?{[u.lowThreshold]:u.colors[0],[u.highThreshold]:{value:u.colors[1],excluded:!0},[u.max]:u.colors[2]}:u.colors),I=J(()=>{const e=r(w.value,E.value);return Q(e)?"":e}),$=J(()=>{let e="";return S.value?e=`${T.value}%`:u.allowHalf&&(e="50%"),{color:I.value,width:e}}),B=J(()=>{let e=K(u.icons)?[...u.icons]:{...u.icons};return e=G(e),K(e)?{[u.lowThreshold]:e[0],[u.highThreshold]:{value:e[1],excluded:!0},[u.max]:e[2]}:e}),D=J(()=>r(u.modelValue,B.value)),O=J(()=>S.value?W(u.disabledVoidIcon)?u.disabledVoidIcon:G(u.disabledVoidIcon):W(u.voidIcon)?u.voidIcon:G(u.voidIcon)),M=J(()=>r(w.value,B.value));function P(e){const a=S.value&&T.value>0&&e-1<u.modelValue&&e>u.modelValue,l=u.allowHalf&&x.value&&e-.5<=w.value&&e>w.value;return a||l}function N(e){u.clearable&&e===u.modelValue&&(e=0),o(l,e),u.modelValue!==e&&o(t,e)}function q(e){if(S.value)return;const a=_(e),r=u.allowHalf?.5:1;let n=w.value;switch(a){case y.up:case y.right:n+=r;break;case y.left:case y.down:n-=r}return n=Ue(n,0,u.max),n!==w.value?(e.stopPropagation(),e.preventDefault(),o(l,n),o(t,n),n):void 0}function F(e,a){S.value||(u.allowHalf&&a?(x.value=2*a.offsetX<=j.value[e-1],w.value=x.value?e-.5:e):w.value=e,V.value=e)}function L(){S.value||(u.allowHalf&&(x.value=u.modelValue!==Math.floor(u.modelValue)),w.value=u.modelValue,V.value=-1)}return X(()=>u.modelValue,e=>{w.value=e,x.value=u.modelValue!==Math.floor(u.modelValue)}),u.modelValue||o(l,0),a({setCurrentValue:F,resetCurrentValue:L}),(e,a)=>{var l;return ee(),Z("div",{id:ue(c),class:oe([ue(k),ue(i).is("disabled",ue(S))]),role:"slider","aria-label":ue(g)?void 0:e.ariaLabel||"rating","aria-labelledby":ue(g)?null==(l=ue(s))?void 0:l.labelId:void 0,"aria-valuenow":w.value,"aria-valuetext":ue(z)||void 0,"aria-valuemin":"0","aria-valuemax":e.max,tabindex:"0",style:pe(ue(U)),onKeydown:q},[(ee(!0),Z(le,null,te(e.max,(e,a)=>(ee(),Z("span",{key:a,class:oe(ue(i).e("item")),onMousemove:a=>F(e,a),onMouseleave:L,onClick:a=>{return l=e,void(S.value||(u.allowHalf&&x.value?N(w.value):N(l)));var l}},[re(ue(f),{ref_for:!0,ref_key:"iconRefs",ref:C,class:oe([ue(i).e("icon"),{hover:V.value===e},ue(i).is("active",e<=w.value),ue(i).is("focus-visible",e===Math.ceil(w.value||1))])},{default:ne(()=>[se((ee(),de(ie(ue(M)),null,null,512)),[[ce,!P(e)&&e<=w.value]]),se((ee(),de(ie(ue(O)),null,null,512)),[[ce,!P(e)&&e>w.value]]),se((ee(),de(ie(ue(O)),{class:oe([ue(i).em("decimal","box")])},null,8,["class"])),[[ce,P(e)]]),se(re(ue(f),{style:pe(ue($)),class:oe([ue(i).e("icon"),ue(i).e("decimal")])},{default:ne(()=>[(ee(),de(ie(ue(D))))]),_:2},1032,["style","class"]),[[ce,P(e)]])]),_:2},1032,["class"])],42,["onMousemove","onClick"]))),128)),e.showText||e.showScore?(ee(),Z("span",{key:0,class:oe(ue(i).e("text")),style:pe({color:e.textColor})},ve(ue(z)),7)):ae("v-if",!0)],46,["id","aria-label","aria-labelledby","aria-valuenow","aria-valuetext","aria-valuemax"])}}}),[["__file","rate.vue"]])),Oe=w("company",()=>{const e=H(null),a=H([]),l=H(!1),t=H(null),o=J(()=>{var a;return(null==(a=e.value)?void 0:a.id)||null}),u=J(()=>{var a;return(null==(a=e.value)?void 0:a.name)||""}),r=J(()=>{var a;return(null==(a=e.value)?void 0:a.code)||""}),n=J(()=>!!e.value),s=J(()=>a.value.length),d=J(()=>a.value.map(e=>({label:e.name,value:e.id})));function i(a){e.value=a,p()}function c(){e.value=null,localStorage.removeItem("current_company")}function p(){try{e.value&&localStorage.setItem("current_company",JSON.stringify(e.value))}catch(a){}}return{currentCompany:e,companies:a,loading:l,error:t,companyId:o,companyName:u,companyCode:r,hasCurrentCompany:n,companiesCount:s,companiesOptions:d,setCurrentCompany:i,setCurrentCompanyById:async function(e){const o=a.value.find(a=>a.id===e);if(o)return i(o),!0;l.value=!0,t.value=null;try{const a=await Ve.getCompany(e);return a.success&&a.data?(i(a.data),!0):(t.value=a.message||"获取公司信息失败",!1)}catch(u){return t.value=u.message||"获取公司信息失败",!1}finally{l.value=!1}},clearCurrentCompany:c,fetchCompanies:async function(){l.value=!0,t.value=null;try{const e=await Ve.getCompanies();e.success&&e.data&&(a.value=e.data.map(e=>({...e,id:e.company_id??e.id,name:e.name??e.company_name})))}catch(e){t.value=e.message||"获取公司列表失败"}finally{l.value=!1}},fetchCompany:async function(e){l.value=!0,t.value=null;try{const l=await Ve.getCompany(e);if(l.success&&l.data){const t=a.value.findIndex(a=>a.id===e);return-1!==t?a.value[t]=l.data:a.value.push(l.data),l.data}return t.value=l.message||"获取公司详情失败",null}catch(o){return t.value=o.message||"获取公司详情失败",null}finally{l.value=!1}},createCompany:async function(e){l.value=!0,t.value=null;try{const l=await Ve.createCompany(e);return l.success&&l.data?(a.value.push(l.data),l.data):(t.value=l.message||"创建公司失败",null)}catch(o){return t.value=o.message||"创建公司失败",null}finally{l.value=!1}},updateCompany:async function(o,u){var r;l.value=!0,t.value=null;try{const l=await Ve.updateCompany(o,u);if(l.success&&l.data){const t=a.value.findIndex(e=>e.id===o);return-1!==t&&(a.value[t]=l.data),(null==(r=e.value)?void 0:r.id)===o&&(e.value=l.data,p()),!0}return t.value=l.message||"更新公司失败",!1}catch(n){return t.value=n.message||"更新公司失败",!1}finally{l.value=!1}},deleteCompany:async function(o){var u;l.value=!0,t.value=null;try{const l=await Ve.deleteCompany(o);return l.success?(a.value=a.value.filter(e=>e.id!==o),(null==(u=e.value)?void 0:u.id)===o&&c(),!0):(t.value=l.message||"删除公司失败",!1)}catch(r){return t.value=r.message||"删除公司失败",!1}finally{l.value=!1}},searchCompanies:async function(e){if(!e.trim())return a.value;l.value=!0,t.value=null;try{const a=await Ve.searchCompanies(e);return a.success&&a.data?a.data:[]}catch(o){return t.value=o.message||"搜索失败",[]}finally{l.value=!1}},restoreFromStorage:function(){try{const a=localStorage.getItem("current_company");a&&(e.value=JSON.parse(a))}catch(a){}},saveToStorage:p,$reset:function(){e.value=null,a.value=[],l.value=!1,t.value=null,localStorage.removeItem("current_company")}}}),Me={class:"tender-library"},Pe={class:"stats-bar"},Ne={class:"stat-content"},qe={class:"stat-icon docs"},Fe={class:"stat-info"},Le={class:"stat-value"},Re={class:"stat-content"},Ye={class:"stat-icon excerpts"},Ae={class:"stat-info"},He={class:"stat-value"},Je={class:"stat-content"},Ke={class:"stat-icon won"},Qe={class:"stat-info"},Ge={class:"stat-value"},We={class:"tab-toolbar"},Xe={key:3,class:"pagination-wrapper"},Ze={class:"tab-toolbar"},ea={key:2,class:"excerpts-list"},aa={class:"excerpt-header"},la={class:"excerpt-title"},ta={class:"chapter-title"},oa={class:"excerpt-meta"},ua={class:"doc-name"},ra={class:"excerpt-content"},na={class:"excerpt-footer"},sa={class:"excerpt-tags"},da={class:"excerpt-actions"},ia={key:3,class:"pagination-wrapper"},ca={class:"excerpt-full-content"},pa={class:"content-box"},va="/api/tender-library",ma=O(Y({__name:"TenderLibrary",setup(e){const{success:a,error:l}=V(),t=Oe(),o=J(()=>t.companyId||1),u=H([]),r=me({docCount:0,excerptCount:0,wonCount:0}),n=H("documents"),s=H(!1),d=H([]),i=H(""),c=H(""),p=H(1),v=H(10),m=H(0),_=H(!1),y=H([]),b=H(""),h=H(""),g=H(!1),w=H(1),O=H(10),Y=H(0),A=H(!1),K=H(),Q=H(),G=me({file:null,company_id:null,related_products:[],project_name:"",bid_result:"待定",bid_date:"",notes:""}),W={company_id:[{required:!0,message:"请选择所属公司",trigger:"change"}],project_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},oe=H(!1),se=H(!1),ie=H(""),ce=H(""),pe=H(!1),Ve=me({tender_doc_id:null,project_name:"",bid_result:"",bid_date:"",notes:""}),Ue=H(!1),Ie=H(!1),$e=H("view"),Be=H(null),ma=me({excerpt_id:null,chapter_title:"",category:"",quality_score:0,tags:"",content:""}),fa=async()=>{s.value=!0;try{const e=new URLSearchParams({company_id:String(o.value),page:String(p.value),page_size:String(v.value)});i.value&&e.append("keyword",i.value),c.value&&e.append("bid_result",c.value);const a=await fetch(`${va}/documents?${e}`),t=await a.json();t.success?(d.value=t.data||[],m.value=t.total||0,r.docCount=m.value,r.wonCount=d.value.filter(e=>"中标"===e.bid_result).length):l("加载失败",t.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{s.value=!1}},_a=async()=>{_.value=!0;try{const e=new URLSearchParams({company_id:String(o.value),page:String(w.value),page_size:String(O.value)});b.value&&e.append("keyword",b.value),h.value&&e.append("category",h.value),g.value&&e.append("won_only","true");const a=await fetch(`${va}/excerpts?${e}`),t=await a.json();t.success?(y.value=t.data||[],Y.value=t.total||0,r.excerptCount=Y.value):l("加载失败",t.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{_.value=!1}},ya=()=>{G.file=null,G.company_id=t.companyId||null,G.related_products=[],G.project_name="",G.bid_result="待定",G.bid_date="",G.notes="",K.value&&K.value.clearFiles(),A.value=!0},ba=(e,a)=>{e&&e.raw&&(G.file=e.raw)},ha=()=>{G.file=null},ga=async()=>{if(G.file)if(G.company_id){oe.value=!0;try{const e=new FormData;e.append("file",G.file),e.append("company_id",String(G.company_id)),e.append("project_name",G.project_name),e.append("bid_result",G.bid_result),G.bid_date&&e.append("bid_date",G.bid_date),G.notes&&e.append("notes",G.notes),G.related_products.length>0&&e.append("related_products",JSON.stringify(G.related_products));const t=await fetch(`${va}/documents/upload`,{method:"POST",body:e}),o=await t.json();o.success?(a("上传成功",o.message),A.value=!1,fa()):l("上传失败",o.error||"未知错误")}catch(e){l("上传失败",e instanceof Error?e.message:"未知错误")}finally{oe.value=!1}}else l("请选择所属公司");else l("请选择文件")},wa=async()=>{Ue.value=!0;try{const e=await fetch(`${va}/documents/${Ve.tender_doc_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ve)}),t=await e.json();t.success?(a("保存成功"),pe.value=!1,fa()):l("保存失败",t.error||"未知错误")}catch(e){l("保存失败",e instanceof Error?e.message:"未知错误")}finally{Ue.value=!1}},Va=async()=>{Ue.value=!0;try{const e=await fetch(`${va}/excerpts/${ma.excerpt_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ma)}),t=await e.json();t.success?(a("保存成功"),Ie.value=!1,_a()):l("保存失败",t.error||"未知错误")}catch(e){l("保存失败",e instanceof Error?e.message:"未知错误")}finally{Ue.value=!1}},xa=e=>"中标"===e?"success":"未中标"===e?"danger":"info";return fe(()=>{t.fetchCompanies(),(async()=>{try{const e=await fetch("/api/product-categories"),a=await e.json();a.success&&(u.value=a.data||[])}catch(e){}})(),fa(),_a()}),X(n,e=>{"documents"===e?fa():_a()}),X(o,()=>{fa(),_a()}),(e,o)=>{const V=f,H=xe,J=k,X=N,me=P,fe=U,Oe=je,Ca=ke,ja=Ce,ka=R,Sa=F,Ua=Se,za=De,Ta=L,Ea=ze,Ia=E,$a=q,Ba=$,Da=I,Oa=M,Ma=T,Pa=B,Na=Ee,qa=Te;return ee(),Z("div",Me,[_e("div",Pe,[re(H,{class:"stat-card"},{default:ne(()=>[_e("div",Ne,[_e("div",qe,[re(V,{size:32,color:"#409eff"},{default:ne(()=>[re(ue(x))]),_:1})]),_e("div",Fe,[o[33]||(o[33]=_e("div",{class:"stat-label"},"标书文档",-1)),_e("div",Le,ve(r.docCount),1)])])]),_:1}),re(H,{class:"stat-card"},{default:ne(()=>[_e("div",Re,[_e("div",Ye,[re(V,{size:32,color:"#67c23a"},{default:ne(()=>[re(ue(C))]),_:1})]),_e("div",Ae,[o[34]||(o[34]=_e("div",{class:"stat-label"},"素材片段",-1)),_e("div",He,ve(r.excerptCount),1)])])]),_:1}),re(H,{class:"stat-card"},{default:ne(()=>[_e("div",Je,[_e("div",Ke,[re(V,{size:32,color:"#e6a23c"},{default:ne(()=>[re(ue(j))]),_:1})]),_e("div",Qe,[o[35]||(o[35]=_e("div",{class:"stat-label"},"中标标书",-1)),_e("div",Ge,ve(r.wonCount),1)])])]),_:1})]),re(Ta,{modelValue:n.value,"onUpdate:modelValue":o[9]||(o[9]=e=>n.value=e),type:"border-card"},{default:ne(()=>[re(Sa,{label:"标书文档",name:"documents"},{default:ne(()=>[_e("div",We,[re(J,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),placeholder:"搜索文档名称...",clearable:"",style:{width:"200px"},onKeyup:ye(fa,["enter"])},{prefix:ne(()=>[re(V,null,{default:ne(()=>[re(ue(S))]),_:1})]),_:1},8,["modelValue"]),re(me,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=e=>c.value=e),placeholder:"投标结果",clearable:"",style:{width:"120px"},onChange:fa},{default:ne(()=>[re(X,{label:"全部",value:""}),re(X,{label:"中标",value:"中标"}),re(X,{label:"未中标",value:"未中标"}),re(X,{label:"待定",value:"待定"})]),_:1},8,["modelValue"]),re(fe,{type:"primary",onClick:ya},{default:ne(()=>[re(V,null,{default:ne(()=>[re(ue(z))]),_:1}),o[36]||(o[36]=be(" 上传标书 ",-1))]),_:1})]),s.value?(ee(),de(ue(he),{key:0,text:"加载中..."})):d.value.length?(ee(),de(ja,{key:2,data:d.value,stripe:""},{default:ne(()=>[re(Oe,{prop:"doc_name",label:"文档名称","min-width":"200","show-overflow-tooltip":""}),re(Oe,{prop:"project_name",label:"项目名称",width:"180","show-overflow-tooltip":""}),re(Oe,{prop:"bid_result",label:"投标结果",width:"100",align:"center"},{default:ne(({row:e})=>[re(Ca,{type:xa(e.bid_result)},{default:ne(()=>[be(ve(e.bid_result||"待定"),1)]),_:2},1032,["type"])]),_:1}),re(Oe,{prop:"excerpt_count",label:"片段数",width:"80",align:"center"}),re(Oe,{prop:"bid_date",label:"投标日期",width:"120"}),re(Oe,{prop:"created_at",label:"上传时间",width:"160"}),re(Oe,{label:"操作",width:"200",fixed:"right"},{default:ne(({row:e})=>[re(fe,{link:"",type:"primary",size:"small",onClick:a=>{return l=e,ie.value=l.file_path||"",ce.value=l.doc_name||"文档预览",void(se.value=!0);var l}},{default:ne(()=>[...o[37]||(o[37]=[be(" 查看 ",-1)])]),_:1},8,["onClick"]),re(fe,{link:"",type:"success",size:"small",onClick:t=>(async e=>{try{await D.confirm(`确定要从 "${e.doc_name}" 提取素材片段吗？`,"提取素材",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"})}catch{return}try{const t=await fetch(`${va}/documents/${e.tender_doc_id}/extract`,{method:"POST"}),o=await t.json();o.success?(a("提取完成",`成功提取 ${o.extracted_count||0} 个片段`),fa(),_a()):l("提取失败",o.error||"未知错误")}catch(t){l("提取失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:ne(()=>[...o[38]||(o[38]=[be(" 提取 ",-1)])]),_:1},8,["onClick"]),re(fe,{link:"",type:"warning",size:"small",onClick:a=>{return l=e,Ve.tender_doc_id=l.tender_doc_id,Ve.project_name=l.project_name||"",Ve.bid_result=l.bid_result||"待定",Ve.bid_date=l.bid_date||"",Ve.notes=l.notes||"",void(pe.value=!0);var l}},{default:ne(()=>[...o[39]||(o[39]=[be(" 编辑 ",-1)])]),_:1},8,["onClick"]),re(fe,{link:"",type:"danger",size:"small",onClick:t=>(async e=>{try{await D.confirm(`确定要删除 "${e.doc_name}" 吗？关联的素材片段也会被删除。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${va}/documents/${e.tender_doc_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功"),fa(),_a()):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:ne(()=>[...o[40]||(o[40]=[be(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(ee(),de(ue(ge),{key:1,type:"no-data",description:"暂无标书文档"})),m.value>v.value?(ee(),Z("div",Xe,[re(ka,{"current-page":p.value,"onUpdate:currentPage":o[2]||(o[2]=e=>p.value=e),"page-size":v.value,"onUpdate:pageSize":o[3]||(o[3]=e=>v.value=e),total:m.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:fa,onCurrentChange:fa},null,8,["current-page","page-size","total"])])):ae("",!0)]),_:1}),re(Sa,{label:"素材片段",name:"excerpts"},{default:ne(()=>[_e("div",Ze,[re(J,{modelValue:b.value,"onUpdate:modelValue":o[4]||(o[4]=e=>b.value=e),placeholder:"搜索素材内容...",clearable:"",style:{width:"250px"},onKeyup:ye(_a,["enter"])},{prefix:ne(()=>[re(V,null,{default:ne(()=>[re(ue(S))]),_:1})]),_:1},8,["modelValue"]),re(me,{modelValue:h.value,"onUpdate:modelValue":o[5]||(o[5]=e=>h.value=e),placeholder:"分类",clearable:"",style:{width:"120px"},onChange:_a},{default:ne(()=>[re(X,{label:"全部",value:""}),re(X,{label:"技术方案",value:"技术方案"}),re(X,{label:"项目管理",value:"项目管理"}),re(X,{label:"售后服务",value:"售后服务"}),re(X,{label:"企业资质",value:"企业资质"}),re(X,{label:"团队介绍",value:"团队介绍"}),re(X,{label:"其他",value:"其他"})]),_:1},8,["modelValue"]),re(Ua,{modelValue:g.value,"onUpdate:modelValue":o[6]||(o[6]=e=>g.value=e),onChange:_a},{default:ne(()=>[...o[41]||(o[41]=[be("仅中标",-1)])]),_:1},8,["modelValue"])]),_.value?(ee(),de(ue(he),{key:0,text:"加载中..."})):y.value.length?(ee(),Z("div",ea,[(ee(!0),Z(le,null,te(y.value,e=>(ee(),de(H,{key:e.excerpt_id,class:"excerpt-card",shadow:"hover"},{header:ne(()=>{return[_e("div",aa,[_e("div",la,[_e("span",ta,ve(e.chapter_title||"无标题"),1),re(Ca,{size:"small",type:(a=e.category,{"技术方案":"primary","项目管理":"success","售后服务":"warning","企业资质":"info","团队介绍":"","其他":"info"}[a]||"info")},{default:ne(()=>[be(ve(e.category||"未分类"),1)]),_:2},1032,["type"]),"中标"===e.bid_result?(ee(),de(Ca,{key:0,size:"small",type:"success"},{default:ne(()=>[...o[42]||(o[42]=[be(" 中标 ",-1)])]),_:1})):ae("",!0)]),_e("div",oa,[_e("span",ua,ve(e.doc_name),1),re(za,{modelValue:e.quality_score,"onUpdate:modelValue":a=>e.quality_score=a,disabled:"",max:5,size:"small",colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue","onUpdate:modelValue"])])])];var a}),default:ne(()=>{var t,u;return[_e("div",ra,ve(null==(t=e.content)?void 0:t.substring(0,300))+ve((null==(u=e.content)?void 0:u.length)>300?"...":""),1),_e("div",na,[_e("div",sa,[(ee(!0),Z(le,null,te((e.tags||"").split(",").filter(Boolean).slice(0,3),e=>(ee(),de(Ca,{key:e,size:"small",type:"info"},{default:ne(()=>[be(ve(e),1)]),_:2},1024))),128))]),_e("div",da,[re(fe,{link:"",type:"primary",size:"small",onClick:a=>(e=>{Be.value=e,$e.value="view",Ie.value=!0})(e)},{default:ne(()=>[...o[43]||(o[43]=[be(" 查看全文 ",-1)])]),_:1},8,["onClick"]),re(fe,{link:"",type:"primary",size:"small",onClick:t=>(async e=>{try{await navigator.clipboard.writeText(e.content||""),a("已复制到剪贴板")}catch(t){l("复制失败")}})(e)},{default:ne(()=>[...o[44]||(o[44]=[be(" 复制 ",-1)])]),_:1},8,["onClick"]),re(fe,{link:"",type:"warning",size:"small",onClick:a=>(e=>{Be.value=e,ma.excerpt_id=e.excerpt_id,ma.chapter_title=e.chapter_title||"",ma.category=e.category||"",ma.quality_score=e.quality_score||0,ma.tags=e.tags||"",ma.content=e.content||"",$e.value="edit",Ie.value=!0})(e)},{default:ne(()=>[...o[45]||(o[45]=[be(" 编辑 ",-1)])]),_:1},8,["onClick"]),re(fe,{link:"",type:"danger",size:"small",onClick:t=>(async e=>{try{await D.confirm(`确定要删除素材片段 "${e.chapter_title||"未命名"}" 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${va}/excerpts/${e.excerpt_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功"),_a()):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:ne(()=>[...o[46]||(o[46]=[be(" 删除 ",-1)])]),_:1},8,["onClick"])])])]}),_:2},1024))),128))])):(ee(),de(ue(ge),{key:1,type:"no-data",description:"暂无素材片段"})),Y.value>O.value?(ee(),Z("div",ia,[re(ka,{"current-page":w.value,"onUpdate:currentPage":o[7]||(o[7]=e=>w.value=e),"page-size":O.value,"onUpdate:pageSize":o[8]||(o[8]=e=>O.value=e),total:Y.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:_a,onCurrentChange:_a},null,8,["current-page","page-size","total"])])):ae("",!0)]),_:1})]),_:1},8,["modelValue"]),re(Pa,{modelValue:A.value,"onUpdate:modelValue":o[17]||(o[17]=e=>A.value=e),title:"上传标书文档",width:"600px"},{footer:ne(()=>[re(fe,{onClick:o[16]||(o[16]=e=>A.value=!1)},{default:ne(()=>[...o[52]||(o[52]=[be("取消",-1)])]),_:1}),re(fe,{type:"primary",onClick:ga,loading:oe.value},{default:ne(()=>[...o[53]||(o[53]=[be(" 上传 ",-1)])]),_:1},8,["loading"])]),default:ne(()=>[re(Ma,{model:G,rules:W,ref_key:"uploadFormRef",ref:Q,"label-width":"100px"},{default:ne(()=>[re(Ia,{label:"文档文件",prop:"file"},{default:ne(()=>[re(Ea,{ref_key:"uploadRef",ref:K,"auto-upload":!1,limit:1,"on-change":ba,"on-remove":ha,accept:".docx,.doc,.pdf"},{trigger:ne(()=>[re(fe,{type:"primary"},{default:ne(()=>[...o[47]||(o[47]=[be("选择文件",-1)])]),_:1})]),tip:ne(()=>[...o[48]||(o[48]=[_e("div",{class:"el-upload__tip"},"支持 .docx, .doc, .pdf 格式",-1)])]),_:1},512)]),_:1}),re(Ia,{label:"所属公司",prop:"company_id"},{default:ne(()=>[re(me,{modelValue:G.company_id,"onUpdate:modelValue":o[10]||(o[10]=e=>G.company_id=e),placeholder:"请选择公司",style:{width:"100%"},filterable:""},{default:ne(()=>[(ee(!0),Z(le,null,te(ue(t).companiesOptions,e=>(ee(),de(X,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),re(Ia,{label:"关联产品",prop:"related_products"},{default:ne(()=>[re(me,{modelValue:G.related_products,"onUpdate:modelValue":o[11]||(o[11]=e=>G.related_products=e),placeholder:"请选择产品分类（可多选）",style:{width:"100%"},multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:ne(()=>[(ee(!0),Z(le,null,te(u.value,e=>(ee(),de($a,{key:e.category_id,label:e.category_name},{default:ne(()=>[(ee(!0),Z(le,null,te(e.items,e=>(ee(),de(X,{key:e.item_id,label:e.item_name,value:e.item_code},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),re(Ia,{label:"项目名称",prop:"project_name"},{default:ne(()=>[re(J,{modelValue:G.project_name,"onUpdate:modelValue":o[12]||(o[12]=e=>G.project_name=e),placeholder:"投标项目名称"},null,8,["modelValue"])]),_:1}),re(Ia,{label:"投标结果",prop:"bid_result"},{default:ne(()=>[re(Da,{modelValue:G.bid_result,"onUpdate:modelValue":o[13]||(o[13]=e=>G.bid_result=e)},{default:ne(()=>[re(Ba,{label:"中标"},{default:ne(()=>[...o[49]||(o[49]=[be("中标",-1)])]),_:1}),re(Ba,{label:"未中标"},{default:ne(()=>[...o[50]||(o[50]=[be("未中标",-1)])]),_:1}),re(Ba,{label:"待定"},{default:ne(()=>[...o[51]||(o[51]=[be("待定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),re(Ia,{label:"投标日期",prop:"bid_date"},{default:ne(()=>[re(Oa,{modelValue:G.bid_date,"onUpdate:modelValue":o[14]||(o[14]=e=>G.bid_date=e),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),re(Ia,{label:"备注",prop:"notes"},{default:ne(()=>[re(J,{modelValue:G.notes,"onUpdate:modelValue":o[15]||(o[15]=e=>G.notes=e),type:"textarea",rows:2,placeholder:"可选备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),re(Pa,{modelValue:pe.value,"onUpdate:modelValue":o[23]||(o[23]=e=>pe.value=e),title:"编辑标书信息",width:"500px"},{footer:ne(()=>[re(fe,{onClick:o[22]||(o[22]=e=>pe.value=!1)},{default:ne(()=>[...o[57]||(o[57]=[be("取消",-1)])]),_:1}),re(fe,{type:"primary",onClick:wa,loading:Ue.value},{default:ne(()=>[...o[58]||(o[58]=[be(" 保存 ",-1)])]),_:1},8,["loading"])]),default:ne(()=>[re(Ma,{model:Ve,"label-width":"100px"},{default:ne(()=>[re(Ia,{label:"项目名称"},{default:ne(()=>[re(J,{modelValue:Ve.project_name,"onUpdate:modelValue":o[18]||(o[18]=e=>Ve.project_name=e)},null,8,["modelValue"])]),_:1}),re(Ia,{label:"投标结果"},{default:ne(()=>[re(Da,{modelValue:Ve.bid_result,"onUpdate:modelValue":o[19]||(o[19]=e=>Ve.bid_result=e)},{default:ne(()=>[re(Ba,{label:"中标"},{default:ne(()=>[...o[54]||(o[54]=[be("中标",-1)])]),_:1}),re(Ba,{label:"未中标"},{default:ne(()=>[...o[55]||(o[55]=[be("未中标",-1)])]),_:1}),re(Ba,{label:"待定"},{default:ne(()=>[...o[56]||(o[56]=[be("待定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),re(Ia,{label:"投标日期"},{default:ne(()=>[re(Oa,{modelValue:Ve.bid_date,"onUpdate:modelValue":o[20]||(o[20]=e=>Ve.bid_date=e),type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),re(Ia,{label:"备注"},{default:ne(()=>[re(J,{modelValue:Ve.notes,"onUpdate:modelValue":o[21]||(o[21]=e=>Ve.notes=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),re(Pa,{modelValue:Ie.value,"onUpdate:modelValue":o[31]||(o[31]=e=>Ie.value=e),title:"view"===$e.value?"素材详情":"编辑素材",width:"700px"},{footer:ne(()=>[re(fe,{onClick:o[29]||(o[29]=e=>Ie.value=!1)},{default:ne(()=>[...o[60]||(o[60]=[be("关闭",-1)])]),_:1}),"view"===$e.value?(ee(),de(fe,{key:0,type:"primary",onClick:o[30]||(o[30]=e=>$e.value="edit")},{default:ne(()=>[...o[61]||(o[61]=[be(" 编辑 ",-1)])]),_:1})):(ee(),de(fe,{key:1,type:"primary",onClick:Va,loading:Ue.value},{default:ne(()=>[...o[62]||(o[62]=[be(" 保存 ",-1)])]),_:1},8,["loading"]))]),default:ne(()=>{var e;return["view"===$e.value?(ee(),Z(le,{key:0},[re(qa,{column:2,border:""},{default:ne(()=>[re(Na,{label:"章节标题",span:2},{default:ne(()=>{var e;return[be(ve(null==(e=Be.value)?void 0:e.chapter_title),1)]}),_:1}),re(Na,{label:"分类"},{default:ne(()=>{var e;return[be(ve((null==(e=Be.value)?void 0:e.category)||"未分类"),1)]}),_:1}),re(Na,{label:"质量评分"},{default:ne(()=>{var e;return[re(za,{"model-value":null==(e=Be.value)?void 0:e.quality_score,disabled:"",max:5},null,8,["model-value"])]}),_:1}),re(Na,{label:"来源文档",span:2},{default:ne(()=>{var e;return[be(ve(null==(e=Be.value)?void 0:e.doc_name),1)]}),_:1}),re(Na,{label:"投标结果"},{default:ne(()=>{var e;return[re(Ca,{type:xa(null==(e=Be.value)?void 0:e.bid_result)},{default:ne(()=>{var e;return[be(ve((null==(e=Be.value)?void 0:e.bid_result)||"待定"),1)]}),_:1},8,["type"])]}),_:1}),re(Na,{label:"标签"},{default:ne(()=>{var e;return[be(ve((null==(e=Be.value)?void 0:e.tags)||"无"),1)]}),_:1})]),_:1}),_e("div",ca,[o[59]||(o[59]=_e("h4",null,"素材内容",-1)),_e("div",pa,ve(null==(e=Be.value)?void 0:e.content),1)])],64)):(ee(),de(Ma,{key:1,model:ma,"label-width":"100px"},{default:ne(()=>[re(Ia,{label:"章节标题"},{default:ne(()=>[re(J,{modelValue:ma.chapter_title,"onUpdate:modelValue":o[24]||(o[24]=e=>ma.chapter_title=e)},null,8,["modelValue"])]),_:1}),re(Ia,{label:"分类"},{default:ne(()=>[re(me,{modelValue:ma.category,"onUpdate:modelValue":o[25]||(o[25]=e=>ma.category=e),style:{width:"100%"}},{default:ne(()=>[re(X,{label:"技术方案",value:"技术方案"}),re(X,{label:"项目管理",value:"项目管理"}),re(X,{label:"售后服务",value:"售后服务"}),re(X,{label:"企业资质",value:"企业资质"}),re(X,{label:"团队介绍",value:"团队介绍"}),re(X,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),re(Ia,{label:"质量评分"},{default:ne(()=>[re(za,{modelValue:ma.quality_score,"onUpdate:modelValue":o[26]||(o[26]=e=>ma.quality_score=e),max:5},null,8,["modelValue"])]),_:1}),re(Ia,{label:"标签"},{default:ne(()=>[re(J,{modelValue:ma.tags,"onUpdate:modelValue":o[27]||(o[27]=e=>ma.tags=e),placeholder:"逗号分隔的标签"},null,8,["modelValue"])]),_:1}),re(Ia,{label:"内容"},{default:ne(()=>[re(J,{modelValue:ma.content,"onUpdate:modelValue":o[28]||(o[28]=e=>ma.content=e),type:"textarea",rows:10},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]))]}),_:1},8,["modelValue","title"]),re(we,{modelValue:se.value,"onUpdate:modelValue":o[32]||(o[32]=e=>se.value=e),"file-url":ie.value,"file-name":ce.value},null,8,["modelValue","file-url","file-name"])])}}}),[["__scopeId","data-v-bd638af1"]]);export{ma as default};
