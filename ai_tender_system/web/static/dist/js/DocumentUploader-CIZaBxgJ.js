import{Q as e,k as a,D as t,F as s,a3 as l,au as o,av as r,aw as i,c as u,$ as p,ax as d}from"./element-plus-ZLeSHaWT.js";import{s as c}from"./imageCompressor-CTkRt5bg.js";import{v as m,r as n,c as f,x as g,O as x,A as v,F as y,z as _,y as h,B as w,E as k,I as z,u as F,L as $,K as b}from"./vue-core-CiAVTOOY.js";/* empty css                                                                          */import{_ as T}from"./index.js";const V={class:"document-uploader"},B={key:1,class:"upload-drag-area"},D={key:0,class:"upload-hint"},j={key:0,class:"upload-tip"},C={class:"upload-file-item"},L={class:"file-name"},q=T(m({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(m,{expose:T,emit:q}){const I=m,S=q,H=n(),R=f({get:()=>I.modelValue||[],set:e=>S("update:modelValue",e)}),U=async e=>{var t;if(I.maxSize&&e.size/1024/1024>I.maxSize)return a.error(`文件大小不能超过 ${I.maxSize}MB`),!1;if(I.accept){const s=I.accept.split(",").map(e=>e.trim()),l="."+(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase());if(!s.some(e=>l===e.toLowerCase()))return a.error(`不支持的文件格式：${l}`),!1}if(I.autoCompressImage&&e.type.startsWith("image/"))try{const a=await c(e,I.imageType),t=e.size,s=a.size;((t-s)/t*100).toFixed(1);if(s<t)return a}catch(s){a.warning("图片压缩失败，将上传原文件")}return!0},M=(e,a,t)=>{},A=(e,a,t)=>{S("success",a,t),S("update:modelValue",t)},E=(e,t,s)=>{a.error("文件上传失败："+e.message),S("error",e,t,s)},K=(e,t)=>{a.warning(`最多只能上传 ${I.limit} 个文件`),S("exceed",e,t)},O=(e,a)=>{S("remove",e,a),S("update:modelValue",a)};return T({clearFiles:()=>{var e;null==(e=H.value)||e.clearFiles(),S("update:modelValue",[])},submit:()=>{var e;null==(e=H.value)||e.submit()},abort:e=>{var a;null==(a=H.value)||a.abort(e)}}),(a,c)=>{const n=u,f=t,T=l,q=e;return h(),g("div",V,[x(q,v({ref_key:"uploadRef",ref:H,action:m.uploadUrl,"http-request":m.httpRequest,headers:m.uploadHeaders,data:m.uploadData,accept:m.accept,limit:m.limit,multiple:m.multiple,drag:m.drag,"show-file-list":m.showFileList,"before-upload":U,"on-progress":M,"on-success":A,"on-error":E,"on-exceed":K,"on-remove":O,"file-list":R.value},a.$attrs),{default:y(()=>[_(a.$slots,"trigger",{},()=>[m.drag?(h(),g("div",B,[x(f,{class:"upload-icon"},{default:y(()=>[x(F(d))]),_:1}),c[0]||(c[0]=w("div",{class:"upload-text"},[b(" 将文件拖到此处，或"),w("em",null,"点击上传")],-1)),m.accept?(h(),g("div",D," 支持的文件格式："+$(m.accept),1)):z("",!0)])):(h(),k(n,{key:0,type:"primary",icon:F(p)},{default:y(()=>[b($(m.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:y(()=>[_(a.$slots,"tip",{},()=>[m.tipText?(h(),g("div",j,[x(f,null,{default:y(()=>[x(F(i))]),_:1}),b(" "+$(m.tipText),1)])):z("",!0)],!0)]),file:y(({file:e})=>[_(a.$slots,"file",{file:e},()=>[w("div",C,[x(f,{class:"file-icon"},{default:y(()=>[x(F(s))]),_:1}),w("span",L,$(e.name),1),"uploading"===e.status?(h(),k(T,{key:0,percentage:e.percentage,"stroke-width":2},null,8,["percentage"])):z("",!0),"success"===e.status?(h(),k(f,{key:1,class:"status-icon success"},{default:y(()=>[x(F(o))]),_:1})):z("",!0),"fail"===e.status?(h(),k(f,{key:2,class:"status-icon error"},{default:y(()=>[x(F(r))]),_:1})):z("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),[["__scopeId","data-v-ddbb8fd4"]]);export{q as D};
