import{E as e,d as l,e as t,r as a,f as o,g as i,h as n,i as s}from"./index.js";/* empty css                   *//* empty css                                                        */import{am as r,an as u,ao as v,ap as d,aq as c,ar as m,as as f,at as p,au as h,av as y,aw as g,ax as w,ay as C,az as _,aA as x,aB as k,aC as V,aD as b,aE as j,aF as T}from"./editor-CkQC1Uq_.js";import{E as S}from"./index-CwbKUXgF.js";import{v as U}from"./directive-BoVrmPHi.js";const E={"element-loading-text":"æ­£åœ¨åŠ è½½æ–‡æ¡£...",class:"preview-container"},q={key:1,class:"preview-body"},z={key:0,class:"outline-sidebar"},A={class:"outline-header"},D={class:"outline-list"},I=["onClick"],N={class:"outline-text"},O={class:"outline-footer"},P={class:"editor-preview-wrapper"},$=r({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"æ–‡æ¡£é¢„è§ˆ"},htmlContent:{default:""}},emits:["update:modelValue"],setup(r,{emit:$}){const B=r,M=$,F=u(!1),H=u(""),L=u(""),W=u(null),J=u([]),R=u(!1),G=u(""),K=u(!1),Q=v({get:()=>B.modelValue,set:e=>M("update:modelValue",e)}),X=v(()=>`æ–‡æ¡£é¢„è§ˆ - ${B.fileName||"æœªå‘½åæ–‡æ¡£"}`),Y=()=>{W.value&&L.value&&setTimeout(()=>{"function"==typeof W.value.setContent&&(W.value.setContent(L.value),setTimeout(()=>{Z()},500))},300)},Z=async()=>{var e,l;if(W.value){K.value=!0;try{const t=(null==(l=(e=W.value).getHTML)?void 0:l.call(e))||L.value;if(!t||"<p></p>"===t)return void(J.value=[]);const a=new DOMParser,o=a.parseFromString(t,"text/html").querySelectorAll("h1, h2, h3, h4, h5, h6");J.value=Array.from(o).map((e,l)=>({id:e.id||`heading-${l}`,level:parseInt(e.tagName[1]),textContent:(e.textContent||"").trim(),dom:null}))}catch(t){J.value=[]}finally{K.value=!1}}},ee=()=>{Q.value=!1};return d(()=>B.modelValue,async e=>{e&&(B.fileUrl||B.htmlContent)?(await T(),(async()=>{if(B.htmlContent)L.value=B.htmlContent;else if(B.fileUrl){F.value=!0,H.value="";try{const e=await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:B.fileUrl})}),l=await e.json();if(!l.success||!l.html_content)throw new Error(l.error||"Wordè½¬HTMLå¤±è´¥");L.value=l.html_content}catch(e){H.value=`æ–‡æ¡£é¢„è§ˆå¤±è´¥: ${e.message||"æœªçŸ¥é”™è¯¯"}`,s.error("æ–‡æ¡£é¢„è§ˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®æˆ–å°è¯•ä¸‹è½½åŽæŸ¥çœ‹")}finally{F.value=!1}}else H.value="æ–‡æ¡£åœ°å€ä¸èƒ½ä¸ºç©º"})()):(H.value="",L.value="",J.value=[],G.value="")}),(s,r)=>{const u=e,v=t,d=l,T=S,$=n,B=U;return m(),c($,{modelValue:Q.value,"onUpdate:modelValue":r[2]||(r[2]=e=>Q.value=e),title:X.value,fullscreen:"","before-close":ee,"destroy-on-close":"",class:"document-preview-dialog fullscreen-preview"},{default:f(()=>[p((m(),h("div",E,[H.value?(m(),c(u,{key:0,type:"error",title:H.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):y("",!0),!H.value&&L.value?(m(),h("div",q,[R.value?y("",!0):(m(),h("div",z,[g("div",A,[r[3]||(r[3]=g("h4",null,"ðŸ“‘ ç›®å½•",-1)),w(d,{text:"",size:"small",onClick:Z,loading:K.value},{default:f(()=>[w(v,null,{default:f(()=>[w(C(a))]),_:1})]),_:1},8,["loading"])]),g("div",D,[(m(!0),h(_,null,x(J.value,(e,l)=>(m(),h("div",{key:e.id||l,class:k(["outline-item",`level-${e.level}`,{active:G.value===e.id}]),onClick:l=>(e=>{var l;if(e)try{if(e.id){const l=document.getElementById(e.id);if(l)return l.scrollIntoView({behavior:"smooth",block:"start"}),void(G.value=e.id)}const t=document.querySelector(".editor-preview-wrapper .umo-editor-container");if(t&&e.textContent){const a=t.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const t of a)if((null==(l=t.textContent)?void 0:l.trim())===e.textContent)return t.scrollIntoView({behavior:"smooth",block:"start"}),void(G.value=e.id)}}catch(t){}})(e)},[g("span",N,V(e.textContent),1)],10,I))),128)),0===J.value.length?(m(),c(T,{key:0,description:"æš‚æ— æ ‡é¢˜","image-size":60})):y("",!0)]),g("div",O,[w(d,{text:"",size:"small",onClick:r[0]||(r[0]=e=>R.value=!0)},{default:f(()=>[w(v,null,{default:f(()=>[w(C(o))]),_:1}),r[4]||(r[4]=b(" æŠ˜å ç›®å½• ",-1))]),_:1})])])),R.value?(m(),h("div",{key:1,class:"outline-toggle",onClick:r[1]||(r[1]=e=>R.value=!1)},[w(v,null,{default:f(()=>[w(C(i))]),_:1}),r[5]||(r[5]=g("span",{class:"toggle-text"},"å±•å¼€ç›®å½•",-1))])):y("",!0),g("div",P,[w(C(j),{ref_key:"editorRef",ref:W,document:{readOnly:!0},onCreated:Y},null,512)])])):y("",!0)])),[[B,F.value]])]),_:1},8,["modelValue","title"])}}});export{$ as _};
