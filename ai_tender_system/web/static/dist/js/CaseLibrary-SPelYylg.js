import{D as j,F as H,Q as P,aB as W,aC as X,d as Z,f as ee,i as te,af as ae,q as le,o as oe,a as se,ap as ne,J as re,K as ce,p as de,au as ie}from"./element-plus-IkZgpaz4.js";import{bT as ue,gi as _e,bt as m,bu as z,bG as pe,bU as A,bV as v,bY as r,c8 as t,c0 as l,bv as u,c6 as g,b$ as x,c5 as p}from"./vendor-CdA3MjAt.js";import{L as fe}from"./Loading-CmykbBZp.js";import{E as me}from"./Empty-BNVBwC0L.js";/* empty css                                                                          */import{C as ve}from"./Card-BYP2BB2j.js";import"./umo-editor-BmhDOXHm.js";/* empty css                                                                        */import{a as ye,_ as be}from"./index.js";import{k as F,f as I}from"./formatters-D7k9w9WL.js";import{c as he}from"./company-B1QhkZBS.js";import"./onnxruntime-DkHy2lK3.js";import"./mermaid-e-fO57px.js";import"./echarts-Cqw1j_Z-.js";const ge={class:"case-library"},Ce={class:"stats-bar"},we={class:"stat-content"},ke={class:"stat-icon"},xe={class:"stat-info"},Ee={class:"stat-value"},Ve={class:"stat-content"},Te={class:"stat-icon"},$e={class:"stat-info"},ze={class:"stat-value"},Fe={class:"stat-content"},Ie={class:"stat-icon"},Le={class:"stat-info"},Be={class:"stat-value"},De={class:"filter-section"},Ue={key:1,style:{color:"#909399"}},Ne=ue({__name:"CaseLibrary",setup(Ae){const E=_e(),{success:L,error:f}=ye(),V=m(!1),T=m(!1),y=m([]),b=m([]),C=m(),o=m({keyword:"",productCategory:"",industry:"",contractType:""}),B=z(()=>{let a=[...y.value];if(o.value.keyword){const e=o.value.keyword.toLowerCase();a=a.filter(s=>{var i,_,k;return((i=s.case_title)==null?void 0:i.toLowerCase().includes(e))||((_=s.customer_name)==null?void 0:_.toLowerCase().includes(e))||((k=s.case_number)==null?void 0:k.toLowerCase().includes(e))})}return o.value.productCategory&&(a=a.filter(e=>e.product_category===o.value.productCategory)),o.value.industry&&(a=a.filter(e=>e.industry===o.value.industry)),o.value.contractType&&(a=a.filter(e=>e.contract_type===o.value.contractType)),a}),S=z(()=>y.value.filter(a=>a.contract_type==="合同").length),R=z(()=>{let a=0;return y.value.forEach(e=>{if(e.contract_amount){const s=e.contract_amount.match(/[\d.]+/);if(s){const i=parseFloat(s[0]);e.contract_amount.includes("万")?a+=i*1e4:e.contract_amount.includes("亿")?a+=i*1e8:a+=i}}}),a>=1e8?`${(a/1e8).toFixed(2)}亿`:a>=1e4?`${(a/1e4).toFixed(2)}万`:a.toFixed(2)}),D=async()=>{V.value=!0;try{const a=await F.getCases({company_id:C.value});a.success&&a.data&&(y.value=a.data.map(e=>({...e,contract_start_date:e.contract_start_date?I(e.contract_start_date,"date"):"-",contract_end_date:e.contract_end_date?I(e.contract_end_date,"date"):"-",created_at:e.created_at?I(e.created_at):"-"})))}catch(a){console.error("加载案例列表失败:",a),f("加载失败",a instanceof Error?a.message:"未知错误")}finally{V.value=!1}},q=async()=>{try{const a=await he.getCompanies();a.success&&a.data&&(b.value=a.data,b.value.length>0&&!C.value&&(C.value=b.value[0].company_id,await D()))}catch(a){console.error("加载企业列表失败:",a)}},w=()=>{},G=()=>{o.value.keyword="",o.value.productCategory="",o.value.industry="",o.value.contractType=""},J=async()=>{var a;if(b.value.length===0){f("无法创建","请先添加企业信息");return}T.value=!0;try{const e=C.value||((a=b.value[0])==null?void 0:a.company_id),s=await F.createCase({company_id:e,case_title:"新建案例",customer_name:"待完善",industry:"金融",contract_type:"合同"});s.success&&s.data?(L("创建成功","正在跳转到编辑页面..."),E.push(`/knowledge/case/${s.data.case_id}`)):f("创建失败",s.error||"未知错误")}catch(e){console.error("创建案例失败:",e),f("创建失败",e instanceof Error?e.message:"未知错误")}finally{T.value=!1}},K=a=>{E.push(`/knowledge/case/${a.case_id}`)},M=a=>{E.push(`/knowledge/case/${a.case_id}`)},O=async a=>{try{if(!confirm(`确定要删除案例 "${a.case_title}" 吗？此操作不可恢复。`))return;const e=await F.deleteCase(a.case_id);e.success?(L("删除成功",`已删除案例: ${a.case_title}`),await D()):f("删除失败",e.error||"未知错误")}catch(e){console.error("删除案例失败:",e),f("删除失败",e instanceof Error?e.message:"未知错误")}};return pe(async()=>{await q()}),(a,e)=>{const s=j,i=P,_=se,k=te,h=ee,c=oe,$=le,Q=Z,d=ce,U=de,Y=re;return v(),A("div",ge,[r("div",Ce,[t(i,{class:"stat-card"},{default:l(()=>[r("div",we,[r("div",ke,[t(s,{size:32,color:"#409eff"},{default:l(()=>[t(u(H))]),_:1})]),r("div",xe,[e[4]||(e[4]=r("div",{class:"stat-label"},"总案例数",-1)),r("div",Ee,g(y.value.length),1)])])]),_:1}),t(i,{class:"stat-card"},{default:l(()=>[r("div",Ve,[r("div",Te,[t(s,{size:32,color:"#67c23a"},{default:l(()=>[t(u(W))]),_:1})]),r("div",$e,[e[5]||(e[5]=r("div",{class:"stat-label"},"合同案例",-1)),r("div",ze,g(S.value),1)])])]),_:1}),t(i,{class:"stat-card"},{default:l(()=>[r("div",Fe,[r("div",Ie,[t(s,{size:32,color:"#e6a23c"},{default:l(()=>[t(u(X))]),_:1})]),r("div",Le,[e[6]||(e[6]=r("div",{class:"stat-label"},"合同总额",-1)),r("div",Be,g(R.value),1)])])]),_:1})]),t(u(ve),{title:"案例列表"},{actions:l(()=>[t(_,{type:"primary",loading:T.value,onClick:J},{default:l(()=>[t(s,null,{default:l(()=>[t(u(ie))]),_:1}),e[7]||(e[7]=p(" 新建案例 ",-1))]),_:1},8,["loading"])]),default:l(()=>[r("div",De,[t(Q,{inline:!0,model:o.value},{default:l(()=>[t(h,{label:"搜索"},{default:l(()=>[t(k,{modelValue:o.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.keyword=n),placeholder:"搜索案例标题、客户名称...",clearable:"",style:{width:"300px"},onInput:w},{prefix:l(()=>[t(s,null,{default:l(()=>[t(u(ae))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"产品分类"},{default:l(()=>[t($,{modelValue:o.value.productCategory,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.productCategory=n),placeholder:"全部产品",clearable:"",style:{width:"130px"},onChange:w},{default:l(()=>[t(c,{label:"全部产品",value:""}),t(c,{label:"风控产品",value:"风控产品"}),t(c,{label:"实修",value:"实修"}),t(c,{label:"免密",value:"免密"}),t(c,{label:"风控位置",value:"风控位置"})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"行业"},{default:l(()=>[t($,{modelValue:o.value.industry,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.industry=n),placeholder:"全部行业",clearable:"",style:{width:"120px"},onChange:w},{default:l(()=>[t(c,{label:"全部行业",value:""}),t(c,{label:"科技",value:"科技"}),t(c,{label:"制造业",value:"制造业"}),t(c,{label:"金融",value:"金融"}),t(c,{label:"教育",value:"教育"}),t(c,{label:"医疗",value:"医疗"}),t(c,{label:"建筑",value:"建筑"}),t(c,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"合同类型"},{default:l(()=>[t($,{modelValue:o.value.contractType,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.contractType=n),placeholder:"全部类型",clearable:"",style:{width:"120px"},onChange:w},{default:l(()=>[t(c,{label:"全部类型",value:""}),t(c,{label:"合同",value:"合同"}),t(c,{label:"订单",value:"订单"})]),_:1},8,["modelValue"])]),_:1}),t(h,null,{default:l(()=>[t(_,{onClick:G},{default:l(()=>[t(s,null,{default:l(()=>[t(u(ne))]),_:1}),e[8]||(e[8]=p(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),V.value?(v(),x(u(fe),{key:0,text:"加载中..."})):B.value.length?(v(),x(Y,{key:2,data:B.value,stripe:"",style:{width:"100%"}},{default:l(()=>[t(d,{prop:"case_id",label:"ID",width:"70",fixed:""}),t(d,{prop:"case_title",label:"案例标题","min-width":"200",fixed:"","show-overflow-tooltip":""}),t(d,{prop:"customer_name",label:"客户名称",width:"180","show-overflow-tooltip":""}),t(d,{prop:"product_category",label:"产品分类",width:"110",align:"center"},{default:l(({row:n})=>[n.product_category?(v(),x(U,{key:0,type:"primary",size:"small"},{default:l(()=>[p(g(n.product_category),1)]),_:2},1024)):(v(),A("span",Ue,"-"))]),_:1}),t(d,{prop:"industry",label:"所属行业",width:"100"}),t(d,{prop:"contract_type",label:"合同类型",width:"100",align:"center"},{default:l(({row:n})=>[t(U,{type:n.contract_type==="合同"?"primary":"success",size:"small"},{default:l(()=>[p(g(n.contract_type),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"contract_amount",label:"合同金额",width:"120",align:"right"}),t(d,{prop:"contract_start_date",label:"合同开始日期",width:"120"}),t(d,{prop:"contract_end_date",label:"合同结束日期",width:"120"}),t(d,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),t(d,{label:"操作",width:"220",fixed:"right"},{default:l(({row:n})=>[t(_,{text:"",type:"primary",size:"small",onClick:N=>K(n)},{default:l(()=>[...e[9]||(e[9]=[p(" 查看详情 ",-1)])]),_:1},8,["onClick"]),t(_,{text:"",type:"warning",size:"small",onClick:N=>M(n)},{default:l(()=>[...e[10]||(e[10]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(_,{text:"",type:"danger",size:"small",onClick:N=>O(n)},{default:l(()=>[...e[11]||(e[11]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(v(),x(u(me),{key:1,type:"no-data",description:"暂无案例数据"}))]),_:1})])}}}),Xe=be(Ne,[["__scopeId","data-v-f9e054aa"]]);export{Xe as default};
