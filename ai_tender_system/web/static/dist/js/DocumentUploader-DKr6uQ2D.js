import{d as e,r as a,c as t,e as s,o as l,f as o,at as i,aN as r,w as u,aM as d,A as p,n as c,k as n,l as m,ad as f,h as g,ae as x,t as v,aL as y,aO as _,aP as h,p as w,aQ as k,g as z,aF as b,aR as F}from"./vendor-UMr2cBTC.js";import{s as T}from"./imageCompressor-CTkRt5bg.js";/* empty css                                                                          */import{_ as V}from"./index.js";const $={class:"document-uploader"},B={key:1,class:"upload-drag-area"},C={key:0,class:"upload-hint"},L={key:0,class:"upload-tip"},j={class:"upload-file-item"},q={class:"file-name"},D=V(e({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(e,{expose:V,emit:D}){const I=e,R=D,S=a(),H=t({get:()=>I.modelValue||[],set:e=>R("update:modelValue",e)}),U=async e=>{var a;if(I.maxSize&&e.size/1024/1024>I.maxSize)return p.error(`文件大小不能超过 ${I.maxSize}MB`),!1;if(I.accept){const t=I.accept.split(",").map(e=>e.trim()),s="."+(null==(a=e.name.split(".").pop())?void 0:a.toLowerCase());if(!t.some(e=>s===e.toLowerCase()))return p.error(`不支持的文件格式：${s}`),!1}if(I.autoCompressImage&&e.type.startsWith("image/"))try{const a=await T(e,I.imageType),t=e.size,s=a.size;((t-s)/t*100).toFixed(1);if(s<t)return a}catch(t){p.warning("图片压缩失败，将上传原文件")}return!0},M=(e,a,t)=>{},P=(e,a,t)=>{R("success",a,t),R("update:modelValue",t)},A=(e,a,t)=>{p.error("文件上传失败："+e.message),R("error",e,a,t)},N=(e,a)=>{p.warning(`最多只能上传 ${I.limit} 个文件`),R("exceed",e,a)},O=(e,a)=>{R("remove",e,a),R("update:modelValue",a)};return V({clearFiles:()=>{var e;null==(e=S.value)||e.clearFiles(),R("update:modelValue",[])},submit:()=>{var e;null==(e=S.value)||e.submit()},abort:e=>{var a;null==(a=S.value)||a.abort(e)}}),(a,t)=>{const p=z,T=f,V=y,D=i;return l(),s("div",$,[o(D,r({ref_key:"uploadRef",ref:S,action:e.uploadUrl,"http-request":e.httpRequest,headers:e.uploadHeaders,data:e.uploadData,accept:e.accept,limit:e.limit,multiple:e.multiple,drag:e.drag,"show-file-list":e.showFileList,"before-upload":U,"on-progress":M,"on-success":P,"on-error":A,"on-exceed":N,"on-remove":O,"file-list":H.value},a.$attrs),{default:u(()=>[d(a.$slots,"trigger",{},()=>[e.drag?(l(),s("div",B,[o(T,{class:"upload-icon"},{default:u(()=>[o(g(F))]),_:1}),t[0]||(t[0]=c("div",{class:"upload-text"},[w(" 将文件拖到此处，或"),c("em",null,"点击上传")],-1)),e.accept?(l(),s("div",C," 支持的文件格式："+v(e.accept),1)):m("",!0)])):(l(),n(p,{key:0,type:"primary",icon:g(b)},{default:u(()=>[w(v(e.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:u(()=>[d(a.$slots,"tip",{},()=>[e.tipText?(l(),s("div",L,[o(T,null,{default:u(()=>[o(g(k))]),_:1}),w(" "+v(e.tipText),1)])):m("",!0)],!0)]),file:u(({file:e})=>[d(a.$slots,"file",{file:e},()=>[c("div",j,[o(T,{class:"file-icon"},{default:u(()=>[o(g(x))]),_:1}),c("span",q,v(e.name),1),"uploading"===e.status?(l(),n(V,{key:0,percentage:e.percentage,"stroke-width":2},null,8,["percentage"])):m("",!0),"success"===e.status?(l(),n(T,{key:1,class:"status-icon success"},{default:u(()=>[o(g(_))]),_:1})):m("",!0),"fail"===e.status?(l(),n(T,{key:2,class:"status-icon error"},{default:u(()=>[o(g(h))]),_:1})):m("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),[["__scopeId","data-v-ddbb8fd4"]]);export{D};
