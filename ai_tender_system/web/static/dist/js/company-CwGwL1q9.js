import{j as a}from"./index.js";import{c as e}from"./company-CHa0NuIL.js";import{an as n,ao as u}from"./editor-DIU3HkCl.js";const l=a("company",()=>{const a=n(null),l=n([]),t=n(!1),r=n(null),c=u(()=>{var e;return(null==(e=a.value)?void 0:e.id)||null}),s=u(()=>{var e;return(null==(e=a.value)?void 0:e.name)||""}),o=u(()=>{var e;return(null==(e=a.value)?void 0:e.code)||""}),v=u(()=>!!a.value),i=u(()=>l.value.length),m=u(()=>l.value.map(a=>({label:a.name,value:a.id})));function y(e){a.value=e,p()}function d(){a.value=null,localStorage.removeItem("current_company")}function p(){try{a.value&&localStorage.setItem("current_company",JSON.stringify(a.value))}catch(e){}}return{currentCompany:a,companies:l,loading:t,error:r,companyId:c,companyName:s,companyCode:o,hasCurrentCompany:v,companiesCount:i,companiesOptions:m,setCurrentCompany:y,setCurrentCompanyById:async function(a){const n=l.value.find(e=>e.id===a);if(n)return y(n),!0;t.value=!0,r.value=null;try{const n=await e.getCompany(a);return n.success&&n.data?(y(n.data),!0):(r.value=n.message||"获取公司信息失败",!1)}catch(u){return r.value=u.message||"获取公司信息失败",!1}finally{t.value=!1}},clearCurrentCompany:d,fetchCompanies:async function(){t.value=!0,r.value=null;try{const a=await e.getCompanies();a.success&&a.data&&(l.value=a.data.map(a=>({...a,id:a.company_id??a.id,name:a.name??a.company_name})))}catch(a){r.value=a.message||"获取公司列表失败"}finally{t.value=!1}},fetchCompany:async function(a){t.value=!0,r.value=null;try{const n=await e.getCompany(a);if(n.success&&n.data){const e=l.value.findIndex(e=>e.id===a);return-1!==e?l.value[e]=n.data:l.value.push(n.data),n.data}return r.value=n.message||"获取公司详情失败",null}catch(n){return r.value=n.message||"获取公司详情失败",null}finally{t.value=!1}},createCompany:async function(a){t.value=!0,r.value=null;try{const n=await e.createCompany(a);return n.success&&n.data?(l.value.push(n.data),n.data):(r.value=n.message||"创建公司失败",null)}catch(n){return r.value=n.message||"创建公司失败",null}finally{t.value=!1}},updateCompany:async function(n,u){var c;t.value=!0,r.value=null;try{const t=await e.updateCompany(n,u);if(t.success&&t.data){const e=l.value.findIndex(a=>a.id===n);return-1!==e&&(l.value[e]=t.data),(null==(c=a.value)?void 0:c.id)===n&&(a.value=t.data,p()),!0}return r.value=t.message||"更新公司失败",!1}catch(s){return r.value=s.message||"更新公司失败",!1}finally{t.value=!1}},deleteCompany:async function(n){var u;t.value=!0,r.value=null;try{const t=await e.deleteCompany(n);return t.success?(l.value=l.value.filter(a=>a.id!==n),(null==(u=a.value)?void 0:u.id)===n&&d(),!0):(r.value=t.message||"删除公司失败",!1)}catch(c){return r.value=c.message||"删除公司失败",!1}finally{t.value=!1}},searchCompanies:async function(a){if(!a.trim())return l.value;t.value=!0,r.value=null;try{const n=await e.searchCompanies(a);return n.success&&n.data?n.data:[]}catch(n){return r.value=n.message||"搜索失败",[]}finally{t.value=!1}},restoreFromStorage:function(){try{const e=localStorage.getItem("current_company");e&&(a.value=JSON.parse(e))}catch(e){}},saveToStorage:p,$reset:function(){a.value=null,l.value=[],t.value=!1,r.value=null,localStorage.removeItem("current_company")}}});export{l as u};
