import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";import{r as t}from"./DocumentPreview.vue_vue_type_style_index_0_scoped_3e333bda_lang-DmpRfM6z.js";/* empty css                 */import{E as n}from"./index-Cjozyviu.js";import{r as l,b as o,bb as s,d as a,bc as r,bd as i,ah as u,w as d,ai as c,g as v,aj as m,a9 as b,ac as g,be as p,W as f,y as x,bf as y,aa as w,an as h,bg as _,bh as k,x as C,A,B as L,o as V,c as B,a0 as $,e as W,D as I,aA as j}from"./index.js";import{E as P}from"./index-CNz3qB3a.js";function E(e,t){let n;const p=l(!1),f=o({...e,originalPosition:"",originalOverflow:"",visible:!1});function x(){var e,t;null==(t=null==(e=_.$el)?void 0:e.parentNode)||t.removeChild(_.$el)}function y(){if(!p.value)return;const e=f.parent;p.value=!1,e.vLoadingAddClassList=void 0,function(){const e=f.parent,t=_.ns;if(!e.vLoadingAddClassList){let n=e.getAttribute("loading-number");n=Number.parseInt(n)-1,n?e.setAttribute("loading-number",n.toString()):(g(e,t.bm("parent","relative")),e.removeAttribute("loading-number")),g(e,t.bm("parent","hidden"))}x(),h.unmount()}()}const w=a({name:"ElLoading",setup(e,{expose:t}){const{ns:n,zIndex:l}=i("loading");return t({ns:n,zIndex:l}),()=>{const e=f.spinner||f.svg,t=u("svg",{class:"circular",viewBox:f.svgViewBox?f.svgViewBox:"0 0 50 50",...e?{innerHTML:e}:{}},[u("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),l=f.text?u("p",{class:n.b("text")},[f.text]):void 0;return u(b,{name:n.b("fade"),onAfterLeave:y},{default:d(()=>[c(v("div",{style:{backgroundColor:f.background||""},class:[n.b("mask"),f.customClass,f.fullscreen?"is-fullscreen":""]},[u("div",{class:n.b("spinner")},[t,l])]),[[m,f.visible]])])})}}}),h=s(w);Object.assign(h._context,null!=t?t:{});const _=h.mount(document.createElement("div"));return{...r(f),setText:function(e){f.text=e},removeElLoadingChild:x,close:function(){var t;e.beforeClose&&!e.beforeClose()||(p.value=!0,clearTimeout(n),n=setTimeout(y,400),f.visible=!1,null==(t=e.closed)||t.call(e))},handleAfterLeave:y,vm:_,get $el(){return _.$el}}}let T;const z=function(e={},t){if(!p)return;const n=N(e);if(n.fullscreen&&T)return T;const l=E({...n,closed:()=>{var e;null==(e=n.closed)||e.call(n),n.fullscreen&&(T=void 0)}},null!=t?t:z._context);D(n,n.parent,l),U(n,n.parent,l),n.parent.vLoadingAddClassList=()=>U(n,n.parent,l);let o=n.parent.getAttribute("loading-number");return o=o?`${Number.parseInt(o)+1}`:"1",n.parent.setAttribute("loading-number",o),n.parent.appendChild(l.$el),f(()=>l.visible.value=n.visible),n.fullscreen&&(T=l),l},N=e=>{var t,n,l,o;let s;return s=x(e.target)?null!=(t=document.querySelector(e.target))?t:document.body:e.target||document.body,{parent:s===document.body||e.body?document.body:s,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:s===document.body&&(null==(n=e.fullscreen)||n),lock:null!=(l=e.lock)&&l,customClass:e.customClass||"",visible:null==(o=e.visible)||o,beforeClose:e.beforeClose,closed:e.closed,target:s}},D=async(e,t,n)=>{const{nextZIndex:l}=n.vm.zIndex||n.vm._.exposed.zIndex,o={};if(e.fullscreen)n.originalPosition.value=y(document.body,"position"),n.originalOverflow.value=y(document.body,"overflow"),o.zIndex=l();else if(e.parent===document.body){n.originalPosition.value=y(document.body,"position"),await f();for(const t of["top","left"]){const n="top"===t?"scrollTop":"scrollLeft";o[t]=e.target.getBoundingClientRect()[t]+document.body[n]+document.documentElement[n]-Number.parseInt(y(document.body,`margin-${t}`),10)+"px"}for(const t of["height","width"])o[t]=`${e.target.getBoundingClientRect()[t]}px`}else n.originalPosition.value=y(t,"position");for(const[s,a]of Object.entries(o))n.$el.style[s]=a},U=(e,t,n)=>{const l=n.vm.ns||n.vm._.exposed.ns;["absolute","fixed","sticky"].includes(n.originalPosition.value)?g(t,l.bm("parent","relative")):w(t,l.bm("parent","relative")),e.fullscreen&&e.lock?w(t,l.bm("parent","hidden")):g(t,l.bm("parent","hidden"))};z._context=null;const H=Symbol("ElLoading"),O=e=>`element-loading-${k(e)}`,R=(e,t)=>{var n,o,s,a;const r=t.instance,i=e=>h(t.value)?t.value[e]:void 0,u=t=>(e=>{const t=x(e)&&(null==r?void 0:r[e])||e;return l(t)})(i(t)||e.getAttribute(O(t))),d=null!=(n=i("fullscreen"))?n:t.modifiers.fullscreen,c={text:u("text"),svg:u("svg"),svgViewBox:u("svgViewBox"),spinner:u("spinner"),background:u("background"),customClass:u("customClass"),fullscreen:d,target:null!=(o=i("target"))?o:d?void 0:e,body:null!=(s=i("body"))?s:t.modifiers.body,lock:null!=(a=i("lock"))?a:t.modifiers.lock},v=z(c);v._context=M._context,e[H]={options:c,instance:v}},M={mounted(e,t){t.value&&R(e,t)},updated(e,t){const n=e[H];if(!t.value)return null==n||n.instance.close(),void(e[H]=null);n?((e,t)=>{for(const n of Object.keys(e))_(e[n])&&(e[n].value=t[n])})(n.options,h(t.value)?t.value:{text:e.getAttribute(O("text")),svg:e.getAttribute(O("svg")),svgViewBox:e.getAttribute(O("svgViewBox")),spinner:e.getAttribute(O("spinner")),background:e.getAttribute(O("background")),customClass:e.getAttribute(O("customClass"))}):R(e,t)},unmounted(e){var t;null==(t=e[H])||t.instance.close(),e[H]=null},_context:null},S={"element-loading-text":"正在加载文档...",class:"preview-container"},q=e(a({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"文档预览"}},emits:["update:modelValue"],setup(e,{emit:o}){const s=e,a=o,r=l(!1),i=l(""),u=l(null),v=C({get:()=>s.modelValue,set:e=>a("update:modelValue",e)}),m=C(()=>`文档预览 - ${s.fileName||"未命名文档"}`),b=()=>{v.value=!1};return A(()=>s.modelValue,async e=>{e&&s.fileUrl?(await f(),(async()=>{if(s.fileUrl){r.value=!0,i.value="";try{const e=(e=>{if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/api/"))return e;if(e.startsWith("/download/"))return`/api/files/serve/download/${e.substring(10)}`;let t=e;const n="/Users/lvhe/Downloads/zhongbiao/zhongbiao/";return t.startsWith(n)&&(t=t.substring(42)),t.startsWith("ai_tender_system/data/")?t=t.substring(22):t.startsWith("data/")&&(t=t.substring(5)),t.startsWith("outputs/")?t="download/"+t.substring(8):t.startsWith("uploads/")||(t="download/"+t),`/api/files/serve/${t}`})(s.fileUrl),n=await fetch(e);if(!n.ok)throw new Error(`HTTP错误: ${n.status}`);const l=await n.arrayBuffer();if(await f(),!u.value)throw new Error("预览容器未找到");u.value.innerHTML="",await t(l,u.value,void 0,{className:"docx-preview",inWrapper:!0,ignoreWidth:!1,ignoreHeight:!1,ignoreFonts:!1,breakPages:!0,ignoreLastRenderedPageBreak:!0,experimental:!0,trimXmlDeclaration:!0})}catch(e){i.value=`文档预览失败: ${e.message||"未知错误"}`,j.error("文档预览失败，请检查文件是否正确或尝试下载后查看")}finally{r.value=!1}}else i.value="文档地址不能为空"})()):(i.value="",u.value&&(u.value.innerHTML=""))}),(e,t)=>{const l=P,o=n,s=M;return V(),L(o,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),title:m.value,width:"80%","before-close":b,"destroy-on-close":""},{default:d(()=>[c((V(),B("div",S,[i.value?(V(),L(l,{key:0,type:"error",title:i.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):$("",!0),W("div",{ref_key:"previewContentRef",ref:u,class:"preview-content",style:I({display:i.value?"none":"block"})},null,4)])),[[s,r.value]])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-3e333bda"]]);export{q as D,M as v};
