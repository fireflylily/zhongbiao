import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";import{E as a}from"./el-overlay-WbHDJpPR.js";import{a as l,E as t}from"./el-table-column-BD7A42cI.js";import"./el-checkbox-BGKkTKtQ.js";/* empty css                   */import"./el-scrollbar-CIZTQeWR.js";import{E as s}from"./el-tag-Bqv51Q1S.js";/* empty css                */import{E as n,a as i}from"./el-form-item-36bfcgrq.js";import{E as o,a as r}from"./el-col-DR3qk7qZ.js";/* empty css                 */import{E as d,a as u}from"./el-select-DifvCuS7.js";import{q as c,y as p,am as m,m as v,aI as f,aV as g,n as y,at as h,r as b,A as x,v as _,x as w,M as j,aW as C,aX as k,ae as q,_ as I,d as $,c as V,o as A,C as E,I as K,F as S,af as N,p as P,N as U,aY as z,e as F,g as B,k as H,t as L,w as D,B as T,G as O,H as R,j as M,h as W,ai as J,aj as G,J as Q,P as X,L as Y,a0 as Z,aA as ee,a6 as ae,aB as le,E as te,l as se,aZ as ne,aT as ie}from"./index.js";import"./DocumentUploader.vue_vue_type_style_index_0_scoped_1530a3ce_lang-kpO4p46J.js";import{P as oe}from"./PageHeader-BjzQIq6-.js";import{S as re}from"./SSEStreamViewer-vj7zVCfL.js";import{D as de}from"./DocumentUploader-BrnGgnC5.js";import{t as ue}from"./tender-Z_tK6YyL.js";import{E as ce}from"./index-C4gi5RAB.js";import{E as pe}from"./index-2qkNUAPG.js";import{c as me}from"./castArray-Bpm97oyT.js";import{E as ve}from"./index-RT-6Un_W.js";import"./refs-Cw5r5QN8.js";import"./_baseClone-DjpDAVKO.js";import"./omit-CrzxF80D.js";import"./raf-C3W2Tojd.js";import"./index-C9x2piTf.js";import"./strings-DTR7aduZ.js";import"./index-C1e8Wm8f.js";const fe=e=>c(e)||p(e)||m(e),ge=v({accordion:Boolean,modelValue:{type:y([Array,String,Number]),default:()=>h([])},expandIconPosition:{type:y([String]),default:"right"},beforeCollapse:{type:y(Function)}}),ye={[g]:fe,[f]:fe},he=Symbol("collapseContextKey"),be=$({name:"ElCollapse"});var xe=I($({...be,props:ge,emits:ye,setup(e,{expose:a,emit:l}){const t=e,{activeNames:s,setActiveNames:n}=((e,a)=>{const l=b(me(e.modelValue)),t=t=>{l.value=t;const s=e.accordion?l.value[0]:l.value;a(g,s),a(f,s)},s=a=>{if(e.accordion)t([l.value[0]===a?"":a]);else{const e=[...l.value],s=e.indexOf(a);s>-1?e.splice(s,1):e.push(a),t(e)}};return x(()=>e.modelValue,()=>l.value=me(e.modelValue),{deep:!0}),j(he,{activeNames:l,handleItemClick:async a=>{const{beforeCollapse:l}=e;if(!l)return void s(a);const t=l(a);[C(t),k(t)].includes(!0)||q("ElCollapse","beforeCollapse must return type `Promise<boolean>` or `boolean`"),C(t)?t.then(e=>{!1!==e&&s(a)}).catch(e=>{}):t&&s(a)}}),{activeNames:l,setActiveNames:t}})(t,l),{rootKls:i}=(e=>{const a=_("collapse");return{rootKls:w(()=>[a.b(),a.b(`icon-position-${e.expandIconPosition}`)])}})(t);return a({activeNames:s,setActiveNames:n}),(e,a)=>(A(),V("div",{class:K(S(i))},[E(e.$slots,"default")],2))}}),[["__file","collapse.vue"]]);const _e=v({title:{type:String,default:""},name:{type:y([String,Number]),default:void 0},icon:{type:P,default:N},disabled:Boolean}),we=$({name:"ElCollapseItem"});var je=I($({...we,props:_e,setup(e,{expose:a}){const l=e,{focusing:t,id:s,isActive:n,handleFocus:i,handleHeaderClick:o,handleEnterClick:r}=(e=>{const a=U(he),{namespace:l}=_("collapse"),t=b(!1),s=b(!1),n=z(),i=w(()=>n.current++),o=w(()=>{var a;return null!=(a=e.name)?a:`${l.value}-id-${n.prefix}-${S(i)}`}),r=w(()=>null==a?void 0:a.activeNames.value.includes(S(o)));return{focusing:t,id:i,isActive:r,handleFocus:()=>{setTimeout(()=>{s.value?s.value=!1:t.value=!0},50)},handleHeaderClick:l=>{if(e.disabled)return;const n=l.target;(null==n?void 0:n.closest("input, textarea, select"))||(null==a||a.handleItemClick(S(o)),t.value=!1,s.value=!0)},handleEnterClick:e=>{const l=e.target;(null==l?void 0:l.closest("input, textarea, select"))||(e.preventDefault(),null==a||a.handleItemClick(S(o)))}}})(l),{arrowKls:d,headKls:u,rootKls:c,itemTitleKls:p,itemWrapperKls:m,itemContentKls:v,scopedContentId:f,scopedHeadId:g}=((e,{focusing:a,isActive:l,id:t})=>{const s=_("collapse"),n=w(()=>[s.b("item"),s.is("active",S(l)),s.is("disabled",e.disabled)]),i=w(()=>[s.be("item","header"),s.is("active",S(l)),{focusing:S(a)&&!e.disabled}]),o=w(()=>[s.be("item","arrow"),s.is("active",S(l))]);return{itemTitleKls:w(()=>[s.be("item","title")]),arrowKls:o,headKls:i,rootKls:n,itemWrapperKls:w(()=>s.be("item","wrap")),itemContentKls:w(()=>s.be("item","content")),scopedContentId:w(()=>s.b(`content-${S(t)}`)),scopedHeadId:w(()=>s.b(`head-${S(t)}`))}})(l,{focusing:t,isActive:n,id:s});return a({isActive:n}),(e,a)=>(A(),V("div",{class:K(S(c))},[F("div",{id:S(g),class:K(S(u)),"aria-expanded":S(n),"aria-controls":S(f),"aria-describedby":S(f),tabindex:e.disabled?-1:0,role:"button",onClick:S(o),onKeydown:M(W(S(r),["stop"]),["space","enter"]),onFocus:S(i),onBlur:e=>t.value=!1},[F("span",{class:K(S(p))},[E(e.$slots,"title",{isActive:S(n)},()=>[H(L(e.title),1)])],2),E(e.$slots,"icon",{isActive:S(n)},()=>[B(S(R),{class:K(S(d))},{default:D(()=>[(A(),T(O(e.icon)))]),_:1},8,["class"])])],42,["id","aria-expanded","aria-controls","aria-describedby","tabindex","onClick","onKeydown","onFocus","onBlur"]),B(S(ve),null,{default:D(()=>[J(F("div",{id:S(f),role:"region",class:K(S(m)),"aria-hidden":!S(n),"aria-labelledby":S(g)},[F("div",{class:K(S(v))},[E(e.$slots,"default")],2)],10,["id","aria-hidden","aria-labelledby"]),[[G,S(n)]])]),_:3})],2))}}),[["__file","collapse-item.vue"]]);const Ce=Q(xe,{CollapseItem:je}),ke=X(je),qe={class:"point-to-point"},Ie={class:"action-controls"},$e={class:"card-header"},Ve={class:"card-header"},Ae={class:"header-actions"},Ee={class:"requirement-text"},Ke={class:"card-header"},Se={class:"card-header"},Ne={class:"header-actions"},Pe={class:"collapse-title"},Ue={class:"requirement-preview"},ze={class:"response-content"},Fe={class:"response-item"},Be={class:"requirement-detail"},He={class:"response-item"},Le={key:0,class:"response-item"},De={key:0,class:"response-dialog"},Te={class:"dialog-section"},Oe={class:"requirement-detail"},Re={class:"dialog-section"},Me={key:0,class:"dialog-section"},We=e($({__name:"PointToPoint",setup(e){const c=b({projectId:null,tenderFiles:[]}),p=b([]),m=w(()=>p.value.find(e=>e.id===c.value.projectId)),v=b(!1),f=b(0),g=b(""),y=b([]),h=b([]),x=b(""),_=b(""),j=w(()=>{let e=y.value;return x.value&&(e=e.filter(e=>e.requirement.toLowerCase().includes(x.value.toLowerCase()))),_.value&&(e=e.filter(e=>e.category===_.value)),e}),C=b(!1),k=b(0),q=b(""),I=w(()=>y.value.some(e=>e.response)),$=b([]),E=b(!1),K=b(null),N=w(()=>c.value.projectId&&c.value.tenderFiles.length>0),P=()=>{c.value.tenderFiles=[],y.value=[],h.value=[]},U=()=>{ee.success("文档上传成功")},z=async()=>{v.value=!0,f.value=0,g.value="",y.value=[];try{await O(),ee.success("招标要求提取完成")}catch(e){ee.error("提取失败，请重试")}finally{v.value=!1}},O=async()=>new Promise(e=>{const a=[{progress:25,message:"正在解析招标文档..."},{progress:50,message:"正在识别招标要求..."},{progress:75,message:"正在分类整理..."},{progress:100,message:"提取完成！"}];let l=0;const t=setInterval(()=>{if(l<a.length){const e=a[l];f.value=e.progress,g.value+=`\n[${e.progress}%] ${e.message}`,l++}else clearInterval(t),y.value=[{id:1,category:"technical",requirement:"系统应支持不少于10000个并发用户同时在线访问",priority:"高",status:"pending"},{id:2,category:"technical",requirement:"系统响应时间应不超过3秒",priority:"高",status:"pending"},{id:3,category:"business",requirement:"项目实施周期不超过6个月",priority:"高",status:"pending"},{id:4,category:"qualification",requirement:"投标人应具有ISO 9001质量管理体系认证",priority:"中",status:"pending"},{id:5,category:"qualification",requirement:"投标人应具有信息安全等级保护三级资质",priority:"中",status:"pending"},{id:6,category:"business",requirement:"质保期不少于2年",priority:"中",status:"pending"},{id:7,category:"technical",requirement:"系统应支持移动端访问（iOS和Android）",priority:"中",status:"pending"},{id:8,category:"other",requirement:"投标文件应包含详细的培训计划",priority:"低",status:"pending"}],e()},600)}),M=e=>{h.value=e},W=async()=>{if(0!==h.value.length){C.value=!0,k.value=0,q.value="";try{await J(),ee.success("点对点应答生成完成")}catch(e){ee.error("生成失败，请重试")}finally{C.value=!1}}else ee.warning("请选择要生成应答的要求")},J=async()=>new Promise(e=>{const a=h.value.length;let l=0;const t=setInterval(()=>{if(l<a){const e=h.value[l];k.value=Math.round((l+1)/a*100),q.value+=`\n[${l+1}/${a}] 正在生成"${e.requirement.substring(0,20)}..."的应答`;const t=y.value.findIndex(a=>a.id===e.id);-1!==t&&(y.value[t]={...y.value[t],status:"generated",response:G(e),compliance:Math.random()>.3?"完全符合":"部分符合"}),l++}else clearInterval(t),e()},800)}),G=e=>({technical:"## 技术响应\n\n我方系统完全满足该技术要求：\n\n### 方案说明\n1. 采用xxx架构设计，支持高并发访问\n2. 经过压力测试，可支持xxx并发用户\n3. 配置xxx服务器集群，确保系统稳定性\n\n### 技术指标\n- 并发处理能力：满足要求\n- 响应时间：平均2秒以内\n- 系统可用性：99.9%\n\n### 证明材料\n详见附件《技术方案书》第xx页",business:"## 商务响应\n\n我方完全接受该商务条款：\n\n### 承诺内容\n1. 严格按照要求执行\n2. 提供相应的保障措施\n3. 确保按时完成\n\n### 具体安排\n- 项目周期：符合要求\n- 质保期：满足要求\n- 验收标准：按照招标文件执行\n\n### 服务保障\n详见附件《商务应答书》第xx页",qualification:"## 资质响应\n\n我方具备该项资质要求：\n\n### 资质证明\n1. 持有xxx证书，证书编号：xxx\n2. 证书有效期：xxxx年xx月至xxxx年xx月\n3. 认证范围：覆盖本项目需求\n\n### 相关业绩\n- 近三年完成类似项目xx个\n- 项目验收合格率100%\n\n### 附件材料\n详见附件《资质证明文件》",other:"## 其他要求响应\n\n我方承诺满足该要求：\n\n### 具体安排\n1. 制定详细计划\n2. 配备专业人员\n3. 提供完整文档\n\n### 执行标准\n- 严格按照招标文件要求\n- 确保质量和进度\n\n### 相关文件\n详见附件相关章节"}[e.category]||"我方完全响应该要求。"),Q=()=>{C.value=!1,ee.info("已停止生成")},X=()=>{var e;const a=y.value.filter(e=>e.response).map((e,a)=>`${a+1}. 【${me(e.category)}】${e.requirement}\n\n${e.response}\n\n符合性：${e.compliance}\n\n---\n`).join("\n"),l=new Blob([`# 点对点应答文档\n\n${a}`],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(l),s=document.createElement("a");s.href=t,s.download=`点对点应答-${(null==(e=m.value)?void 0:e.name)||"export"}-${Date.now()}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t),ee.success("导出成功")},me=e=>({technical:"技术要求",business:"商务要求",qualification:"资质要求",other:"其他要求"}[e]||e),ve=e=>({technical:"primary",business:"success",qualification:"warning",other:"info"}[e]||""),fe=e=>({pending:"待生成",generated:"已生成",reviewed:"已审核"}[e]||e),ge=e=>({pending:"info",generated:"success",reviewed:"primary"}[e]||"");return Y(()=>{(async()=>{var e;try{const a=await ue.getProjects({page:1,page_size:100});p.value=(null==(e=a.data)?void 0:e.items)||[]}catch(a){ee.error("加载项目列表失败")}})()}),(e,b)=>{const w=u,O=d,J=i,G=r,Y=te,ee=o,ue=n,ye=ce,he=se,be=pe,xe=R,_e=l,we=s,je=t,We=ke,Je=Ce,Ge=a;return A(),V("div",qe,[B(S(oe),{title:"点对点应答",description:"针对招标要求逐点响应"}),B(ye,{class:"project-section",shadow:"never"},{header:D(()=>[...b[6]||(b[6]=[F("div",{class:"card-header"},[F("span",null,"Step 1: 选择项目")],-1)])]),default:D(()=>[B(ue,{model:c.value,"label-width":"100px"},{default:D(()=>[B(ee,{gutter:20},{default:D(()=>[B(G,{span:12},{default:D(()=>[B(J,{label:"项目"},{default:D(()=>[B(O,{modelValue:c.value.projectId,"onUpdate:modelValue":b[0]||(b[0]=e=>c.value.projectId=e),placeholder:"请选择项目",filterable:"",onChange:P,style:{width:"100%"}},{default:D(()=>[(A(!0),V(ae,null,le(p.value,e=>(A(),T(w,{key:e.id,label:`${e.name} (${e.number||"-"})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),B(G,{span:12},{default:D(()=>[B(J,{label:"公司"},{default:D(()=>{var e;return[B(Y,{value:(null==(e=m.value)?void 0:e.company_name)||"-",disabled:""},null,8,["value"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),c.value.projectId?(A(),T(ye,{key:0,class:"upload-section",shadow:"never"},{header:D(()=>[...b[7]||(b[7]=[F("div",{class:"card-header"},[F("span",null,"Step 2: 上传招标文档")],-1)])]),default:D(()=>[B(S(de),{modelValue:c.value.tenderFiles,"onUpdate:modelValue":b[1]||(b[1]=e=>c.value.tenderFiles=e),"upload-url":`/api/tender-projects/${c.value.projectId}/upload-tender`,accept:".pdf,.doc,.docx",limit:5,"max-size":50,drag:"","tip-text":"上传招标文档，AI将自动提取所有要求并生成点对点应答",onSuccess:U},null,8,["modelValue","upload-url"]),F("div",Ie,[B(he,{type:"primary",size:"large",disabled:!N.value,loading:v.value,onClick:z},{default:D(()=>[...b[8]||(b[8]=[H(" 提取招标要求 ",-1)])]),_:1},8,["disabled","loading"])])]),_:1})):Z("",!0),v.value?(A(),T(ye,{key:1,class:"extracting-section",shadow:"never"},{header:D(()=>[F("div",$e,[b[9]||(b[9]=F("span",null,"正在提取招标要求...",-1)),B(be,{percentage:f.value,status:100===f.value?"success":void 0,style:{width:"300px"}},null,8,["percentage","status"])])]),default:D(()=>[B(S(re),{content:g.value,"is-streaming":v.value},null,8,["content","is-streaming"])]),_:1})):Z("",!0),y.value.length>0?(A(),T(ye,{key:2,class:"requirements-section",shadow:"never"},{header:D(()=>[F("div",Ve,[F("span",null,"招标要求列表 (共 "+L(y.value.length)+" 条)",1),F("div",Ae,[B(Y,{modelValue:x.value,"onUpdate:modelValue":b[2]||(b[2]=e=>x.value=e),placeholder:"搜索要求...",clearable:"",style:{width:"200px"}},{prefix:D(()=>[B(xe,null,{default:D(()=>[B(S(ne))]),_:1})]),_:1},8,["modelValue"]),B(O,{modelValue:_.value,"onUpdate:modelValue":b[3]||(b[3]=e=>_.value=e),placeholder:"筛选分类",clearable:"",style:{width:"150px"}},{default:D(()=>[B(w,{label:"全部",value:""}),B(w,{label:"技术要求",value:"technical"}),B(w,{label:"商务要求",value:"business"}),B(w,{label:"资质要求",value:"qualification"}),B(w,{label:"其他要求",value:"other"})]),_:1},8,["modelValue"]),B(he,{type:"primary",disabled:0===h.value.length,loading:C.value,onClick:W},{default:D(()=>[H(" 生成应答 ("+L(h.value.length)+") ",1)]),_:1},8,["disabled","loading"])])])]),default:D(()=>[B(je,{data:j.value,border:"",onSelectionChange:M,"max-height":"500"},{default:D(()=>[B(_e,{type:"selection",width:"55"}),B(_e,{type:"index",label:"序号",width:"60"}),B(_e,{prop:"category",label:"分类",width:"100"},{default:D(({row:e})=>[B(we,{type:ve(e.category),size:"small"},{default:D(()=>[H(L(me(e.category)),1)]),_:2},1032,["type"])]),_:1}),B(_e,{prop:"requirement",label:"招标要求","min-width":"300"},{default:D(({row:e})=>[F("div",Ee,L(e.requirement),1)]),_:1}),B(_e,{prop:"priority",label:"优先级",width:"100"},{default:D(({row:e})=>{return[B(we,{type:(a=e.priority,{"高":"danger","中":"warning","低":"info"}[a]||""),size:"small"},{default:D(()=>[H(L(e.priority),1)]),_:2},1032,["type"])];var a}),_:1}),B(_e,{prop:"status",label:"应答状态",width:"100"},{default:D(({row:e})=>[B(we,{type:ge(e.status),size:"small"},{default:D(()=>[H(L(fe(e.status)),1)]),_:2},1032,["type"])]),_:1}),B(_e,{label:"操作",width:"100",fixed:"right"},{default:D(({row:e})=>[e.response?(A(),T(he,{key:0,type:"primary",size:"small",text:"",onClick:a=>{return l=e,K.value=l,void(E.value=!0);var l}},{default:D(()=>[...b[10]||(b[10]=[H(" 查看 ",-1)])]),_:1},8,["onClick"])):Z("",!0)]),_:1})]),_:1},8,["data"])]),_:1})):Z("",!0),C.value?(A(),T(ye,{key:3,class:"generation-output",shadow:"never"},{header:D(()=>[F("div",Ke,[b[11]||(b[11]=F("span",null,"AI正在生成点对点应答...",-1)),B(be,{percentage:k.value,status:100===k.value?"success":void 0,style:{width:"300px"}},null,8,["percentage","status"])])]),default:D(()=>[B(S(re),{content:q.value,"is-streaming":C.value,onStop:Q},null,8,["content","is-streaming"])]),_:1})):Z("",!0),I.value?(A(),T(ye,{key:4,class:"responses-section",shadow:"never"},{header:D(()=>[F("div",Se,[b[13]||(b[13]=F("span",null,"点对点应答结果",-1)),F("div",Ne,[B(he,{type:"success",icon:S(ie),onClick:X},{default:D(()=>[...b[12]||(b[12]=[H(" 导出应答文档 ",-1)])]),_:1},8,["icon"])])])]),default:D(()=>[B(Je,{modelValue:$.value,"onUpdate:modelValue":b[4]||(b[4]=e=>$.value=e),accordion:""},{default:D(()=>[(A(!0),V(ae,null,le(y.value.filter(e=>e.response),e=>(A(),T(We,{key:e.id,name:e.id},{title:D(()=>[F("div",Pe,[B(we,{type:ve(e.category),size:"small"},{default:D(()=>[H(L(me(e.category)),1)]),_:2},1032,["type"]),F("span",Ue,L(e.requirement),1),B(we,{type:ge(e.status),size:"small"},{default:D(()=>[H(L(fe(e.status)),1)]),_:2},1032,["type"])])]),default:D(()=>[F("div",ze,[F("div",Fe,[b[14]||(b[14]=F("h4",null,"招标要求",-1)),F("div",Be,L(e.requirement),1)]),F("div",He,[b[15]||(b[15]=F("h4",null,"我方应答",-1)),B(S(re),{content:e.response||"","is-streaming":!1,"enable-markdown":!0},null,8,["content"])]),e.compliance?(A(),V("div",Le,[b[16]||(b[16]=F("h4",null,"符合性说明",-1)),B(we,{type:"完全符合"===e.compliance?"success":"warning",size:"large"},{default:D(()=>[H(L(e.compliance),1)]),_:2},1032,["type"])])):Z("",!0)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1})):Z("",!0),B(Ge,{modelValue:E.value,"onUpdate:modelValue":b[5]||(b[5]=e=>E.value=e),title:"应答详情",width:"800px","destroy-on-close":""},{default:D(()=>[K.value?(A(),V("div",De,[F("div",Te,[b[17]||(b[17]=F("h4",null,"招标要求",-1)),F("div",Oe,L(K.value.requirement),1)]),F("div",Re,[b[18]||(b[18]=F("h4",null,"我方应答",-1)),B(S(re),{content:K.value.response||"","is-streaming":!1,"enable-markdown":!0},null,8,["content"])]),K.value.compliance?(A(),V("div",Me,[b[19]||(b[19]=F("h4",null,"符合性",-1)),B(we,{type:"完全符合"===K.value.compliance?"success":"warning"},{default:D(()=>[H(L(K.value.compliance),1)]),_:1},8,["type"])])):Z("",!0)])):Z("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-426113e8"]]);export{We as default};
