import{ck as e,T as a,cl as l,cm as t,c0 as s,b9 as n,av as r,_ as o,W as i,u,au as c,cn as d,co as p,c1 as v,e as m,a5 as f,c3 as g,w as h,ax as y,aB as _,aA as w,az as k,aC as b,a2 as x,aD as V,aI as S,aK as C,aN as P,aE as j,aM as F,aL as T,b5 as $,as as I,U as z,b1 as M,s as E,a3 as D,d as B,al as R,h as L,r as N,G as U,i as A,q as O,aq as q,a7 as X,p as Y,cp as W,bq as H,a4 as Q,E as K,bb as J,ap as G,ad as Z,O as ee,cq as ae,Q as le,R as te,cr as se,cs as ne,ct as re,F as oe,D as ie,y as ue,J as ce}from"./index.js";/* empty css                   *//* empty css                                                        *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                                                                            *//* empty css                */import{E as de}from"./el-input-number-CnPBhObR.js";import{C as pe}from"./ChapterTree-B_Ty3B1j.js";import{d as ve,E as me,a as fe}from"./el-select-CldpbmUv.js";import{ao as ge,an as he,ap as ye,aX as _e,am as we,bZ as ke,aq as be,ar as xe,as as Ve,ax as Se,aR as Ce,ay as Pe,at as je,aw as Fe,aP as Te,aU as $e,au as Ie,av as ze,aB as Me,aO as Ee,aC as De,aS as Be,aV as Re,bR as Le,ck as Ne,bO as Ue,aF as Ae,bt as Oe,bz as qe,bB as Xe,bA as Ye,c8 as We,aW as He,bP as Qe,az as Ke,aA as Je,aT as Ge,aD as Ze,aY as ea,c7 as aa}from"./editor-Dt4gYtYt.js";/* empty css                */import{S as la}from"./SSEStreamViewer-Danfvgux.js";import{D as ta}from"./DocumentUploader-CxdT86Ko.js";import{_ as sa}from"./DocumentPreview.vue_vue_type_script_setup_true_lang-CAKmezWj.js";import{R as na}from"./RichTextEditor-CIl5npix.js";import{u as ra,S as oa,d as ia}from"./helpers-C1wuofaA.js";/* empty css                */import{t as ua}from"./tender-B2uBMreU.js";import{E as ca}from"./index-rLTqmg7l.js";import{E as da}from"./strings-BjAjE6k-.js";import{E as pa}from"./index-BgAfl9sI.js";import{v as va}from"./directive-CBGghap-.js";import{E as ma,a as fa}from"./index-zK8U2JRv.js";import{E as ga,a as ha}from"./index-BX21ihZ_.js";import{a as ya,E as _a}from"./index-CUA8F766.js";import{u as wa}from"./useProjectDocuments-B5q-q_DN.js";import{a as ka,E as ba}from"./index-zLnbxgQE.js";import{c as xa}from"./clamp-BWjOrnxb.js";import{E as Va}from"./index-CzbDvFem.js";import{E as Sa,a as Ca}from"./index-IU_h0TRZ.js";import"./index-DdGYlGy6.js";import"./el-tree-Bvhsy4-9.js";import"./index-GOKzZPhn.js";import"./el-text-Kv3Vn9-t.js";import"./index-CcWeoNg9.js";import"./toNumber-D5oObipZ.js";import"./_baseIteratee-BnEJjc-Z.js";import"./imageCompressor-CTkRt5bg.js";import"./index-CzCnSpIZ.js";import"./cloneDeep-syPWYH98.js";import"./index-CFRmMOiB.js";import"./project-Cff1E3wd.js";import"./flatMap-B-HSJstM.js";import"./map-7mKJdJp1.js";import"./_baseEach-BT2EtZBY.js";import"./raf-BZHcGSIv.js";const Pa=a({...l,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},resizable:Boolean,size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),ja=e;function Fa(e,a){const{width:l,height:o}=t(),i=ge(()=>["ltr","rtl"].includes(e.direction)),u=ge(()=>["ltr","ttb"].includes(e.direction)?1:-1),c=ge(()=>i.value?l.value:o.value),d=ge(()=>s(p.value+u.value*v.value,4,c.value)),p=he(0),v=he(0),m=he(!1),f=he(!1);let g=[],h=[];ye(()=>[e.size,e.resizable],()=>{f.value=!1,p.value=0,v.value=0,_()});const y=e=>{const{pageX:a,pageY:l}=e,t=a-g[0],s=l-g[1];v.value=i.value?t:s},_=()=>{g=[],p.value=d.value,v.value=0,m.value=!1,h.forEach(e=>null==e?void 0:e()),h=[]},w=n(a,"mousedown",l=>{e.resizable&&(f.value||(p.value=(()=>{var e;const l=null==(e=a.value)?void 0:e.closest('[aria-modal="true"]');return l?i.value?l.offsetWidth:l.offsetHeight:100})(),f.value=!0),g=[l.pageX,l.pageY],m.value=!0,h.push(n(window,"mouseup",_),n(window,"mousemove",y)))});return _e(()=>{w(),_()}),{size:ge(()=>f.value?`${d.value}px`:r(e.size)),isResizing:m,isHorizontal:i}}const Ta=we({name:"ElDrawer",inheritAttrs:!1});const $a=h(o(we({...Ta,props:Pa,emits:ja,setup(e,{expose:a}){const l=e,t=ke();i({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},ge(()=>!!t.title));const s=he(),n=he(),r=he(),o=u("drawer"),{t:h}=c(),{afterEnter:y,afterLeave:_,beforeLeave:w,visible:k,rendered:b,titleId:x,bodyId:V,zIndex:S,onModalClick:C,onOpenAutoFocus:P,onCloseAutoFocus:j,onFocusoutPrevented:F,onCloseRequested:T,handleClose:$}=d(l,s),{isHorizontal:I,size:z,isResizing:M}=Fa(l,r);return a({handleClose:$,afterEnter:y,afterLeave:_}),(e,a)=>(xe(),be(Pe(g),{to:e.appendTo,disabled:"body"===e.appendTo&&!e.appendToBody},{default:Ve(()=>[Se(Ce,{name:Pe(o).b("fade"),onAfterEnter:Pe(y),onAfterLeave:Pe(_),onBeforeLeave:Pe(w),persisted:""},{default:Ve(()=>{var a;return[je(Se(Pe(p),{mask:e.modal,"overlay-class":[Pe(o).is("drawer"),null!=(a=e.modalClass)?a:""],"z-index":Pe(S),onClick:Pe(C)},{default:Ve(()=>[Se(Pe(v),{loop:"",trapped:Pe(k),"focus-trap-el":s.value,"focus-start-el":n.value,onFocusAfterTrapped:Pe(P),onFocusAfterReleased:Pe(j),onFocusoutPrevented:Pe(F),onReleaseRequested:Pe(T)},{default:Ve(()=>[Fe("div",Te({ref_key:"drawerRef",ref:s,"aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:Pe(x),"aria-describedby":Pe(V)},e.$attrs,{class:[Pe(o).b(),e.direction,Pe(k)&&"open",Pe(o).is("dragging",Pe(M))],style:{[Pe(I)?"width":"height"]:Pe(z)},role:"dialog",onClick:$e(()=>{},["stop"])}),[Fe("span",{ref_key:"focusStartRef",ref:n,class:Me(Pe(o).e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(xe(),Ie("header",{key:0,class:Me([Pe(o).e("header"),e.headerClass])},[e.$slots.title?Ee(e.$slots,"title",{key:1},()=>[ze(" DEPRECATED SLOT ")]):Ee(e.$slots,"header",{key:0,close:Pe($),titleId:Pe(x),titleClass:Pe(o).e("title")},()=>[Fe("span",{id:Pe(x),role:"heading","aria-level":e.headerAriaLevel,class:Me(Pe(o).e("title"))},De(e.title),11,["id","aria-level"])]),e.showClose?(xe(),Ie("button",{key:2,"aria-label":Pe(h)("el.drawer.close"),class:Me(Pe(o).e("close-btn")),type:"button",onClick:Pe($)},[Se(Pe(m),{class:Me(Pe(o).e("close"))},{default:Ve(()=>[Se(Pe(f))]),_:1},8,["class"])],10,["aria-label","onClick"])):ze("v-if",!0)],2)):ze("v-if",!0),Pe(b)?(xe(),Ie("div",{key:1,id:Pe(V),class:Me([Pe(o).e("body"),e.bodyClass])},[Ee(e.$slots,"default")],10,["id"])):ze("v-if",!0),e.$slots.footer?(xe(),Ie("div",{key:2,class:Me([Pe(o).e("footer"),e.footerClass])},[Ee(e.$slots,"footer")],2)):ze("v-if",!0),e.resizable?(xe(),Ie("div",{key:3,ref_key:"draggerRef",ref:r,style:Be({zIndex:Pe(S)}),class:Me(Pe(o).e("dragger"))},null,6)):ze("v-if",!0)],16,["aria-label","aria-labelledby","aria-describedby","onClick"])]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Re,Pe(k)]])]}),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}}),[["__file","drawer.vue"]])),Ia=Symbol("sliderContextKey"),za=a({modelValue:{type:x([Number,Array]),default:0},id:{type:String,default:void 0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},showInput:Boolean,showInputControls:{type:Boolean,default:!0},size:V,inputSize:V,showStops:Boolean,showTooltip:{type:Boolean,default:!0},formatTooltip:{type:x(Function),default:void 0},disabled:Boolean,range:Boolean,vertical:Boolean,height:String,rangeStartLabel:{type:String,default:void 0},rangeEndLabel:{type:String,default:void 0},formatValueText:{type:x(Function),default:void 0},tooltipClass:{type:String,default:void 0},placement:{type:String,values:Ne,default:"top"},marks:{type:x(Object)},validateEvent:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},...b(["ariaLabel"])}),Ma=e=>y(e)||Le(e)&&e.every(y),Ea={[k]:Ma,[w]:Ma,[_]:Ma},Da=a({modelValue:{type:Number,default:0},vertical:Boolean,tooltipClass:String,placement:{type:String,values:Ne,default:"top"}}),Ba={[k]:e=>y(e)},Ra=(e,a,l)=>{const{disabled:t,min:s,max:r,step:o,showTooltip:i,persistent:u,precision:c,sliderSize:d,formatTooltip:p,emitChange:v,resetSize:m,updateDragging:f}=Ue(Ia),{tooltip:g,tooltipVisible:h,formatValue:y,displayTooltip:_,hideTooltip:w}=((e,a,l)=>{const t=he(),s=he(!1),n=ge(()=>a.value instanceof Function),r=ge(()=>n.value&&a.value(e.modelValue)||e.modelValue),o=ve(()=>{l.value&&(s.value=!0)},50),i=ve(()=>{l.value&&(s.value=!1)},50);return{tooltip:t,tooltipVisible:s,formatValue:r,displayTooltip:o,hideTooltip:i}})(e,p,i),b=he(),x=ge(()=>(e.modelValue-s.value)/(r.value-s.value)*100+"%"),V=ge(()=>e.vertical?{bottom:x.value}:{left:x.value}),P=e=>{t.value||(e.preventDefault(),T(e),window.addEventListener("mousemove",$),window.addEventListener("touchmove",$),window.addEventListener("mouseup",I),window.addEventListener("touchend",I),window.addEventListener("contextmenu",I),b.value.focus())},j=e=>{t.value||(a.newPosition=Number.parseFloat(x.value)+e/(r.value-s.value)*100,z(a.newPosition),v())},F=e=>{let a,l;return e.type.startsWith("touch")?(l=e.touches[0].clientY,a=e.touches[0].clientX):(l=e.clientY,a=e.clientX),{clientX:a,clientY:l}},T=l=>{a.dragging=!0,a.isClick=!0;const{clientX:t,clientY:s}=F(l);e.vertical?a.startY=s:a.startX=t,a.startPosition=Number.parseFloat(x.value),a.newPosition=a.startPosition},$=l=>{if(a.dragging){let t;a.isClick=!1,_(),m();const{clientX:s,clientY:n}=F(l);e.vertical?(a.currentY=n,t=(a.startY-a.currentY)/d.value*100):(a.currentX=s,t=(a.currentX-a.startX)/d.value*100),a.newPosition=a.startPosition+t,z(a.newPosition)}},I=()=>{a.dragging&&(setTimeout(()=>{a.dragging=!1,a.hovering||w(),a.isClick||z(a.newPosition),v()},0),window.removeEventListener("mousemove",$),window.removeEventListener("touchmove",$),window.removeEventListener("mouseup",I),window.removeEventListener("touchend",I),window.removeEventListener("contextmenu",I))},z=async t=>{if(null===t||Number.isNaN(+t))return;t=xa(t,0,100);const n=Math.floor((r.value-s.value)/o.value),i=n*o.value/(r.value-s.value)*100,u=i+(100-i)/2;let d;if(t<i){const e=i/n,a=Math.round(t/e);d=s.value+a*o.value}else d=t<u?s.value+n*o.value:r.value;d=Number.parseFloat(d.toFixed(c.value)),d!==e.modelValue&&l(k,d),a.dragging||e.modelValue===a.oldValue||(a.oldValue=e.modelValue),await Ae(),a.dragging&&_(),g.value.updatePopper()};return ye(()=>a.dragging,e=>{f(e)}),n(b,"touchstart",P,{passive:!1}),{disabled:t,button:b,tooltip:g,tooltipVisible:h,showTooltip:i,persistent:u,wrapperStyle:V,formatValue:y,handleMouseEnter:()=>{a.hovering=!0,_()},handleMouseLeave:()=>{a.hovering=!1,a.dragging||w()},onButtonDown:P,onKeyDown:e=>{let a=!0;switch(S(e)){case C.left:case C.down:j(-o.value);break;case C.right:case C.up:j(o.value);break;case C.home:t.value||(z(0),v());break;case C.end:t.value||(z(100),v());break;case C.pageDown:j(4*-o.value);break;case C.pageUp:j(4*o.value);break;default:a=!1}a&&e.preventDefault()},setPosition:z}},La=we({name:"ElSliderButton"});var Na=o(we({...La,props:Da,emits:Ba,setup(e,{expose:a,emit:l}){const t=e,s=u("slider"),n=Oe({hovering:!1,dragging:!1,isClick:!1,startX:0,currentX:0,startY:0,currentY:0,startPosition:0,newPosition:0,oldValue:t.modelValue}),r=ge(()=>!!d.value&&p.value),{disabled:o,button:i,tooltip:c,showTooltip:d,persistent:p,tooltipVisible:v,wrapperStyle:m,formatValue:f,handleMouseEnter:g,handleMouseLeave:h,onButtonDown:y,onKeyDown:_,setPosition:w}=Ra(t,n,l),{hovering:k,dragging:b}=qe(n);return a({onButtonDown:y,onKeyDown:_,setPosition:w,hovering:k,dragging:b}),(e,a)=>(xe(),Ie("div",{ref_key:"button",ref:i,class:Me([Pe(s).e("button-wrapper"),{hover:Pe(k),dragging:Pe(b)}]),style:Be(Pe(m)),tabindex:Pe(o)?-1:0,onMouseenter:Pe(g),onMouseleave:Pe(h),onMousedown:Pe(y),onFocus:Pe(g),onBlur:Pe(h),onKeydown:Pe(_)},[Se(Pe(P),{ref_key:"tooltip",ref:c,visible:Pe(v),placement:e.placement,"fallback-placements":["top","bottom","right","left"],"stop-popper-mouse-event":!1,"popper-class":e.tooltipClass,disabled:!Pe(d),persistent:Pe(r)},{content:Ve(()=>[Fe("span",null,De(Pe(f)),1)]),default:Ve(()=>[Fe("div",{class:Me([Pe(s).e("button"),{hover:Pe(k),dragging:Pe(b)}])},null,2)]),_:1},8,["visible","placement","popper-class","disabled","persistent"])],46,["tabindex","onMouseenter","onMouseleave","onMousedown","onFocus","onBlur","onKeydown"]))}}),[["__file","button.vue"]]);var Ua=we({name:"ElSliderMarker",props:a({mark:{type:x([String,Object]),default:void 0}}),setup(e){const a=u("slider"),l=ge(()=>Xe(e.mark)?e.mark:e.mark.label),t=ge(()=>Xe(e.mark)?void 0:e.mark.style);return()=>Ye("div",{class:a.e("marks-text"),style:t.value},l.value)}});const Aa=(e,a,l)=>{const{form:t,formItem:s}=j(),n=We(),r=he(),o=he(),i={firstButton:r,secondButton:o},u=ge(()=>e.disabled||(null==t?void 0:t.disabled)||!1),c=ge(()=>Math.min(a.firstValue,a.secondValue)),d=ge(()=>Math.max(a.firstValue,a.secondValue)),p=ge(()=>e.range?100*(d.value-c.value)/(e.max-e.min)+"%":100*(a.firstValue-e.min)/(e.max-e.min)+"%"),v=ge(()=>e.range?100*(c.value-e.min)/(e.max-e.min)+"%":"0%"),m=ge(()=>e.vertical?{height:e.height}:{}),f=ge(()=>e.vertical?{height:p.value,bottom:v.value}:{width:p.value,left:v.value}),g=()=>{if(n.value){const l=n.value.getBoundingClientRect();a.sliderSize=l[e.vertical?"height":"width"]}},h=l=>{const t=(l=>{const t=e.min+l*(e.max-e.min)/100;if(!e.range)return r;let s;return s=Math.abs(c.value-t)<Math.abs(d.value-t)?a.firstValue<a.secondValue?"firstButton":"secondButton":a.firstValue>a.secondValue?"firstButton":"secondButton",i[s]})(l);return t.value.setPosition(l),t},y=e=>{l(k,e),l(w,e)},b=async()=>{await Ae(),l(_,e.range?[c.value,d.value]:e.modelValue)},x=l=>{var t,s,r,o,i,c;if(u.value||a.dragging)return;g();let d=0;if(e.vertical){const e=null!=(r=null==(s=null==(t=l.touches)?void 0:t.item(0))?void 0:s.clientY)?r:l.clientY;d=(n.value.getBoundingClientRect().bottom-e)/a.sliderSize*100}else{d=((null!=(c=null==(i=null==(o=l.touches)?void 0:o.item(0))?void 0:i.clientX)?c:l.clientX)-n.value.getBoundingClientRect().left)/a.sliderSize*100}return d<0||d>100?void 0:h(d)};return{elFormItem:s,slider:n,firstButton:r,secondButton:o,sliderDisabled:u,minValue:c,maxValue:d,runwayStyle:m,barStyle:f,resetSize:g,setPosition:h,emitChange:b,onSliderWrapperPrevent:e=>{var a,l;((null==(a=i.firstButton.value)?void 0:a.dragging)||(null==(l=i.secondButton.value)?void 0:l.dragging))&&e.preventDefault()},onSliderClick:e=>{x(e)&&b()},onSliderDown:async e=>{const a=x(e);a&&(await Ae(),a.value.onButtonDown(e))},onSliderMarkerDown:e=>{if(u.value||a.dragging)return;h(e)&&b()},setFirstValue:l=>{a.firstValue=null!=l?l:e.min,y(e.range?[c.value,d.value]:null!=l?l:e.min)},setSecondValue:l=>{a.secondValue=l,e.range&&y([c.value,d.value])}}},Oa=we({name:"ElSlider"});const qa=h(o(we({...Oa,props:za,emits:Ea,setup(e,{expose:a,emit:l}){const t=e,s=u("slider"),{t:r}=c(),o=Oe({firstValue:0,secondValue:0,oldValue:0,dragging:!1,sliderSize:1}),{elFormItem:i,slider:d,firstButton:p,secondButton:v,sliderDisabled:m,minValue:f,maxValue:g,runwayStyle:h,barStyle:_,resetSize:b,emitChange:x,onSliderWrapperPrevent:V,onSliderClick:S,onSliderDown:C,onSliderMarkerDown:P,setFirstValue:j,setSecondValue:z}=Aa(t,o,l),{stops:M,getStopStyle:E}=((e,a,l,t)=>({stops:ge(()=>{if(!e.showStops||e.min>e.max)return[];if(0===e.step)return[];const s=Math.ceil((e.max-e.min)/e.step),n=100*e.step/(e.max-e.min),r=Array.from({length:s-1}).map((e,a)=>(a+1)*n);return e.range?r.filter(a=>a<100*(l.value-e.min)/(e.max-e.min)||a>100*(t.value-e.min)/(e.max-e.min)):r.filter(l=>l>100*(a.firstValue-e.min)/(e.max-e.min))}),getStopStyle:a=>e.vertical?{bottom:`${a}%`}:{left:`${a}%`}}))(t,o,f,g),{inputId:D,isLabeledByFormItem:B}=$(t,{formItemContext:i}),R=I(),L=ge(()=>t.inputSize||R.value),N=ge(()=>t.ariaLabel||r("el.slider.defaultLabel",{min:t.min,max:t.max})),U=ge(()=>t.range?t.rangeStartLabel||r("el.slider.defaultRangeStartLabel"):N.value),A=ge(()=>t.formatValueText?t.formatValueText(Q.value):`${Q.value}`),O=ge(()=>t.rangeEndLabel||r("el.slider.defaultRangeEndLabel")),q=ge(()=>t.formatValueText?t.formatValueText(K.value):`${K.value}`),X=ge(()=>[s.b(),s.m(R.value),s.is("vertical",t.vertical),{[s.m("with-input")]:t.showInput}]),Y=(e=>ge(()=>e.marks?Object.keys(e.marks).map(Number.parseFloat).sort((e,a)=>e-a).filter(a=>a<=e.max&&a>=e.min).map(a=>({point:a,position:100*(a-e.min)/(e.max-e.min),mark:e.marks[a]})):[]))(t);((e,a,l,t,s,n)=>{const r=e=>{s(k,e),s(w,e)},o=()=>e.range?![l.value,t.value].every((e,l)=>e===a.oldValue[l]):e.modelValue!==a.oldValue,i=()=>{var l,t;e.min>e.max&&F("Slider","min should not be greater than max.");const s=e.modelValue;e.range&&Le(s)?s[1]<e.min?r([e.min,e.min]):s[0]>e.max?r([e.max,e.max]):s[0]<e.min?r([e.min,s[1]]):s[1]>e.max?r([s[0],e.max]):(a.firstValue=s[0],a.secondValue=s[1],o()&&(e.validateEvent&&(null==(l=null==n?void 0:n.validate)||l.call(n,"change").catch(e=>T())),a.oldValue=s.slice())):e.range||!y(s)||Number.isNaN(s)||(s<e.min?r(e.min):s>e.max?r(e.max):(a.firstValue=s,o()&&(e.validateEvent&&(null==(t=null==n?void 0:n.validate)||t.call(n,"change").catch(e=>T())),a.oldValue=s)))};i(),ye(()=>a.dragging,e=>{e||i()}),ye(()=>e.modelValue,(e,l)=>{a.dragging||Le(e)&&Le(l)&&e.every((e,a)=>e===l[a])&&a.firstValue===e[0]&&a.secondValue===e[1]||i()},{deep:!0}),ye(()=>[e.min,e.max],()=>{i()})})(t,o,f,g,l,i);const W=ge(()=>{const e=[t.min,t.max,t.step].map(e=>{const a=`${e}`.split(".")[1];return a?a.length:0});return Math.max.apply(null,e)}),{sliderWrapper:H}=((e,a,l)=>{const t=he();return He(async()=>{e.range?(Le(e.modelValue)?(a.firstValue=Math.max(e.min,e.modelValue[0]),a.secondValue=Math.min(e.max,e.modelValue[1])):(a.firstValue=e.min,a.secondValue=e.max),a.oldValue=[a.firstValue,a.secondValue]):(!y(e.modelValue)||Number.isNaN(e.modelValue)?a.firstValue=e.min:a.firstValue=Math.min(e.max,Math.max(e.min,e.modelValue)),a.oldValue=a.firstValue),n(window,"resize",l),await Ae(),l()}),{sliderWrapper:t}})(t,o,b),{firstValue:Q,secondValue:K,sliderSize:J}=qe(o);return n(H,"touchstart",V,{passive:!1}),n(H,"touchmove",V,{passive:!1}),Qe(Ia,{...qe(t),sliderSize:J,disabled:m,precision:W,emitChange:x,resetSize:b,updateDragging:e=>{o.dragging=e}}),a({onSliderClick:S}),(e,a)=>{var l,t;return xe(),Ie("div",{id:e.range?Pe(D):void 0,ref_key:"sliderWrapper",ref:H,class:Me(Pe(X)),role:e.range?"group":void 0,"aria-label":e.range&&!Pe(B)?Pe(N):void 0,"aria-labelledby":e.range&&Pe(B)?null==(l=Pe(i))?void 0:l.labelId:void 0},[Fe("div",{ref_key:"slider",ref:d,class:Me([Pe(s).e("runway"),{"show-input":e.showInput&&!e.range},Pe(s).is("disabled",Pe(m))]),style:Be(Pe(h)),onMousedown:Pe(C),onTouchstartPassive:Pe(C)},[Fe("div",{class:Me(Pe(s).e("bar")),style:Be(Pe(_))},null,6),Se(Na,{id:e.range?void 0:Pe(D),ref_key:"firstButton",ref:p,"model-value":Pe(Q),vertical:e.vertical,"tooltip-class":e.tooltipClass,placement:e.placement,role:"slider","aria-label":e.range||!Pe(B)?Pe(U):void 0,"aria-labelledby":!e.range&&Pe(B)?null==(t=Pe(i))?void 0:t.labelId:void 0,"aria-valuemin":e.min,"aria-valuemax":e.range?Pe(K):e.max,"aria-valuenow":Pe(Q),"aria-valuetext":Pe(A),"aria-orientation":e.vertical?"vertical":"horizontal","aria-disabled":Pe(m),"onUpdate:modelValue":Pe(j)},null,8,["id","model-value","vertical","tooltip-class","placement","aria-label","aria-labelledby","aria-valuemin","aria-valuemax","aria-valuenow","aria-valuetext","aria-orientation","aria-disabled","onUpdate:modelValue"]),e.range?(xe(),be(Na,{key:0,ref_key:"secondButton",ref:v,"model-value":Pe(K),vertical:e.vertical,"tooltip-class":e.tooltipClass,placement:e.placement,role:"slider","aria-label":Pe(O),"aria-valuemin":Pe(Q),"aria-valuemax":e.max,"aria-valuenow":Pe(K),"aria-valuetext":Pe(q),"aria-orientation":e.vertical?"vertical":"horizontal","aria-disabled":Pe(m),"onUpdate:modelValue":Pe(z)},null,8,["model-value","vertical","tooltip-class","placement","aria-label","aria-valuemin","aria-valuemax","aria-valuenow","aria-valuetext","aria-orientation","aria-disabled","onUpdate:modelValue"])):ze("v-if",!0),e.showStops?(xe(),Ie("div",{key:1},[(xe(!0),Ie(Ke,null,Je(Pe(M),(e,a)=>(xe(),Ie("div",{key:a,class:Me(Pe(s).e("stop")),style:Be(Pe(E)(e))},null,6))),128))])):ze("v-if",!0),Pe(Y).length>0?(xe(),Ie(Ke,{key:2},[Fe("div",null,[(xe(!0),Ie(Ke,null,Je(Pe(Y),(e,a)=>(xe(),Ie("div",{key:a,style:Be(Pe(E)(e.position)),class:Me([Pe(s).e("stop"),Pe(s).e("marks-stop")])},null,6))),128))]),Fe("div",{class:Me(Pe(s).e("marks"))},[(xe(!0),Ie(Ke,null,Je(Pe(Y),(e,a)=>(xe(),be(Pe(Ua),{key:a,mark:e.mark,style:Be(Pe(E)(e.position)),onMousedown:$e(a=>Pe(P)(e.position),["stop"])},null,8,["mark","style","onMousedown"]))),128))],2)],64)):ze("v-if",!0)],46,["onMousedown","onTouchstartPassive"]),e.showInput&&!e.range?(xe(),be(Pe(de),{key:0,ref:"input","model-value":Pe(Q),class:Me(Pe(s).e("input")),step:e.step,disabled:Pe(m),controls:e.showInputControls,min:e.min,max:e.max,precision:Pe(W),size:Pe(L),"onUpdate:modelValue":Pe(j),onChange:Pe(x)},null,8,["model-value","class","step","disabled","controls","min","max","precision","size","onUpdate:modelValue","onChange"])):ze("v-if",!0)],10,["id","role","aria-label","aria-labelledby"])}}}),[["__file","slider.vue"]])),Xa=we({name:"ElTimeline",setup(e,{slots:a}){const l=u("timeline");return Qe("timeline",a),()=>Ye("ul",{class:[l.b()]},[Ee(a,"default")])}}),Ya=a({timestamp:{type:String,default:""},hideTimestamp:Boolean,center:Boolean,placement:{type:String,values:["top","bottom"],default:"bottom"},type:{type:String,values:["primary","success","warning","danger","info"],default:""},color:{type:String,default:""},size:{type:String,values:["normal","large"],default:"normal"},icon:{type:z},hollow:Boolean}),Wa=we({name:"ElTimelineItem"});var Ha=o(we({...Wa,props:Ya,setup(e){const a=e,l=u("timeline-item"),t=ge(()=>[l.e("node"),l.em("node",a.size||""),l.em("node",a.type||""),l.is("hollow",a.hollow)]);return(e,a)=>(xe(),Ie("li",{class:Me([Pe(l).b(),{[Pe(l).e("center")]:e.center}])},[Fe("div",{class:Me(Pe(l).e("tail"))},null,2),e.$slots.dot?ze("v-if",!0):(xe(),Ie("div",{key:0,class:Me(Pe(t)),style:Be({backgroundColor:e.color})},[e.icon?(xe(),be(Pe(m),{key:0,class:Me(Pe(l).e("icon"))},{default:Ve(()=>[(xe(),be(Ge(e.icon)))]),_:1},8,["class"])):ze("v-if",!0)],6)),e.$slots.dot?(xe(),Ie("div",{key:1,class:Me(Pe(l).e("dot"))},[Ee(e.$slots,"dot")],2)):ze("v-if",!0),Fe("div",{class:Me(Pe(l).e("wrapper"))},[e.hideTimestamp||"top"!==e.placement?ze("v-if",!0):(xe(),Ie("div",{key:0,class:Me([Pe(l).e("timestamp"),Pe(l).is("top")])},De(e.timestamp),3)),Fe("div",{class:Me(Pe(l).e("content"))},[Ee(e.$slots,"default")],2),e.hideTimestamp||"bottom"!==e.placement?ze("v-if",!0):(xe(),Ie("div",{key:1,class:Me([Pe(l).e("timestamp"),Pe(l).is("bottom")])},De(e.timestamp),3))],2)],2))}}),[["__file","timeline-item.vue"]]);const Qa=h(Xa,{TimelineItem:Ha}),Ka=M(Ha),Ja={class:"drawer-header"},Ga={class:"task-list"},Za={key:1,class:"task-items"},el={class:"task-header"},al={class:"task-id"},ll={class:"status-tags"},tl={class:"task-info"},sl={class:"info-row"},nl={class:"value"},rl={class:"info-row"},ol={class:"value"},il={key:0,class:"info-row error"},ul={class:"value"},cl={key:1,class:"info-row"},dl={class:"value time-warning"},pl={class:"task-actions"},vl={key:0,class:"task-detail"},ml={key:0,class:"stats-section"},fl={class:"stat-item success"},gl={class:"stat-value"},hl={class:"stat-item danger"},yl={class:"stat-value"},_l={class:"stat-item warning"},wl={class:"stat-value"},kl={class:"stat-item info"},bl={class:"stat-value"},xl={key:1,class:"logs-section"},Vl={class:"log-content"},Sl={class:"log-header"},Cl={class:"agent-name"},Pl={key:0,class:"log-error"},jl={key:1,class:"log-duration"},Fl=3e5,Tl=O(we({__name:"TaskHistoryDrawer",props:{modelValue:{type:Boolean},projectId:{}},emits:["update:modelValue","resume"],setup(e,{emit:a}){const l=e,t=a,s=he(l.modelValue),n=he(!1),r=he([]),o=he(null),i=he(!1),u=he(null);async function c(){n.value=!0;try{const e=await ua.getTechProposalTasks(l.projectId);e.success&&(r.value=e.tasks)}catch(e){}finally{n.value=!1}}function d(e){if("running"!==e.overall_status)return!1;const a=e.last_heartbeat;if(a){const e=new Date(a).getTime();if(Date.now()-e>Fl)return!0}else{const a=e.started_at;if(a){const e=new Date(a).getTime();if(Date.now()-e>Fl)return!0}}return!1}function p(){s.value=!1}function v(e){return{completed:"success",running:"warning",failed:"danger",pending:"info",cancelled:"info"}[e]||"info"}function f(e){return{completed:"已完成",running:"运行中",failed:"失败",pending:"待执行",cancelled:"已取消"}[e]||e}function g(e){if(!e)return"";return{scoring_extraction:"评分点提取",product_matching:"产品匹配",strategy_planning:"评分策略",material_retrieval:"素材检索",outline_generation:"大纲生成",content_writing:"内容撰写",expert_review:"专家评审",iteration:"迭代优化"}[e]||e}function h(e){return{success:"success",failed:"danger",running:"primary",retrying:"warning",skipped:"info"}[e]||"info"}function y(e){return e?new Date(e).toLocaleString("zh-CN"):""}function _(e){if(e<=0)return"已过期";const a=Math.floor(e/3600),l=Math.floor(e%3600/60);return a>0?`${a}小时${l}分钟`:`${l}分钟`}function w(e){if(!e)return"-";if(e<1e3)return`${e}ms`;const a=Math.floor(e/1e3);if(a<60)return`${a}秒`;return`${Math.floor(a/60)}分${a%60}秒`}return ye(()=>l.modelValue,e=>{s.value=e,e&&c()}),ye(s,e=>{t("update:modelValue",e)}),(e,a)=>{const l=m,k=B,b=ca,x=da,V=pa,S=fa,C=ma,P=ha,j=ga,F=Ka,T=Qa,$=L,I=$a,z=va;return xe(),be(I,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),title:"任务历史",direction:"rtl",size:"450px","before-close":p},{header:Ve(()=>[Fe("div",Ja,[a[2]||(a[2]=Fe("span",{class:"title"},"任务历史",-1)),Se(k,{text:"",onClick:c},{default:Ve(()=>[Se(l,null,{default:Ve(()=>[Se(Pe(N))]),_:1})]),_:1})])]),default:Ve(()=>[je((xe(),Ie("div",Ga,[n.value||0!==r.value.length?(xe(),Ie("div",Za,[(xe(!0),Ie(Ke,null,Je(r.value,e=>{return xe(),Ie("div",{key:e.task_id,class:Me(["task-item",{"is-failed":"failed"===e.overall_status}])},[Fe("div",el,[Fe("div",al,[Se(l,null,{default:Ve(()=>[Se(Pe(E))]),_:1}),Fe("span",null,De(e.task_id),1)]),Fe("div",ll,[Se(x,{type:v(e.overall_status),size:"small"},{default:Ve(()=>[Ze(De(f(e.overall_status)),1)]),_:2},1032,["type"]),d(e)?(xe(),be(x,{key:0,type:"danger",size:"small",effect:"dark"},{default:Ve(()=>[Se(l,{class:"abnormal-icon"},{default:Ve(()=>[Se(Pe(D))]),_:1}),a[3]||(a[3]=Ze(" 任务异常 ",-1))]),_:1})):ze("",!0)])]),Se(V,{percentage:e.progress_percentage,status:(n=e.overall_status,"completed"===n?"success":"failed"===n?"exception":""),"stroke-width":6,class:"task-progress"},null,8,["percentage","status"]),Fe("div",tl,[Fe("div",sl,[a[4]||(a[4]=Fe("span",{class:"label"},"当前阶段:",-1)),Fe("span",nl,De(g(e.current_phase)||"-"),1)]),Fe("div",rl,[a[5]||(a[5]=Fe("span",{class:"label"},"创建时间:",-1)),Fe("span",ol,De(y(e.created_at)),1)]),e.last_error?(xe(),Ie("div",il,[a[6]||(a[6]=Fe("span",{class:"label"},"错误信息:",-1)),Fe("span",ul,De(e.last_error),1)])):ze("",!0),"failed"===e.overall_status&&e.seconds_until_expire>0?(xe(),Ie("div",cl,[a[7]||(a[7]=Fe("span",{class:"label"},"剩余恢复时间:",-1)),Fe("span",dl,De(_(e.seconds_until_expire)),1)])):ze("",!0)]),Fe("div",pl,[e.can_resume&&"failed"===e.overall_status||d(e)?(xe(),be(k,{key:0,type:"primary",size:"small",onClick:a=>async function(e,a=!1){try{const l=a?`任务 ${e.task_id} 疑似异常（心跳超时），确定要强制恢复吗？\n这将终止可能正在运行的进程并从上次保存点继续。`:`确定要恢复任务 ${e.task_id} 吗？将从上次失败的阶段继续执行。`;if(await U.confirm(l,a?"强制恢复任务":"恢复任务",{type:a?"warning":"info"}),o.value=e.task_id,a)try{await ua.cancelTechProposalTask(e.task_id)}catch{}const n=await ua.resumeTechProposalTask(e.task_id);n.success?(A.success("任务已准备恢复"),t("resume",e),s.value=!1):A.error(n.error||"恢复失败")}catch(l){"cancel"!==l&&A.error("恢复任务失败")}finally{o.value=null}}(e,d(e)),loading:o.value===e.task_id},{default:Ve(()=>[Se(l,null,{default:Ve(()=>[Se(Pe(R))]),_:1}),Ze(" "+De(d(e)?"强制恢复":"恢复执行"),1)]),_:2},1032,["onClick","loading"])):ze("",!0),"running"!==e.overall_status||d(e)?ze("",!0):(xe(),be(k,{key:1,type:"danger",size:"small",plain:"",onClick:a=>async function(e){try{await U.confirm(`确定要取消任务 ${e.task_id} 吗？`,"取消任务",{type:"warning"}),(await ua.cancelTechProposalTask(e.task_id)).success&&(A.success("任务已取消"),c())}catch(a){"cancel"!==a&&A.error("取消任务失败")}}(e)},{default:Ve(()=>[...a[8]||(a[8]=[Ze(" 取消 ",-1)])]),_:1},8,["onClick"])),Se(k,{size:"small",text:"",onClick:a=>async function(e){try{const a=await ua.getTechProposalTaskDetail(e.task_id);a.success&&(u.value={task:a.task,logs:a.logs,stats:a.stats},i.value=!0)}catch(a){A.error("获取任务详情失败")}}(e)},{default:Ve(()=>[...a[9]||(a[9]=[Ze(" 详情 ",-1)])]),_:1},8,["onClick"])])],2);var n}),128))])):(xe(),be(b,{key:0,description:"暂无任务记录"}))])),[[z,n.value]]),Se($,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),title:"任务详情",width:"600px","append-to-body":""},{default:Ve(()=>{var e;return[u.value?(xe(),Ie("div",vl,[Se(C,{column:2,border:""},{default:Ve(()=>[Se(S,{label:"任务ID"},{default:Ve(()=>[Ze(De(u.value.task.task_id),1)]),_:1}),Se(S,{label:"状态"},{default:Ve(()=>[Se(x,{type:v(u.value.task.overall_status)},{default:Ve(()=>[Ze(De(f(u.value.task.overall_status)),1)]),_:1},8,["type"])]),_:1}),Se(S,{label:"进度"},{default:Ve(()=>[Ze(De(u.value.task.progress_percentage)+"%",1)]),_:1}),Se(S,{label:"重试次数"},{default:Ve(()=>[Ze(De(u.value.task.retry_count),1)]),_:1}),Se(S,{label:"创建时间"},{default:Ve(()=>[Ze(De(y(u.value.task.created_at)),1)]),_:1}),Se(S,{label:"开始时间"},{default:Ve(()=>[Ze(De(y(u.value.task.started_at)||"-"),1)]),_:1})]),_:1}),u.value.stats?(xe(),Ie("div",ml,[a[14]||(a[14]=Fe("h4",null,"执行统计",-1)),Se(j,{gutter:16},{default:Ve(()=>[Se(P,{span:6},{default:Ve(()=>[Fe("div",fl,[Fe("div",gl,De(u.value.stats.successful_phases),1),a[10]||(a[10]=Fe("div",{class:"stat-label"},"成功阶段",-1))])]),_:1}),Se(P,{span:6},{default:Ve(()=>[Fe("div",hl,[Fe("div",yl,De(u.value.stats.failed_phases),1),a[11]||(a[11]=Fe("div",{class:"stat-label"},"失败阶段",-1))])]),_:1}),Se(P,{span:6},{default:Ve(()=>[Fe("div",_l,[Fe("div",wl,De(u.value.stats.total_retries),1),a[12]||(a[12]=Fe("div",{class:"stat-label"},"总重试",-1))])]),_:1}),Se(P,{span:6},{default:Ve(()=>[Fe("div",kl,[Fe("div",bl,De(w(u.value.stats.total_duration_ms)),1),a[13]||(a[13]=Fe("div",{class:"stat-label"},"总耗时",-1))])]),_:1})]),_:1})])):ze("",!0),(null==(e=u.value.logs)?void 0:e.length)?(xe(),Ie("div",xl,[a[15]||(a[15]=Fe("h4",null,"执行日志",-1)),Se(T,null,{default:Ve(()=>[(xe(!0),Ie(Ke,null,Je(u.value.logs,e=>(xe(),be(F,{key:e.log_id,type:h(e.status),timestamp:y(e.created_at),placement:"top"},{default:Ve(()=>[Fe("div",Vl,[Fe("div",Sl,[Fe("span",Cl,De(e.agent_name),1),Se(x,{type:h(e.status),size:"small"},{default:Ve(()=>[Ze(De(e.status),1)]),_:2},1032,["type"])]),e.error_message?(xe(),Ie("div",Pl,De(e.error_message),1)):ze("",!0),e.duration_ms?(xe(),Ie("div",jl," 耗时: "+De(w(e.duration_ms)),1)):ze("",!0)])]),_:2},1032,["type","timestamp"]))),128))]),_:1})])):ze("",!0)])):ze("",!0)]}),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-6353f324"]]),$l={class:"crew-progress-tracker"},Il={class:"tracker-header"},zl={class:"phase-list"},Ml={class:"phase-main"},El={class:"phase-icon"},Dl={class:"phase-content"},Bl={class:"phase-name"},Rl={key:0,class:"phase-result"},Ll={key:1,class:"phase-message"},Nl={key:0,class:"phase-detail"},Ul={class:"step-progress"},Al={class:"step-text"},Ol={key:0,class:"sub-items"},ql={key:1,class:"chapter-preview"},Xl={class:"preview-header"},Yl={class:"chapter-number"},Wl={class:"chapter-title"},Hl={class:"word-count"},Ql=["innerHTML"],Kl={key:0,class:"phase-connector"},Jl={class:"detail-content"},Gl={class:"dim-name"},Zl={class:"dim-count"},et={class:"dim-score"},at={class:"detail-content"},lt={key:0,class:"review-section"},tt={key:1,class:"review-section"},st=O(we({__name:"CrewProgressTracker",props:{currentPhase:{default:""},phaseProgress:{default:()=>({})},phaseDetails:{default:()=>({})},chapterPreview:{default:null},scoringPoints:{},productMatch:{},scoringStrategy:{},materials:{},reviewResult:{},showDetails:{type:Boolean,default:!1}},setup(e){const a=e,l=he([]),t=he(null),s=e=>{var l;return"running"===(null==(l=a.phaseProgress[e])?void 0:l.status)},n=e=>{var l;const t=null==(l=a.phaseDetails)?void 0:l[e];return!!(t&&t.totalSteps>0)},r=e=>{var l;const t=null==(l=a.phaseDetails)?void 0:l[e];return t&&0!==t.totalSteps?Math.round(t.currentStep/t.totalSteps*100):0},o=e=>{var l;const t=null==(l=a.phaseDetails)?void 0:l[e];return t?`${t.stepName} (${t.currentStep}/${t.totalSteps})`:""},i=e=>{var l;const t=null==(l=a.phaseDetails)?void 0:l[e];return(null==t?void 0:t.subItems)||[]},u=ge(()=>{var e;if(!(null==(e=a.chapterPreview)?void 0:e.content))return"";try{return ea(a.chapterPreview.content,{breaks:!0})}catch{return a.chapterPreview.content}});ye(()=>{var e;return null==(e=a.chapterPreview)?void 0:e.content},()=>{Ae(()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)})});const c=[{key:"scoring_extraction",label:"评分点提取"},{key:"product_matching",label:"产品能力匹配"},{key:"strategy_planning",label:"评分策略规划"},{key:"material_retrieval",label:"历史素材检索"},{key:"outline_generation",label:"大纲结构生成"},{key:"content_writing",label:"技术方案撰写"},{key:"expert_review",label:"专家评审"},{key:"complete",label:"生成完成"}],d=e=>({scoring_extraction:"提取评分点",product_matching:"匹配产品",strategy_planning:"策略规划",material_retrieval:"检索素材",outline_generation:"生成大纲",content_writing:"撰写内容",expert_review:"专家评审",iteration:"迭代优化",complete:"已完成"}[e]||e),p=ge(()=>a.scoringPoints||a.reviewResult);return(a,v)=>{const f=m,g=da,h=pa,y=_a,_=ya;return xe(),Ie("div",$l,[Fe("div",Il,[Se(f,null,{default:Ve(()=>[Se(Pe(q))]),_:1}),v[1]||(v[1]=Fe("span",null,"Quality-First 智能体协作进度",-1)),e.currentPhase?(xe(),be(g,{key:0,type:(w=e.currentPhase,"complete"===w?"success":"expert_review"===w?"warning":"content_writing"===w?"primary":"info"),size:"small"},{default:Ve(()=>[Ze(De(d(e.currentPhase)),1)]),_:1},8,["type"])):ze("",!0)]),Fe("div",zl,[(xe(),Ie(Ke,null,Je(c,a=>{var l,c,d,p,m,y,_,w;return Fe("div",{key:a.key,class:Me(["phase-item",{"phase-item--complete":"complete"===(null==(l=e.phaseProgress[a.key])?void 0:l.status),"phase-item--running":"running"===(null==(c=e.phaseProgress[a.key])?void 0:c.status),"phase-item--skipped":"skipped"===(null==(d=e.phaseProgress[a.key])?void 0:d.status),"phase-item--pending":!e.phaseProgress[a.key],"phase-item--has-detail":s(a.key)&&n(a.key)}])},[Fe("div",Ml,[Fe("div",El,["complete"===(null==(p=e.phaseProgress[a.key])?void 0:p.status)?(xe(),be(f,{key:0,class:"icon-success"},{default:Ve(()=>[Se(Pe(X))]),_:1})):"running"===(null==(m=e.phaseProgress[a.key])?void 0:m.status)?(xe(),be(f,{key:1,class:"icon-running"},{default:Ve(()=>[Se(Pe(Y))]),_:1})):"skipped"===(null==(y=e.phaseProgress[a.key])?void 0:y.status)?(xe(),be(f,{key:2,class:"icon-skipped"},{default:Ve(()=>[Se(Pe(W))]),_:1})):(xe(),be(f,{key:3,class:"icon-pending"},{default:Ve(()=>[Se(Pe(H))]),_:1}))]),Fe("div",Dl,[Fe("div",Bl,De(a.label),1),(null==(_=e.phaseProgress[a.key])?void 0:_.result)?(xe(),Ie("div",Rl,["scoring_extraction"===a.key?(xe(),Ie(Ke,{key:0},[Ze(De(e.phaseProgress[a.key].result.count||0)+"个评分维度 ",1)],64)):"product_matching"===a.key?(xe(),Ie(Ke,{key:1},[Ze(" 覆盖率 "+De((100*(e.phaseProgress[a.key].result.coverage_rate||0)).toFixed(1))+"% ",1)],64)):"strategy_planning"===a.key?(xe(),Ie(Ke,{key:2},[Ze(" 预估得分 "+De(e.phaseProgress[a.key].result.estimated_score||0)+"分 ",1)],64)):"material_retrieval"===a.key?(xe(),Ie(Ke,{key:3},[Ze(De(e.phaseProgress[a.key].result.package_count||0)+"个素材包 ",1)],64)):"outline_generation"===a.key?(xe(),Ie(Ke,{key:4},[Ze(De(e.phaseProgress[a.key].result.chapter_count||0)+"章节 ",1)],64)):"content_writing"===a.key?(xe(),Ie(Ke,{key:5},[Ze(De(e.phaseProgress[a.key].result.chapter_count||0)+"章，"+De(e.phaseProgress[a.key].result.total_words||0)+"字 ",1)],64)):"expert_review"===a.key?(xe(),Ie(Ke,{key:6},[Ze(De(e.phaseProgress[a.key].result.overall_score||0)+"分 ",1),Se(g,{type:e.phaseProgress[a.key].result.pass_recommendation?"success":"warning",size:"small"},{default:Ve(()=>[Ze(De(e.phaseProgress[a.key].result.pass_recommendation?"通过":"需改进"),1)]),_:2},1032,["type"])],64)):ze("",!0)])):(null==(w=e.phaseProgress[a.key])?void 0:w.message)?(xe(),Ie("div",Ll,De(e.phaseProgress[a.key].message),1)):ze("",!0)])]),Se(Ce,{name:"slide-fade"},{default:Ve(()=>{var l;return[s(a.key)&&n(a.key)?(xe(),Ie("div",Nl,[Fe("div",Ul,[Se(h,{percentage:r(a.key),"stroke-width":6,"show-text":!1,color:"#409eff"},null,8,["percentage"]),Fe("span",Al,De(o(a.key)),1)]),i(a.key).length>0?(xe(),Ie("div",Ol,[Se(aa,{name:"list",tag:"ul"},{default:Ve(()=>[(xe(!0),Ie(Ke,null,Je(i(a.key),(e,a)=>(xe(),Ie("li",{key:a,class:"sub-item"},[Se(f,{class:"item-icon"},{default:Ve(()=>[Se(Pe(Q))]),_:1}),Fe("span",null,De(e),1)]))),128))]),_:2},1024)])):ze("",!0),"content_writing"===a.key&&(null==(l=e.chapterPreview)?void 0:l.content)?(xe(),Ie("div",ql,[Fe("div",Xl,[Fe("span",Yl,De(e.chapterPreview.currentChapter),1),Fe("span",Wl,De(e.chapterPreview.currentTitle),1),Fe("span",Hl,De(e.chapterPreview.wordCount)+" 字",1)]),Fe("div",{class:"preview-content",ref_for:!0,ref_key:"previewRef",ref:t},[Fe("div",{innerHTML:u.value,class:"markdown-body"},null,8,Ql),v[2]||(v[2]=Fe("span",{class:"typing-cursor"},"|",-1))],512)])):ze("",!0)])):ze("",!0)]}),_:2},1024),"complete"!==a.key?(xe(),Ie("div",Kl,[...v[3]||(v[3]=[Fe("div",{class:"connector-line"},null,-1)])])):ze("",!0)],2)}),64))]),e.showDetails&&p.value?(xe(),be(_,{key:0,modelValue:l.value,"onUpdate:modelValue":v[0]||(v[0]=e=>l.value=e),class:"details-collapse"},{default:Ve(()=>[e.scoringPoints?(xe(),be(y,{key:0,title:"评分点详情",name:"scoring"},{default:Ve(()=>[Fe("div",Jl,[(xe(!0),Ie(Ke,null,Je(e.scoringPoints.dimensions,e=>(xe(),Ie("div",{key:e.name,class:"dimension-item"},[Fe("span",Gl,De(e.name),1),Fe("span",Zl,De(e.count)+"项",1),Fe("span",et,De(e.total_score)+"分",1)]))),128))])]),_:1})):ze("",!0),e.reviewResult?(xe(),be(y,{key:1,title:"评审详情",name:"review"},{default:Ve(()=>{var a,l;return[Fe("div",at,[(null==(a=e.reviewResult.strengths)?void 0:a.length)?(xe(),Ie("div",lt,[v[4]||(v[4]=Fe("h4",null,"优势",-1)),Fe("ul",null,[(xe(!0),Ie(Ke,null,Je(e.reviewResult.strengths,(e,a)=>(xe(),Ie("li",{key:a},De(e),1))),128))])])):ze("",!0),(null==(l=e.reviewResult.weaknesses)?void 0:l.length)?(xe(),Ie("div",tt,[v[5]||(v[5]=Fe("h4",null,"不足",-1)),Fe("ul",null,[(xe(!0),Ie(Ke,null,Je(e.reviewResult.weaknesses,(e,a)=>(xe(),Ie("li",{key:a},De(e),1))),128))])])):ze("",!0)])]}),_:1})):ze("",!0)]),_:1},8,["modelValue"])):ze("",!0)]);var w}}}),[["__scopeId","data-v-33418adb"]]),nt={key:1,class:"loading-container"},rt={key:2,class:"chapter-selector"},ot={class:"stats-row"},it={class:"batch-operations"},ut={class:"dialog-footer"},ct=O(we({__name:"TenderChapterSelectorDialog",props:{modelValue:{type:Boolean},projectId:{}},emits:["update:modelValue","success"],setup(e,{emit:a}){const l=e,t=a,s=ge({get:()=>l.modelValue,set:e=>t("update:modelValue",e)}),n=he(!1),r=he(!1),o=he([]),i=he([]),u=he([]),c=he(),d=ge(()=>o.value.length>0),p=ge(()=>{const e=a=>{let l=a.length;return a.forEach(a=>{var t;(null==(t=a.children)?void 0:t.length)&&(l+=e(a.children))}),l};return e(o.value)}),v=ge(()=>i.value.length),g=ge(()=>u.value.reduce((e,a)=>e+(a.word_count||0),0)),h=(e,a)=>{i.value=e,u.value=a},y=e=>{const a=[];return e.forEach(e=>{var l;a.push(e.id),(null==(l=e.children)?void 0:l.length)&&a.push(...y(e.children))}),a},_=(e,a)=>{const l=[];return e.forEach(e=>{var t;a.some(a=>e.title.includes(a))&&l.push(e.id),(null==(t=e.children)?void 0:t.length)&&l.push(..._(e.children,a))}),l},w=()=>{var e,a;const l=y(o.value);null==(e=c.value)||e.setCheckedKeys(l),i.value=l,u.value=(null==(a=c.value)?void 0:a.getCheckedNodes())||[]},k=()=>{var e;null==(e=c.value)||e.setCheckedKeys([]),i.value=[],u.value=[]},b=()=>{var e,a;const l=_(o.value,["技术","方案","实施","系统","功能","需求","架构","设计","开发","部署"]);null==(e=c.value)||e.setCheckedKeys(l),i.value=l,u.value=(null==(a=c.value)?void 0:a.getCheckedNodes())||[]},x=async()=>{if(0!==v.value){r.value=!0;try{const e=await ua.saveTechnicalChapters(l.projectId,i.value);if(!e.success)throw new Error(e.error||"生成失败");A.success("模板文件已生成"),t("success",{filePath:e.data.file_path,filename:e.data.filename}),s.value=!1}catch(e){A.error(e.message||"生成模板文件失败")}finally{r.value=!1}}else A.warning("请先选择章节")},V=()=>{i.value=[],u.value=[],s.value=!1};return ye(s,e=>{e&&l.projectId&&(async()=>{var e;if(l.projectId){n.value=!0;try{const a=(await ua.getProject(l.projectId)).data;(null==(e=null==a?void 0:a.step1_data)?void 0:e.chapters)?o.value=a.step1_data.chapters:o.value=[]}catch(a){A.error("加载章节数据失败"),o.value=[]}finally{n.value=!1}}})()}),(e,a)=>{const l=K,t=m,i=da,u=B,y=J,_=L;return xe(),be(_,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),title:"从招标文件选择章节",width:"800px","close-on-click-modal":!1,"destroy-on-close":"",onClose:V},{footer:Ve(()=>[Fe("div",ut,[Se(u,{onClick:V},{default:Ve(()=>[...a[6]||(a[6]=[Ze("取消",-1)])]),_:1}),Se(u,{type:"primary",disabled:0===v.value,loading:r.value,onClick:x},{default:Ve(()=>[Se(t,null,{default:Ve(()=>[Se(Pe(Z))]),_:1}),Ze(" 生成模板文件 ("+De(v.value)+"章) ",1)]),_:1},8,["disabled","loading"])])]),default:Ve(()=>[d.value||n.value?ze("",!0):(xe(),be(l,{key:0,type:"warning",closable:!1,"show-icon":""},{title:Ve(()=>[...a[1]||(a[1]=[Ze(" 当前项目尚未解析招标文档章节，请先在项目管理中上传并解析招标文档。 ",-1)])]),_:1})),n.value?(xe(),Ie("div",nt,[Se(t,{class:"is-loading"},{default:Ve(()=>[Se(Pe(Y))]),_:1}),a[2]||(a[2]=Fe("span",null,"正在加载章节数据...",-1))])):d.value?(xe(),Ie("div",rt,[Fe("div",ot,[Se(i,{type:"info"},{default:Ve(()=>[Ze("总章节: "+De(p.value),1)]),_:1}),Se(i,{type:"success"},{default:Ve(()=>[Ze("已选择: "+De(v.value),1)]),_:1}),Se(i,{type:"primary"},{default:Ve(()=>{return[Ze("选中字数: "+De((e=g.value,e>=1e4?`${(e/1e4).toFixed(1)}万`:e.toLocaleString())),1)];var e}),_:1})]),Fe("div",it,[Se(y,null,{default:Ve(()=>[Se(u,{size:"small",onClick:w},{default:Ve(()=>[Se(t,null,{default:Ve(()=>[Se(Pe(Q))]),_:1}),a[3]||(a[3]=Ze(" 全选 ",-1))]),_:1}),Se(u,{size:"small",onClick:k},{default:Ve(()=>[Se(t,null,{default:Ve(()=>[Se(Pe(f))]),_:1}),a[4]||(a[4]=Ze(" 全不选 ",-1))]),_:1}),Se(u,{size:"small",type:"success",onClick:b},{default:Ve(()=>[Se(t,null,{default:Ve(()=>[Se(Pe(G))]),_:1}),a[5]||(a[5]=Ze(" 仅选技术章节 ",-1))]),_:1})]),_:1})]),Se(pe,{ref_key:"chapterTreeRef",ref:c,chapters:o.value,"show-checkbox":!0,"show-search":!0,onCheck:h},null,8,["chapters"])])):ze("",!0)]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-f5c06cb4"]]),dt={class:"tech-proposal"},pt={class:"panel-row project-row"},vt={class:"row-item"},mt={class:"row-item"},ft={class:"panel-row project-row document-row"},gt={class:"row-item"},ht={key:0,class:"file-chip file-chip--success"},yt=["title"],_t={key:1,class:"file-chip file-chip--info"},wt=["title"],kt={key:2,class:"file-chip file-chip--primary"},bt=["title"],xt={key:3,class:"file-placeholder"},Vt={class:"file-actions"},St={class:"config-section"},Ct={class:"panel-row project-row"},Pt={class:"row-item"},jt={class:"row-item"},Ft={class:"panel-row project-row"},Tt={class:"row-item"},$t={key:0,class:"row-item"},It={key:1,class:"row-item"},zt={key:0,class:"quality-first-config"},Mt={class:"config-header"},Et={class:"panel-row project-row"},Dt={class:"row-item"},Bt={class:"panel-row project-row"},Rt={class:"row-item slider-row"},Lt={class:"slider-wrapper"},Nt={class:"panel-row project-row"},Ut={class:"row-item"},At={class:"panel-row project-row"},Ot={class:"row-item slider-row"},qt={class:"slider-wrapper"},Xt={class:"page-hint"},Yt={class:"panel-row project-row"},Wt={class:"row-item"},Ht={class:"row-item"},Qt={class:"panel-row project-row"},Kt={class:"row-item"},Jt={class:"row-item"},Gt={class:"panel-actions"},Zt={class:"card-header"},es={class:"card-header"},as={class:"requirement-categories"},ls={class:"category-title"},ts={class:"category-content"},ss={key:0,class:"category-summary"},ns={key:1,class:"category-keywords"},rs={key:2,class:"category-points"},os={class:"card-header"},is={class:"header-actions"},us={class:"result-content"},cs={class:"output-files"},ds={class:"file-buttons"},ps={class:"collapse-header"},vs={class:"filename-cell"},ms=O(we({__name:"TechProposal",setup(e){const{projects:a,selectedProject:l,loadProjects:t,handleProjectChange:s,restoreProjectFromStore:n}=wa(),{useHitlFile:r,hitlFileInfo:o,syncing:i,synced:u,loadFromHITL:c,cancelHitlFile:d,syncToHitl:p}=ra({onFileLoaded:()=>{w.value.tenderFiles=[]}}),v=he([]),f=he(!1),g=he([]),h=async()=>{if(w.value.projectId){f.value=!0;try{const e=await fetch(`/api/tech-proposal/files?project_id=${w.value.projectId}`),a=await e.json();if(!a.success)throw new Error(a.error||"加载失败");v.value=a.data||[]}catch(e){A.error(e.message||"加载历史文件失败")}finally{f.value=!1}}else v.value=[]},y=e=>{const a=["B","KB","MB","GB"];let l=e,t=0;for(;l>=1024&&t<a.length-1;)l/=1024,t++;return`${l.toFixed(1)} ${a[t]}`},_=e=>{try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return e}},w=he({projectId:null,tenderFiles:[]}),k=he({outputPrefix:"技术方案",aiModel:"shihuang-gpt4o-mini",generationMode:"Quality-First",templateName:"政府采购标准",pageCount:200,contentStyle:{tables:"适量",flowcharts:"流程图",images:"少量"},additionalOutputs:["includeAnalysis","includeMapping","includeSummary"]}),b=he({enabledPhases:["product_matching","material_retrieval","expert_review"],minReviewScore:85,maxIterations:2}),x=he({scoringPoints:null,productMatch:null,scoringStrategy:null,materials:null,reviewResult:null,currentPhase:"",phaseProgress:{},phaseDetails:{},chapterPreview:{currentChapter:"",currentTitle:"",content:"",wordCount:0}}),V=he(!1),S=he(0),C=he(""),j=he(null),F=he(!0),T=he(null);he(!0);const $=he(null),I=he(null),z=he(!1),M=he(""),D=he(""),R=he(!1),L=he(null),N=he(""),U=he(!1),O=he(!1),q=he(!1),X=he(null),Y=he(!1),W=he(null);ge(()=>{var e;return(null==(e=T.value)?void 0:e.chapters)?T.value.chapters:[]});const Q=ge(()=>w.value.projectId&&(r.value||w.value.tenderFiles.length>0||null!==W.value)),K=async e=>{var a;const{file:t,onSuccess:s,onError:n}=e;if(!w.value.projectId){return n(new Error("请先选择项目")),void A.error("请先选择项目")}if(!(null==(a=l.value)?void 0:a.company_id)){return n(new Error("项目没有关联公司")),void A.error("项目没有关联公司")}try{const e=new FormData;e.append("file",t),e.append("company_id",l.value.company_id.toString()),e.append("project_id",w.value.projectId.toString());const a=await ua.parseDocumentStructureQuick(e);if(!a.success)throw new Error(a.message||a.error||"解析失败");{A.success("目录识别完成，正在分析字数...");const e=await ua.enrichChapters({project_id:w.value.projectId,file_path:a.file_path,chapters:a.chapters,toc_end_idx:a.toc_end_idx});e.success?(s(e.data),A.success("技术需求文档上传成功")):(s(a),A.warning("字数统计失败，但目录结构已识别"))}}catch(r){n(r),A.error(r.message||"文档上传失败")}},J=()=>{A.success("文档上传成功")},G=e=>{w.value.tenderFiles=[],r.value&&d(),W.value=e,A.success(`已生成模板: ${e.filename}`)},Z=async()=>{await s(w.value.projectId,{onClear:()=>{w.value.tenderFiles=[],j.value=null,T.value=null,$.value=null,I.value=null,C.value="",R.value=!1,N.value="",v.value=[],W.value=null,r.value&&d()},onDocumentsLoaded:e=>{e.technicalFile&&c(e,"technicalFile"),e.techProposalFile&&(I.value=e.techProposalFile)}}),w.value.projectId&&await h()},pe=async()=>{var e;if(Q.value){V.value=!0,S.value=0,C.value="",j.value=null,$.value=null,R.value=!1,N.value="";try{const a=new FormData;if(r.value)a.append("use_hitl_technical_file","true"),a.append("project_id",w.value.projectId.toString());else{if(!(null==(e=w.value.tenderFiles[0])?void 0:e.raw))throw new Error("请上传技术需求文档或使用技术文件");a.append("tender_file",w.value.tenderFiles[0].raw)}a.append("outputPrefix",k.value.outputPrefix),a.append("companyId",l.value.company_id.toString()),a.append("projectName",l.value.project_name||""),a.append("projectId",w.value.projectId.toString()),a.append("aiModel",k.value.aiModel),k.value.generationMode&&(a.append("generation_mode",k.value.generationMode),a.append("page_count",k.value.pageCount.toString()),a.append("content_style",JSON.stringify(k.value.contentStyle)),"编写专项章节"===k.value.generationMode&&k.value.templateName&&a.append("template_name",k.value.templateName)),a.append("includeAnalysis",k.value.additionalOutputs.includes("includeAnalysis")?"true":"false"),a.append("includeMapping",k.value.additionalOutputs.includes("includeMapping")?"true":"false"),a.append("includeSummary",k.value.additionalOutputs.includes("includeSummary")?"true":"false"),await ve(a),A.success("技术方案生成完成")}catch(a){A.error(a.message||"生成失败，请重试")}finally{V.value=!1}}else A.warning("请选择项目并上传技术需求文档")},ve=async e=>{var a,l,t,s,n,r,o,i,u,c,d,v,m,f,g,h;let y;"Quality-First"===k.value.generationMode?(y="/api/agent/generate-crew",e.append("crew_config",JSON.stringify({skip_product_matching:!b.value.enabledPhases.includes("product_matching"),skip_material_retrieval:!b.value.enabledPhases.includes("material_retrieval"),enable_expert_review:b.value.enabledPhases.includes("expert_review"),min_review_score:b.value.minReviewScore,max_iterations:b.value.maxIterations})),x.value={scoringPoints:null,productMatch:null,scoringStrategy:null,materials:null,reviewResult:null,currentPhase:"",phaseProgress:{},phaseDetails:{},chapterPreview:{currentChapter:"",currentTitle:"",content:"",wordCount:0}}):y=k.value.generationMode?"/api/agent/generate":"/api/generate-proposal-stream-v2";const _=await fetch(y,{method:"POST",body:e});if(!_.ok)throw new Error(`HTTP ${_.status}: ${_.statusText}`);const V=null==(a=_.body)?void 0:a.getReader();if(!V)throw new Error("无法读取响应流");R.value=!0,N.value='<div style="text-align:center; padding:40px; color:#909399;">🔄 技术方案生成中，请稍候...</div>';const P=new TextDecoder;let F="";const z={};let M="",E=null;const D=()=>{E&&clearTimeout(E),E=setTimeout(()=>{ye(z)},500)};for(;;){const{done:e,value:a}=await V.read();if(e)break;F+=P.decode(a,{stream:!0});const y=F.split("\n");F=y.pop()||"";for(const _ of y)if(_.startsWith("data: "))try{const e=JSON.parse(_.slice(6));if(void 0!==e.progress&&(S.value=e.progress),e.message&&(C.value+=e.message+"\n"),"analysis_completed"===e.stage&&e.analysis_result&&(j.value=e.analysis_result),"outline_completed"===e.stage&&e.outline_data&&(T.value=e.outline_data),"Quality-First"===k.value.generationMode){if(e.phase&&(x.value.currentPhase=e.phase,x.value.phaseProgress[e.phase]={status:e.status,message:e.message,result:e.result}),e.detail&&e.phase&&(x.value.phaseDetails[e.phase]={currentStep:e.detail.step||0,totalSteps:e.detail.totalSteps||0,stepName:e.detail.stepName||"",subItems:e.detail.subItems||[]}),e.content&&(e.content.contentChunk?(x.value.chapterPreview.content+=e.content.contentChunk,x.value.chapterPreview.wordCount=e.content.wordCount||0):e.content.isComplete?x.value.chapterPreview={currentChapter:"",currentTitle:"",content:"",wordCount:0}:e.content.chapterNumber&&(x.value.chapterPreview={currentChapter:e.content.chapterNumber,currentTitle:e.content.chapterTitle||"",content:"",wordCount:0})),"complete"===e.status&&e.phase&&delete x.value.phaseDetails[e.phase],"scoring_extraction"===e.phase&&"complete"===e.status&&(x.value.scoringPoints=e.result,C.value+=`✅ 评分点提取完成: ${(null==(l=e.result)?void 0:l.count)||0}个评分维度\n`),"product_matching"===e.phase&&"complete"===e.status){x.value.productMatch=e.result;const a=(null==(t=e.result)?void 0:t.coverage_rate)||0;C.value+=`✅ 产品能力匹配完成: 覆盖率 ${(100*a).toFixed(1)}%\n`}if("strategy_planning"===e.phase&&"complete"===e.status&&(x.value.scoringStrategy=e.result,C.value+=`✅ 评分策略制定完成: 预估得分 ${(null==(s=e.result)?void 0:s.estimated_score)||0}\n`),"material_retrieval"===e.phase&&"complete"===e.status&&(x.value.materials=e.result,C.value+=`✅ 素材检索完成: ${(null==(n=e.result)?void 0:n.package_count)||0}个素材包\n`),"outline_generation"===e.phase&&"complete"===e.status&&((null==(r=e.result)?void 0:r.outline)&&(T.value={chapters:e.result.outline,total_chapters:e.result.chapter_count,total_words:e.result.total_words},ye(z)),C.value+=`✅ 大纲生成完成: ${(null==(o=e.result)?void 0:o.chapter_count)||0}章\n`),"content_writing"===e.phase)if("chapter_progress"===e.event)M=(null==(i=e.chapter_index)?void 0:i.toString())||"",C.value+=`📝 正在撰写: ${e.chapter_title}\n`,R.value||(R.value=!0);else if("chapter_complete"===e.event&&e.chapter){const a=(null==(u=e.chapter)?void 0:u.chapter_number)||M;a&&(z[a]=(null==(c=e.chapter)?void 0:c.content)||"",ye(z)),C.value+=`✓ ${(null==(d=e.chapter)?void 0:d.title)||"章节"} 撰写完成\n`}if("expert_review"===e.phase&&"complete"===e.status){x.value.reviewResult=e.result;const a=(null==(v=e.result)?void 0:v.overall_score)||0,l=(null==(m=e.result)?void 0:m.pass_recommendation)?"✅通过":"⚠️需改进";C.value+=`✅ 专家评审完成: ${a}分 ${l}\n`}"iteration"===e.phase&&("running"===e.status?C.value+=`🔄 第${e.iteration}轮优化中... (当前${e.current_score}分 → 目标${e.target_score}分)\n`:"complete"===e.status&&(C.value+=`✅ 第${e.iteration}轮优化完成: ${(null==(f=e.result)?void 0:f.new_score)||0}分\n`)),"skipped"===e.status&&(C.value+=`⏭️ 跳过: ${e.message}\n`)}if("content_generation"===e.stage)if("chapter_start"===e.event)M=e.chapter_number||"",z[M]="",C.value+=`\n\n## ${e.chapter_number} ${e.chapter_title}\n\n`,R.value||(R.value=!0);else if("content_chunk"===e.event){const a=e.chapter_number||M;a&&(z[a]=(z[a]||"")+(e.content||""),D())}else"chapter_end"===e.event&&(E&&clearTimeout(E),ye(z),C.value+=`\n✓ ${e.chapter_title||"章节"} 生成完成\n`);if("completed"===e.stage&&e.success&&($.value=e,I.value={outputFile:e.output_file,downloadUrl:null==(g=e.output_files)?void 0:g.proposal,stats:{requirements_count:e.requirements_count,sections_count:e.sections_count,matches_count:e.matches_count},message:"技术方案已生成"},R.value=!0,e.output_file&&await Le(e.output_file),e.output_file&&w.value.projectId&&await p(w.value.projectId,e.output_file,"tech_proposal")),"error"===e.stage){const a=e.error||e.message||"未知错误";throw C.value+=`\n❌ 错误: ${a}\n`,e.traceback&&(C.value+=`\n📋 详细信息:\n${e.traceback}\n`),new Error(a)}}catch(B){if(!(null==(h=B.message)?void 0:h.includes("JSON")))throw B}}},ye=e=>{var a;if(null==(a=T.value)?void 0:a.chapters){let a="";const l=t=>{for(const s of t){const t=s.chapter_number||s.id||"",n=e[t]||"",r=s.level||1,o=`ch-${(t||"").replace(/\./g,"-")}`;if(a+=`<h${r} id="${o}">${t} ${s.title}</h${r}>\n`,s.description&&(a+=`<div style="padding: 12px; background: #E8F4FD; border-left: 4px solid #409EFF; margin: 12px 0;">\n            <strong>【本章说明】</strong> ${s.description}\n          </div>\n`),s.response_strategy&&(a+=`<div style="padding: 12px; background: #F0F9FF; border-left: 4px solid #67C23A; margin: 12px 0;">\n            <strong>【应答策略】</strong> ${s.response_strategy}\n          </div>\n`),s.content_hints&&s.content_hints.length>0&&(a+=`<div style="padding: 12px; background: #FFF7E6; border-left: 4px solid #E6A23C; margin: 12px 0;">\n            <strong>【内容提示】</strong>\n            <ul style="margin: 8px 0; padding-left: 24px;">\n              ${s.content_hints.map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n          </div>\n`),s.response_tips&&s.response_tips.length>0&&(a+=`<div style="padding: 12px; background: #FEF0F0; border-left: 4px solid #F56C6C; margin: 12px 0;">\n            <strong>【应答建议】</strong>\n            <ul style="margin: 8px 0; padding-left: 24px;">\n              ${s.response_tips.map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n          </div>\n`),n){a+='<div style="padding: 12px; background: #F0FFF4; border-left: 4px solid #52C41A; margin: 12px 0;">\n            <strong style="color: #52C41A;">【AI生成内容】</strong>\n          </div>\n';const e=ea(n,{breaks:!0});a+=`<div style="line-height: 1.8; margin: 12px 0;">${e}</div>\n`}else t in e&&(a+='<div style="padding: 12px; background: #F5F5F5; border: 1px dashed #D9D9D9; margin: 12px 0; color: #999;">\n            <em>正在生成内容...</em>\n          </div>\n');s.subsections&&s.subsections.length>0&&l(s.subsections)}};l(T.value.chapters),N.value=a}else{let a="";const l=Object.entries(e).sort((e,a)=>{const[l]=e,[t]=a;return l.localeCompare(t,"zh-CN")});for(const[e,t]of l)if(a+=`<h2>${e}</h2>\n`,t){a+=`<div style="line-height: 1.8;">${ea(t,{breaks:!0})}</div>\n`}N.value=a}},_e=()=>{V.value=!1,A.info("已停止生成")},we=e=>{var a,l;if(!(null==(l=null==(a=$.value)?void 0:a.output_files)?void 0:l[e]))return void A.warning("文件不存在");const t=$.value.output_files[e];let s=t.split("/").pop()||`技术方案_${e}.docx`;s=s.split("?")[0],ia(t,s),A.success("下载已开始")},ke=()=>{var e,a,t;(null==(a=null==(e=$.value)?void 0:e.output_files)?void 0:a.proposal)?(M.value=$.value.output_files.proposal,D.value=`技术方案-${(null==(t=l.value)?void 0:t.project_name)||"文档"}.docx`,z.value=!0):A.warning("暂无文档可预览")},Ce=async()=>{var e;(null==(e=$.value)?void 0:e.output_file)?w.value.projectId?await p(w.value.projectId,$.value.output_file,"tech_proposal"):A.error("项目ID无效"):A.warning("没有可同步的文件")},Te=async e=>{if(null==e?void 0:e.task_id){X.value=e.task_id,V.value=!0,S.value=e.progress_percentage||0,C.value=`正在恢复任务 ${e.task_id}...\n`,x.value={scoringPoints:null,productMatch:null,scoringStrategy:null,materials:null,reviewResult:null,currentPhase:e.current_phase||"",phaseProgress:{},phaseDetails:{},chapterPreview:{currentChapter:"",currentTitle:"",content:"",wordCount:0}};try{const l=new FormData;l.append("task_id",e.task_id);const t=await fetch("/api/agent/generate-with-recovery",{method:"POST",body:l});if(!t.ok)throw new Error("恢复任务请求失败");if(!t.body)throw new Error("响应体为空");const s=t.body.getReader(),n=new TextDecoder;for(;;){const{done:e,value:l}=await s.read();if(e)break;const t=n.decode(l,{stream:!0}).split("\n");for(const s of t)if(s.startsWith("data: "))try{const e=JSON.parse(s.slice(6));Me(e)}catch(a){}}}catch(l){A.error(l.message||"恢复任务失败")}finally{V.value=!1}}else A.error("任务ID无效")},Me=e=>{const a=e.stage||e.phase,l=e.status,t=e.message;t&&(C.value+=t+"\n"),"complete"===a?(S.value=100,e.result&&($.value=e.result),A.success("技术方案生成完成")):"error"===l?(A.error(e.error||"生成失败"),e.can_resume&&A.info("任务已保存，可稍后恢复")):(x.value.currentPhase=a,e.result&&Ee(a,e.result))},Ee=(e,a)=>{switch(e){case"scoring_extraction":x.value.scoringPoints=a.scoring_points||a;break;case"product_matching":x.value.productMatch=a;break;case"strategy_planning":x.value.scoringStrategy=a;break;case"material_retrieval":x.value.materials=a;break;case"expert_review":x.value.reviewResult=a}},Be=async e=>{var a;if(null==(a=$.value)?void 0:a.output_file)try{O.value=!0;const a=await fetch("/api/editor/save-html-to-word",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html_content:e,project_id:w.value.projectId,document_type:"tech_proposal",original_file:$.value.output_file})}),l=await a.json();if(!l.success)throw new Error(l.error||"保存失败");A.success("技术方案内容已保存"),l.output_file&&($.value.output_file=l.output_file,l.download_url&&$.value.output_files&&($.value.output_files.proposal=l.download_url)),l.output_file&&w.value.projectId&&await p(w.value.projectId,l.output_file,"tech_proposal")}catch(l){throw l}finally{O.value=!1}else A.warning("没有可保存的文件")},Le=async e=>{try{U.value=!0,N.value='<p style="color: #409EFF;">正在转换Word文档为可编辑格式...</p>';const a=await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:e})}),l=await a.json();if(!l.success||!l.html_content)throw new Error(l.error||"转换失败");N.value=l.html_content,L.value&&L.value.setContent(l.html_content)}catch(a){N.value=`\n      <h1>📄 技术方案文档</h1>\n      <div style="padding: 20px; background: #FFF3E0; border-left: 4px solid #FF9800; margin: 16px 0;">\n        <p><strong>⚠️ 提示：</strong>Word文档转换失败</p>\n        <p>原因：${a.message}</p>\n        <p>您可以：</p>\n        <ul>\n          <li>直接在此编辑器中输入内容</li>\n          <li>或点击下方"预览Word"或"下载"按钮查看原始文档</li>\n        </ul>\n      </div>\n      <p>开始编辑您的内容...</p>\n    `,A.warning("Word转换HTML失败，请使用预览或下载功能")}finally{U.value=!1}};return He(async()=>{await t();const e=await n({onClear:()=>{w.value.tenderFiles=[],j.value=null,T.value=null,$.value=null,I.value=null,r.value&&d()},onDocumentsLoaded:e=>{e.technicalFile&&c(e,"technicalFile"),e.techProposalFile&&(I.value=e.techProposalFile)}});e&&(w.value.projectId=e)}),(e,t)=>{const s=fe,n=me,c=ee,p=m,T=B,I=da,X=te,ve=le,ge=P,he=ba,ye=ka,Me=qa,Ee=de,Le=Va,Ne=pa,Ue=_a,Ae=ya,Oe=Ca,qe=Sa,Xe=ca,Ye=va;return xe(),Ie("div",dt,[Se(Le,{class:"main-panel",shadow:"never"},{default:Ve(()=>{var e,i,u;return[Fe("div",pt,[Fe("div",vt,[t[29]||(t[29]=Fe("label",{class:"row-label"},"选择项目",-1)),Se(n,{modelValue:w.value.projectId,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value.projectId=e),placeholder:"请选择项目",filterable:"",onChange:Z,class:"row-select"},{default:Ve(()=>[(xe(!0),Ie(Ke,null,Je(Pe(a),e=>(xe(),be(s,{key:e.id,label:`${e.project_name} (${e.project_number||"-"})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),Fe("div",mt,[t[30]||(t[30]=Fe("label",{class:"row-label"},"应答公司",-1)),Se(c,{value:(null==(e=Pe(l))?void 0:e.company_name)||"-",disabled:"",class:"row-input"},null,8,["value"])])]),Fe("div",ft,[Fe("div",gt,[t[39]||(t[39]=Fe("label",{class:"row-label"},"技术文档",-1)),Pe(r)?(xe(),Ie("div",ht,[Se(p,{class:"file-chip-icon"},{default:Ve(()=>[Se(Pe(E))]),_:1}),Fe("span",{class:"file-chip-name",title:null==(i=Pe(o))?void 0:i.filename},De((null==(u=Pe(o))?void 0:u.filename)||"未知文件"),9,yt),t[32]||(t[32]=Fe("span",{class:"file-chip-tag"},"已加载",-1)),Se(T,{class:"file-chip-close",type:"danger",text:"",size:"small",onClick:Pe(d)},{default:Ve(()=>[...t[31]||(t[31]=[Ze("×",-1)])]),_:1},8,["onClick"])])):w.value.tenderFiles.length>0?(xe(),Ie("div",_t,[Se(p,{class:"file-chip-icon"},{default:Ve(()=>[Se(Pe(E))]),_:1}),Fe("span",{class:"file-chip-name",title:w.value.tenderFiles[0].name},De(w.value.tenderFiles[0].name),9,wt),t[34]||(t[34]=Fe("span",{class:"file-chip-tag"},"已上传",-1)),Se(T,{class:"file-chip-close",type:"danger",text:"",size:"small",onClick:t[1]||(t[1]=e=>w.value.tenderFiles=[])},{default:Ve(()=>[...t[33]||(t[33]=[Ze("×",-1)])]),_:1})])):W.value?(xe(),Ie("div",kt,[Se(p,{class:"file-chip-icon"},{default:Ve(()=>[Se(Pe(ae))]),_:1}),Fe("span",{class:"file-chip-name",title:W.value.filename},De(W.value.filename),9,bt),t[36]||(t[36]=Fe("span",{class:"file-chip-tag"},"从招标文件生成",-1)),Se(T,{class:"file-chip-close",type:"danger",text:"",size:"small",onClick:t[2]||(t[2]=e=>W.value=null)},{default:Ve(()=>[...t[35]||(t[35]=[Ze("×",-1)])]),_:1})])):(xe(),Ie("div",xt,[t[38]||(t[38]=Fe("span",{class:"placeholder-text"},"请上传技术需求文档",-1)),Fe("div",Vt,[Se(Pe(ta),{modelValue:w.value.tenderFiles,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value.tenderFiles=e),"http-request":K,accept:".pdf,.doc,.docx",limit:1,"max-size":50,"show-file-list":!1,"trigger-text":"选择文件",onSuccess:J},null,8,["modelValue"]),Se(T,{type:"primary",plain:"",disabled:!w.value.projectId,onClick:t[4]||(t[4]=e=>Y.value=!0)},{default:Ve(()=>[Se(p,null,{default:Ve(()=>[Se(Pe(ae))]),_:1}),t[37]||(t[37]=Ze(" 从招标文件选择 ",-1))]),_:1},8,["disabled"])])]))])]),Fe("div",St,[Fe("div",Ct,[Fe("div",Pt,[t[40]||(t[40]=Fe("label",{class:"row-label"},"输出前缀",-1)),Se(c,{modelValue:k.value.outputPrefix,"onUpdate:modelValue":t[5]||(t[5]=e=>k.value.outputPrefix=e),placeholder:"技术方案",class:"row-input"},null,8,["modelValue"])]),Fe("div",jt,[t[41]||(t[41]=Fe("label",{class:"row-label"},"AI模型",-1)),Se(n,{modelValue:k.value.aiModel,"onUpdate:modelValue":t[6]||(t[6]=e=>k.value.aiModel=e),class:"row-select"},{default:Ve(()=>[Se(s,{label:"GPT5（最强推理）",value:"shihuang-gpt5"}),Se(s,{label:"Claude Sonnet 4.5（标书专用）",value:"shihuang-claude-sonnet-45"}),Se(s,{label:"GPT4o Mini（推荐-默认）",value:"shihuang-gpt4o-mini"}),Se(s,{label:"通义千问-Max",value:"qwen-max"})]),_:1},8,["modelValue"])])]),Fe("div",Ft,[Fe("div",Tt,[t[47]||(t[47]=Fe("label",{class:"row-label"},"生成模式",-1)),Se(ve,{modelValue:k.value.generationMode,"onUpdate:modelValue":t[7]||(t[7]=e=>k.value.generationMode=e),class:"row-radio-group"},{default:Ve(()=>[Se(X,{value:"Quality-First"},{default:Ve(()=>[t[43]||(t[43]=Ze(" Quality-First模式 ",-1)),Se(I,{type:"success",size:"small",style:{"margin-left":"4px"}},{default:Ve(()=>[...t[42]||(t[42]=[Ze("推荐",-1)])]),_:1})]),_:1}),Se(X,{value:"按评分点写"},{default:Ve(()=>[...t[44]||(t[44]=[Ze("按评分点写",-1)])]),_:1}),Se(X,{value:"按招标书目录写"},{default:Ve(()=>[...t[45]||(t[45]=[Ze("按招标书目录写",-1)])]),_:1}),Se(X,{value:"编写专项章节"},{default:Ve(()=>[...t[46]||(t[46]=[Ze("使用固定模板",-1)])]),_:1})]),_:1},8,["modelValue"])]),"编写专项章节"===k.value.generationMode?(xe(),Ie("div",$t,[t[48]||(t[48]=Fe("label",{class:"row-label"},"选择模板",-1)),Se(n,{modelValue:k.value.templateName,"onUpdate:modelValue":t[8]||(t[8]=e=>k.value.templateName=e),placeholder:"请选择模板",class:"row-select"},{default:Ve(()=>[Se(s,{label:"政府采购标准（5章）",value:"政府采购标准"}),Se(s,{label:"软件开发项目（8章）",value:"软件开发项目"}),Se(s,{label:"ISO质量体系（6章）",value:"ISO质量体系"})]),_:1},8,["modelValue"])])):(xe(),Ie("div",It))]),"Quality-First"===k.value.generationMode?(xe(),Ie("div",zt,[Fe("div",Mt,[Se(p,null,{default:Ve(()=>[Se(Pe(se))]),_:1}),t[49]||(t[49]=Fe("span",null,"Quality-First 高级配置",-1)),Se(ge,{content:"8个智能体协作生成高质量技术方案：评分点提取 → 产品匹配 → 策略规划 → 素材检索 → 大纲生成 → 内容撰写 → 专家评审 → 迭代优化",placement:"top"},{default:Ve(()=>[Se(p,{class:"help-icon"},{default:Ve(()=>[Se(Pe(ne))]),_:1})]),_:1})]),Fe("div",Et,[Fe("div",Dt,[t[53]||(t[53]=Fe("label",{class:"row-label"},"流程控制",-1)),Se(ye,{modelValue:b.value.enabledPhases,"onUpdate:modelValue":t[9]||(t[9]=e=>b.value.enabledPhases=e),class:"row-checkbox-group"},{default:Ve(()=>[Se(he,{label:"product_matching"},{default:Ve(()=>[...t[50]||(t[50]=[Ze("产品匹配",-1)])]),_:1}),Se(he,{label:"material_retrieval"},{default:Ve(()=>[...t[51]||(t[51]=[Ze("素材检索",-1)])]),_:1}),Se(he,{label:"expert_review"},{default:Ve(()=>[...t[52]||(t[52]=[Ze("专家评审",-1)])]),_:1})]),_:1},8,["modelValue"])])]),Fe("div",Bt,[Fe("div",Rt,[t[54]||(t[54]=Fe("label",{class:"row-label"},"质量目标",-1)),Fe("div",Lt,[Se(Me,{modelValue:b.value.minReviewScore,"onUpdate:modelValue":t[10]||(t[10]=e=>b.value.minReviewScore=e),min:60,max:100,step:5,marks:{60:"60分",70:"70分",80:"80分",90:"90分",100:"100分"},"show-input":"","show-input-controls":!1},null,8,["modelValue"])]),t[55]||(t[55]=Fe("span",{class:"page-hint",style:{color:"var(--el-color-success)",background:"var(--el-color-success-light-9)"}},"评审目标分数",-1))])]),Fe("div",Nt,[Fe("div",Ut,[t[56]||(t[56]=Fe("label",{class:"row-label"},"迭代优化",-1)),Se(Ee,{modelValue:b.value.maxIterations,"onUpdate:modelValue":t[11]||(t[11]=e=>b.value.maxIterations=e),min:0,max:5,step:1,"controls-position":"right"},null,8,["modelValue"]),t[57]||(t[57]=Fe("span",{class:"page-hint"},"0表示不迭代，最多5轮",-1))]),t[58]||(t[58]=Fe("div",{class:"row-item"},null,-1))])])):ze("",!0),Fe("div",At,[Fe("div",Ot,[t[59]||(t[59]=Fe("label",{class:"row-label"},"页数控制",-1)),Fe("div",qt,[Se(Me,{modelValue:k.value.pageCount,"onUpdate:modelValue":t[12]||(t[12]=e=>k.value.pageCount=e),min:50,max:400,step:10,marks:{50:"50页",100:"100页",200:"200页",300:"300页",400:"400页"},"show-input":"","show-input-controls":!1},null,8,["modelValue"])]),Fe("span",Xt,"约 "+De(Math.round(700*k.value.pageCount*.8).toLocaleString())+" - "+De(Math.round(700*k.value.pageCount).toLocaleString())+" 字",1)])]),Fe("div",Yt,[Fe("div",Wt,[t[60]||(t[60]=Fe("label",{class:"row-label"},"表格数量",-1)),Se(n,{modelValue:k.value.contentStyle.tables,"onUpdate:modelValue":t[13]||(t[13]=e=>k.value.contentStyle.tables=e),class:"row-select"},{default:Ve(()=>[Se(s,{label:"无",value:"无"}),Se(s,{label:"少量",value:"少量"}),Se(s,{label:"适量（推荐）",value:"适量"}),Se(s,{label:"大量",value:"大量"})]),_:1},8,["modelValue"])]),Fe("div",Ht,[t[61]||(t[61]=Fe("label",{class:"row-label"},"流程图",-1)),Se(n,{modelValue:k.value.contentStyle.flowcharts,"onUpdate:modelValue":t[14]||(t[14]=e=>k.value.contentStyle.flowcharts=e),class:"row-select"},{default:Ve(()=>[Se(s,{label:"无",value:"无"}),Se(s,{label:"流程图（推荐）",value:"流程图"}),Se(s,{label:"SmartArt",value:"SmartArt"})]),_:1},8,["modelValue"])])]),Fe("div",Qt,[Fe("div",Kt,[t[62]||(t[62]=Fe("label",{class:"row-label"},"图片数量",-1)),Se(n,{modelValue:k.value.contentStyle.images,"onUpdate:modelValue":t[15]||(t[15]=e=>k.value.contentStyle.images=e),class:"row-select"},{default:Ve(()=>[Se(s,{label:"无",value:"无"}),Se(s,{label:"少量（推荐）",value:"少量"}),Se(s,{label:"大量",value:"大量"})]),_:1},8,["modelValue"])]),Fe("div",Jt,[t[66]||(t[66]=Fe("label",{class:"row-label"},"附加输出",-1)),Se(ye,{modelValue:k.value.additionalOutputs,"onUpdate:modelValue":t[16]||(t[16]=e=>k.value.additionalOutputs=e),class:"row-checkbox-group"},{default:Ve(()=>[Se(he,{label:"includeAnalysis"},{default:Ve(()=>[...t[63]||(t[63]=[Ze("需求分析",-1)])]),_:1}),Se(he,{label:"includeMapping"},{default:Ve(()=>[...t[64]||(t[64]=[Ze("匹配表",-1)])]),_:1}),Se(he,{label:"includeSummary"},{default:Ve(()=>[...t[65]||(t[65]=[Ze("总结报告",-1)])]),_:1})]),_:1},8,["modelValue"])])])]),Fe("div",Gt,[Se(T,{type:"primary",size:"large",disabled:!Q.value,loading:V.value,onClick:pe},{default:Ve(()=>[Se(p,null,{default:Ve(()=>[Se(Pe(re))]),_:1}),t[67]||(t[67]=Ze(" 生成技术方案 ",-1))]),_:1},8,["disabled","loading"]),Se(T,{type:"info",size:"large",plain:"",onClick:t[17]||(t[17]=e=>q.value=!0)},{default:Ve(()=>[Se(p,null,{default:Ve(()=>[Se(Pe(H))]),_:1}),t[68]||(t[68]=Ze(" 任务历史 ",-1))]),_:1})])]}),_:1}),Se(Pe(Tl),{modelValue:q.value,"onUpdate:modelValue":t[18]||(t[18]=e=>q.value=e),"project-id":w.value.projectId||void 0,onResume:Te},null,8,["modelValue","project-id"]),V.value?(xe(),be(Le,{key:0,class:"generation-output",shadow:"never"},{header:Ve(()=>[Fe("div",Zt,[t[69]||(t[69]=Fe("span",null,"AI正在生成技术方案...",-1)),Se(Ne,{percentage:S.value,status:100===S.value?"success":void 0,style:{width:"300px"}},null,8,["percentage","status"])])]),default:Ve(()=>["Quality-First"===k.value.generationMode?(xe(),be(Pe(st),{key:0,"current-phase":x.value.currentPhase,"phase-progress":x.value.phaseProgress,"phase-details":x.value.phaseDetails,"chapter-preview":x.value.chapterPreview,"scoring-points":x.value.scoringPoints,"product-match":x.value.productMatch,"scoring-strategy":x.value.scoringStrategy,materials:x.value.materials,"review-result":x.value.reviewResult,"show-details":!0,class:"crew-tracker"},null,8,["current-phase","phase-progress","phase-details","chapter-preview","scoring-points","product-match","scoring-strategy","materials","review-result"])):ze("",!0),"Quality-First"!==k.value.generationMode?(xe(),be(Pe(la),{key:1,content:C.value,"is-streaming":V.value,onStop:_e},null,8,["content","is-streaming"])):ze("",!0)]),_:1})):ze("",!0),j.value?(xe(),be(Le,{key:1,class:"analysis-section",shadow:"never"},{header:Ve(()=>[Fe("div",es,[t[70]||(t[70]=Fe("span",null,"需求分析结果",-1)),Se(T,{size:"small",onClick:t[19]||(t[19]=e=>F.value=!F.value)},{default:Ve(()=>[Ze(De(F.value?"收起":"展开"),1)]),_:1})])]),default:Ve(()=>[je(Fe("div",null,[Se(Pe(oa),{title:"文档摘要",stats:j.value.document_summary||{},"stat-items":[{key:"total_requirements",label:"总需求数",suffix:"项"},{key:"mandatory_count",label:"强制需求",suffix:"项"},{key:"optional_count",label:"可选需求",suffix:"项"}]},null,8,["stats"]),Fe("div",as,[t[73]||(t[73]=Fe("h4",null,"需求分类",-1)),Se(Ae,{accordion:""},{default:Ve(()=>[(xe(!0),Ie(Ke,null,Je(j.value.requirement_categories,(e,a)=>(xe(),be(Ue,{key:a,name:a},{title:Ve(()=>{return[Fe("div",ls,[Fe("span",null,De(e.category),1),Se(I,{type:(a=e.priority,{"高":"danger",high:"danger","中":"warning",medium:"warning","低":"info",low:"info"}[a]||"info"),size:"small"},{default:Ve(()=>[Ze(De(e.priority),1)]),_:2},1032,["type"]),Se(I,{type:"info",size:"small"},{default:Ve(()=>[Ze(De(e.requirements_count||0)+"项 ",1)]),_:2},1024)])];var a}),default:Ve(()=>[Fe("div",ts,[e.summary?(xe(),Ie("p",ss,De(e.summary),1)):ze("",!0),e.keywords&&e.keywords.length>0?(xe(),Ie("div",ns,[t[71]||(t[71]=Fe("strong",null,"关键词：",-1)),(xe(!0),Ie(Ke,null,Je(e.keywords,e=>(xe(),be(I,{key:e,size:"small",style:{"margin-right":"8px"}},{default:Ve(()=>[Ze(De(e),1)]),_:2},1024))),128))])):ze("",!0),e.key_points&&e.key_points.length>0?(xe(),Ie("div",rs,[t[72]||(t[72]=Fe("strong",null,"要点：",-1)),Fe("ul",null,[(xe(!0),Ie(Ke,null,Je(e.key_points,(e,a)=>(xe(),Ie("li",{key:a},De(e),1))),128))])])):ze("",!0)])]),_:2},1032,["name"]))),128))]),_:1})])],512),[[Re,F.value]])]),_:1})):ze("",!0),R.value?(xe(),be(Le,{key:2,class:"editor-section",shadow:"never"},{default:Ve(()=>[Se(Pe(na),{ref_key:"editorRef",ref:L,modelValue:N.value,"onUpdate:modelValue":t[20]||(t[20]=e=>N.value=e),title:"技术方案文档",height:1e3,loading:U.value,saving:O.value,onSave:Be},null,8,["modelValue","loading","saving"])]),_:1})):ze("",!0),$.value?(xe(),be(Le,{key:3,class:"result-section",shadow:"never"},{header:Ve(()=>[Fe("div",os,[t[79]||(t[79]=Fe("span",null,"✅ 生成结果",-1)),Fe("div",is,[Se(T,{type:"primary",icon:Pe(ie),onClick:ke},{default:Ve(()=>[...t[74]||(t[74]=[Ze(" 预览文档 ",-1)])]),_:1},8,["icon"]),Se(T,{type:"success",icon:Pe(oe),onClick:t[21]||(t[21]=e=>we("proposal"))},{default:Ve(()=>[...t[75]||(t[75]=[Ze(" 下载技术方案 ",-1)])]),_:1},8,["icon"]),Pe(u)?(xe(),be(I,{key:1,type:"success",size:"large"},{default:Ve(()=>[...t[77]||(t[77]=[Ze(" 已同步到投标项目 ",-1)])]),_:1})):(xe(),be(T,{key:0,type:"info",icon:Pe(ue),loading:Pe(i),onClick:Ce},{default:Ve(()=>[...t[76]||(t[76]=[Ze(" 同步到投标项目 ",-1)])]),_:1},8,["icon","loading"])),Se(T,{type:"primary",icon:Pe(ce),onClick:pe},{default:Ve(()=>[...t[78]||(t[78]=[Ze(" 重新生成 ",-1)])]),_:1},8,["icon"])])])]),default:Ve(()=>{var e,a,l,s;return[Fe("div",us,[Se(Pe(oa),{title:"生成统计",stats:$.value,"stat-items":[{key:"requirements_count",label:"需求数量",suffix:"项"},{key:"sections_count",label:"章节数量",suffix:"章"},{key:"matches_count",label:"匹配数量",suffix:"项"}]},null,8,["stats"]),Fe("div",cs,[t[84]||(t[84]=Fe("h4",null,"输出文件",-1)),Fe("div",ds,[(null==(e=$.value.output_files)?void 0:e.proposal)?(xe(),be(T,{key:0,type:"success",onClick:t[22]||(t[22]=e=>we("proposal"))},{default:Ve(()=>[Se(p,null,{default:Ve(()=>[Se(Pe(oe))]),_:1}),t[80]||(t[80]=Ze(" 下载技术方案 ",-1))]),_:1})):ze("",!0),(null==(a=$.value.output_files)?void 0:a.analysis)?(xe(),be(T,{key:1,type:"primary",onClick:t[23]||(t[23]=e=>we("analysis"))},{default:Ve(()=>[Se(p,null,{default:Ve(()=>[Se(Pe(oe))]),_:1}),t[81]||(t[81]=Ze(" 下载需求分析 ",-1))]),_:1})):ze("",!0),(null==(l=$.value.output_files)?void 0:l.mapping)?(xe(),be(T,{key:2,type:"info",onClick:t[24]||(t[24]=e=>we("mapping"))},{default:Ve(()=>[Se(p,null,{default:Ve(()=>[Se(Pe(oe))]),_:1}),t[82]||(t[82]=Ze(" 下载匹配表 ",-1))]),_:1})):ze("",!0),(null==(s=$.value.output_files)?void 0:s.summary)?(xe(),be(T,{key:3,type:"warning",onClick:t[25]||(t[25]=e=>we("summary"))},{default:Ve(()=>[Se(p,null,{default:Ve(()=>[Se(Pe(oe))]),_:1}),t[83]||(t[83]=Ze(" 下载生成报告 ",-1))]),_:1})):ze("",!0)])])])]}),_:1})):ze("",!0),w.value.projectId?(xe(),be(Ae,{key:4,modelValue:g.value,"onUpdate:modelValue":t[26]||(t[26]=e=>g.value=e),class:"history-collapse"},{default:Ve(()=>[Se(Ue,{name:"history"},{title:Ve(()=>[Fe("div",ps,[Fe("span",null,"📂 本项目历史文件 ("+De(v.value.length)+")",1),g.value?(xe(),be(T,{key:0,type:"primary",size:"small",loading:f.value,onClick:$e(h,["stop"]),style:{"margin-left":"16px"}},{default:Ve(()=>[...t[85]||(t[85]=[Ze(" 刷新列表 ",-1)])]),_:1},8,["loading"])):ze("",!0)])]),default:Ve(()=>[Se(Le,{shadow:"never",style:{border:"none"}},{default:Ve(()=>[je((xe(),be(qe,{data:v.value,border:"",stripe:"","max-height":"400"},{default:Ve(()=>[Se(Oe,{type:"index",label:"序号",width:"60"}),Se(Oe,{prop:"filename",label:"文件名","min-width":"300"},{default:Ve(({row:e})=>[Fe("div",vs,[Se(p,null,{default:Ve(()=>[Se(Pe(E))]),_:1}),Fe("span",null,De(e.filename),1)])]),_:1}),Se(Oe,{prop:"size",label:"文件大小",width:"120"},{default:Ve(({row:e})=>[Ze(De(y(e.size)),1)]),_:1}),Se(Oe,{prop:"process_time",label:"处理时间",width:"180"},{default:Ve(({row:e})=>[Ze(De(_(e.process_time)),1)]),_:1}),Se(Oe,{label:"操作",width:"200",fixed:"right"},{default:Ve(({row:e})=>[Se(T,{type:"primary",size:"small",onClick:a=>{return l=e,M.value=l.file_path||l.outputFile,D.value=l.filename||"技术方案.docx",void(z.value=!0);var l}},{default:Ve(()=>[...t[86]||(t[86]=[Ze(" 预览 ",-1)])]),_:1},8,["onClick"]),Se(T,{type:"success",size:"small",onClick:a=>(async e=>{try{if(!e.download_url)return void A.error("下载地址无效");const a=e.filename||"技术方案.docx";ia(e.download_url,a),A.success("文件下载中...")}catch(a){A.error(a.message||"下载文件失败")}})(e)},{default:Ve(()=>[...t[87]||(t[87]=[Ze(" 下载 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ye,f.value]]),f.value||0!==v.value.length?ze("",!0):(xe(),be(Xe,{key:0,description:"暂无历史文件","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):ze("",!0),Se(Pe(sa),{modelValue:z.value,"onUpdate:modelValue":t[27]||(t[27]=e=>z.value=e),"file-url":M.value,"file-name":D.value},null,8,["modelValue","file-url","file-name"]),Se(ct,{modelValue:Y.value,"onUpdate:modelValue":t[28]||(t[28]=e=>Y.value=e),"project-id":w.value.projectId,onSuccess:G},null,8,["modelValue","project-id"])])}}}),[["__scopeId","data-v-4e81d122"]]);export{ms as default};
