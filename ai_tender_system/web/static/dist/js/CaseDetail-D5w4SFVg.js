import{M as e,P as a,N as t,O as l,Q as o,R as r,d as c,e as s,F as n,aS as u,y as d,h as i,z as p,aT as _,aU as m,am as f,aV as v,s as y,G as h,q as g,aW as b,K as V}from"./index.js";/* empty css               */import{L as w}from"./Loading-BVHBNKFx.js";/* empty css                                                                          *//* empty css                *//* empty css                                                        *//* empty css                */import{am as j,an as k,ap as x,aX as C,au as U,ar as D,ax as E,as as I,az as z,aA as F,aq as M,aD as Y,aw as q,ay as A,aU as P,aC as B,av as N}from"./editor-CkQC1Uq_.js";/* empty css                             *//* empty css                   *//* empty css                     *//* empty css                    *//* empty css                */import{a as R,f as T,k as G}from"./formatters-B5qX4Bdv.js";import{E as L}from"./el-divider-CtOrExum.js";import{E as O}from"./el-date-picker-panel-BFWaZmWo.js";import{E as J,a as Q}from"./el-select-DZeK41OH.js";import{E as W}from"./Empty-D5VnJphi.js";import{s as X}from"./imageCompressor-CTkRt5bg.js";import{c as $}from"./company-CHa0NuIL.js";import{E as H}from"./index-CPjPqG6g.js";import{E as K,a as S}from"./index-CwhopI9-.js";import{E as Z}from"./index-Jdk3-L3D.js";import{E as ee}from"./index-ZlCuKr4C.js";import"./index-DzllSHb7.js";import"./advancedFormat-Cpf37SL5.js";import"./index-DO7-lxyV.js";import"./index-B_fegSBy.js";import"./index-C1LY3n9p.js";import"./toNumber-B_atpBHU.js";import"./strings-DygAwr0H.js";import"./_baseFindIndex-BTqrMG7V.js";import"./_baseIteratee-CwtmDzoV.js";import"./cloneDeep-syPWYH98.js";const ae={class:"case-basic-info-tab"},te={class:"card-header"},le={key:2,class:"attachments-grid"},oe={class:"attachment-header"},re={class:"attachment-body"},ce=["title"],se={class:"file-info"},ne={class:"file-size"},ue={class:"file-date"},de={key:0,class:"file-desc"},ie={class:"attachment-actions"},pe=g(j({__name:"CaseBasicInfoTab",props:{caseId:{},caseData:{}},emits:["update"],setup(g,{emit:b}){const V=g,j=b,{success:pe,error:_e}=e(),me=k(),fe=k(!1),ve=k([]),ye=k({company_id:null,case_title:"",case_number:"",customer_name:"",product_category:"",industry:"金融",contract_type:"合同",final_customer_name:"",contract_amount:"",contract_start_date:"",contract_end_date:"",party_a_contact_name:"",party_a_contact_phone:"",party_a_contact_email:""}),he={company_id:[{required:!0,message:"请选择所属企业",trigger:"change"}],case_title:[{required:!0,message:"请输入案例标题",trigger:"blur"}],customer_name:[{required:!0,message:"请输入客户名称",trigger:"blur"}],contract_type:[{required:!0,message:"请选择合同类型",trigger:"change"}]},ge=k(!1),be=k([]),Ve=k(!1),we=k(!1),je=k(),ke=k(),xe=k([]),Ce=k({attachment_type:"contract",description:"",file:null}),Ue={attachment_type:[{required:!0,message:"请选择附件类型",trigger:"change"}]};x(()=>V.caseData,e=>{e&&(ye.value={company_id:e.company_id||null,case_title:e.case_title||"",case_number:e.case_number||"",customer_name:e.customer_name||"",product_category:e.product_category||"",industry:e.industry||"金融",contract_type:e.contract_type||"合同",final_customer_name:e.final_customer_name||"",contract_amount:e.contract_amount||"",contract_start_date:e.contract_start_date||"",contract_end_date:e.contract_end_date||"",party_a_contact_name:e.party_a_contact_name||"",party_a_contact_phone:e.party_a_contact_phone||"",party_a_contact_email:e.party_a_contact_email||""})},{immediate:!0,deep:!0});const De=async()=>{me.value&&await me.value.validate(async e=>{if(e){fe.value=!0;try{const e=await G.updateCase(V.caseId,ye.value);e.success?(pe("保存成功","案例信息已更新"),j("update")):_e("保存失败",e.error||"未知错误")}catch(a){_e("保存失败",a instanceof Error?a.message:"未知错误")}finally{fe.value=!1}}})},Ee=()=>{var e;null==(e=me.value)||e.resetFields()},Ie=e=>{switch(e){case"contract":return y;case"acceptance":return v;case"testimony":return f;case"photo":return m;default:return _}},ze=e=>{switch(e){case"contract":return"#409eff";case"acceptance":return"#67c23a";case"testimony":return"#e6a23c";case"photo":return"#f56c6c";default:return"#909399"}},Fe=e=>{switch(e){case"contract":return"primary";case"acceptance":return"success";case"testimony":return"warning";case"photo":return"danger";default:return"info"}},Me=e=>{switch(e){case"contract":return"合同文件";case"acceptance":return"验收证明";case"testimony":return"客户证明";case"photo":return"项目照片";default:return"其他材料"}},Ye=async()=>{ge.value=!0;try{const e=await G.getCaseAttachments(V.caseId);e.success&&e.data&&(be.value=e.data)}catch(e){_e("加载失败",e instanceof Error?e.message:"未知错误")}finally{ge.value=!1}},qe=e=>{if(e.raw){const a=104857600;if(e.raw.size>a)return _e("文件过大","文件大小不能超过100MB"),xe.value=[],void(Ce.value.file=null);Ce.value.file=e.raw}},Ae=()=>{Ce.value.file=null},Pe=()=>{Ve.value=!0},Be=async()=>{je.value&&await je.value.validate(async e=>{if(e)if(Ce.value.file){we.value=!0;try{let e=Ce.value.file;if(e.type.startsWith("image/")){const a="photo"===Ce.value.attachment_type?"photo":"default";e=await X(e,a)}const a=await G.uploadCaseAttachment(V.caseId,e,Ce.value.attachment_type,Ce.value.description||void 0);a.success?(pe("上传成功","附件已上传"),Ve.value=!1,await Ye(),j("update")):_e("上传失败",a.error||"未知错误")}catch(a){_e("上传失败",a instanceof Error?a.message:"未知错误")}finally{we.value=!1}}else _e("请选择文件","请先选择要上传的文件")})},Ne=()=>{var e;xe.value=[],Ce.value={attachment_type:"contract",description:"",file:null},null==(e=je.value)||e.resetFields()};return C(()=>{(async()=>{try{const e=await $.getCompanies();e.success&&e.data&&(ve.value=e.data)}catch(e){}})(),Ye()}),(e,_)=>{const m=Q,f=J,v=t,y=S,g=K,b=l,V=r,k=o,x=O,C=L,X=c,$=a,Re=H,Te=s,Ge=Z,Le=ee,Oe=i;return D(),U("div",ae,[E(Re,{style:{"margin-bottom":"20px"}},{header:I(()=>[..._[19]||(_[19]=[q("span",null,"案例基本信息",-1)])]),default:I(()=>[E($,{ref_key:"formRef",ref:me,model:ye.value,rules:he,"label-width":"140px"},{default:I(()=>[E(g,{gutter:20},{default:I(()=>[E(y,{span:12},{default:I(()=>[E(v,{label:"所属企业",prop:"company_id"},{default:I(()=>[E(f,{modelValue:ye.value.company_id,"onUpdate:modelValue":_[0]||(_[0]=e=>ye.value.company_id=e),placeholder:"请选择企业",filterable:"",style:{width:"100%"}},{default:I(()=>[(D(!0),U(z,null,F(ve.value,e=>(D(),M(m,{key:e.company_id,label:e.company_name,value:e.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(g,{gutter:20},{default:I(()=>[E(y,{span:12},{default:I(()=>[E(v,{label:"案例标题",prop:"case_title"},{default:I(()=>[E(b,{modelValue:ye.value.case_title,"onUpdate:modelValue":_[1]||(_[1]=e=>ye.value.case_title=e),placeholder:"请输入案例标题/合同名称"},null,8,["modelValue"])]),_:1})]),_:1}),E(y,{span:12},{default:I(()=>[E(v,{label:"案例编号",prop:"case_number"},{default:I(()=>[E(b,{modelValue:ye.value.case_number,"onUpdate:modelValue":_[2]||(_[2]=e=>ye.value.case_number=e),placeholder:"请输入案例编号（可选）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(g,{gutter:20},{default:I(()=>[E(y,{span:12},{default:I(()=>[E(v,{label:"客户名称",prop:"customer_name"},{default:I(()=>[E(b,{modelValue:ye.value.customer_name,"onUpdate:modelValue":_[3]||(_[3]=e=>ye.value.customer_name=e),placeholder:"请输入甲方客户名称"},null,8,["modelValue"])]),_:1})]),_:1}),E(y,{span:12},{default:I(()=>[E(v,{label:"产品分类",prop:"product_category"},{default:I(()=>[E(f,{modelValue:ye.value.product_category,"onUpdate:modelValue":_[4]||(_[4]=e=>ye.value.product_category=e),placeholder:"请选择产品分类",clearable:"",style:{width:"100%"}},{default:I(()=>[E(m,{label:"风控产品",value:"风控产品"}),E(m,{label:"实修",value:"实修"}),E(m,{label:"免密",value:"免密"}),E(m,{label:"风控位置",value:"风控位置"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(g,{gutter:20},{default:I(()=>[E(y,{span:12},{default:I(()=>[E(v,{label:"所属行业",prop:"industry"},{default:I(()=>[E(f,{modelValue:ye.value.industry,"onUpdate:modelValue":_[5]||(_[5]=e=>ye.value.industry=e),placeholder:"请选择行业",clearable:"",style:{width:"100%"}},{default:I(()=>[E(m,{label:"科技",value:"科技"}),E(m,{label:"制造业",value:"制造业"}),E(m,{label:"金融",value:"金融"}),E(m,{label:"教育",value:"教育"}),E(m,{label:"医疗",value:"医疗"}),E(m,{label:"建筑",value:"建筑"}),E(m,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),E(y,{span:12},{default:I(()=>[E(v,{label:"合同类型",prop:"contract_type"},{default:I(()=>[E(k,{modelValue:ye.value.contract_type,"onUpdate:modelValue":_[6]||(_[6]=e=>ye.value.contract_type=e)},{default:I(()=>[E(V,{label:"合同"},{default:I(()=>[..._[20]||(_[20]=[Y("合同",-1)])]),_:1}),E(V,{label:"订单"},{default:I(()=>[..._[21]||(_[21]=[Y("订单",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(g,{gutter:20},{default:I(()=>[E(y,{span:12},{default:I(()=>[E(v,{label:"合同金额",prop:"contract_amount"},{default:I(()=>[E(b,{modelValue:ye.value.contract_amount,"onUpdate:modelValue":_[7]||(_[7]=e=>ye.value.contract_amount=e),placeholder:"如：100万元、百万级"},{append:I(()=>[..._[22]||(_[22]=[Y("元",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(g,{gutter:20},{default:I(()=>[E(y,{span:12},{default:I(()=>[E(v,{label:"最终客户",prop:"final_customer_name"},{default:I(()=>[E(b,{modelValue:ye.value.final_customer_name,"onUpdate:modelValue":_[8]||(_[8]=e=>ye.value.final_customer_name=e),placeholder:"订单类型时填写最终客户",disabled:"订单"!==ye.value.contract_type},null,8,["modelValue","disabled"])]),_:1})]),_:1}),E(y,{span:12},{default:I(()=>[E(v,{label:"合同开始日期",prop:"contract_start_date"},{default:I(()=>[E(x,{modelValue:ye.value.contract_start_date,"onUpdate:modelValue":_[9]||(_[9]=e=>ye.value.contract_start_date=e),type:"date",placeholder:"选择开始日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(g,{gutter:20},{default:I(()=>[E(y,{span:12},{default:I(()=>[E(v,{label:"合同结束日期",prop:"contract_end_date"},{default:I(()=>[E(x,{modelValue:ye.value.contract_end_date,"onUpdate:modelValue":_[10]||(_[10]=e=>ye.value.contract_end_date=e),type:"date",placeholder:"选择结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(C,{"content-position":"left"},{default:I(()=>[..._[23]||(_[23]=[Y("客户联系方式",-1)])]),_:1}),E(g,{gutter:20},{default:I(()=>[E(y,{span:8},{default:I(()=>[E(v,{label:"联系人姓名",prop:"party_a_contact_name"},{default:I(()=>[E(b,{modelValue:ye.value.party_a_contact_name,"onUpdate:modelValue":_[11]||(_[11]=e=>ye.value.party_a_contact_name=e),placeholder:"联系人"},null,8,["modelValue"])]),_:1})]),_:1}),E(y,{span:8},{default:I(()=>[E(v,{label:"联系电话",prop:"party_a_contact_phone"},{default:I(()=>[E(b,{modelValue:ye.value.party_a_contact_phone,"onUpdate:modelValue":_[12]||(_[12]=e=>ye.value.party_a_contact_phone=e),placeholder:"联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),E(y,{span:8},{default:I(()=>[E(v,{label:"联系邮箱",prop:"party_a_contact_email"},{default:I(()=>[E(b,{modelValue:ye.value.party_a_contact_email,"onUpdate:modelValue":_[13]||(_[13]=e=>ye.value.party_a_contact_email=e),placeholder:"邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(v,null,{default:I(()=>[E(X,{type:"primary",loading:fe.value,onClick:De},{default:I(()=>[..._[24]||(_[24]=[Y(" 保存 ",-1)])]),_:1},8,["loading"]),E(X,{onClick:Ee},{default:I(()=>[..._[25]||(_[25]=[Y("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),E(Re,null,{header:I(()=>[q("div",te,[_[27]||(_[27]=q("span",null,"案例附件",-1)),E(X,{type:"primary",size:"small",onClick:Pe},{default:I(()=>[E(Te,null,{default:I(()=>[E(A(d))]),_:1}),_[26]||(_[26]=Y(" 上传附件 ",-1))]),_:1})])]),default:I(()=>[ge.value?(D(),M(A(w),{key:0,text:"加载附件中..."})):be.value.length?(D(),U("div",le,[(D(!0),U(z,null,F(be.value,e=>(D(),U("div",{key:e.attachment_id,class:"attachment-card"},[q("div",oe,[E(Te,{size:32,color:ze(e.attachment_type)},{default:I(()=>[(D(),M(P(Ie(e.attachment_type))))]),_:2},1032,["color"]),E(Ge,{type:Fe(e.attachment_type),size:"small"},{default:I(()=>[Y(B(Me(e.attachment_type)),1)]),_:2},1032,["type"])]),q("div",re,[q("div",{class:"file-name",title:e.original_filename},B(e.original_filename),9,ce),q("div",se,[q("span",ne,B(A(R)(e.file_size)),1),q("span",ue,B(A(T)(e.uploaded_at,"date")),1)]),e.attachment_description?(D(),U("div",de,B(e.attachment_description),1)):N("",!0)]),q("div",ie,[E(X,{size:"small",onClick:a=>(e=>{const a=G.downloadCaseAttachment(e.attachment_id);window.open(a,"_blank")})(e)},{default:I(()=>[E(Te,null,{default:I(()=>[E(A(n))]),_:1}),_[28]||(_[28]=Y(" 下载 ",-1))]),_:1},8,["onClick"]),E(X,{size:"small",type:"danger",onClick:a=>(async e=>{try{await h.confirm(`确定要删除附件 "${e.original_filename}" 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const a=await G.deleteCaseAttachment(e.attachment_id);a.success?(pe("删除成功","附件已删除"),await Ye(),j("update")):_e("删除失败",a.error||"未知错误")}catch(a){_e("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:I(()=>[E(Te,null,{default:I(()=>[E(A(u))]),_:1}),_[29]||(_[29]=Y(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])):(D(),M(A(W),{key:1,type:"no-data",description:"暂无附件"}))]),_:1}),E(Oe,{modelValue:Ve.value,"onUpdate:modelValue":_[18]||(_[18]=e=>Ve.value=e),title:"上传案例附件",width:"500px",onClose:Ne},{footer:I(()=>[E(X,{onClick:_[17]||(_[17]=e=>Ve.value=!1)},{default:I(()=>[..._[32]||(_[32]=[Y("取消",-1)])]),_:1}),E(X,{type:"primary",loading:we.value,onClick:Be},{default:I(()=>[..._[33]||(_[33]=[Y(" 确定上传 ",-1)])]),_:1},8,["loading"])]),default:I(()=>[E($,{ref_key:"uploadFormRef",ref:je,model:Ce.value,rules:Ue,"label-width":"120px"},{default:I(()=>[E(v,{label:"附件类型",prop:"attachment_type"},{default:I(()=>[E(f,{modelValue:Ce.value.attachment_type,"onUpdate:modelValue":_[14]||(_[14]=e=>Ce.value.attachment_type=e),placeholder:"请选择附件类型",style:{width:"100%"}},{default:I(()=>[E(m,{label:"合同文件",value:"contract"}),E(m,{label:"验收证明",value:"acceptance"}),E(m,{label:"客户证明",value:"testimony"}),E(m,{label:"项目照片",value:"photo"}),E(m,{label:"其他材料",value:"other"})]),_:1},8,["modelValue"])]),_:1}),E(v,{label:"附件说明",prop:"description"},{default:I(()=>[E(b,{modelValue:Ce.value.description,"onUpdate:modelValue":_[15]||(_[15]=e=>Ce.value.description=e),type:"textarea",rows:2,placeholder:"请简要说明附件内容（可选）"},null,8,["modelValue"])]),_:1}),E(v,{label:"选择文件",prop:"file"},{default:I(()=>[E(Le,{ref_key:"uploadRef",ref:ke,"file-list":xe.value,"onUpdate:fileList":_[16]||(_[16]=e=>xe.value=e),"auto-upload":!1,limit:1,"on-change":qe,"on-remove":Ae,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",drag:""},{tip:I(()=>[..._[30]||(_[30]=[q("div",{class:"el-upload__tip"}," 支持PDF、DOC、DOCX、JPG、PNG格式，文件大小不超过100MB ",-1)])]),default:I(()=>[E(Te,{class:"el-icon--upload"},{default:I(()=>[E(A(p))]),_:1}),_[31]||(_[31]=q("div",{class:"el-upload__text"},[Y(" 拖拽文件到这里 或 "),q("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-319896b0"]]),_e={class:"case-detail"},me={class:"detail-header"},fe={class:"header-title"},ve={key:1,class:"detail-content"},ye=g(j({__name:"CaseDetail",setup(a){const t=b(),l=V(),{error:o}=e(),r=k(!1),s=k(0),n=k({}),u=async()=>{r.value=!0;try{const e=await G.getCase(s.value);e.success&&e.data?n.value=e.data:(o("加载失败","无法获取案例信息"),i())}catch(e){o("加载失败",e instanceof Error?e.message:"未知错误"),i()}finally{r.value=!1}},d=async()=>{await u()},i=()=>{l.push("/knowledge/case-library")};return C(()=>{const e=t.params.id;if(e){if(s.value=parseInt(e,10),isNaN(s.value))return o("参数错误","无效的案例ID"),void i();u()}else o("参数错误","缺少案例ID"),i()}),(e,a)=>{const t=c,l=Z;return D(),U("div",_e,[q("div",me,[E(t,{onClick:i,icon:"ArrowLeft"},{default:I(()=>[...a[0]||(a[0]=[Y("返回列表",-1)])]),_:1}),q("div",fe,[q("h2",null,B(n.value.case_title||"案例详情"),1),n.value.contract_type?(D(),M(l,{key:0,type:"合同"===n.value.contract_type?"primary":"success"},{default:I(()=>[Y(B(n.value.contract_type),1)]),_:1},8,["type"])):N("",!0),n.value.product_category?(D(),M(l,{key:1,type:"primary"},{default:I(()=>[Y(B(n.value.product_category),1)]),_:1})):N("",!0)])]),r.value?(D(),M(A(w),{key:0,text:"加载案例信息中..."})):(D(),U("div",ve,[E(pe,{"case-id":s.value,"case-data":n.value,onUpdate:d},null,8,["case-id","case-data"])]))])}}}),[["__scopeId","data-v-ea362180"]]);export{ye as default};
