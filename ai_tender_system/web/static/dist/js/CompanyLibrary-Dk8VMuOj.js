import{p as e,J as a,n as l,a6 as t,a7 as o,M as i,K as s,L as n,a3 as r,o as d,a8 as c,j as u,_ as p}from"./index.js";/* empty css                             *//* empty css                    *//* empty css               */import{E as m,a as y}from"./el-select-CfI0FrkR.js";import{L as _}from"./Loading-D28U8juR.js";import{E as v}from"./Empty-DyH0R3pV.js";/* empty css                                                                          */import{C as f}from"./Card-8ZtqTMQ7.js";/* empty css                                                                        */import{aw as w,am as b,an as h,aW as g,aC as C,az as j,aO as k,aE as x,aA as V,aF as E,aQ as q,ay as D,aR as z}from"./editor-B1Gv6Imt.js";/* empty css                   *//* empty css                */import{c as L}from"./company-DX6fQVXW.js";import{E as N}from"./index-CwMlfsED.js";import{E as U,a as T}from"./index-DrfNVuW0.js";import{E as F}from"./index-oqRCX8uh.js";import{E as I}from"./strings-CWsqWnJP.js";import"./toNumber-CoSJzAwT.js";import"./_baseIteratee-zS_3b1Hu.js";import"./flatMap-DWvNyWNY.js";import"./map-BLkpOroI.js";import"./_baseEach-C6rkbNHp.js";import"./index-CLdA0MiM.js";import"./raf-B6jWGkGX.js";const P={class:"company-library"},$={class:"stats-bar"},M={class:"stat-content"},O={class:"stat-icon"},A={class:"stat-info"},Q={class:"stat-value"},R={class:"stat-content"},G={class:"stat-icon"},H={class:"stat-info"},J={class:"stat-value"},K={class:"filter-section"},S={class:"qualification-progress"},W={class:"progress-text"},Z=p(w({__name:"CompanyLibrary",setup(p){const w=e(),{success:Z,error:B}=a(),X=b(!1),Y=b([]),ee=b({keyword:"",industry:""}),ae=b(!1),le=b(!1),te=b(),oe=b({companyName:"",companyCode:"",industryType:"",companyDescription:""}),ie={companyName:[{required:!0,message:"请输入企业名称",trigger:"blur"},{min:2,max:100,message:"企业名称长度在 2 到 100 个字符",trigger:"blur"}]},se=h(()=>{let e=[...Y.value];if(ee.value.keyword){const a=ee.value.keyword.toLowerCase();e=e.filter(e=>{var l,t,o;return(null==(l=e.company_name)?void 0:l.toLowerCase().includes(a))||(null==(t=e.social_credit_code)?void 0:t.toLowerCase().includes(a))||(null==(o=e.company_code)?void 0:o.toLowerCase().includes(a))})}return ee.value.industry&&(e=e.filter(e=>e.industry_type===ee.value.industry)),e}),ne=async()=>{X.value=!0;try{const e=(await L.getCompanies()).data||[],a=await Promise.all(e.map(async e=>{let a=0;try{const l=await L.getCompanyQualifications(e.company_id);l.data&&(a=Object.keys(l.data).length)}catch(t){}const l=Math.round(a/17*100);return{company_id:e.company_id,company_name:e.company_name||"未命名",company_code:e.company_code||"",social_credit_code:e.social_credit_code||"-",legal_representative:e.legal_representative||"-",registered_capital:e.registered_capital||"-",employee_count:e.employee_count||"-",industry_type:e.industry_type||"",product_count:e.product_count||0,document_count:e.document_count||0,qualification_completed:a,qualification_total:17,qualification_progress:l,created_at:e.created_at||"-",updated_at:e.updated_at||"-",...e}}));Y.value=a}catch(e){B("加载失败",e instanceof Error?e.message:"未知错误")}finally{X.value=!1}},re=()=>{},de=()=>{ee.value.keyword="",ee.value.industry=""},ce=async()=>{te.value&&await te.value.validate(async e=>{if(e){le.value=!0;try{(await L.createCompany({name:oe.value.companyName,code:oe.value.companyCode||void 0,description:oe.value.companyDescription||void 0})).success&&(Z("创建成功","企业创建成功"),ae.value=!1,await ne())}catch(a){B("创建失败",a instanceof Error?a.message:"未知错误")}finally{le.value=!1}}})},ue=()=>{var e;oe.value={companyName:"",companyCode:"",industryType:"",companyDescription:""},null==(e=te.value)||e.resetFields()};return g(()=>{ne()}),(e,a)=>{const p=l,b=N,h=n,g=s,pe=y,me=m,ye=d,_e=i,ve=T,fe=F,we=I,be=U,he=u;return j(),C("div",P,[k("div",$,[x(b,{class:"stat-card"},{default:V(()=>[k("div",M,[k("div",O,[x(p,{size:32,color:"#409eff"},{default:V(()=>[x(E(t))]),_:1})]),k("div",A,[a[8]||(a[8]=k("div",{class:"stat-label"},"总企业数",-1)),k("div",Q,q(Y.value.length),1)])])]),_:1}),x(b,{class:"stat-card"},{default:V(()=>[k("div",R,[k("div",G,[x(p,{size:32,color:"#67c23a"},{default:V(()=>[x(E(o))]),_:1})]),k("div",H,[a[9]||(a[9]=k("div",{class:"stat-label"},"筛选结果",-1)),k("div",J,q(se.value.length),1)])])]),_:1})]),x(E(f),{title:"企业列表"},{default:V(()=>[k("div",K,[x(_e,{inline:!0,model:ee.value},{default:V(()=>[x(g,{label:"搜索"},{default:V(()=>[x(h,{modelValue:ee.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.keyword=e),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:re},{prefix:V(()=>[x(p,null,{default:V(()=>[x(E(r))]),_:1})]),_:1},8,["modelValue"])]),_:1}),x(g,{label:"行业类型"},{default:V(()=>[x(me,{modelValue:ee.value.industry,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value.industry=e),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:re},{default:V(()=>[x(pe,{label:"全部行业",value:""}),x(pe,{label:"科技",value:"technology"}),x(pe,{label:"制造业",value:"manufacturing"}),x(pe,{label:"金融",value:"finance"}),x(pe,{label:"教育",value:"education"}),x(pe,{label:"医疗",value:"healthcare"}),x(pe,{label:"零售",value:"retail"}),x(pe,{label:"建筑",value:"construction"}),x(pe,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),x(g,null,{default:V(()=>[x(ye,{onClick:de},{default:V(()=>[x(p,null,{default:V(()=>[x(E(c))]),_:1}),a[10]||(a[10]=z(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),X.value?(j(),D(E(_),{key:0,text:"加载中..."})):se.value.length?(j(),D(be,{key:2,data:se.value,stripe:"",style:{width:"100%"}},{default:V(()=>[x(ve,{prop:"company_id",label:"ID",width:"70",fixed:""}),x(ve,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),x(ve,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),x(ve,{prop:"legal_representative",label:"法定代表人",width:"120"}),x(ve,{prop:"registered_capital",label:"注册资本",width:"120"}),x(ve,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),x(ve,{label:"资质完成度",width:"180",align:"center"},{default:V(({row:e})=>{return[k("div",S,[x(fe,{percentage:e.qualification_progress||0,color:(a=e.qualification_progress||0,a<30?"#f56c6c":a<70?"#e6a23c":"#67c23a"),"stroke-width":8},null,8,["percentage","color"]),k("span",W,q(e.qualification_completed||0)+"/"+q(e.qualification_total||17),1)])];var a}),_:1}),x(ve,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:V(({row:e})=>[x(we,{size:"small",type:"info"},{default:V(()=>[z(q(e.product_count||0),1)]),_:2},1024)]),_:1}),x(ve,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:V(({row:e})=>[x(we,{size:"small",type:"success"},{default:V(()=>[z(q(e.document_count||0),1)]),_:2},1024)]),_:1}),x(ve,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),x(ve,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),x(ve,{label:"操作",width:"220",fixed:"right"},{default:V(({row:e})=>[x(ye,{text:"",type:"primary",size:"small",onClick:a=>(e=>{w.push(`/knowledge/company/${e.company_id}`)})(e)},{default:V(()=>[...a[11]||(a[11]=[z(" 查看详情 ",-1)])]),_:1},8,["onClick"]),x(ye,{text:"",type:"warning",size:"small",onClick:a=>(e=>{w.push(`/knowledge/company/${e.company_id}`)})(e)},{default:V(()=>[...a[12]||(a[12]=[z(" 编辑 ",-1)])]),_:1},8,["onClick"]),x(ye,{text:"",type:"danger",size:"small",onClick:a=>(async e=>{try{if(!confirm(`确定要删除企业 "${e.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`))return;await L.deleteCompany(e.company_id),Z("删除成功",`已删除企业: ${e.company_name}`),await ne()}catch(a){B("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:V(()=>[...a[13]||(a[13]=[z(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(j(),D(E(v),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1}),x(he,{modelValue:ae.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ae.value=e),title:"新建企业",width:"500px",onClose:ue},{footer:V(()=>[x(ye,{onClick:a[6]||(a[6]=e=>ae.value=!1)},{default:V(()=>[...a[14]||(a[14]=[z("取消",-1)])]),_:1}),x(ye,{type:"primary",loading:le.value,onClick:ce},{default:V(()=>[...a[15]||(a[15]=[z(" 确定 ",-1)])]),_:1},8,["loading"])]),default:V(()=>[x(_e,{ref_key:"createFormRef",ref:te,model:oe.value,rules:ie,"label-width":"120px"},{default:V(()=>[x(g,{label:"企业名称",prop:"companyName"},{default:V(()=>[x(h,{modelValue:oe.value.companyName,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value.companyName=e),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),x(g,{label:"企业代码",prop:"companyCode"},{default:V(()=>[x(h,{modelValue:oe.value.companyCode,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.value.companyCode=e),placeholder:"请输入企业代码（可选）"},null,8,["modelValue"])]),_:1}),x(g,{label:"行业类型",prop:"industryType"},{default:V(()=>[x(me,{modelValue:oe.value.industryType,"onUpdate:modelValue":a[4]||(a[4]=e=>oe.value.industryType=e),placeholder:"请选择行业类型",style:{width:"100%"}},{default:V(()=>[x(pe,{label:"科技",value:"technology"}),x(pe,{label:"制造业",value:"manufacturing"}),x(pe,{label:"金融",value:"finance"}),x(pe,{label:"教育",value:"education"}),x(pe,{label:"医疗",value:"healthcare"}),x(pe,{label:"零售",value:"retail"}),x(pe,{label:"建筑",value:"construction"}),x(pe,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),x(g,{label:"企业简介",prop:"companyDescription"},{default:V(()=>[x(h,{modelValue:oe.value.companyDescription,"onUpdate:modelValue":a[5]||(a[5]=e=>oe.value.companyDescription=e),type:"textarea",rows:3,placeholder:"请输入企业简介（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-bc300562"]]);export{Z as default};
