import{H as e,I as a,m as t,o as l,J as s,a as i}from"./vendor-element-plus-CEQaQHNc.js";import{d as r,r as n,b7 as o,b as c,P as p,M as u,c as d,N as m,L as _,Q as f,I as y,H as v,R as b,O as g}from"./vendor-vue-DnBj6vzG.js";import{L as h}from"./Loading-fOFG7xAl.js";import{E as w}from"./Empty-BzPBqxja.js";/* empty css                                                                          */import{C as j}from"./Card-CKMHDauo.js";import{I as k}from"./IconButton-t7rtXnWM.js";import"./vendor-other-CxXkF0Pk.js";import"./vendor-editor-CGvuleas.js";/* empty css                                                                        */import{d as z}from"./vendor-dayjs-CeOjnJlt.js";import{a as C,_ as x}from"./index.js";import{t as D}from"./tender-ZYcn_VXM.js";import{c as P}from"./company-DX6fQVXW.js";import"./vendor-echarts-C00rBISf.js";import"./vendor-axios-BG7aBJwU.js";const I={class:"tender-management"},E={key:3,class:"pagination-wrapper"},H=x(r({__name:"Management",setup(r){const x=n(!1),H=n(!1),M=n([]),Y=n(1),$=n(10),L=n(0),B=o(),{success:F,error:J}=C(),R=async()=>{var e,a;x.value=!0;try{const t=await D.getProjects({page:Y.value,page_size:$.value}),l=(null==(e=t.data)?void 0:e.items)||t.data||[];M.value=l.map(e=>({id:e.project_id,name:e.project_name,number:e.project_number,company_name:e.company_name,status:e.status,created_at:e.created_at,...e})),L.value=(null==(a=t.data)?void 0:a.total)||M.value.length}catch(t){J("加载失败",t instanceof Error?t.message:"未知错误")}finally{x.value=!1}},S=e=>{B.push({name:"TenderManagementDetail",params:{id:e.id}})},T=async()=>{H.value=!0;try{const e=(await P.getCompanies()).data||[];if(0===e.length)return void J("无法创建项目：请先添加公司信息");const a=(await D.createProject({project_name:"新项目",project_number:`PRJ-${Date.now()}`,company_id:e[0].company_id})).project_id;F("创建成功"),B.push({name:"TenderManagementDetail",params:{id:a}})}catch(e){const a=e instanceof Error?e.message:"未知错误";J(`创建项目失败：${a}`)}finally{H.value=!1}},U=e=>{$.value=e,Y.value=1,R()},G=e=>{Y.value=e,R()};return c(()=>{R()}),(r,n)=>{const o=i,c=a,C=t,P=l,B=e,N=s;return u(),p("div",I,[d(y(j),{title:"项目列表"},{actions:m(()=>[d(o,{type:"primary",loading:H.value,onClick:T},{default:m(()=>[...n[2]||(n[2]=[g("i",{class:"bi bi-plus-lg"},null,-1),v(" 新建项目 ",-1)])]),_:1},8,["loading"])]),default:m(()=>[x.value?(u(),_(y(h),{key:0,text:"加载中..."})):M.value.length?(u(),_(B,{key:2,data:M.value,stripe:"",style:{width:"100%"}},{default:m(()=>[d(c,{prop:"id",label:"ID",width:"70",fixed:""}),d(c,{prop:"name",label:"项目名称","min-width":"200",fixed:""},{default:m(({row:e})=>[d(C,{type:"primary",onClick:a=>S(e)},{default:m(()=>[v(b(e.name),1)]),_:2},1032,["onClick"])]),_:1}),d(c,{prop:"company_name",label:"公司名称","min-width":"180","show-overflow-tooltip":""}),d(c,{prop:"authorized_person_name",label:"被授权人",width:"100"}),d(c,{label:"商务应答",width:"100",align:"center"},{default:m(({row:e})=>{return[(a=e,a.business_response_file||"completed"===a.business_response_status?(u(),_(P,{key:0,type:"success",size:"small"},{default:m(()=>[...n[3]||(n[3]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),v(" 已生成 ",-1)])]),_:1})):(u(),_(P,{key:1,type:"info",size:"small"},{default:m(()=>[...n[4]||(n[4]=[g("i",{class:"bi bi-dash-circle"},null,-1),v(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),d(c,{label:"技术点对点",width:"110",align:"center"},{default:m(({row:e})=>{return[(a=e,a.point_to_point_file||"completed"===a.point_to_point_status?(u(),_(P,{key:0,type:"success",size:"small"},{default:m(()=>[...n[5]||(n[5]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),v(" 已生成 ",-1)])]),_:1})):(u(),_(P,{key:1,type:"info",size:"small"},{default:m(()=>[...n[6]||(n[6]=[g("i",{class:"bi bi-dash-circle"},null,-1),v(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),d(c,{label:"技术方案",width:"100",align:"center"},{default:m(({row:e})=>{return[(a=e,a.tech_proposal_file||"completed"===a.tech_proposal_status||a.technical_data?(u(),_(P,{key:0,type:"success",size:"small"},{default:m(()=>[...n[7]||(n[7]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),v(" 已生成 ",-1)])]),_:1})):(u(),_(P,{key:1,type:"info",size:"small"},{default:m(()=>[...n[8]||(n[8]=[g("i",{class:"bi bi-dash-circle"},null,-1),v(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),d(c,{label:"最后融合",width:"100",align:"center"},{default:m(({row:e})=>{return[(a=e,a.final_merge_file||"completed"===a.merge_status?(u(),_(P,{key:0,type:"success",size:"small"},{default:m(()=>[...n[9]||(n[9]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),v(" 已融合 ",-1)])]),_:1})):(u(),_(P,{key:1,type:"info",size:"small"},{default:m(()=>[...n[10]||(n[10]=[g("i",{class:"bi bi-dash-circle"},null,-1),v(" 未融合 ",-1)])]),_:1})))];var a}),_:1}),d(c,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:m(({row:e})=>["active"===e.status?(u(),_(P,{key:0,type:"success"},{default:m(()=>[...n[11]||(n[11]=[v("进行中",-1)])]),_:1})):"completed"===e.status?(u(),_(P,{key:1,type:"primary"},{default:m(()=>[...n[12]||(n[12]=[v("已完成",-1)])]),_:1})):(u(),_(P,{key:2,type:"info"},{default:m(()=>[...n[13]||(n[13]=[v("草稿",-1)])]),_:1}))]),_:1}),d(c,{prop:"created_at",label:"创建时间",width:"160"},{default:m(({row:e})=>{return[v(b((a=e.created_at,a?z(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),d(c,{label:"操作",width:"120",fixed:"right"},{default:m(({row:e})=>[d(y(k),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:a=>S(e)},null,8,["onClick"]),d(y(k),{icon:"bi-trash",type:"danger",tooltip:"删除项目",onClick:a=>(async e=>{try{if(!confirm(`确定要删除项目 "${e.name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`))return;await D.deleteProject(e.id),F("删除成功",`已删除项目: ${e.name}`),await R()}catch(a){J("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])):(u(),_(y(w),{key:1,type:"no-data",description:"暂无项目"})),M.value.length>0?(u(),p("div",E,[d(N,{"current-page":Y.value,"onUpdate:currentPage":n[0]||(n[0]=e=>Y.value=e),"page-size":$.value,"onUpdate:pageSize":n[1]||(n[1]=e=>$.value=e),total:L.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:G},null,8,["current-page","page-size","total"])])):f("",!0)]),_:1})])}}}),[["__scopeId","data-v-aca97e9b"]]);export{H as default};
