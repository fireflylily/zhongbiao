import{r as e,c as a,A as t,ao as l,d as s,e as i,o as n,l as r,f as o,t as u,w as c,F as d,V as f,ak as p,k as y,ai as m,n as h,aj as _,aW as g,ad as v,h as w,ae as F,X as k,p as b,aM as x,m as I,g as z,aX as C,as as $,ay as H,az as T,Q as B,aY as M,aD as S,aE as R,aG as j,aH as E,aC as L,aa as Y,al as U,am as D,aJ as O,ar as P,R as V}from"./vendor-UMr2cBTC.js";/* empty css                                                                          */import{_ as A}from"./index.js";function G(l={}){const{onFileLoaded:s,onFileCancelled:i,onSyncSuccess:n}=l,r=e(!1),o=e(null),u=e(!1),c=e(!1),d=a(()=>!!o.value),f=e=>({technicalFile:"ÊäÄÊúØÈúÄÊ±ÇÊñá‰ª∂",tenderFile:"ÊãõÊ†áÊñáÊ°£",templateFile:"Â∫îÁ≠îÊ®°Êùø",businessResponseFile:"ÂïÜÂä°Â∫îÁ≠îÊñá‰ª∂",p2pResponseFile:"ÁÇπÂØπÁÇπÂ∫îÁ≠îÊñá‰ª∂",techProposalFile:"ÊäÄÊúØÊñπÊ°àÊñá‰ª∂"}[e]||"Êñá‰ª∂");return{useHitlFile:r,hitlFileInfo:o,hasHitlFile:d,syncing:u,synced:c,loadFromHITL:(e,a="technicalFile")=>{const l=e[a];return l?(o.value={filename:l.filename||l.name||"Êú™Áü•Êñá‰ª∂",file_path:l.file_path||l.url||"",file_size:l.file_size||l.size,file_url:l.file_url||l.url},r.value=!0,c.value=!1,t.success({message:`Â∑≤Âä†ËΩΩHITL${f(a)}: ${o.value.filename}`,duration:3e3}),s&&s(o.value),!0):(t.warning(`ÂΩìÂâçÈ°πÁõÆÊ≤°Êúâ${f(a)}`),!1)},cancelHitlFile:()=>{r.value=!1,o.value=null,c.value=!1,t.info("Â∑≤ÂèñÊ∂à‰ΩøÁî®HITLÊñá‰ª∂"),i&&i()},syncToHitl:async(e,a,l)=>{if(!e)return t.error("È°πÁõÆIDÊó†Êïà"),!1;if(!a)return t.error("Êñá‰ª∂Ë∑ØÂæÑÊó†Êïà"),!1;u.value=!0;try{const s=await fetch(`/api/tender-processing/sync-file/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:a,file_type:l})}),i=s.headers.get("content-type");if(!(null==i?void 0:i.includes("application/json"))){await s.text();throw new Error(`ÊúçÂä°Âô®ËøîÂõûÂºÇÂ∏∏ÂìçÂ∫î (${s.status}): ${s.statusText}„ÄÇÂèØËÉΩÊòØÂêéÁ´ØÈÖçÁΩÆÈóÆÈ¢òÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëò„ÄÇ`)}const r=await s.json();if(r.success||s.ok)return c.value=!0,t.success({message:r.message||"Â∑≤ÊàêÂäüÂêåÊ≠•Âà∞ÊäïÊ†áÈ°πÁõÆ",duration:3e3}),n&&await n(),!0;throw new Error(r.error||r.message||"ÂêåÊ≠•Â§±Ë¥•")}catch(s){let e="ÂêåÊ≠•Âà∞È°πÁõÆÂ§±Ë¥•";return s.message?e=s.message:"TypeError"===s.name&&(e="ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•"),t.error({message:e,duration:5e3}),!1}finally{u.value=!1}},resetSyncStatus:()=>{c.value=!1}}}function J(e,a="YYYY-MM-DD"){return e?l(e).format(a):""}function W(e,a=2){if(null==e||0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(a)} ${["B","KB","MB","GB","TB","PB"][t]}`}const X={class:"stats-card"},K={key:0,class:"stats-title"},N={class:"stat-item"},Q={class:"stat-prefix"},q={class:"stat-suffix"},Z=A(s({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,l=[{key:"total_replacements",label:"ÊñáÊú¨ÊõøÊç¢",suffix:"Â§Ñ"},{key:"tables_processed",label:"Ë°®Ê†ºÂ§ÑÁêÜ",suffix:"‰∏™"},{key:"cells_filled",label:"ÂçïÂÖÉÊ†ºÂ°´ÂÖÖ",suffix:"‰∏™"},{key:"images_inserted",label:"ÂõæÁâáÊèíÂÖ•",suffix:"Âº†"}],s=a(()=>t.statItems||l),v=e=>{const a=e.split(".");let l=t.stats;for(const t of a)if(l=null==l?void 0:l[t],null==l)break;return"number"==typeof l?l:0};return(a,t)=>{const l=_,w=m,F=p;return n(),i("div",X,[e.title?(n(),i("h4",K,u(e.title),1)):r("",!0),o(F,{gutter:e.gutter},{default:c(()=>[(n(!0),i(d,null,f(s.value,a=>(n(),y(w,{key:a.key,span:e.span},{default:c(()=>[h("div",N,[o(l,{title:a.label,value:v(a.key),precision:a.precision,"value-style":e.valueStyle},g({_:2},[a.prefix?{name:"prefix",fn:c(()=>[h("span",Q,u(a.prefix),1)]),key:"0"}:void 0,a.suffix?{name:"suffix",fn:c(()=>[h("span",q,u(a.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),ee={class:"alert-content"},ae={class:"file-info"},te={class:"file-details"},le={class:"file-label"},se={class:"file-name"},ie={key:0,class:"file-size"},ne={class:"alert-actions"},re=A(s({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"‰ΩøÁî®HITLÊñá‰ª∂:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"ÂèñÊ∂à‰ΩøÁî®"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:a}){const t=a,l=()=>{t("cancel")};return(a,t)=>{const s=v,d=k,f=z,p=I;return e.fileInfo?(n(),y(p,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:c(()=>[h("div",ee,[h("div",ae,[o(s,{class:"file-icon"},{default:c(()=>[o(w(F))]),_:1}),h("div",te,[h("span",le,u(e.label),1),h("span",se,u(e.fileInfo.filename),1),e.fileInfo.file_size?(n(),i("span",ie," ("+u(w(W)(e.fileInfo.file_size))+") ",1)):r("",!0),e.showTag?(n(),y(d,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:c(()=>[...t[0]||(t[0]=[b(" Â∑≤‰ªéÊäïÊ†áÈ°πÁõÆÂä†ËΩΩ ",-1)])]),_:1})):r("",!0)])]),h("div",ne,[x(a.$slots,"actions",{},()=>[e.showCancel?(n(),y(f,{key:0,type:"text",size:"small",onClick:l},{default:c(()=>[o(s,null,{default:c(()=>[o(w(C))]),_:1}),b(" "+u(e.cancelText),1)]),_:1})):r("",!0)],!0)])])]),_:3},8,["type"])):r("",!0)}}}),[["__scopeId","data-v-1a132715"]]),oe={class:"history-files-panel"},ue={class:"card-header"},ce={class:"header-title"},de={class:"current-file-content"},fe={class:"history-actions"},pe={class:"collapse-header"},ye={class:"filename-cell"},me=A(s({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"ËØ•È°πÁõÆÂ∑≤ÊúâÁîüÊàêÊñá‰ª∂"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(a){const t=e([]),l=e=>{if(!e)return"-";let a=e;try{a=decodeURIComponent(e)}catch{}const t=a.split("/");return t[t.length-1]||"-"};return(e,s)=>{const d=k,f=I,p=T,m=B,_=H,g=v,x=z,C=$,A=D,G=U,X=P,K=L,N=E,Q=O;return n(),i("div",oe,[a.currentFile?(n(),y(C,{key:0,shadow:"never",class:"current-file-card"},{header:c(()=>[h("div",ue,[h("div",ce,[h("span",null,u(a.title||"üìÑ ËØ•È°πÁõÆÁöÑÁîüÊàêÊñá‰ª∂"),1),o(d,{type:"info"},{default:c(()=>[...s[6]||(s[6]=[b("ÂéÜÂè≤Êñá‰ª∂",-1)])]),_:1})])])]),default:c(()=>[h("div",de,[o(f,{type:"info",title:a.currentFile.message||a.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),a.currentFile.stats&&a.showStats?(n(),y(Z,{key:0,stats:a.currentFile.stats,"stat-items":a.statItems},null,8,["stats","stat-items"])):r("",!0),o(_,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:c(()=>[o(p,{label:"Êñá‰ª∂Âêç"},{default:c(()=>[b(u(l(a.currentFile.outputFile||a.currentFile.file_path)),1)]),_:1}),o(p,{label:"‰∏ãËΩΩÂú∞ÂùÄ"},{default:c(()=>[o(m,{href:a.currentFile.downloadUrl,type:"primary"},{default:c(()=>[b(u(l(a.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),h("div",fe,[a.showEditorOpen?(n(),y(x,{key:0,type:"primary",size:"large",onClick:s[0]||(s[0]=t=>e.$emit("openInEditor",a.currentFile))},{default:c(()=>[o(g,null,{default:c(()=>[o(w(M))]),_:1}),s[7]||(s[7]=b(" Âú®ÁºñËæëÂô®‰∏≠ÊâìÂºÄ ",-1))]),_:1})):r("",!0),o(x,{type:"primary",size:"large",icon:w(S),onClick:s[1]||(s[1]=t=>e.$emit("preview",a.currentFile))},{default:c(()=>[...s[8]||(s[8]=[b(" È¢ÑËßàWord ",-1)])]),_:1},8,["icon"]),o(x,{type:"success",size:"large",icon:w(R),onClick:s[2]||(s[2]=t=>e.$emit("download",a.currentFile))},{default:c(()=>[...s[9]||(s[9]=[b(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["icon"]),a.showRegenerate?(n(),y(x,{key:1,size:"large",icon:w(j),onClick:s[3]||(s[3]=a=>e.$emit("regenerate"))},{default:c(()=>[...s[10]||(s[10]=[b(" ÈáçÊñ∞ÁîüÊàê ",-1)])]),_:1},8,["icon"])):r("",!0)])])]),_:1})):r("",!0),a.historyFiles.length>0?(n(),y(N,{key:1,modelValue:t.value,"onUpdate:modelValue":s[5]||(s[5]=e=>t.value=e),class:"history-collapse"},{default:c(()=>[o(K,{name:"history"},{title:c(()=>[h("div",pe,[h("span",null,"üìÇ Êü•ÁúãÊâÄÊúâÂéÜÂè≤Â§ÑÁêÜÊñá‰ª∂ ("+u(a.historyFiles.length)+")",1),t.value.includes("history")?(n(),y(x,{key:0,type:"primary",size:"small",loading:a.loading,onClick:s[4]||(s[4]=V(a=>e.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:c(()=>[...s[11]||(s[11]=[b(" Âà∑Êñ∞ÂàóË°® ",-1)])]),_:1},8,["loading"])):r("",!0)])]),default:c(()=>[o(C,{shadow:"never",style:{border:"none"}},{default:c(()=>[Y((n(),y(G,{data:a.historyFiles,border:"",stripe:"","max-height":"400"},{default:c(()=>[o(A,{type:"index",label:"Â∫èÂè∑",width:"60"}),o(A,{prop:"filename",label:"Êñá‰ª∂Âêç","min-width":"300"},{default:c(({row:e})=>[h("div",ye,[o(g,null,{default:c(()=>[o(w(F))]),_:1}),h("span",null,u(e.filename),1)])]),_:1}),o(A,{prop:"size",label:"Êñá‰ª∂Â§ßÂ∞è",width:"120"},{default:c(({row:e})=>[b(u(w(W)(e.size)),1)]),_:1}),o(A,{prop:"process_time",label:"Â§ÑÁêÜÊó∂Èó¥",width:"180"},{default:c(({row:e})=>[b(u(w(J)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),o(A,{label:"Êìç‰Ωú",width:"200",fixed:"right"},{default:c(({row:a})=>[o(x,{type:"primary",size:"small",onClick:t=>e.$emit("preview",a)},{default:c(()=>[...s[12]||(s[12]=[b(" È¢ÑËßà ",-1)])]),_:1},8,["onClick"]),o(x,{type:"success",size:"small",onClick:t=>e.$emit("download",a)},{default:c(()=>[...s[13]||(s[13]=[b(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,a.loading]]),a.loading||0!==a.historyFiles.length?r("",!0):(n(),y(X,{key:0,description:"ÊöÇÊó†ÂéÜÂè≤Êñá‰ª∂","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):r("",!0)])}}}),[["__scopeId","data-v-6814751e"]]);function he(e,a){const t="string"==typeof e?e:URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),"string"!=typeof e&&URL.revokeObjectURL(t)}export{re as H,Z as S,me as a,he as d,G as u};
