import{K as a,M as e,e as t,s as l,ae as s,af as o,P as r,N as c,O as i,S as d,d as n,aa as u,ab as p,G as _,q as m}from"./index.js";/* empty css                             *//* empty css                    *//* empty css                     *//* empty css               */import{E as v,a as y}from"./el-select-OYnihe3P.js";/* empty css                */import{L as f}from"./Loading-BeReBNvy.js";import{E as w}from"./Empty-VlzT6V_U.js";/* empty css                */import{C as b}from"./Card-Cv-82T4J.js";/* empty css                                                        *//* empty css                                                                            */import{am as h,an as g,ao as j,aW as C,au as x,ar as k,aw as V,ax as E,as as T,ay as z,aC as L,aq as $,aD as F}from"./editor-TazJhAAN.js";/* empty css                   *//* empty css                */import{k as D}from"./knowledge-BR5smuxz.js";import{c as I}from"./company-CHa0NuIL.js";import{f as P}from"./formatters-CqsP5WAK.js";import{E as U}from"./index-IM9EhOrM.js";import{E as N,a as q}from"./index-CEGNKDhc.js";import{E as B}from"./strings-X7bymAdO.js";import"./index-ChK61zXh.js";import"./toNumber-C9XTs0cM.js";import"./_baseIteratee-DK-XCWub.js";import"./index-ByYpZ62U.js";import"./flatMap-B556EPsX.js";import"./map-DlvCx75E.js";import"./_baseEach-uBBvXMMp.js";import"./index-DYIGgvz_.js";import"./raf-BZHcGSIv.js";const G={class:"case-library"},M={class:"stats-bar"},O={class:"stat-content"},S={class:"stat-icon"},A={class:"stat-info"},K={class:"stat-value"},Q={class:"stat-content"},W={class:"stat-icon"},Y={class:"stat-info"},Z={class:"stat-value"},H={class:"stat-content"},J={class:"stat-icon"},R={class:"stat-info"},X={class:"stat-value"},aa={class:"filter-section"},ea={key:1,style:{color:"#909399"}},ta=m(h({__name:"CaseLibrary",setup(m){const h=a(),{success:ta,error:la}=e(),sa=g(!1),oa=g(!1),ra=g([]),ca=g([]),ia=g(),da=g({keyword:"",productCategory:"",industry:"",contractType:""}),na=j(()=>{let a=[...ra.value];if(da.value.keyword){const e=da.value.keyword.toLowerCase();a=a.filter(a=>{var t,l,s;return(null==(t=a.case_title)?void 0:t.toLowerCase().includes(e))||(null==(l=a.customer_name)?void 0:l.toLowerCase().includes(e))||(null==(s=a.case_number)?void 0:s.toLowerCase().includes(e))})}return da.value.productCategory&&(a=a.filter(a=>a.product_category===da.value.productCategory)),da.value.industry&&(a=a.filter(a=>a.industry===da.value.industry)),da.value.contractType&&(a=a.filter(a=>a.contract_type===da.value.contractType)),a}),ua=j(()=>ra.value.filter(a=>"合同"===a.contract_type).length),pa=j(()=>{let a=0;return ra.value.forEach(e=>{if(e.contract_amount){const t=e.contract_amount.match(/[\d.]+/);if(t){const l=parseFloat(t[0]);e.contract_amount.includes("万")?a+=1e4*l:e.contract_amount.includes("亿")?a+=1e8*l:a+=l}}}),a>=1e8?`${(a/1e8).toFixed(2)}亿`:a>=1e4?`${(a/1e4).toFixed(2)}万`:a.toFixed(2)}),_a=async()=>{sa.value=!0;try{const a=await D.getCases({company_id:ia.value});a.success&&a.data&&(ra.value=a.data.map(a=>({...a,contract_start_date:a.contract_start_date?P(a.contract_start_date,"date"):"-",contract_end_date:a.contract_end_date?P(a.contract_end_date,"date"):"-",created_at:a.created_at?P(a.created_at):"-"})))}catch(a){la("加载失败",a instanceof Error?a.message:"未知错误")}finally{sa.value=!1}},ma=()=>{},va=()=>{da.value.keyword="",da.value.productCategory="",da.value.industry="",da.value.contractType=""},ya=async()=>{var a;if(0!==ca.value.length){oa.value=!0;try{const e=ia.value||(null==(a=ca.value[0])?void 0:a.company_id),t=await D.createCase({company_id:e,case_title:"新建案例",customer_name:"待完善",industry:"金融",contract_type:"合同"});t.success&&t.data?(ta("创建成功","正在跳转到编辑页面..."),h.push(`/knowledge/case/${t.data.case_id}`)):la("创建失败",t.error||"未知错误")}catch(e){la("创建失败",e instanceof Error?e.message:"未知错误")}finally{oa.value=!1}}else la("无法创建","请先添加企业信息")};return C(async()=>{await(async()=>{try{const a=await I.getCompanies();a.success&&a.data&&(ca.value=a.data,ca.value.length>0&&!ia.value&&(ia.value=ca.value[0].company_id,await _a()))}catch(a){}})()}),(a,e)=>{const m=t,g=U,j=n,C=i,I=c,P=y,ca=v,ia=r,fa=q,wa=B,ba=N;return k(),x("div",G,[V("div",M,[E(g,{class:"stat-card"},{default:T(()=>[V("div",O,[V("div",S,[E(m,{size:32,color:"#409eff"},{default:T(()=>[E(z(l))]),_:1})]),V("div",A,[e[4]||(e[4]=V("div",{class:"stat-label"},"总案例数",-1)),V("div",K,L(ra.value.length),1)])])]),_:1}),E(g,{class:"stat-card"},{default:T(()=>[V("div",Q,[V("div",W,[E(m,{size:32,color:"#67c23a"},{default:T(()=>[E(z(s))]),_:1})]),V("div",Y,[e[5]||(e[5]=V("div",{class:"stat-label"},"合同案例",-1)),V("div",Z,L(ua.value),1)])])]),_:1}),E(g,{class:"stat-card"},{default:T(()=>[V("div",H,[V("div",J,[E(m,{size:32,color:"#e6a23c"},{default:T(()=>[E(z(o))]),_:1})]),V("div",R,[e[6]||(e[6]=V("div",{class:"stat-label"},"合同总额",-1)),V("div",X,L(pa.value),1)])])]),_:1})]),E(z(b),{title:"案例列表"},{actions:T(()=>[E(j,{type:"primary",loading:oa.value,onClick:ya},{default:T(()=>[E(m,null,{default:T(()=>[E(z(p))]),_:1}),e[7]||(e[7]=F(" 新建案例 ",-1))]),_:1},8,["loading"])]),default:T(()=>[V("div",aa,[E(ia,{inline:!0,model:da.value},{default:T(()=>[E(I,{label:"搜索"},{default:T(()=>[E(C,{modelValue:da.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>da.value.keyword=a),placeholder:"搜索案例标题、客户名称...",clearable:"",style:{width:"300px"},onInput:ma},{prefix:T(()=>[E(m,null,{default:T(()=>[E(z(d))]),_:1})]),_:1},8,["modelValue"])]),_:1}),E(I,{label:"产品分类"},{default:T(()=>[E(ca,{modelValue:da.value.productCategory,"onUpdate:modelValue":e[1]||(e[1]=a=>da.value.productCategory=a),placeholder:"全部产品",clearable:"",style:{width:"130px"},onChange:ma},{default:T(()=>[E(P,{label:"全部产品",value:""}),E(P,{label:"风控产品",value:"风控产品"}),E(P,{label:"实修",value:"实修"}),E(P,{label:"免密",value:"免密"}),E(P,{label:"风控位置",value:"风控位置"})]),_:1},8,["modelValue"])]),_:1}),E(I,{label:"行业"},{default:T(()=>[E(ca,{modelValue:da.value.industry,"onUpdate:modelValue":e[2]||(e[2]=a=>da.value.industry=a),placeholder:"全部行业",clearable:"",style:{width:"120px"},onChange:ma},{default:T(()=>[E(P,{label:"全部行业",value:""}),E(P,{label:"科技",value:"科技"}),E(P,{label:"制造业",value:"制造业"}),E(P,{label:"金融",value:"金融"}),E(P,{label:"教育",value:"教育"}),E(P,{label:"医疗",value:"医疗"}),E(P,{label:"建筑",value:"建筑"}),E(P,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),E(I,{label:"合同类型"},{default:T(()=>[E(ca,{modelValue:da.value.contractType,"onUpdate:modelValue":e[3]||(e[3]=a=>da.value.contractType=a),placeholder:"全部类型",clearable:"",style:{width:"120px"},onChange:ma},{default:T(()=>[E(P,{label:"全部类型",value:""}),E(P,{label:"合同",value:"合同"}),E(P,{label:"订单",value:"订单"})]),_:1},8,["modelValue"])]),_:1}),E(I,null,{default:T(()=>[E(j,{onClick:va},{default:T(()=>[E(m,null,{default:T(()=>[E(z(u))]),_:1}),e[8]||(e[8]=F(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),sa.value?(k(),$(z(f),{key:0,text:"加载中..."})):na.value.length?(k(),$(ba,{key:2,data:na.value,stripe:"",style:{width:"100%"}},{default:T(()=>[E(fa,{prop:"case_id",label:"ID",width:"70",fixed:""}),E(fa,{prop:"case_title",label:"案例标题","min-width":"200",fixed:"","show-overflow-tooltip":""}),E(fa,{prop:"customer_name",label:"客户名称",width:"180","show-overflow-tooltip":""}),E(fa,{prop:"product_category",label:"产品分类",width:"110",align:"center"},{default:T(({row:a})=>[a.product_category?(k(),$(wa,{key:0,type:"primary",size:"small"},{default:T(()=>[F(L(a.product_category),1)]),_:2},1024)):(k(),x("span",ea,"-"))]),_:1}),E(fa,{prop:"industry",label:"所属行业",width:"100"}),E(fa,{prop:"contract_type",label:"合同类型",width:"100",align:"center"},{default:T(({row:a})=>[E(wa,{type:"合同"===a.contract_type?"primary":"success",size:"small"},{default:T(()=>[F(L(a.contract_type),1)]),_:2},1032,["type"])]),_:1}),E(fa,{prop:"contract_amount",label:"合同金额",width:"120",align:"right"}),E(fa,{prop:"contract_start_date",label:"合同开始日期",width:"120"}),E(fa,{prop:"contract_end_date",label:"合同结束日期",width:"120"}),E(fa,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),E(fa,{label:"操作",width:"220",fixed:"right"},{default:T(({row:a})=>[E(j,{text:"",type:"primary",size:"small",onClick:e=>(a=>{h.push(`/knowledge/case/${a.case_id}`)})(a)},{default:T(()=>[...e[9]||(e[9]=[F(" 查看详情 ",-1)])]),_:1},8,["onClick"]),E(j,{text:"",type:"warning",size:"small",onClick:e=>(a=>{h.push(`/knowledge/case/${a.case_id}`)})(a)},{default:T(()=>[...e[10]||(e[10]=[F(" 编辑 ",-1)])]),_:1},8,["onClick"]),E(j,{text:"",type:"danger",size:"small",onClick:e=>(async a=>{try{await _.confirm(`确定要删除案例 "${a.case_title}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const e=await D.deleteCase(a.case_id);e.success?(ta("删除成功",`已删除案例: ${a.case_title}`),await _a()):la("删除失败",e.error||"未知错误")}catch(e){la("删除失败",e instanceof Error?e.message:"未知错误")}})(a)},{default:T(()=>[...e[11]||(e[11]=[F(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(k(),$(z(w),{key:1,type:"no-data",description:"暂无案例数据"}))]),_:1})])}}}),[["__scopeId","data-v-4eca5175"]]);export{ta as default};
