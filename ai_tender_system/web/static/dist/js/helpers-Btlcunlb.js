import{k as x,I as P,G as O,H as j,D as L,F as D,p as R,c as U,a as V,ad as A,Q as J,W,X as G,n as Q,ae as X,_ as Z,$ as q,a1 as K,a2 as ee,Z as te,J as le,K as se,a3 as ae,P as ne}from"./element-plus-IkZgpaz4.js";import{bt as T,bu as Y,cu as ie,bT as H,bU as S,bV as u,c3 as h,c8 as s,c6 as y,c0 as l,c7 as oe,cC as re,b$ as g,bY as o,cT as ce,bv as k,c5 as m,bW as ue,c1 as de,ce as fe}from"./vendor-CdA3MjAt.js";/* empty css                                                                          */import{_ as M}from"./index.js";import"./umo-editor-BmhDOXHm.js";/* empty css                                                                        */function Oe(e={}){const{onFileLoaded:r,onFileCancelled:d,onSyncSuccess:a}=e,t=T(!1),c=T(null),v=T(!1),n=T(!1),F=Y(()=>!!c.value),E=(I,$="technicalFile")=>{const _=I[$];return _?(c.value={filename:_.filename||_.name||"Êú™Áü•Êñá‰ª∂",file_path:_.file_path||_.url||"",file_size:_.file_size||_.size,file_url:_.file_url||_.url},t.value=!0,n.value=!1,x.success({message:`Â∑≤Âä†ËΩΩHITL${C($)}: ${c.value.filename}`,duration:3e3}),r&&r(c.value),!0):(x.warning(`ÂΩìÂâçÈ°πÁõÆÊ≤°Êúâ${C($)}`),!1)},p=()=>{t.value=!1,c.value=null,n.value=!1,x.info("Â∑≤ÂèñÊ∂à‰ΩøÁî®HITLÊñá‰ª∂"),d&&d()},b=async(I,$,_)=>{if(!I)return x.error("È°πÁõÆIDÊó†Êïà"),!1;if(!$)return x.error("Êñá‰ª∂Ë∑ØÂæÑÊó†Êïà"),!1;v.value=!0;try{const f=await fetch(`/api/tender-processing/sync-file/${I}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:$,file_type:_})}),w=f.headers.get("content-type");if(!(w!=null&&w.includes("application/json"))){const B=await f.text();throw console.error("ÂêåÊ≠•APIËøîÂõûÈùûJSONÂìçÂ∫î:",{status:f.status,statusText:f.statusText,contentType:w,responsePreview:B.substring(0,200)}),new Error(`ÊúçÂä°Âô®ËøîÂõûÂºÇÂ∏∏ÂìçÂ∫î (${f.status}): ${f.statusText}„ÄÇÂèØËÉΩÊòØÂêéÁ´ØÈÖçÁΩÆÈóÆÈ¢òÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëò„ÄÇ`)}const i=await f.json();if(i.success||f.ok)return n.value=!0,x.success({message:i.message||"Â∑≤ÊàêÂäüÂêåÊ≠•Âà∞ÊäïÊ†áÈ°πÁõÆ",duration:3e3}),a&&await a(),!0;throw new Error(i.error||i.message||"ÂêåÊ≠•Â§±Ë¥•")}catch(f){console.error("ÂêåÊ≠•Âà∞È°πÁõÆÂ§±Ë¥•:",f);let w="ÂêåÊ≠•Âà∞È°πÁõÆÂ§±Ë¥•";return f.message?w=f.message:f.name==="TypeError"&&(w="ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•"),x.error({message:w,duration:5e3}),!1}finally{v.value=!1}},z=()=>{n.value=!1},C=I=>({technicalFile:"ÊäÄÊúØÈúÄÊ±ÇÊñá‰ª∂",tenderFile:"ÊãõÊ†áÊñáÊ°£",templateFile:"Â∫îÁ≠îÊ®°Êùø",businessResponseFile:"ÂïÜÂä°Â∫îÁ≠îÊñá‰ª∂",p2pResponseFile:"ÁÇπÂØπÁÇπÂ∫îÁ≠îÊñá‰ª∂",techProposalFile:"ÊäÄÊúØÊñπÊ°àÊñá‰ª∂"})[I]||"Êñá‰ª∂";return{useHitlFile:t,hitlFileInfo:c,hasHitlFile:F,syncing:v,synced:n,loadFromHITL:E,cancelHitlFile:p,syncToHitl:b,resetSyncStatus:z}}function me(e,r="YYYY-MM-DD"){return e?ie(e).format(r):""}function N(e,r=2){if(e==null||e===0)return"0 B";const d=1024,a=["B","KB","MB","GB","TB","PB"],t=Math.floor(Math.log(e)/Math.log(d));return`${(e/Math.pow(d,t)).toFixed(r)} ${a[t]}`}const ye={class:"stats-card"},pe={key:0,class:"stats-title"},_e={class:"stat-item"},ge={class:"stat-prefix"},he={class:"stat-suffix"},ve=H({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const r=e,d=[{key:"total_replacements",label:"ÊñáÊú¨ÊõøÊç¢",suffix:"Â§Ñ"},{key:"tables_processed",label:"Ë°®Ê†ºÂ§ÑÁêÜ",suffix:"‰∏™"},{key:"cells_filled",label:"ÂçïÂÖÉÊ†ºÂ°´ÂÖÖ",suffix:"‰∏™"},{key:"images_inserted",label:"ÂõæÁâáÊèíÂÖ•",suffix:"Âº†"}],a=Y(()=>r.statItems||d),t=c=>{const v=c.split(".");let n=r.stats;for(const F of v)if(n=n==null?void 0:n[F],n==null)break;return typeof n=="number"?n:0};return(c,v)=>{const n=j,F=O,E=P;return u(),S("div",ye,[e.title?(u(),S("h4",pe,y(e.title),1)):h("",!0),s(E,{gutter:e.gutter},{default:l(()=>[(u(!0),S(oe,null,re(a.value,p=>(u(),g(F,{key:p.key,span:e.span},{default:l(()=>[o("div",_e,[s(n,{title:p.label,value:t(p.key),precision:p.precision,"value-style":e.valueStyle},ce({_:2},[p.prefix?{name:"prefix",fn:l(()=>[o("span",ge,y(p.prefix),1)]),key:"0"}:void 0,p.suffix?{name:"suffix",fn:l(()=>[o("span",he,y(p.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),ke=M(ve,[["__scopeId","data-v-a61794d1"]]),we={class:"alert-content"},Fe={class:"file-info"},be={class:"file-details"},$e={class:"file-label"},Ce={class:"file-name"},Ie={key:0,class:"file-size"},Ee={class:"alert-actions"},xe=H({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"‰ΩøÁî®HITLÊñá‰ª∂:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"ÂèñÊ∂à‰ΩøÁî®"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:r}){const d=r,a=()=>{d("cancel")};return(t,c)=>{const v=L,n=R,F=V,E=U;return e.fileInfo?(u(),g(E,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:l(()=>[o("div",we,[o("div",Fe,[s(v,{class:"file-icon"},{default:l(()=>[s(k(D))]),_:1}),o("div",be,[o("span",$e,y(e.label),1),o("span",Ce,y(e.fileInfo.filename),1),e.fileInfo.file_size?(u(),S("span",Ie," ("+y(k(N)(e.fileInfo.file_size))+") ",1)):h("",!0),e.showTag?(u(),g(n,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:l(()=>[...c[0]||(c[0]=[m(" Â∑≤‰ªéÊäïÊ†áÈ°πÁõÆÂä†ËΩΩ ",-1)])]),_:1})):h("",!0)])]),o("div",Ee,[ue(t.$slots,"actions",{},()=>[e.showCancel?(u(),g(F,{key:0,type:"text",size:"small",onClick:a},{default:l(()=>[s(v,null,{default:l(()=>[s(k(A))]),_:1}),m(" "+y(e.cancelText),1)]),_:1})):h("",!0)],!0)])])]),_:3},8,["type"])):h("",!0)}}}),je=M(xe,[["__scopeId","data-v-1a132715"]]),Te={class:"history-files-panel"},Se={class:"card-header"},ze={class:"header-title"},Be={class:"current-file-content"},He={class:"history-actions"},Me={class:"collapse-header"},Le={class:"filename-cell"},De=H({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"ËØ•È°πÁõÆÂ∑≤ÊúâÁîüÊàêÊñá‰ª∂"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const r=T([]),d=a=>{if(!a)return"-";let t=a;try{t=decodeURIComponent(a)}catch{}const c=t.split("/");return c[c.length-1]||"-"};return(a,t)=>{const c=R,v=U,n=G,F=Q,E=W,p=L,b=V,z=J,C=se,I=le,$=ne,_=te,f=ee,w=ae;return u(),S("div",Te,[e.currentFile?(u(),g(z,{key:0,shadow:"never",class:"current-file-card"},{header:l(()=>[o("div",Se,[o("div",ze,[o("span",null,y(e.title||"üìÑ ËØ•È°πÁõÆÁöÑÁîüÊàêÊñá‰ª∂"),1),s(c,{type:"info"},{default:l(()=>[...t[6]||(t[6]=[m("ÂéÜÂè≤Êñá‰ª∂",-1)])]),_:1})])])]),default:l(()=>[o("div",Be,[s(v,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(u(),g(k(ke),{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):h("",!0),s(E,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:l(()=>[s(n,{label:"Êñá‰ª∂Âêç"},{default:l(()=>[m(y(d(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),s(n,{label:"‰∏ãËΩΩÂú∞ÂùÄ"},{default:l(()=>[s(F,{href:e.currentFile.downloadUrl,type:"primary"},{default:l(()=>[m(y(d(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),o("div",He,[e.showEditorOpen?(u(),g(b,{key:0,type:"primary",size:"large",onClick:t[0]||(t[0]=i=>a.$emit("openInEditor",e.currentFile))},{default:l(()=>[s(p,null,{default:l(()=>[s(k(X))]),_:1}),t[7]||(t[7]=m(" Âú®ÁºñËæëÂô®‰∏≠ÊâìÂºÄ ",-1))]),_:1})):h("",!0),s(b,{type:"primary",size:"large",icon:k(Z),onClick:t[1]||(t[1]=i=>a.$emit("preview",e.currentFile))},{default:l(()=>[...t[8]||(t[8]=[m(" È¢ÑËßàWord ",-1)])]),_:1},8,["icon"]),s(b,{type:"success",size:"large",icon:k(q),onClick:t[2]||(t[2]=i=>a.$emit("download",e.currentFile))},{default:l(()=>[...t[9]||(t[9]=[m(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(u(),g(b,{key:1,size:"large",icon:k(K),onClick:t[3]||(t[3]=i=>a.$emit("regenerate"))},{default:l(()=>[...t[10]||(t[10]=[m(" ÈáçÊñ∞ÁîüÊàê ",-1)])]),_:1},8,["icon"])):h("",!0)])])]),_:1})):h("",!0),e.historyFiles.length>0?(u(),g(f,{key:1,modelValue:r.value,"onUpdate:modelValue":t[5]||(t[5]=i=>r.value=i),class:"history-collapse"},{default:l(()=>[s(_,{name:"history"},{title:l(()=>[o("div",Me,[o("span",null,"üìÇ Êü•ÁúãÊâÄÊúâÂéÜÂè≤Â§ÑÁêÜÊñá‰ª∂ ("+y(e.historyFiles.length)+")",1),r.value.includes("history")?(u(),g(b,{key:0,type:"primary",size:"small",loading:e.loading,onClick:t[4]||(t[4]=fe(i=>a.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:l(()=>[...t[11]||(t[11]=[m(" Âà∑Êñ∞ÂàóË°® ",-1)])]),_:1},8,["loading"])):h("",!0)])]),default:l(()=>[s(z,{shadow:"never",style:{border:"none"}},{default:l(()=>[de((u(),g(I,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:l(()=>[s(C,{type:"index",label:"Â∫èÂè∑",width:"60"}),s(C,{prop:"filename",label:"Êñá‰ª∂Âêç","min-width":"300"},{default:l(({row:i})=>[o("div",Le,[s(p,null,{default:l(()=>[s(k(D))]),_:1}),o("span",null,y(i.filename),1)])]),_:1}),s(C,{prop:"size",label:"Êñá‰ª∂Â§ßÂ∞è",width:"120"},{default:l(({row:i})=>[m(y(k(N)(i.size)),1)]),_:1}),s(C,{prop:"process_time",label:"Â§ÑÁêÜÊó∂Èó¥",width:"180"},{default:l(({row:i})=>[m(y(k(me)(i.process_time||i.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),s(C,{label:"Êìç‰Ωú",width:"200",fixed:"right"},{default:l(({row:i})=>[s(b,{type:"primary",size:"small",onClick:B=>a.$emit("preview",i)},{default:l(()=>[...t[12]||(t[12]=[m(" È¢ÑËßà ",-1)])]),_:1},8,["onClick"]),s(b,{type:"success",size:"small",onClick:B=>a.$emit("download",i)},{default:l(()=>[...t[13]||(t[13]=[m(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[w,e.loading]]),!e.loading&&e.historyFiles.length===0?(u(),g($,{key:0,description:"ÊöÇÊó†ÂéÜÂè≤Êñá‰ª∂","image-size":100})):h("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])):h("",!0)])}}}),Ae=M(De,[["__scopeId","data-v-6e6ba197"]]);function Je(e,r){const d=typeof e=="string"?e:URL.createObjectURL(e),a=document.createElement("a");a.href=d,a.download=r,document.body.appendChild(a),a.click(),document.body.removeChild(a),typeof e!="string"&&URL.revokeObjectURL(d)}export{je as H,ke as S,Ae as a,Je as d,Oe as u};
