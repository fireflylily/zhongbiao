import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";import"./DocumentPreview.vue_vue_type_style_index_0_scoped_c8a3e4c1_lang-CvTZjc9R.js";import{a,E as l}from"./el-table-column-Jg32dLxM.js";import"./el-checkbox-D7AoGZX-.js";/* empty css                   */import"./el-scrollbar-CxZt4BCk.js";/* empty css               *//* empty css                */import{E as t,a as o}from"./el-form-item-B_TvUsZB.js";import{E as i,a as r}from"./el-select-bIavA1Zf.js";/* empty css                 */import{d as s,a as n,r as c,x as d,L as u,c as p,e as m,g as y,w as _,F as v,o as f,H as w,bw as b,t as h,bx as g,B as j,E as C,b9 as x,l as k,k as V,by as E,i as q}from"./index.js";import{L}from"./Loading-DdI__2QU.js";import{E as z}from"./Empty-B_GysxL4.js";import{C as D}from"./Card-n3WhZAJc.js";/* empty css                 */import"./el-alert-CXP7XODY.js";import{c as N}from"./company-DNfURC7c.js";import{E as U}from"./index-ELBiC1Q4.js";import{E as T}from"./index-TEIk0rR2.js";import{E as F}from"./index-DzZX4pf4.js";import{E as $}from"./index-_IbxD8AI.js";import"./_baseClone-DZAH0W8r.js";import"./omit-Czoq2i9Z.js";import"./castArray-pal66jBx.js";import"./raf-Bx50Y2cR.js";import"./strings-DTuDRpJG.js";import"./refs-Cw5r5QN8.js";const I={class:"company-library"},A={class:"stats-bar"},B={class:"stat-content"},M={class:"stat-icon"},O={class:"stat-info"},P={class:"stat-value"},R={class:"stat-content"},H={class:"stat-icon"},J={class:"stat-info"},K={class:"stat-value"},Q={class:"filter-section"},S={class:"qualification-progress"},G={class:"progress-text"},W=e(s({__name:"CompanyLibrary",setup(e){const s=q(),{success:W,error:X}=n(),Y=c(!1),Z=c([]),ee=c({keyword:"",industry:""}),ae=c(!1),le=c(!1),te=c(),oe=c({companyName:"",companyCode:"",industryType:"",companyDescription:""}),ie={companyName:[{required:!0,message:"请输入企业名称",trigger:"blur"},{min:2,max:100,message:"企业名称长度在 2 到 100 个字符",trigger:"blur"}]},re=d(()=>{let e=[...Z.value];if(ee.value.keyword){const a=ee.value.keyword.toLowerCase();e=e.filter(e=>{var l,t,o;return(null==(l=e.company_name)?void 0:l.toLowerCase().includes(a))||(null==(t=e.social_credit_code)?void 0:t.toLowerCase().includes(a))||(null==(o=e.company_code)?void 0:o.toLowerCase().includes(a))})}return ee.value.industry&&(e=e.filter(e=>e.industry_type===ee.value.industry)),e}),se=async()=>{Y.value=!0;try{const e=(await N.getCompanies()).data||[],a=await Promise.all(e.map(async e=>{let a=0;try{const l=await N.getCompanyQualifications(e.company_id);l.data&&(a=Object.keys(l.data).length)}catch(t){}const l=Math.round(a/17*100);return{company_id:e.company_id,company_name:e.company_name||"未命名",company_code:e.company_code||"",social_credit_code:e.social_credit_code||"-",legal_representative:e.legal_representative||"-",registered_capital:e.registered_capital||"-",employee_count:e.employee_count||"-",industry_type:e.industry_type||"",product_count:e.product_count||0,document_count:e.document_count||0,qualification_completed:a,qualification_total:17,qualification_progress:l,created_at:e.created_at||"-",updated_at:e.updated_at||"-",...e}}));Z.value=a}catch(e){X("加载失败",e instanceof Error?e.message:"未知错误")}finally{Y.value=!1}},ne=()=>{},ce=()=>{ee.value.keyword="",ee.value.industry=""},de=async()=>{te.value&&await te.value.validate(async e=>{if(e){le.value=!0;try{(await N.createCompany({name:oe.value.companyName,code:oe.value.companyCode||void 0,description:oe.value.companyDescription||void 0})).success&&(W("创建成功","企业创建成功"),ae.value=!1,await se())}catch(a){X("创建失败",a instanceof Error?a.message:"未知错误")}finally{le.value=!1}}})},ue=()=>{var e;oe.value={companyName:"",companyCode:"",industryType:"",companyDescription:""},null==(e=te.value)||e.resetFields()};return u(()=>{se()}),(e,n)=>{const c=w,d=U,u=C,q=o,pe=r,me=i,ye=k,_e=t,ve=a,fe=F,we=$,be=l,he=T;return f(),p("div",I,[m("div",A,[y(d,{class:"stat-card"},{default:_(()=>[m("div",B,[m("div",M,[y(c,{size:32,color:"#409eff"},{default:_(()=>[y(v(b))]),_:1})]),m("div",O,[n[8]||(n[8]=m("div",{class:"stat-label"},"总企业数",-1)),m("div",P,h(Z.value.length),1)])])]),_:1}),y(d,{class:"stat-card"},{default:_(()=>[m("div",R,[m("div",H,[y(c,{size:32,color:"#67c23a"},{default:_(()=>[y(v(g))]),_:1})]),m("div",J,[n[9]||(n[9]=m("div",{class:"stat-label"},"筛选结果",-1)),m("div",K,h(re.value.length),1)])])]),_:1})]),y(v(D),{title:"企业列表"},{default:_(()=>[m("div",Q,[y(_e,{inline:!0,model:ee.value},{default:_(()=>[y(q,{label:"搜索"},{default:_(()=>[y(u,{modelValue:ee.value.keyword,"onUpdate:modelValue":n[0]||(n[0]=e=>ee.value.keyword=e),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:ne},{prefix:_(()=>[y(c,null,{default:_(()=>[y(v(x))]),_:1})]),_:1},8,["modelValue"])]),_:1}),y(q,{label:"行业类型"},{default:_(()=>[y(me,{modelValue:ee.value.industry,"onUpdate:modelValue":n[1]||(n[1]=e=>ee.value.industry=e),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:ne},{default:_(()=>[y(pe,{label:"全部行业",value:""}),y(pe,{label:"科技",value:"technology"}),y(pe,{label:"制造业",value:"manufacturing"}),y(pe,{label:"金融",value:"finance"}),y(pe,{label:"教育",value:"education"}),y(pe,{label:"医疗",value:"healthcare"}),y(pe,{label:"零售",value:"retail"}),y(pe,{label:"建筑",value:"construction"}),y(pe,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),y(q,null,{default:_(()=>[y(ye,{onClick:ce},{default:_(()=>[y(c,null,{default:_(()=>[y(v(E))]),_:1}),n[10]||(n[10]=V(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),Y.value?(f(),j(v(L),{key:0,text:"加载中..."})):re.value.length?(f(),j(be,{key:2,data:re.value,stripe:"",style:{width:"100%"}},{default:_(()=>[y(ve,{prop:"company_id",label:"ID",width:"70",fixed:""}),y(ve,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),y(ve,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),y(ve,{prop:"legal_representative",label:"法定代表人",width:"120"}),y(ve,{prop:"registered_capital",label:"注册资本",width:"120"}),y(ve,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),y(ve,{label:"资质完成度",width:"180",align:"center"},{default:_(({row:e})=>{return[m("div",S,[y(fe,{percentage:e.qualification_progress||0,color:(a=e.qualification_progress||0,a<30?"#f56c6c":a<70?"#e6a23c":"#67c23a"),"stroke-width":8},null,8,["percentage","color"]),m("span",G,h(e.qualification_completed||0)+"/"+h(e.qualification_total||17),1)])];var a}),_:1}),y(ve,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:_(({row:e})=>[y(we,{size:"small",type:"info"},{default:_(()=>[V(h(e.product_count||0),1)]),_:2},1024)]),_:1}),y(ve,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:_(({row:e})=>[y(we,{size:"small",type:"success"},{default:_(()=>[V(h(e.document_count||0),1)]),_:2},1024)]),_:1}),y(ve,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),y(ve,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),y(ve,{label:"操作",width:"220",fixed:"right"},{default:_(({row:e})=>[y(ye,{text:"",type:"primary",size:"small",onClick:a=>(e=>{s.push(`/knowledge/company/${e.company_id}`)})(e)},{default:_(()=>[...n[11]||(n[11]=[V(" 查看详情 ",-1)])]),_:1},8,["onClick"]),y(ye,{text:"",type:"warning",size:"small",onClick:a=>(e=>{s.push(`/knowledge/company/${e.company_id}`)})(e)},{default:_(()=>[...n[12]||(n[12]=[V(" 编辑 ",-1)])]),_:1},8,["onClick"]),y(ye,{text:"",type:"danger",size:"small",onClick:a=>(async e=>{try{if(!confirm(`确定要删除企业 "${e.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`))return;await N.deleteCompany(e.company_id),W("删除成功",`已删除企业: ${e.company_name}`),await se()}catch(a){X("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:_(()=>[...n[13]||(n[13]=[V(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(f(),j(v(z),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1}),y(he,{modelValue:ae.value,"onUpdate:modelValue":n[7]||(n[7]=e=>ae.value=e),title:"新建企业",width:"500px",onClose:ue},{footer:_(()=>[y(ye,{onClick:n[6]||(n[6]=e=>ae.value=!1)},{default:_(()=>[...n[14]||(n[14]=[V("取消",-1)])]),_:1}),y(ye,{type:"primary",loading:le.value,onClick:de},{default:_(()=>[...n[15]||(n[15]=[V(" 确定 ",-1)])]),_:1},8,["loading"])]),default:_(()=>[y(_e,{ref_key:"createFormRef",ref:te,model:oe.value,rules:ie,"label-width":"120px"},{default:_(()=>[y(q,{label:"企业名称",prop:"companyName"},{default:_(()=>[y(u,{modelValue:oe.value.companyName,"onUpdate:modelValue":n[2]||(n[2]=e=>oe.value.companyName=e),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),y(q,{label:"企业代码",prop:"companyCode"},{default:_(()=>[y(u,{modelValue:oe.value.companyCode,"onUpdate:modelValue":n[3]||(n[3]=e=>oe.value.companyCode=e),placeholder:"请输入企业代码（可选）"},null,8,["modelValue"])]),_:1}),y(q,{label:"行业类型",prop:"industryType"},{default:_(()=>[y(me,{modelValue:oe.value.industryType,"onUpdate:modelValue":n[4]||(n[4]=e=>oe.value.industryType=e),placeholder:"请选择行业类型",style:{width:"100%"}},{default:_(()=>[y(pe,{label:"科技",value:"technology"}),y(pe,{label:"制造业",value:"manufacturing"}),y(pe,{label:"金融",value:"finance"}),y(pe,{label:"教育",value:"education"}),y(pe,{label:"医疗",value:"healthcare"}),y(pe,{label:"零售",value:"retail"}),y(pe,{label:"建筑",value:"construction"}),y(pe,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),y(q,{label:"企业简介",prop:"companyDescription"},{default:_(()=>[y(u,{modelValue:oe.value.companyDescription,"onUpdate:modelValue":n[5]||(n[5]=e=>oe.value.companyDescription=e),type:"textarea",rows:3,placeholder:"请输入企业简介（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-bc300562"]]);export{W as default};
