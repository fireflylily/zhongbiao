import{n as e,o as a,E as t,_ as l}from"./index.js";/* empty css                   */import{ap as o,am as s,an as n,aH as r,aq as i,ar as u,as as d,aI as m,av as v,aJ as c,at as p,ax as f,aK as y,aL as _}from"./editor-CZjPbfOV.js";import{v as h}from"./directive-Bx4Bncqq.js";/* empty css                                                                        */const w={"element-loading-text":"正在加载文档...",class:"preview-container"},g={key:1,class:"editor-preview-wrapper"},C=l(o({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"文档预览"},htmlContent:{default:""}},emits:["update:modelValue"],setup(l,{emit:o}){const C=l,V=o,j=s(!1),b=s(""),x=s(""),T=s(null),U=n({get:()=>C.modelValue,set:e=>V("update:modelValue",e)}),k=n(()=>`文档预览 - ${C.fileName||"未命名文档"}`),D=()=>{T.value&&x.value&&setTimeout(()=>{"function"==typeof T.value.setContent&&T.value.setContent(x.value)},300)},N=()=>{U.value=!1};return r(()=>C.modelValue,async e=>{e&&(C.fileUrl||C.htmlContent)?(await _(),(async()=>{if(C.htmlContent)x.value=C.htmlContent;else if(C.fileUrl){j.value=!0,b.value="";try{const e=await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:C.fileUrl})}),a=await e.json();if(!a.success||!a.html_content)throw new Error(a.error||"Word转HTML失败");x.value=a.html_content}catch(e){b.value=`文档预览失败: ${e.message||"未知错误"}`,t.error("文档预览失败，请检查文件是否正确或尝试下载后查看")}finally{j.value=!1}}else b.value="文档地址不能为空"})()):(b.value="",x.value="")}),(t,l)=>{const o=e,s=a,n=h;return u(),i(s,{modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value=e),title:k.value,width:"90%","before-close":N,"destroy-on-close":"",class:"document-preview-dialog"},{default:d(()=>[m((u(),v("div",w,[b.value?(u(),i(o,{key:0,type:"error",title:b.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):c("",!0),!b.value&&x.value?(u(),v("div",g,[p(f(y),{ref_key:"editorRef",ref:T,document:{readOnly:!0},onCreated:D},null,512)])):c("",!0)])),[[n,j.value]])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-62c282b6"]]);export{C as D};
