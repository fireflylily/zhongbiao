import{c as P,a3 as T,b as k,k as x}from"./element-plus-IkZgpaz4.js";import{m as U}from"./umo-editor-BmhDOXHm.js";import{bT as E,bt as r,bu as u,bA as N,b$ as m,bV as s,c0 as B,c1 as H,bU as d,c3 as v,c8 as L,bv as M,bH as O}from"./vendor-CdA3MjAt.js";/* empty css                                                                        */import{_ as $}from"./index.js";const j={"element-loading-text":"正在加载文档...",class:"preview-container"},A={key:1,class:"editor-preview-wrapper"},R=E({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"文档预览"},htmlContent:{default:""}},emits:["update:modelValue"],setup(f,{emit:p}){const e=f,_=p,i=r(!1),l=r(""),n=r(""),a=r(null),c=u({get:()=>e.modelValue,set:t=>_("update:modelValue",t)}),w=u(()=>`文档预览 - ${e.fileName||"未命名文档"}`),h=async()=>{if(e.htmlContent){console.log("[DocumentPreview] 使用HTML内容预览"),n.value=e.htmlContent;return}if(!e.fileUrl){l.value="文档地址不能为空";return}i.value=!0,l.value="";try{console.log("[DocumentPreview] 开始加载文档:",e.fileUrl);const o=await(await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:e.fileUrl})})).json();if(o.success&&o.html_content)n.value=o.html_content,console.log("[DocumentPreview] Word转HTML成功，长度:",o.html_content.length);else throw new Error(o.error||"Word转HTML失败");console.log("[DocumentPreview] 文档渲染成功")}catch(t){console.error("[DocumentPreview] 文档预览失败:",t),l.value=`文档预览失败: ${t.message||"未知错误"}`,x.error("文档预览失败，请检查文件是否正确或尝试下载后查看")}finally{i.value=!1}},g=()=>{console.log("[DocumentPreview] 编辑器已创建，设置内容..."),a.value&&n.value&&setTimeout(()=>{typeof a.value.setContent=="function"?(a.value.setContent(n.value),console.log("[DocumentPreview] 内容已设置，长度:",n.value.length)):console.error("[DocumentPreview] setContent方法不可用")},300)},b=()=>{c.value=!1};return N(()=>e.modelValue,async t=>{t&&(e.fileUrl||e.htmlContent)?(await O(),h()):(l.value="",n.value="")}),(t,o)=>{const y=P,C=k,D=T;return s(),m(C,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=V=>c.value=V),title:w.value,width:"90%","before-close":b,"destroy-on-close":"",class:"document-preview-dialog"},{default:B(()=>[H((s(),d("div",j,[l.value?(s(),m(y,{key:0,type:"error",title:l.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):v("",!0),!l.value&&n.value?(s(),d("div",A,[L(M(U),{ref_key:"editorRef",ref:a,document:{readOnly:!0},onCreated:g},null,512)])):v("",!0)])),[[D,i.value]])]),_:1},8,["modelValue","title"])}}}),z=$(R,[["__scopeId","data-v-62c282b6"]]);export{z as D};
