import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";import{a,E as t}from"./el-table-column-Jg32dLxM.js";import"./el-checkbox-D7AoGZX-.js";/* empty css                   */import"./el-scrollbar-CxZt4BCk.js";/* empty css               */import{d as l,r as s,a as i,L as r,c as o,g as n,w as c,F as p,o as m,B as d,e as u,k as _,l as f,i as y}from"./index.js";import{L as b}from"./Loading-DdI__2QU.js";import{E as h}from"./Empty-B_GysxL4.js";import"./DocumentPreview.vue_vue_type_style_index_0_scoped_c8a3e4c1_lang-CvTZjc9R.js";import{C as w}from"./Card-n3WhZAJc.js";/* empty css                *//* empty css                 */import"./el-alert-CXP7XODY.js";import{t as g}from"./tender-OU9NbYj0.js";import{c as j}from"./company-DNfURC7c.js";import{E as v}from"./index-_IbxD8AI.js";import"./_baseClone-DZAH0W8r.js";import"./omit-Czoq2i9Z.js";import"./castArray-pal66jBx.js";import"./raf-Bx50Y2cR.js";import"./index-DzZX4pf4.js";const k={class:"tender-management"},x=e(l({__name:"Management",setup(e){const l=s(!1),x=s(!1),z=s([]),C=y(),{success:E,error:D}=i(),P=async()=>{var e;l.value=!0;try{const a=await g.getProjects({page:1,page_size:100}),t=(null==(e=a.data)?void 0:e.items)||a.data||[];z.value=t.map(e=>({id:e.project_id,name:e.project_name,number:e.project_number,company_name:e.company_name,status:e.status,created_at:e.created_at,...e}))}catch(a){D("加载失败",a instanceof Error?a.message:"未知错误")}finally{l.value=!1}},L=async()=>{x.value=!0;try{const e=(await j.getCompanies()).data||[];if(0===e.length)return void D("无法创建项目：请先添加公司信息");const a=(await g.createProject({project_name:"新项目",project_number:`PRJ-${Date.now()}`,company_id:e[0].company_id})).project_id;E("创建成功"),C.push({name:"TenderManagementDetail",params:{id:a}})}catch(e){const a=e instanceof Error?e.message:"未知错误";D(`创建项目失败：${a}`)}finally{x.value=!1}};return r(()=>{P()}),(e,s)=>{const i=f,r=a,y=v,j=t;return m(),o("div",k,[n(p(w),{title:"项目列表"},{actions:c(()=>[n(i,{type:"primary",loading:x.value,onClick:L},{default:c(()=>[...s[0]||(s[0]=[u("i",{class:"bi bi-plus-lg"},null,-1),_(" 新建项目 ",-1)])]),_:1},8,["loading"])]),default:c(()=>[l.value?(m(),d(p(b),{key:0,text:"加载中..."})):z.value.length?(m(),d(j,{key:2,data:z.value,stripe:"",style:{width:"100%"}},{default:c(()=>[n(r,{prop:"id",label:"ID",width:"70",fixed:""}),n(r,{prop:"name",label:"项目名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),n(r,{prop:"company_name",label:"公司名称","min-width":"180","show-overflow-tooltip":""}),n(r,{prop:"authorized_person_name",label:"被授权人",width:"100"}),n(r,{label:"商务应答",width:"100",align:"center"},{default:c(({row:e})=>{return[(a=e,a.business_response_file||"completed"===a.business_response_status?(m(),d(y,{key:0,type:"success",size:"small"},{default:c(()=>[...s[1]||(s[1]=[u("i",{class:"bi bi-check-circle-fill"},null,-1),_(" 已生成 ",-1)])]),_:1})):(m(),d(y,{key:1,type:"info",size:"small"},{default:c(()=>[...s[2]||(s[2]=[u("i",{class:"bi bi-dash-circle"},null,-1),_(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),n(r,{label:"技术点对点",width:"110",align:"center"},{default:c(({row:e})=>{return[(a=e,a.point_to_point_file||"completed"===a.point_to_point_status?(m(),d(y,{key:0,type:"success",size:"small"},{default:c(()=>[...s[3]||(s[3]=[u("i",{class:"bi bi-check-circle-fill"},null,-1),_(" 已生成 ",-1)])]),_:1})):(m(),d(y,{key:1,type:"info",size:"small"},{default:c(()=>[...s[4]||(s[4]=[u("i",{class:"bi bi-dash-circle"},null,-1),_(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),n(r,{label:"技术方案",width:"100",align:"center"},{default:c(({row:e})=>{return[(a=e,a.tech_proposal_file||"completed"===a.tech_proposal_status||a.technical_data?(m(),d(y,{key:0,type:"success",size:"small"},{default:c(()=>[...s[5]||(s[5]=[u("i",{class:"bi bi-check-circle-fill"},null,-1),_(" 已生成 ",-1)])]),_:1})):(m(),d(y,{key:1,type:"info",size:"small"},{default:c(()=>[...s[6]||(s[6]=[u("i",{class:"bi bi-dash-circle"},null,-1),_(" 未生成 ",-1)])]),_:1})))];var a}),_:1}),n(r,{label:"最后融合",width:"100",align:"center"},{default:c(({row:e})=>{return[(a=e,a.final_merge_file||"completed"===a.merge_status?(m(),d(y,{key:0,type:"success",size:"small"},{default:c(()=>[...s[7]||(s[7]=[u("i",{class:"bi bi-check-circle-fill"},null,-1),_(" 已融合 ",-1)])]),_:1})):(m(),d(y,{key:1,type:"info",size:"small"},{default:c(()=>[...s[8]||(s[8]=[u("i",{class:"bi bi-dash-circle"},null,-1),_(" 未融合 ",-1)])]),_:1})))];var a}),_:1}),n(r,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:c(({row:e})=>["active"===e.status?(m(),d(y,{key:0,type:"success"},{default:c(()=>[...s[9]||(s[9]=[_("进行中",-1)])]),_:1})):"completed"===e.status?(m(),d(y,{key:1,type:"primary"},{default:c(()=>[...s[10]||(s[10]=[_("已完成",-1)])]),_:1})):(m(),d(y,{key:2,type:"info"},{default:c(()=>[...s[11]||(s[11]=[_("草稿",-1)])]),_:1}))]),_:1}),n(r,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),n(r,{label:"操作",width:"140",fixed:"right"},{default:c(({row:e})=>[n(i,{text:"",type:"primary",size:"small",onClick:a=>(e=>{C.push({name:"TenderManagementDetail",params:{id:e.id}})})(e)},{default:c(()=>[...s[12]||(s[12]=[_(" 查看 ",-1)])]),_:1},8,["onClick"]),n(i,{text:"",type:"danger",size:"small",onClick:a=>(async e=>{try{if(!confirm(`确定要删除项目 "${e.name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`))return;await g.deleteProject(e.id),E("删除成功",`已删除项目: ${e.name}`),await P()}catch(a){D("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:c(()=>[...s[13]||(s[13]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(m(),d(p(h),{key:1,type:"no-data",description:"暂无项目"}))]),_:1})])}}}),[["__scopeId","data-v-1849ad96"]]);export{x as default};
