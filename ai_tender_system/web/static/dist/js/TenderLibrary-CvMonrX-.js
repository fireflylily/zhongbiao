import{aA as e,T as a,aC as l,aE as t,aF as o,aG as s,aX as u,a6 as r,b0 as d,U as n,b1 as i,_ as c,$ as p,u as v,b2 as m,e as f,aL as _,aN as b,b3 as y,b4 as h,w as g,M as x,L as w,s as V,am as j,b5 as k,O as C,S as U,d as z,y as E,P as T,N as S,Q as $,R as B,h as I,G as D,q as M}from"./index.js";/* empty css                             */import{E as P}from"./el-date-picker-panel-DKPdkS07.js";/* empty css                     *//* empty css                                                                            *//* empty css                *//* empty css                    */import{a as F,E as L}from"./el-tab-pane-By4zK3XC.js";import{E as q}from"./el-pagination-xKYLvwnI.js";/* empty css               */import{E as A,a as H}from"./el-select-ke7UrdxB.js";/* empty css                */import{am as N,bQ as O,an as R,ao as Y,bH as G,bD as K,bV as Q,bC as W,ap as X,au as J,ar as Z,av as ee,az as ae,aA as le,aB as te,ay as oe,ax as se,as as ue,at as re,aq as de,aU as ne,aW as ie,aT as ce,aC as pe,bu as ve,aX as me,aw as fe,bw as _e,aD as be}from"./editor-CeUA3ax_.js";import{L as ye}from"./Loading-BYRlvOhH.js";import{E as he}from"./Empty-D7Fl5Zrw.js";/* empty css                                                        */import{_ as ge}from"./DocumentPreview.vue_vue_type_script_setup_true_lang-a28IOceM.js";/* empty css                   *//* empty css                */import{E as xe}from"./index-DE8f5ksc.js";import{E as we,a as Ve}from"./index-DIDzDbKq.js";import{E as je}from"./index-BISXlzby.js";import{E as ke}from"./index-BSM8fZi2.js";import{c as Ce}from"./clamp-BxJn91Q5.js";import{E as Ue}from"./index-DzjaNwmz.js";import{E as ze,a as Ee}from"./index-DpMZ9cG3.js";import"./advancedFormat-ZTlvfdMs.js";import"./index-B9zQDgNq.js";import"./index-BrzJahDp.js";import"./index-pPpeQHfX.js";import"./toNumber-CDEuZe1n.js";import"./raf-BZHcGSIv.js";import"./strings-twdxJQ8K.js";import"./_baseFindIndex-BTqrMG7V.js";import"./_baseIteratee-PtO-pneB.js";import"./index-DOCWmJkm.js";import"./index-CamumCgu.js";import"./directive-BH7c5R5q.js";import"./flatMap-K8MMJsz8.js";import"./map-BH6IylNP.js";import"./_baseEach-DGFkAtUh.js";import"./cloneDeep-syPWYH98.js";const Te=a({modelValue:{type:Number,default:0},id:{type:String,default:void 0},lowThreshold:{type:Number,default:2},highThreshold:{type:Number,default:4},max:{type:Number,default:5},colors:{type:r([Array,Object]),default:()=>u(["","",""])},voidColor:{type:String,default:""},disabledVoidColor:{type:String,default:""},icons:{type:r([Array,Object]),default:()=>[d,d,d]},voidIcon:{type:n,default:()=>i},disabledVoidIcon:{type:n,default:()=>d},disabled:Boolean,allowHalf:Boolean,showText:Boolean,showScore:Boolean,textColor:{type:String,default:""},texts:{type:r(Array),default:()=>u(["Extremely bad","Disappointed","Fair","Satisfied","Surprise"])},scoreTemplate:{type:String,default:"{value}"},size:s,clearable:Boolean,...o(["ariaLabel"])}),Se={[t]:a=>e(a),[l]:a=>e(a)},$e=N({name:"ElRate"});const Be=g(c(N({...$e,props:Te,emits:Se,setup(e,{expose:a,emit:o}){const s=e;function u(e,a){const l=e=>K(e),t=Object.keys(a).map(e=>+e).filter(t=>{const o=a[t];return!!l(o)&&o.excluded?e<t:e<=t}).sort((e,a)=>e-a),o=a[t[0]];return l(o)&&o.value||o}const r=O(y,void 0),d=O(h,void 0),n=p(),i=v("rate"),{inputId:c,isLabeledByFormItem:g}=m(s,{formItemContext:d}),x=R(s.modelValue),w=R(-1),V=R(!0),j=R([]),k=Y(()=>j.value.map(e=>e.$el.clientWidth)),C=Y(()=>[i.b(),i.m(n.value)]),U=Y(()=>s.disabled||(null==r?void 0:r.disabled)),z=Y(()=>i.cssVarBlock({"void-color":s.voidColor,"disabled-void-color":s.disabledVoidColor,"fill-color":$.value})),E=Y(()=>{let e="";return s.showScore?e=s.scoreTemplate.replace(/\{\s*value\s*\}/,U.value?`${s.modelValue}`:`${x.value}`):s.showText&&(e=s.texts[Math.ceil(x.value)-1]),e}),T=Y(()=>100*s.modelValue-100*Math.floor(s.modelValue)),S=Y(()=>G(s.colors)?{[s.lowThreshold]:s.colors[0],[s.highThreshold]:{value:s.colors[1],excluded:!0},[s.max]:s.colors[2]}:s.colors),$=Y(()=>{const e=u(x.value,S.value);return K(e)?"":e}),B=Y(()=>{let e="";return U.value?e=`${T.value}%`:s.allowHalf&&(e="50%"),{color:$.value,width:e}}),I=Y(()=>{let e=G(s.icons)?[...s.icons]:{...s.icons};return e=Q(e),G(e)?{[s.lowThreshold]:e[0],[s.highThreshold]:{value:e[1],excluded:!0},[s.max]:e[2]}:e}),D=Y(()=>u(s.modelValue,I.value)),M=Y(()=>U.value?W(s.disabledVoidIcon)?s.disabledVoidIcon:Q(s.disabledVoidIcon):W(s.voidIcon)?s.voidIcon:Q(s.voidIcon)),P=Y(()=>u(x.value,I.value));function F(e){const a=U.value&&T.value>0&&e-1<s.modelValue&&e>s.modelValue,l=s.allowHalf&&V.value&&e-.5<=x.value&&e>x.value;return a||l}function L(e){s.clearable&&e===s.modelValue&&(e=0),o(l,e),s.modelValue!==e&&o(t,e)}function q(e){if(U.value)return;const a=_(e),u=s.allowHalf?.5:1;let r=x.value;switch(a){case b.up:case b.right:r+=u;break;case b.left:case b.down:r-=u}return r=Ce(r,0,s.max),r!==x.value?(e.stopPropagation(),e.preventDefault(),o(l,r),o(t,r),r):void 0}function A(e,a){U.value||(s.allowHalf&&a?(V.value=2*a.offsetX<=k.value[e-1],x.value=V.value?e-.5:e):x.value=e,w.value=e)}function H(){U.value||(s.allowHalf&&(V.value=s.modelValue!==Math.floor(s.modelValue)),x.value=s.modelValue,w.value=-1)}return X(()=>s.modelValue,e=>{x.value=e,V.value=s.modelValue!==Math.floor(s.modelValue)}),s.modelValue||o(l,0),a({setCurrentValue:A,resetCurrentValue:H}),(e,a)=>{var l;return Z(),J("div",{id:oe(c),class:te([oe(C),oe(i).is("disabled",oe(U))]),role:"slider","aria-label":oe(g)?void 0:e.ariaLabel||"rating","aria-labelledby":oe(g)?null==(l=oe(d))?void 0:l.labelId:void 0,"aria-valuenow":x.value,"aria-valuetext":oe(E)||void 0,"aria-valuemin":"0","aria-valuemax":e.max,tabindex:"0",style:ce(oe(z)),onKeydown:q},[(Z(!0),J(ae,null,le(e.max,(e,a)=>(Z(),J("span",{key:a,class:te(oe(i).e("item")),onMousemove:a=>A(e,a),onMouseleave:H,onClick:a=>{return l=e,void(U.value||(s.allowHalf&&V.value?L(x.value):L(l)));var l}},[se(oe(f),{ref_for:!0,ref_key:"iconRefs",ref:j,class:te([oe(i).e("icon"),{hover:w.value===e},oe(i).is("active",e<=x.value),oe(i).is("focus-visible",e===Math.ceil(x.value||1))])},{default:ue(()=>[re((Z(),de(ne(oe(P)),null,null,512)),[[ie,!F(e)&&e<=x.value]]),re((Z(),de(ne(oe(M)),null,null,512)),[[ie,!F(e)&&e>x.value]]),re((Z(),de(ne(oe(M)),{class:te([oe(i).em("decimal","box")])},null,8,["class"])),[[ie,F(e)]]),re(se(oe(f),{style:ce(oe(B)),class:te([oe(i).e("icon"),oe(i).e("decimal")])},{default:ue(()=>[(Z(),de(ne(oe(D))))]),_:2},1032,["style","class"]),[[ie,F(e)]])]),_:2},1032,["class"])],42,["onMousemove","onClick"]))),128)),e.showText||e.showScore?(Z(),J("span",{key:0,class:te(oe(i).e("text")),style:ce({color:e.textColor})},pe(oe(E)),7)):ee("v-if",!0)],46,["id","aria-label","aria-labelledby","aria-valuenow","aria-valuetext","aria-valuemax"])}}}),[["__file","rate.vue"]])),Ie={class:"tender-library"},De={class:"stats-bar"},Me={class:"stat-content"},Pe={class:"stat-icon docs"},Fe={class:"stat-info"},Le={class:"stat-value"},qe={class:"stat-content"},Ae={class:"stat-icon excerpts"},He={class:"stat-info"},Ne={class:"stat-value"},Oe={class:"stat-content"},Re={class:"stat-icon won"},Ye={class:"stat-info"},Ge={class:"stat-value"},Ke={class:"tab-toolbar"},Qe={key:3,class:"pagination-wrapper"},We={class:"tab-toolbar"},Xe={key:2,class:"excerpts-list"},Je={class:"excerpt-header"},Ze={class:"excerpt-title"},ea={class:"chapter-title"},aa={class:"excerpt-meta"},la={class:"doc-name"},ta={class:"excerpt-content"},oa={class:"excerpt-footer"},sa={class:"excerpt-tags"},ua={class:"excerpt-actions"},ra={key:3,class:"pagination-wrapper"},da={class:"excerpt-full-content"},na={class:"content-box"},ia="/api/tender-library",ca=M(N({__name:"TenderLibrary",setup(e){const{success:a,error:l}=x(),t=w(),o=Y(()=>t.currentCompanyId||1),s=ve({docCount:0,excerptCount:0,wonCount:0}),u=R("documents"),r=R(!1),d=R([]),n=R(""),i=R(""),c=R(1),p=R(10),v=R(0),m=R(!1),_=R([]),b=R(""),y=R(""),h=R(!1),g=R(1),M=R(10),N=R(0),O=R(!1),G=R(),K=R(),Q=ve({file:null,project_name:"",bid_result:"待定",bid_date:"",notes:""}),W={project_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},te=R(!1),re=R(!1),ne=R(""),ie=R(""),ce=R(!1),Ce=ve({tender_doc_id:null,project_name:"",bid_result:"",bid_date:"",notes:""}),Te=R(!1),Se=R(!1),$e=R("view"),ca=R(null),pa=ve({excerpt_id:null,chapter_title:"",category:"",quality_score:0,tags:"",content:""}),va=async()=>{r.value=!0;try{const e=new URLSearchParams({company_id:String(o.value),page:String(c.value),page_size:String(p.value)});n.value&&e.append("keyword",n.value),i.value&&e.append("bid_result",i.value);const a=await fetch(`${ia}/documents?${e}`),t=await a.json();t.success?(d.value=t.data||[],v.value=t.total||0,s.docCount=v.value,s.wonCount=d.value.filter(e=>"中标"===e.bid_result).length):l("加载失败",t.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{r.value=!1}},ma=async()=>{m.value=!0;try{const e=new URLSearchParams({company_id:String(o.value),page:String(g.value),page_size:String(M.value)});b.value&&e.append("keyword",b.value),y.value&&e.append("category",y.value),h.value&&e.append("won_only","true");const a=await fetch(`${ia}/excerpts?${e}`),t=await a.json();t.success?(_.value=t.data||[],N.value=t.total||0,s.excerptCount=N.value):l("加载失败",t.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{m.value=!1}},fa=()=>{Q.file=null,Q.project_name="",Q.bid_result="待定",Q.bid_date="",Q.notes="",G.value&&G.value.clearFiles(),O.value=!0},_a=(e,a)=>{e&&e.raw&&(Q.file=e.raw)},ba=()=>{Q.file=null},ya=async()=>{if(Q.file){te.value=!0;try{const e=new FormData;e.append("file",Q.file),e.append("company_id",String(o.value)),e.append("project_name",Q.project_name),e.append("bid_result",Q.bid_result),Q.bid_date&&e.append("bid_date",Q.bid_date),Q.notes&&e.append("notes",Q.notes);const t=await fetch(`${ia}/documents/upload`,{method:"POST",body:e}),s=await t.json();s.success?(a("上传成功",s.message),O.value=!1,va()):l("上传失败",s.error||"未知错误")}catch(e){l("上传失败",e instanceof Error?e.message:"未知错误")}finally{te.value=!1}}else l("请选择文件")},ha=async()=>{Te.value=!0;try{const e=await fetch(`${ia}/documents/${Ce.tender_doc_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ce)}),t=await e.json();t.success?(a("保存成功"),ce.value=!1,va()):l("保存失败",t.error||"未知错误")}catch(e){l("保存失败",e instanceof Error?e.message:"未知错误")}finally{Te.value=!1}},ga=async()=>{Te.value=!0;try{const e=await fetch(`${ia}/excerpts/${pa.excerpt_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(pa)}),t=await e.json();t.success?(a("保存成功"),Se.value=!1,ma()):l("保存失败",t.error||"未知错误")}catch(e){l("保存失败",e instanceof Error?e.message:"未知错误")}finally{Te.value=!1}},xa=e=>"中标"===e?"success":"未中标"===e?"danger":"info";return me(()=>{va(),ma()}),X(u,e=>{"documents"===e?va():ma()}),X(o,()=>{va(),ma()}),(e,t)=>{const o=f,x=xe,w=C,R=H,Y=A,X=z,ve=Ve,me=je,wa=we,Va=q,ja=F,ka=ke,Ca=Be,Ua=L,za=Ue,Ea=S,Ta=B,Sa=$,$a=P,Ba=T,Ia=I,Da=Ee,Ma=ze;return Z(),J("div",Ie,[fe("div",De,[se(x,{class:"stat-card"},{default:ue(()=>[fe("div",Me,[fe("div",Pe,[se(o,{size:32,color:"#409eff"},{default:ue(()=>[se(oe(V))]),_:1})]),fe("div",Fe,[t[31]||(t[31]=fe("div",{class:"stat-label"},"标书文档",-1)),fe("div",Le,pe(s.docCount),1)])])]),_:1}),se(x,{class:"stat-card"},{default:ue(()=>[fe("div",qe,[fe("div",Ae,[se(o,{size:32,color:"#67c23a"},{default:ue(()=>[se(oe(j))]),_:1})]),fe("div",He,[t[32]||(t[32]=fe("div",{class:"stat-label"},"素材片段",-1)),fe("div",Ne,pe(s.excerptCount),1)])])]),_:1}),se(x,{class:"stat-card"},{default:ue(()=>[fe("div",Oe,[fe("div",Re,[se(o,{size:32,color:"#e6a23c"},{default:ue(()=>[se(oe(k))]),_:1})]),fe("div",Ye,[t[33]||(t[33]=fe("div",{class:"stat-label"},"中标标书",-1)),fe("div",Ge,pe(s.wonCount),1)])])]),_:1})]),se(Ua,{modelValue:u.value,"onUpdate:modelValue":t[9]||(t[9]=e=>u.value=e),type:"border-card"},{default:ue(()=>[se(ja,{label:"标书文档",name:"documents"},{default:ue(()=>[fe("div",Ke,[se(w,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),placeholder:"搜索文档名称...",clearable:"",style:{width:"200px"},onKeyup:_e(va,["enter"])},{prefix:ue(()=>[se(o,null,{default:ue(()=>[se(oe(U))]),_:1})]),_:1},8,["modelValue"]),se(Y,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),placeholder:"投标结果",clearable:"",style:{width:"120px"},onChange:va},{default:ue(()=>[se(R,{label:"全部",value:""}),se(R,{label:"中标",value:"中标"}),se(R,{label:"未中标",value:"未中标"}),se(R,{label:"待定",value:"待定"})]),_:1},8,["modelValue"]),se(X,{type:"primary",onClick:fa},{default:ue(()=>[se(o,null,{default:ue(()=>[se(oe(E))]),_:1}),t[34]||(t[34]=be(" 上传标书 ",-1))]),_:1})]),r.value?(Z(),de(oe(ye),{key:0,text:"加载中..."})):d.value.length?(Z(),de(wa,{key:2,data:d.value,stripe:""},{default:ue(()=>[se(ve,{prop:"doc_name",label:"文档名称","min-width":"200","show-overflow-tooltip":""}),se(ve,{prop:"project_name",label:"项目名称",width:"180","show-overflow-tooltip":""}),se(ve,{prop:"bid_result",label:"投标结果",width:"100",align:"center"},{default:ue(({row:e})=>[se(me,{type:xa(e.bid_result)},{default:ue(()=>[be(pe(e.bid_result||"待定"),1)]),_:2},1032,["type"])]),_:1}),se(ve,{prop:"excerpt_count",label:"片段数",width:"80",align:"center"}),se(ve,{prop:"bid_date",label:"投标日期",width:"120"}),se(ve,{prop:"created_at",label:"上传时间",width:"160"}),se(ve,{label:"操作",width:"200",fixed:"right"},{default:ue(({row:e})=>[se(X,{link:"",type:"primary",size:"small",onClick:a=>{return l=e,ne.value=l.file_path||"",ie.value=l.doc_name||"文档预览",void(re.value=!0);var l}},{default:ue(()=>[...t[35]||(t[35]=[be(" 查看 ",-1)])]),_:1},8,["onClick"]),se(X,{link:"",type:"success",size:"small",onClick:t=>(async e=>{try{await D.confirm(`确定要从 "${e.doc_name}" 提取素材片段吗？`,"提取素材",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"})}catch{return}try{const t=await fetch(`${ia}/documents/${e.tender_doc_id}/extract`,{method:"POST"}),o=await t.json();o.success?(a("提取完成",`成功提取 ${o.extracted_count||0} 个片段`),va(),ma()):l("提取失败",o.error||"未知错误")}catch(t){l("提取失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:ue(()=>[...t[36]||(t[36]=[be(" 提取 ",-1)])]),_:1},8,["onClick"]),se(X,{link:"",type:"warning",size:"small",onClick:a=>{return l=e,Ce.tender_doc_id=l.tender_doc_id,Ce.project_name=l.project_name||"",Ce.bid_result=l.bid_result||"待定",Ce.bid_date=l.bid_date||"",Ce.notes=l.notes||"",void(ce.value=!0);var l}},{default:ue(()=>[...t[37]||(t[37]=[be(" 编辑 ",-1)])]),_:1},8,["onClick"]),se(X,{link:"",type:"danger",size:"small",onClick:t=>(async e=>{try{await D.confirm(`确定要删除 "${e.doc_name}" 吗？关联的素材片段也会被删除。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${ia}/documents/${e.tender_doc_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功"),va(),ma()):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:ue(()=>[...t[38]||(t[38]=[be(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(Z(),de(oe(he),{key:1,type:"no-data",description:"暂无标书文档"})),v.value>p.value?(Z(),J("div",Qe,[se(Va,{"current-page":c.value,"onUpdate:currentPage":t[2]||(t[2]=e=>c.value=e),"page-size":p.value,"onUpdate:pageSize":t[3]||(t[3]=e=>p.value=e),total:v.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:va,onCurrentChange:va},null,8,["current-page","page-size","total"])])):ee("",!0)]),_:1}),se(ja,{label:"素材片段",name:"excerpts"},{default:ue(()=>[fe("div",We,[se(w,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=e=>b.value=e),placeholder:"搜索素材内容...",clearable:"",style:{width:"250px"},onKeyup:_e(ma,["enter"])},{prefix:ue(()=>[se(o,null,{default:ue(()=>[se(oe(U))]),_:1})]),_:1},8,["modelValue"]),se(Y,{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=e=>y.value=e),placeholder:"分类",clearable:"",style:{width:"120px"},onChange:ma},{default:ue(()=>[se(R,{label:"全部",value:""}),se(R,{label:"技术方案",value:"技术方案"}),se(R,{label:"项目管理",value:"项目管理"}),se(R,{label:"售后服务",value:"售后服务"}),se(R,{label:"企业资质",value:"企业资质"}),se(R,{label:"团队介绍",value:"团队介绍"}),se(R,{label:"其他",value:"其他"})]),_:1},8,["modelValue"]),se(ka,{modelValue:h.value,"onUpdate:modelValue":t[6]||(t[6]=e=>h.value=e),onChange:ma},{default:ue(()=>[...t[39]||(t[39]=[be("仅中标",-1)])]),_:1},8,["modelValue"])]),m.value?(Z(),de(oe(ye),{key:0,text:"加载中..."})):_.value.length?(Z(),J("div",Xe,[(Z(!0),J(ae,null,le(_.value,e=>(Z(),de(x,{key:e.excerpt_id,class:"excerpt-card",shadow:"hover"},{header:ue(()=>{return[fe("div",Je,[fe("div",Ze,[fe("span",ea,pe(e.chapter_title||"无标题"),1),se(me,{size:"small",type:(a=e.category,{"技术方案":"primary","项目管理":"success","售后服务":"warning","企业资质":"info","团队介绍":"","其他":"info"}[a]||"info")},{default:ue(()=>[be(pe(e.category||"未分类"),1)]),_:2},1032,["type"]),"中标"===e.bid_result?(Z(),de(me,{key:0,size:"small",type:"success"},{default:ue(()=>[...t[40]||(t[40]=[be(" 中标 ",-1)])]),_:1})):ee("",!0)]),fe("div",aa,[fe("span",la,pe(e.doc_name),1),se(Ca,{modelValue:e.quality_score,"onUpdate:modelValue":a=>e.quality_score=a,disabled:"",max:5,size:"small",colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue","onUpdate:modelValue"])])])];var a}),default:ue(()=>{var o,s;return[fe("div",ta,pe(null==(o=e.content)?void 0:o.substring(0,300))+pe((null==(s=e.content)?void 0:s.length)>300?"...":""),1),fe("div",oa,[fe("div",sa,[(Z(!0),J(ae,null,le((e.tags||"").split(",").filter(Boolean).slice(0,3),e=>(Z(),de(me,{key:e,size:"small",type:"info"},{default:ue(()=>[be(pe(e),1)]),_:2},1024))),128))]),fe("div",ua,[se(X,{link:"",type:"primary",size:"small",onClick:a=>(e=>{ca.value=e,$e.value="view",Se.value=!0})(e)},{default:ue(()=>[...t[41]||(t[41]=[be(" 查看全文 ",-1)])]),_:1},8,["onClick"]),se(X,{link:"",type:"primary",size:"small",onClick:t=>(async e=>{try{await navigator.clipboard.writeText(e.content||""),a("已复制到剪贴板")}catch(t){l("复制失败")}})(e)},{default:ue(()=>[...t[42]||(t[42]=[be(" 复制 ",-1)])]),_:1},8,["onClick"]),se(X,{link:"",type:"warning",size:"small",onClick:a=>(e=>{ca.value=e,pa.excerpt_id=e.excerpt_id,pa.chapter_title=e.chapter_title||"",pa.category=e.category||"",pa.quality_score=e.quality_score||0,pa.tags=e.tags||"",pa.content=e.content||"",$e.value="edit",Se.value=!0})(e)},{default:ue(()=>[...t[43]||(t[43]=[be(" 编辑 ",-1)])]),_:1},8,["onClick"]),se(X,{link:"",type:"danger",size:"small",onClick:t=>(async e=>{try{await D.confirm(`确定要删除素材片段 "${e.chapter_title||"未命名"}" 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${ia}/excerpts/${e.excerpt_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功"),ma()):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:ue(()=>[...t[44]||(t[44]=[be(" 删除 ",-1)])]),_:1},8,["onClick"])])])]}),_:2},1024))),128))])):(Z(),de(oe(he),{key:1,type:"no-data",description:"暂无素材片段"})),N.value>M.value?(Z(),J("div",ra,[se(Va,{"current-page":g.value,"onUpdate:currentPage":t[7]||(t[7]=e=>g.value=e),"page-size":M.value,"onUpdate:pageSize":t[8]||(t[8]=e=>M.value=e),total:N.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:ma,onCurrentChange:ma},null,8,["current-page","page-size","total"])])):ee("",!0)]),_:1})]),_:1},8,["modelValue"]),se(Ia,{modelValue:O.value,"onUpdate:modelValue":t[15]||(t[15]=e=>O.value=e),title:"上传标书文档",width:"600px"},{footer:ue(()=>[se(X,{onClick:t[14]||(t[14]=e=>O.value=!1)},{default:ue(()=>[...t[50]||(t[50]=[be("取消",-1)])]),_:1}),se(X,{type:"primary",onClick:ya,loading:te.value},{default:ue(()=>[...t[51]||(t[51]=[be(" 上传 ",-1)])]),_:1},8,["loading"])]),default:ue(()=>[se(Ba,{model:Q,rules:W,ref_key:"uploadFormRef",ref:K,"label-width":"100px"},{default:ue(()=>[se(Ea,{label:"文档文件",prop:"file"},{default:ue(()=>[se(za,{ref_key:"uploadRef",ref:G,"auto-upload":!1,limit:1,"on-change":_a,"on-remove":ba,accept:".docx,.doc,.pdf"},{trigger:ue(()=>[se(X,{type:"primary"},{default:ue(()=>[...t[45]||(t[45]=[be("选择文件",-1)])]),_:1})]),tip:ue(()=>[...t[46]||(t[46]=[fe("div",{class:"el-upload__tip"},"支持 .docx, .doc, .pdf 格式",-1)])]),_:1},512)]),_:1}),se(Ea,{label:"项目名称",prop:"project_name"},{default:ue(()=>[se(w,{modelValue:Q.project_name,"onUpdate:modelValue":t[10]||(t[10]=e=>Q.project_name=e),placeholder:"投标项目名称"},null,8,["modelValue"])]),_:1}),se(Ea,{label:"投标结果",prop:"bid_result"},{default:ue(()=>[se(Sa,{modelValue:Q.bid_result,"onUpdate:modelValue":t[11]||(t[11]=e=>Q.bid_result=e)},{default:ue(()=>[se(Ta,{label:"中标"},{default:ue(()=>[...t[47]||(t[47]=[be("中标",-1)])]),_:1}),se(Ta,{label:"未中标"},{default:ue(()=>[...t[48]||(t[48]=[be("未中标",-1)])]),_:1}),se(Ta,{label:"待定"},{default:ue(()=>[...t[49]||(t[49]=[be("待定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),se(Ea,{label:"投标日期",prop:"bid_date"},{default:ue(()=>[se($a,{modelValue:Q.bid_date,"onUpdate:modelValue":t[12]||(t[12]=e=>Q.bid_date=e),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),se(Ea,{label:"备注",prop:"notes"},{default:ue(()=>[se(w,{modelValue:Q.notes,"onUpdate:modelValue":t[13]||(t[13]=e=>Q.notes=e),type:"textarea",rows:2,placeholder:"可选备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),se(Ia,{modelValue:ce.value,"onUpdate:modelValue":t[21]||(t[21]=e=>ce.value=e),title:"编辑标书信息",width:"500px"},{footer:ue(()=>[se(X,{onClick:t[20]||(t[20]=e=>ce.value=!1)},{default:ue(()=>[...t[55]||(t[55]=[be("取消",-1)])]),_:1}),se(X,{type:"primary",onClick:ha,loading:Te.value},{default:ue(()=>[...t[56]||(t[56]=[be(" 保存 ",-1)])]),_:1},8,["loading"])]),default:ue(()=>[se(Ba,{model:Ce,"label-width":"100px"},{default:ue(()=>[se(Ea,{label:"项目名称"},{default:ue(()=>[se(w,{modelValue:Ce.project_name,"onUpdate:modelValue":t[16]||(t[16]=e=>Ce.project_name=e)},null,8,["modelValue"])]),_:1}),se(Ea,{label:"投标结果"},{default:ue(()=>[se(Sa,{modelValue:Ce.bid_result,"onUpdate:modelValue":t[17]||(t[17]=e=>Ce.bid_result=e)},{default:ue(()=>[se(Ta,{label:"中标"},{default:ue(()=>[...t[52]||(t[52]=[be("中标",-1)])]),_:1}),se(Ta,{label:"未中标"},{default:ue(()=>[...t[53]||(t[53]=[be("未中标",-1)])]),_:1}),se(Ta,{label:"待定"},{default:ue(()=>[...t[54]||(t[54]=[be("待定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),se(Ea,{label:"投标日期"},{default:ue(()=>[se($a,{modelValue:Ce.bid_date,"onUpdate:modelValue":t[18]||(t[18]=e=>Ce.bid_date=e),type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),se(Ea,{label:"备注"},{default:ue(()=>[se(w,{modelValue:Ce.notes,"onUpdate:modelValue":t[19]||(t[19]=e=>Ce.notes=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),se(Ia,{modelValue:Se.value,"onUpdate:modelValue":t[29]||(t[29]=e=>Se.value=e),title:"view"===$e.value?"素材详情":"编辑素材",width:"700px"},{footer:ue(()=>[se(X,{onClick:t[27]||(t[27]=e=>Se.value=!1)},{default:ue(()=>[...t[58]||(t[58]=[be("关闭",-1)])]),_:1}),"view"===$e.value?(Z(),de(X,{key:0,type:"primary",onClick:t[28]||(t[28]=e=>$e.value="edit")},{default:ue(()=>[...t[59]||(t[59]=[be(" 编辑 ",-1)])]),_:1})):(Z(),de(X,{key:1,type:"primary",onClick:ga,loading:Te.value},{default:ue(()=>[...t[60]||(t[60]=[be(" 保存 ",-1)])]),_:1},8,["loading"]))]),default:ue(()=>{var e;return["view"===$e.value?(Z(),J(ae,{key:0},[se(Ma,{column:2,border:""},{default:ue(()=>[se(Da,{label:"章节标题",span:2},{default:ue(()=>{var e;return[be(pe(null==(e=ca.value)?void 0:e.chapter_title),1)]}),_:1}),se(Da,{label:"分类"},{default:ue(()=>{var e;return[be(pe((null==(e=ca.value)?void 0:e.category)||"未分类"),1)]}),_:1}),se(Da,{label:"质量评分"},{default:ue(()=>{var e;return[se(Ca,{"model-value":null==(e=ca.value)?void 0:e.quality_score,disabled:"",max:5},null,8,["model-value"])]}),_:1}),se(Da,{label:"来源文档",span:2},{default:ue(()=>{var e;return[be(pe(null==(e=ca.value)?void 0:e.doc_name),1)]}),_:1}),se(Da,{label:"投标结果"},{default:ue(()=>{var e;return[se(me,{type:xa(null==(e=ca.value)?void 0:e.bid_result)},{default:ue(()=>{var e;return[be(pe((null==(e=ca.value)?void 0:e.bid_result)||"待定"),1)]}),_:1},8,["type"])]}),_:1}),se(Da,{label:"标签"},{default:ue(()=>{var e;return[be(pe((null==(e=ca.value)?void 0:e.tags)||"无"),1)]}),_:1})]),_:1}),fe("div",da,[t[57]||(t[57]=fe("h4",null,"素材内容",-1)),fe("div",na,pe(null==(e=ca.value)?void 0:e.content),1)])],64)):(Z(),de(Ba,{key:1,model:pa,"label-width":"100px"},{default:ue(()=>[se(Ea,{label:"章节标题"},{default:ue(()=>[se(w,{modelValue:pa.chapter_title,"onUpdate:modelValue":t[22]||(t[22]=e=>pa.chapter_title=e)},null,8,["modelValue"])]),_:1}),se(Ea,{label:"分类"},{default:ue(()=>[se(Y,{modelValue:pa.category,"onUpdate:modelValue":t[23]||(t[23]=e=>pa.category=e),style:{width:"100%"}},{default:ue(()=>[se(R,{label:"技术方案",value:"技术方案"}),se(R,{label:"项目管理",value:"项目管理"}),se(R,{label:"售后服务",value:"售后服务"}),se(R,{label:"企业资质",value:"企业资质"}),se(R,{label:"团队介绍",value:"团队介绍"}),se(R,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),se(Ea,{label:"质量评分"},{default:ue(()=>[se(Ca,{modelValue:pa.quality_score,"onUpdate:modelValue":t[24]||(t[24]=e=>pa.quality_score=e),max:5},null,8,["modelValue"])]),_:1}),se(Ea,{label:"标签"},{default:ue(()=>[se(w,{modelValue:pa.tags,"onUpdate:modelValue":t[25]||(t[25]=e=>pa.tags=e),placeholder:"逗号分隔的标签"},null,8,["modelValue"])]),_:1}),se(Ea,{label:"内容"},{default:ue(()=>[se(w,{modelValue:pa.content,"onUpdate:modelValue":t[26]||(t[26]=e=>pa.content=e),type:"textarea",rows:10},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]))]}),_:1},8,["modelValue","title"]),se(ge,{modelValue:re.value,"onUpdate:modelValue":t[30]||(t[30]=e=>re.value=e),"file-url":ne.value,"file-name":ie.value},null,8,["modelValue","file-url","file-name"])])}}}),[["__scopeId","data-v-e529bb72"]]);export{ca as default};
