import{O as e,$ as l,l as a,u as s,bi as t,a0 as i,al as o,w as u,aR as c,o as n,h as r,L as d,bj as p,E as v,b9 as m,_,aN as f,p as b}from"./index.js";/* empty css                             *//* empty css                                                                          *//* empty css               */import{E as y,a as h}from"./el-select-Cn9sh8Qz.js";/* empty css                     */import{L as k}from"./Loading-BAlD57pu.js";import{P as g}from"./PageHeader-DbQlj86k.js";/* empty css                                                                        */import{ax as j,aD as x,aA as w,az as z,aE as V,aG as F,aO as I,bD as P,am as C,aX as D,ay as E,c4 as $,aJ as R,aV as S,aW as U,aF as q,aK as B,c9 as N,an as T,aP as L,aS as W,aR as O,aB as H}from"./editor-6w6Zv5fp.js";/* empty css                   *//* empty css                    *//* empty css                */import{E as J}from"./index-Cdh5ckaS.js";import{E as M}from"./index-DnERDalw.js";import{E as A}from"./index-BWGjdaux.js";import{E as K,a as G}from"./index-Dk7xzYl3.js";import{E as Q}from"./index-BGe3Lza-.js";import{u as X}from"./useProjectDocuments-pheytPkm.js";import{u as Y}from"./project-CG0CT_fq.js";import{E as Z}from"./index-y0eMMvEO.js";import{E as ee}from"./index-DuYxzNPz.js";import"./strings-DTOtcONx.js";import"./toNumber-ue2IRhKK.js";import"./_baseIteratee-BmMFd7Ls.js";/* empty css                                                                   */import"./tender-ZYcn_VXM.js";const le=e({animated:Boolean,count:{type:Number,default:1},rows:{type:Number,default:3},loading:{type:Boolean,default:!0},throttle:{type:l([Number,Object])}}),ae=e({variant:{type:String,values:["circle","rect","h1","h3","text","caption","p","image","button"],default:"text"}}),se=j({name:"ElSkeletonItem"});var te=a(j({...se,props:ae,setup(e){const l=s("skeleton");return(e,a)=>(w(),x("div",{class:I([F(l).e("item"),F(l).e(e.variant)])},["image"===e.variant?(w(),z(F(t),{key:0})):V("v-if",!0)],2))}}),[["__file","skeleton-item.vue"]]);const ie=j({name:"ElSkeleton"});const oe=u(a(j({...ie,props:le,setup(e,{expose:l}){const a=e,t=s("skeleton"),u=((e,l=0)=>{if(0===l)return e;const a=P(l)&&Boolean(l.initVal),s=C(a);let t=null;const u=l=>{o(l)?s.value=e.value:(t&&clearTimeout(t),t=setTimeout(()=>{s.value=e.value},l))},c=e=>{"leading"===e?i(l)?u(l):u(l.leading):P(l)?u(l.trailing):s.value=!1};return D(()=>c("leading")),E(()=>e.value,e=>{c(e?"leading":"trailing")}),s})($(a,"loading"),a.throttle);return l({uiLoading:u}),(e,l)=>F(u)?(w(),x("div",B({key:0,class:[F(t).b(),F(t).is("animated",e.animated)]},e.$attrs),[(w(!0),x(S,null,U(e.count,l=>(w(),x(S,{key:l},[F(u)?R(e.$slots,"template",{key:l},()=>[q(te,{class:I(F(t).is("first")),variant:"p"},null,8,["class"]),(w(!0),x(S,null,U(e.rows,l=>(w(),z(te,{key:l,class:I([F(t).e("paragraph"),F(t).is("last",l===e.rows&&e.rows>1)]),variant:"p"},null,8,["class"]))),128))]):V("v-if",!0)],64))),128))],16)):R(e.$slots,"default",N(B({key:1},e.$attrs)))}}),[["__file","skeleton.vue"]]),{SkeletonItem:te});c(te);const ue={class:"document-merge-panel"},ce={class:"merge-section"},ne={class:"files-status"},re={class:"status-icon"},de={key:0,class:"bi bi-check-circle-fill text-success"},pe={key:1,class:"bi bi-x-circle-fill text-danger"},ve={class:"file-info"},me={class:"file-name"},_e={class:"file-meta"},fe={key:1,class:"text-muted"},be={key:0,class:"file-actions"},ye={class:"status-icon"},he={key:0,class:"bi bi-check-circle-fill text-success"},ke={key:1,class:"bi bi-dash-circle text-warning"},ge={class:"file-info"},je={class:"file-name"},xe={class:"file-meta"},we={key:1,class:"text-muted"},ze={key:0,class:"file-actions"},Ve={class:"status-icon"},Fe={key:0,class:"bi bi-check-circle-fill text-success"},Ie={key:1,class:"bi bi-x-circle-fill text-danger"},Pe={class:"file-info"},Ce={class:"file-name"},De={class:"file-meta"},Ee={key:1,class:"text-muted"},$e={key:0,class:"file-actions"},Re={key:0},Se={key:1},Ue={key:0,class:"merge-section"},qe={class:"config-group"},Be={class:"doc-order-list"},Ne={class:"doc-order-item fixed"},Te={key:0,class:"doc-order-item"},Le={class:"doc-order-item"},We={class:"order-number"},Oe={class:"config-group"},He={class:"options-list"},Je={class:"config-group"},Me={class:"index-template-preview"},Ae={class:"score-items-preview"},Ke={class:"config-group"},Ge={key:1,class:"merge-section"},Qe={key:0,class:"action-area"},Xe={key:1,class:"merge-progress"},Ye={class:"progress-message"},Ze={class:"progress-details"},el={key:0,class:"current"},ll={key:2,class:"merge-result"},al={class:"result-info"},sl={class:"stats-list"},tl={key:0},il={key:1},ol={key:2},ul={class:"processing-details"},cl={key:0},nl={key:1},rl={key:2},dl={key:3},pl={class:"action-buttons"},vl=_(j({__name:"DocumentMergePanel",props:{projectId:{},currentDocuments:{}},setup(e){const l=e,a=C(!0),s=C({}),t=C({required:!1,type:"none"}),i=C({include_p2p:!0,doc_order:["business","p2p","tech"],generate_toc:!0,remove_blanks:!0,unify_styles:!0,add_section_breaks:!0,output_filename:""}),o=C(!1),u=C(!1),c=C(0),_=C(""),f=C(""),b=C(""),y=C([]),h=C(null),k=C(!0),g=T(()=>s.value.business&&s.value.tech),j=async()=>{var e,a;try{u.value=!0;const e={business:s.value.business.file_path,tech:s.value.tech.file_path};i.value.include_p2p&&s.value.p2p&&(e.p2p=s.value.p2p.file_path);const a=await p.post(`/api/projects/${l.projectId}/merge-documents`,{file_paths:e,config:{...i.value,index_config:t.value}});if(a.data.success){const e=a.data.task_id||l.projectId;o.value=!0,u.value=!1,F(e)}}catch(c){v.error((null==(a=null==(e=c.response)?void 0:e.data)?void 0:a.error)||"启动整合失败"),u.value=!1}},F=e=>{const l=new EventSource(`/api/merge-status/${e}`);l.onmessage=e=>{try{const a=JSON.parse(e.data);if(c.value=a.progress_percentage||0,f.value=a.current_step||"",a.current_step&&!y.value.includes(a.current_step)&&(b.value&&y.value.push(b.value),b.value=a.current_step),"completed"===a.overall_status){if(_.value="success",c.value=100,a.options){const e="string"==typeof a.options?JSON.parse(a.options):a.options;h.value={filename:i.value.output_filename+".docx",file_path:e.merged_document_path,file_size:e.file_size||0,stats:e.stats,created_at:(new Date).toLocaleString("zh-CN")}}o.value=!1,l.close(),v.success("文档整合完成！")}else"failed"===a.overall_status&&(_.value="exception",o.value=!1,l.close(),v.error("文档整合失败："+a.current_step))}catch(a){}},l.onerror=()=>{l.close(),o.value&&(v.error("进度监听中断"),o.value=!1)}},P=()=>{m.confirm("确定要重新整合吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.value=null,c.value=0,_.value="",f.value="",b.value="",y.value=[]}).catch(()=>{})},E=e=>{if(!e)return"";if(e.startsWith("/api/"))return e;let l=e;const a="/Users/lvhe/Downloads/zhongbiao/zhongbiao/";return l.startsWith(a)&&(l=l.substring(42)),l.startsWith("ai_tender_system/data/")?l=l.substring(22):l.startsWith("data/")&&(l=l.substring(5)),`/api/files/serve/${l}`},$=()=>{var e;if(null==(e=h.value)?void 0:e.file_path){const e=E(h.value.file_path)+"?download=true";window.open(e,"_blank")}},R=()=>{var e;if(null==(e=h.value)?void 0:e.file_path){const e=E(h.value.file_path);window.open(e,"_blank")}},B=()=>{var e;(null==(e=h.value)?void 0:e.file_path)&&(v.success("正在打开编辑器..."),v.info("编辑功能开发中..."))},N=e=>{const l=s.value[e];if(null==l?void 0:l.file_path){const e=E(l.file_path);window.open(e,"_blank")}},X=e=>e?e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":(e/1048576).toFixed(2)+" MB":"--";return D(()=>{(async()=>{var e,o,u,c,n,r;try{if(a.value=!0,l.currentDocuments){const t=l.currentDocuments;return s.value={},t.businessResponseFile&&(s.value.business={status:"ready",file_path:t.businessResponseFile.outputFile,file_name:(null==(e=t.businessResponseFile.outputFile)?void 0:e.split("/").pop())||"商务应答文件.docx",file_size:(null==(o=t.businessResponseFile.stats)?void 0:o.file_size)||0}),t.p2pResponseFile&&(s.value.p2p={status:"ready",file_path:t.p2pResponseFile.outputFile,file_name:(null==(u=t.p2pResponseFile.outputFile)?void 0:u.split("/").pop())||"点对点应答文件.docx",file_size:(null==(c=t.p2pResponseFile.stats)?void 0:c.file_size)||0}),t.techProposalFile&&(s.value.tech={status:"ready",file_path:t.techProposalFile.outputFile,file_name:(null==(n=t.techProposalFile.outputFile)?void 0:n.split("/").pop())||"技术方案文件.docx",file_size:(null==(r=t.techProposalFile.stats)?void 0:r.file_size)||0}),i.value={include_p2p:!!s.value.p2p,doc_order:s.value.p2p?["business","p2p","tech"]:["business","tech"],generate_toc:!0,remove_blanks:!0,unify_styles:!0,add_section_breaks:!0,output_filename:`项目${l.projectId}_最终标书`},void(a.value=!1)}const d=await p.get(`/api/projects/${l.projectId}/merge-config`);if(d.data.success){const e=d.data.data;s.value=e.files||{},t.value=e.index_requirement||{required:!1,type:"none"},e.default_config&&(i.value={...e.default_config})}}catch(d){v.error("加载配置失败")}finally{a.value=!1}})()}),(e,l)=>{const p=oe,v=n,m=r,F=J,C=M,D=d,E=A,T=G,Y=K,Z=Q;return w(),x("div",ue,[a.value?(w(),z(p,{key:0,rows:10,animated:""})):(w(),x(S,{key:1},[L("section",ce,[l[18]||(l[18]=L("div",{class:"section-header"},[L("h3",null,[L("i",{class:"bi bi-file-check"}),W(" 步骤 1/3：文件状态检查")])],-1)),L("div",ne,[L("div",{class:I(["file-status-item",{"file-ready":s.value.business}])},[L("div",re,[s.value.business?(w(),x("i",de)):(w(),x("i",pe))]),L("div",ve,[l[11]||(l[11]=L("h4",null,"商务应答文件",-1)),s.value.business?(w(),x(S,{key:0},[L("p",me,O(s.value.business.file_name),1),L("p",_e,O(X(s.value.business.file_size)),1)],64)):(w(),x("p",fe,"未生成"))]),s.value.business?(w(),x("div",be,[q(v,{size:"small",onClick:l[0]||(l[0]=e=>N("business"))},{default:H(()=>[...l[12]||(l[12]=[L("i",{class:"bi bi-eye"},null,-1),W(" 预览 ",-1)])]),_:1})])):V("",!0)],2),L("div",{class:I(["file-status-item",{"file-ready":s.value.p2p}])},[L("div",ye,[s.value.p2p?(w(),x("i",he)):(w(),x("i",ke))]),L("div",ge,[l[13]||(l[13]=L("h4",null,"技术点对点应答",-1)),s.value.p2p?(w(),x(S,{key:0},[L("p",je,O(s.value.p2p.file_name),1),L("p",xe,O(X(s.value.p2p.file_size)),1)],64)):(w(),x("p",we,"未生成（可选）"))]),s.value.p2p?(w(),x("div",ze,[q(v,{size:"small",onClick:l[1]||(l[1]=e=>N("p2p"))},{default:H(()=>[...l[14]||(l[14]=[L("i",{class:"bi bi-eye"},null,-1),W(" 预览 ",-1)])]),_:1})])):V("",!0)],2),L("div",{class:I(["file-status-item",{"file-ready":s.value.tech}])},[L("div",Ve,[s.value.tech?(w(),x("i",Fe)):(w(),x("i",Ie))]),L("div",Pe,[l[15]||(l[15]=L("h4",null,"技术方案文件",-1)),s.value.tech?(w(),x(S,{key:0},[L("p",Ce,O(s.value.tech.file_name),1),L("p",De,O(X(s.value.tech.file_size)),1)],64)):(w(),x("p",Ee,"未生成"))]),s.value.tech?(w(),x("div",$e,[q(v,{size:"small",onClick:l[2]||(l[2]=e=>N("tech"))},{default:H(()=>[...l[16]||(l[16]=[L("i",{class:"bi bi-eye"},null,-1),W(" 预览 ",-1)])]),_:1})])):V("",!0)],2)]),g.value?V("",!0):(w(),z(m,{key:0,type:"warning",closable:!1,"show-icon":"",class:"mt-3"},{title:H(()=>[...l[17]||(l[17]=[W(" 无法整合：缺少必需的文件 ",-1)])]),default:H(()=>[s.value.business?V("",!0):(w(),x("p",Re,"• 商务应答文件未生成，请先完成商务应答")),s.value.tech?V("",!0):(w(),x("p",Se,"• 技术方案文件未生成，请先完成技术方案"))]),_:1}))]),g.value?(w(),x("section",Ue,[l[42]||(l[42]=L("div",{class:"section-header"},[L("h3",null,[L("i",{class:"bi bi-sliders"}),W(" 步骤 2/3：整合配置")])],-1)),L("div",qe,[l[27]||(l[27]=L("h4",null,[L("i",{class:"bi bi-files"}),W(" 文档组成与顺序")],-1)),L("div",Be,[L("div",Ne,[l[20]||(l[20]=L("span",{class:"order-number"},"1",-1)),l[21]||(l[21]=L("span",{class:"doc-name"},"商务应答",-1)),q(F,{size:"small",type:"info"},{default:H(()=>[...l[19]||(l[19]=[W("固定第一部分",-1)])]),_:1})]),s.value.p2p?(w(),x("div",Te,[l[23]||(l[23]=L("span",{class:"order-number"},"2",-1)),l[24]||(l[24]=L("span",{class:"doc-name"},"点对点应答",-1)),q(C,{modelValue:i.value.include_p2p,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.include_p2p=e)},{default:H(()=>[...l[22]||(l[22]=[W("包含此部分",-1)])]),_:1},8,["modelValue"])])):V("",!0),L("div",Le,[L("span",We,O(s.value.p2p?"3":"2"),1),l[26]||(l[26]=L("span",{class:"doc-name"},"技术方案",-1)),q(F,{size:"small",type:"success"},{default:H(()=>[...l[25]||(l[25]=[W("✓ 包含",-1)])]),_:1})])])]),L("div",Oe,[l[32]||(l[32]=L("h4",null,[L("i",{class:"bi bi-palette"}),W(" 格式与目录选项")],-1)),L("div",He,[q(C,{modelValue:i.value.generate_toc,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.generate_toc=e)},{default:H(()=>[...l[28]||(l[28]=[W(" 自动生成目录（基于1-3级标题，带页码） ",-1)])]),_:1},8,["modelValue"]),q(C,{modelValue:i.value.remove_blanks,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.remove_blanks=e)},{default:H(()=>[...l[29]||(l[29]=[W(" 删除空白页和空白段落 ",-1)])]),_:1},8,["modelValue"]),q(C,{modelValue:i.value.unify_styles,"onUpdate:modelValue":l[6]||(l[6]=e=>i.value.unify_styles=e)},{default:H(()=>[...l[30]||(l[30]=[W(" 统一页眉页脚格式 ",-1)])]),_:1},8,["modelValue"]),q(C,{modelValue:i.value.add_section_breaks,"onUpdate:modelValue":l[7]||(l[7]=e=>i.value.add_section_breaks=e)},{default:H(()=>[...l[31]||(l[31]=[W(" 每部分间添加分节符 ",-1)])]),_:1},8,["modelValue"])])]),L("div",Je,[l[39]||(l[39]=L("h4",null,[L("i",{class:"bi bi-list-ol"}),W(" 索引设置")],-1)),t.value.required?"fixed_format"===t.value.type?(w(),z(m,{key:1,type:"warning",closable:!1,"show-icon":""},{title:H(()=>[...l[34]||(l[34]=[W(" 招标文件要求提供固定格式索引 ",-1)])]),default:H(()=>[L("div",Me,[L("pre",null,O(t.value.template),1)]),q(C,{modelValue:k.value,"onUpdate:modelValue":l[8]||(l[8]=e=>k.value=e),disabled:"",checked:""},{default:H(()=>[...l[35]||(l[35]=[W(" 自动生成索引（必需） ",-1)])]),_:1},8,["modelValue"])]),_:1})):"score_based"===t.value.type?(w(),z(m,{key:2,type:"success",closable:!1,"show-icon":""},{title:H(()=>[...l[36]||(l[36]=[W(" 招标文件要求以评分标准建立索引 ",-1)])]),default:H(()=>[L("div",Ae,[l[37]||(l[37]=L("p",null,"将基于以下评分项生成索引：",-1)),L("ul",null,[(w(!0),x(S,null,U(t.value.score_items,e=>(w(),x("li",{key:e},O(e),1))),128))])]),q(C,{modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=e=>k.value=e),disabled:"",checked:""},{default:H(()=>[...l[38]||(l[38]=[W(" 自动生成评分标准索引（必需） ",-1)])]),_:1},8,["modelValue"])]),_:1})):V("",!0):(w(),z(m,{key:0,type:"info",closable:!1,"show-icon":""},{title:H(()=>[...l[33]||(l[33]=[W(" 招标文件未要求提供索引，无需生成 ",-1)])]),_:1}))]),L("div",Ke,[l[41]||(l[41]=L("h4",null,[L("i",{class:"bi bi-file-earmark-text"}),W(" 文档名称")],-1)),q(D,{modelValue:i.value.output_filename,"onUpdate:modelValue":l[10]||(l[10]=e=>i.value.output_filename=e),placeholder:"请输入最终标书文件名",maxlength:"100","show-word-limit":""},{suffix:H(()=>[...l[40]||(l[40]=[W(".docx",-1)])]),_:1},8,["modelValue"])])])):V("",!0),g.value?(w(),x("section",Ge,[l[58]||(l[58]=L("div",{class:"section-header"},[L("h3",null,[L("i",{class:"bi bi-rocket-takeoff"}),W(" 步骤 3/3：开始整合")])],-1)),o.value||h.value?V("",!0):(w(),x("div",Qe,[q(v,{type:"primary",size:"large",loading:u.value,onClick:j},{default:H(()=>[...l[43]||(l[43]=[L("i",{class:"bi bi-play-fill"},null,-1),W(" 开始整合 ",-1)])]),_:1},8,["loading"])])),o.value?(w(),x("div",Xe,[q(E,{percentage:c.value,status:_.value},null,8,["percentage","status"]),L("p",Ye,O(f.value),1),L("div",Ze,[l[46]||(l[46]=L("h5",null,"处理详情：",-1)),L("ul",null,[(w(!0),x(S,null,U(y.value,(e,a)=>(w(),x("li",{key:a,class:"completed"},[l[44]||(l[44]=L("i",{class:"bi bi-check-circle-fill"},null,-1)),W(" "+O(e),1)]))),128)),b.value?(w(),x("li",el,[l[45]||(l[45]=L("i",{class:"bi bi-arrow-right-circle-fill"},null,-1)),W(" "+O(b.value),1)])):V("",!0)])])])):V("",!0),h.value?(w(),x("div",ll,[q(Z,{icon:"success",title:"整合完成！","sub-title":"您的最终标书已生成"},{extra:H(()=>{var e,a,s,o,u,c;return[L("div",al,[l[55]||(l[55]=L("h4",null,[L("i",{class:"bi bi-file-earmark-check"}),W(" 文件信息")],-1)),q(Y,{column:2,border:""},{default:H(()=>[q(T,{label:"文件名"},{default:H(()=>[W(O(h.value.filename),1)]),_:1}),q(T,{label:"文件大小"},{default:H(()=>[W(O(X(h.value.file_size)),1)]),_:1}),q(T,{label:"总页数"},{default:H(()=>{var e;return[W(O((null==(e=h.value.stats)?void 0:e.total_pages)||"--")+" 页 ",1)]}),_:1}),q(T,{label:"生成时间"},{default:H(()=>[W(O(h.value.created_at),1)]),_:1})]),_:1}),l[56]||(l[56]=L("h4",{class:"mt-3"},[L("i",{class:"bi bi-bar-chart"}),W(" 文件组成统计")],-1)),L("ul",sl,[(null==(e=h.value.stats)?void 0:e.toc_pages)?(w(),x("li",tl," 目录："+O(h.value.stats.toc_pages)+" 页 ",1)):V("",!0),L("li",null,"商务应答："+O((null==(a=h.value.stats)?void 0:a.business_pages)||"--")+" 页",1),i.value.include_p2p?(w(),x("li",il," 点对点应答："+O((null==(s=h.value.stats)?void 0:s.p2p_pages)||"--")+" 页 ",1)):V("",!0),L("li",null,"技术方案："+O((null==(o=h.value.stats)?void 0:o.tech_pages)||"--")+" 页",1),(null==(u=h.value.stats)?void 0:u.index_pages)?(w(),x("li",ol," 索引："+O(h.value.stats.index_pages)+" 页 ",1)):V("",!0)]),l[57]||(l[57]=L("h4",{class:"mt-3"},[L("i",{class:"bi bi-tools"}),W(" 处理详情")],-1)),L("ul",ul,[(null==(c=h.value.stats)?void 0:c.removed_blanks)?(w(),x("li",cl,[l[47]||(l[47]=L("i",{class:"bi bi-check-circle text-success"},null,-1)),W(" 已删除 "+O(h.value.stats.removed_blanks)+" 个空白段落 ",1)])):V("",!0),i.value.generate_toc?(w(),x("li",nl,[...l[48]||(l[48]=[L("i",{class:"bi bi-check-circle text-success"},null,-1),W(" 已生成多级目录 ",-1)])])):V("",!0),t.value.required?(w(),x("li",rl,[l[49]||(l[49]=L("i",{class:"bi bi-check-circle text-success"},null,-1)),W(" 已生成"+O("score_based"===t.value.type?"评分标准":"固定格式")+"索引 ",1)])):V("",!0),i.value.unify_styles?(w(),x("li",dl,[...l[50]||(l[50]=[L("i",{class:"bi bi-check-circle text-success"},null,-1),W(" 已统一页眉页脚 ",-1)])])):V("",!0)]),L("div",pl,[q(v,{type:"primary",size:"large",onClick:$},{default:H(()=>[...l[51]||(l[51]=[L("i",{class:"bi bi-download"},null,-1),W(" 下载Word版 ",-1)])]),_:1}),q(v,{type:"success",size:"large",onClick:R},{default:H(()=>[...l[52]||(l[52]=[L("i",{class:"bi bi-eye"},null,-1),W(" 在线预览 ",-1)])]),_:1}),q(v,{type:"warning",size:"large",onClick:B},{default:H(()=>[...l[53]||(l[53]=[L("i",{class:"bi bi-pencil-square"},null,-1),W(" 在线编辑 ",-1)])]),_:1}),q(v,{size:"large",onClick:P},{default:H(()=>[...l[54]||(l[54]=[L("i",{class:"bi bi-arrow-clockwise"},null,-1),W(" 重新整合 ",-1)])]),_:1})])])]}),_:1})])):V("",!0)])):V("",!0)],64))])}}}),[["__scopeId","data-v-4f5ce16e"]]),ml={class:"final-tender-page"},_l={class:"selector-content"},fl={class:"project-option"},bl={class:"project-name"},yl={class:"project-status"},hl={class:"project-info"},kl={class:"project-header"},gl={class:"project-meta"},jl=_(j({__name:"FinalTender",setup(e){const l=f(),a=b();Y();const{projects:s,loading:t,selectedProject:i,currentDocuments:o,hasProjects:u,loadProjects:c,handleProjectChange:r,restoreProjectFromStore:d}=X(),p=C({projectId:null}),m=async()=>{await r(p.value.projectId,{onClear:()=>{},onDocumentsLoaded:e=>{const l=!!e.businessResponseFile,a=!!e.techProposalFile;l&&a||v.warning("该项目缺少商务应答或技术方案文件，无法整合")}}),p.value.projectId&&a.replace({name:"FinalTender",query:{projectId:p.value.projectId.toString()}})},_=()=>{p.value.projectId=null,a.replace({name:"FinalTender"})},j=()=>{c()};return D(async()=>{await c();const e=await d({onClear:()=>{},onDocumentsLoaded:e=>{}});e&&(p.value.projectId=e);const a=l.query.projectId;if(a&&!e){const e=Number(a);s.value.some(l=>l.id===e)&&(p.value.projectId=e,await m())}}),(e,l)=>{const a=n,c=J,r=h,d=y,v=Z,f=ee;return w(),x("div",ml,[q(F(g),{title:"最终标书","show-back":!1},{actions:H(()=>[q(a,{onClick:j},{default:H(()=>[...l[2]||(l[2]=[L("i",{class:"bi bi-arrow-clockwise"},null,-1),W(" 刷新 ",-1)])]),_:1})]),_:1}),F(t)?(w(),z(F(k),{key:0,text:"加载项目列表..."})):(w(),x(S,{key:1},[p.value.projectId?V("",!0):(w(),z(f,{key:0,class:"project-selector-card",shadow:"never"},{default:H(()=>[L("div",_l,[l[4]||(l[4]=L("div",{class:"selector-icon"},[L("i",{class:"bi bi-folder2-open"})],-1)),l[5]||(l[5]=L("h3",null,"请选择要整合的项目",-1)),l[6]||(l[6]=L("p",{class:"text-muted"}," 从下方列表中选择一个已完成商务应答和技术方案的项目 ",-1)),q(d,{modelValue:p.value.projectId,"onUpdate:modelValue":l[0]||(l[0]=e=>p.value.projectId=e),placeholder:"选择项目",size:"large",filterable:"",class:"project-select",onChange:m},{default:H(()=>[(w(!0),x(S,null,U(F(s),e=>(w(),z(r,{key:e.id,label:`${e.project_name} (${e.project_number||"-"})`,value:e.id},{default:H(()=>[L("div",fl,[L("span",bl,O(e.project_name),1),L("div",yl,[q(c,{type:"info",size:"small"},{default:H(()=>[W(O(e.company_name),1)]),_:2},1024)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),F(u)?V("",!0):(w(),z(v,{key:0,description:"暂无项目","image-size":120},{extra:H(()=>[q(a,{type:"primary",onClick:l[1]||(l[1]=l=>e.$router.push({name:"TenderManagement"}))},{default:H(()=>[...l[3]||(l[3]=[L("i",{class:"bi bi-folder-plus"},null,-1),W(" 前往项目管理 ",-1)])]),_:1})]),_:1}))])]),_:1})),p.value.projectId&&F(i)?(w(),x(S,{key:1},[q(f,{class:"current-project-card",shadow:"never"},{default:H(()=>[L("div",hl,[L("div",kl,[L("h3",null,[l[7]||(l[7]=L("i",{class:"bi bi-folder-check"},null,-1)),W(" "+O(F(i).project_name),1)]),q(a,{size:"small",text:"",onClick:_},{default:H(()=>[...l[8]||(l[8]=[L("i",{class:"bi bi-arrow-left-right"},null,-1),W(" 切换项目 ",-1)])]),_:1})]),L("p",gl," 公司："+O(F(i).company_name)+" | 项目编号："+O(F(i).project_number||"-")+" | 创建时间："+O(F(i).created_at),1)])]),_:1}),(w(),z(vl,{"project-id":p.value.projectId,"current-documents":F(o),key:p.value.projectId},null,8,["project-id","current-documents"]))],64)):V("",!0)],64))])}}}),[["__scopeId","data-v-a7f77f31"]]);export{jl as default};
