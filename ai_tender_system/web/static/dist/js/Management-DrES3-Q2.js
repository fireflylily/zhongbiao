import{J as H,K as J,n as F,M as G,p as K,L as q,a as O}from"./element-plus-IkZgpaz4.js";import{bT as Q,bt as d,gi as W,bG as X,bU as C,bV as s,c8 as l,c0 as a,b$ as o,c3 as Z,bv as y,c5 as i,c6 as z,bY as m,cu as ee}from"./vendor-CdA3MjAt.js";import{L as te}from"./Loading-CmykbBZp.js";import{E as ae}from"./Empty-BNVBwC0L.js";/* empty css                                                                          */import{C as ne}from"./Card-BYP2BB2j.js";import{I as T}from"./IconButton-Dlyej4ti.js";import"./umo-editor-BmhDOXHm.js";/* empty css                                                                        */import{a as se,_ as le}from"./index.js";import{t as w}from"./tender-2TSD_jRl.js";import{c as oe}from"./company-B1QhkZBS.js";import"./onnxruntime-DkHy2lK3.js";import"./mermaid-e-fO57px.js";import"./echarts-Cqw1j_Z-.js";const ie={class:"tender-management"},re={key:0},pe={key:3,class:"pagination-wrapper"},ce=Q({__name:"Management",setup(ue){const k=d(!1),v=d(!1),f=d([]),_=d(1),g=d(10),E=d(0),x=W(),{success:P,error:h}=se(),b=async()=>{var t,e;k.value=!0;try{const p=await w.getProjects({page:_.value,page_size:g.value}),r=((t=p.data)==null?void 0:t.items)||p.data||[];f.value=r.map(c=>({id:c.project_id,name:c.project_name,number:c.project_number,company_name:c.company_name,status:c.status,created_at:c.created_at,...c})),E.value=((e=p.data)==null?void 0:e.total)||f.value.length}catch(p){console.error("加载项目列表失败:",p),h("加载失败",p instanceof Error?p.message:"未知错误")}finally{k.value=!1}},$=t=>t.business_response_file||t.business_response_status==="completed",B=t=>t.point_to_point_file||t.point_to_point_status==="completed",V=t=>t.tech_proposal_file||t.tech_proposal_status==="completed"||!!t.technical_data,I=t=>t.final_merge_file||t.merge_status==="completed",D=t=>{x.push({name:"TenderManagementDetail",params:{id:t.id}})},N=async t=>{try{if(!confirm(`确定要删除项目 "${t.name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`))return;await w.deleteProject(t.id),P("删除成功",`已删除项目: ${t.name}`),await b()}catch(e){console.error("删除项目失败:",e),h("删除失败",e instanceof Error?e.message:"未知错误")}},R=async()=>{v.value=!0;try{const e=(await oe.getCompanies()).data||[],p={project_name:"新项目",project_number:`PRJ-${Date.now()}`};e.length>0&&(p.company_id=e[0].company_id);const c=(await w.createProject(p)).project_id;P("创建成功"),x.push({name:"TenderManagementDetail",params:{id:c}})}catch(t){console.error("创建项目失败:",t);const e=t instanceof Error?t.message:"未知错误";h(`创建项目失败：${e}`)}finally{v.value=!1}},S=t=>{g.value=t,_.value=1,b()},Y=t=>{_.value=t,b()},j=t=>t?ee(t).format("YYYY-MM-DD HH:mm"):"-";return X(()=>{b()}),(t,e)=>{const p=O,r=J,c=F,L=G,u=K,U=H,A=q;return s(),C("div",ie,[l(y(ne),{title:"项目列表"},{actions:a(()=>[l(p,{type:"primary",loading:v.value,onClick:R},{default:a(()=>[...e[2]||(e[2]=[m("i",{class:"bi bi-plus-lg"},null,-1),i(" 新建项目 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[k.value?(s(),o(y(te),{key:0,text:"加载中..."})):f.value.length?(s(),o(U,{key:2,data:f.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(r,{prop:"id",label:"ID",width:"70",fixed:""}),l(r,{prop:"name",label:"项目名称","min-width":"200",fixed:""},{default:a(({row:n})=>[l(c,{type:"primary",onClick:M=>D(n)},{default:a(()=>[i(z(n.name),1)]),_:2},1032,["onClick"])]),_:1}),l(r,{prop:"company_name",label:"公司名称","min-width":"180","show-overflow-tooltip":""},{default:a(({row:n})=>[n.company_name?(s(),C("span",re,z(n.company_name),1)):(s(),o(L,{key:1,type:"info",size:"small"},{default:a(()=>[...e[3]||(e[3]=[i("未关联公司",-1)])]),_:1}))]),_:1}),l(r,{prop:"authorized_person_name",label:"被授权人",width:"100"}),l(r,{label:"商务应答",width:"100",align:"center"},{default:a(({row:n})=>[$(n)?(s(),o(u,{key:0,type:"success",size:"small"},{default:a(()=>[...e[4]||(e[4]=[m("i",{class:"bi bi-check-circle-fill"},null,-1),i(" 已生成 ",-1)])]),_:1})):(s(),o(u,{key:1,type:"info",size:"small"},{default:a(()=>[...e[5]||(e[5]=[m("i",{class:"bi bi-dash-circle"},null,-1),i(" 未生成 ",-1)])]),_:1}))]),_:1}),l(r,{label:"技术点对点",width:"110",align:"center"},{default:a(({row:n})=>[B(n)?(s(),o(u,{key:0,type:"success",size:"small"},{default:a(()=>[...e[6]||(e[6]=[m("i",{class:"bi bi-check-circle-fill"},null,-1),i(" 已生成 ",-1)])]),_:1})):(s(),o(u,{key:1,type:"info",size:"small"},{default:a(()=>[...e[7]||(e[7]=[m("i",{class:"bi bi-dash-circle"},null,-1),i(" 未生成 ",-1)])]),_:1}))]),_:1}),l(r,{label:"技术方案",width:"100",align:"center"},{default:a(({row:n})=>[V(n)?(s(),o(u,{key:0,type:"success",size:"small"},{default:a(()=>[...e[8]||(e[8]=[m("i",{class:"bi bi-check-circle-fill"},null,-1),i(" 已生成 ",-1)])]),_:1})):(s(),o(u,{key:1,type:"info",size:"small"},{default:a(()=>[...e[9]||(e[9]=[m("i",{class:"bi bi-dash-circle"},null,-1),i(" 未生成 ",-1)])]),_:1}))]),_:1}),l(r,{label:"最后融合",width:"100",align:"center"},{default:a(({row:n})=>[I(n)?(s(),o(u,{key:0,type:"success",size:"small"},{default:a(()=>[...e[10]||(e[10]=[m("i",{class:"bi bi-check-circle-fill"},null,-1),i(" 已融合 ",-1)])]),_:1})):(s(),o(u,{key:1,type:"info",size:"small"},{default:a(()=>[...e[11]||(e[11]=[m("i",{class:"bi bi-dash-circle"},null,-1),i(" 未融合 ",-1)])]),_:1}))]),_:1}),l(r,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:a(({row:n})=>[n.status==="active"?(s(),o(u,{key:0,type:"success"},{default:a(()=>[...e[12]||(e[12]=[i("进行中",-1)])]),_:1})):n.status==="completed"?(s(),o(u,{key:1,type:"primary"},{default:a(()=>[...e[13]||(e[13]=[i("已完成",-1)])]),_:1})):(s(),o(u,{key:2,type:"info"},{default:a(()=>[...e[14]||(e[14]=[i("草稿",-1)])]),_:1}))]),_:1}),l(r,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:n})=>[i(z(j(n.created_at)),1)]),_:1}),l(r,{label:"操作",width:"120",fixed:"right"},{default:a(({row:n})=>[l(y(T),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:M=>D(n)},null,8,["onClick"]),l(y(T),{icon:"bi-trash",type:"danger",tooltip:"删除项目",onClick:M=>N(n)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])):(s(),o(y(ae),{key:1,type:"no-data",description:"暂无项目"})),f.value.length>0?(s(),C("div",pe,[l(A,{"current-page":_.value,"onUpdate:currentPage":e[0]||(e[0]=n=>_.value=n),"page-size":g.value,"onUpdate:pageSize":e[1]||(e[1]=n=>g.value=n),total:E.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:Y},null,8,["current-page","page-size","total"])])):Z("",!0)]),_:1})])}}}),Pe=le(ce,[["__scopeId","data-v-097b39bc"]]);export{Pe as default};
