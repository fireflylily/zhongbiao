import{J as e,M as a,K as t,L as l,a3 as o,a4 as c,o as r,n as s,A as u,aI as n,v as d,j as i,x as _,aJ as p,aK as m,aL as f,aM as v,q as y,_ as h,aN as g,p as b}from"./index.js";/* empty css               */import{L as V}from"./Loading-BAlD57pu.js";/* empty css                                                                          *//* empty css                                                                   *//* empty css                                                                        *//* empty css                             */import{ax as w,am as j,ay as k,aX as x,aD as C,aA as U,aF as D,aB as E,aV as I,aW as z,az as Y,aS as A,aP as F,aG as M,aQ as P,aR as q,aE as L}from"./editor-6w6Zv5fp.js";/* empty css                   *//* empty css                    *//* empty css                     *//* empty css                */import{a as N,f as R,k as B}from"./formatters-D-henrcx.js";import{E as W}from"./el-divider-BEwFkeIl.js";import{E as G}from"./el-date-picker-panel-DNyP4jwe.js";import{E as J,a as O}from"./el-select-Cn9sh8Qz.js";import{E as H}from"./Empty-B97fjWsB.js";import{s as K}from"./imageCompressor-CTkRt5bg.js";import{c as Q}from"./company-DX6fQVXW.js";import{E as X}from"./index-DuYxzNPz.js";import{a as $,E as S}from"./index-ogjNd1Mz.js";import{E as T}from"./index-Cdh5ckaS.js";import{E as Z}from"./index-DWKbo9Il.js";import"./index-BWGjdaux.js";import"./advancedFormat-Bdi84ljT.js";import"./index-CJJgY_jM.js";import"./strings-DTOtcONx.js";import"./toNumber-ue2IRhKK.js";import"./_baseIteratee-BmMFd7Ls.js";import"./cloneDeep-syPWYH98.js";const ee={class:"case-basic-info-tab"},ae={class:"card-header"},te={key:2,class:"attachments-grid"},le={class:"attachment-header"},oe={class:"attachment-body"},ce=["title"],re={class:"file-info"},se={class:"file-size"},ue={class:"file-date"},ne={key:0,class:"file-desc"},de={class:"attachment-actions"},ie=h(w({__name:"CaseBasicInfoTab",props:{caseId:{},caseData:{}},emits:["update"],setup(h,{emit:g}){const b=h,w=g,{success:ie,error:_e}=e(),pe=j(),me=j(!1),fe=j([]),ve=j({company_id:null,case_title:"",case_number:"",customer_name:"",product_category:"",industry:"金融",contract_type:"合同",final_customer_name:"",contract_amount:"",contract_start_date:"",contract_end_date:"",party_a_contact_name:"",party_a_contact_phone:"",party_a_contact_email:""}),ye={company_id:[{required:!0,message:"请选择所属企业",trigger:"change"}],case_title:[{required:!0,message:"请输入案例标题",trigger:"blur"}],customer_name:[{required:!0,message:"请输入客户名称",trigger:"blur"}],contract_type:[{required:!0,message:"请选择合同类型",trigger:"change"}]},he=j(!1),ge=j([]),be=j(!1),Ve=j(!1),we=j(),je=j(),ke=j([]),xe=j({attachment_type:"contract",description:"",file:null}),Ce={attachment_type:[{required:!0,message:"请选择附件类型",trigger:"change"}]};k(()=>b.caseData,e=>{e&&(ve.value={company_id:e.company_id||null,case_title:e.case_title||"",case_number:e.case_number||"",customer_name:e.customer_name||"",product_category:e.product_category||"",industry:e.industry||"金融",contract_type:e.contract_type||"合同",final_customer_name:e.final_customer_name||"",contract_amount:e.contract_amount||"",contract_start_date:e.contract_start_date||"",contract_end_date:e.contract_end_date||"",party_a_contact_name:e.party_a_contact_name||"",party_a_contact_phone:e.party_a_contact_phone||"",party_a_contact_email:e.party_a_contact_email||""})},{immediate:!0,deep:!0});const Ue=async()=>{pe.value&&await pe.value.validate(async e=>{if(e){me.value=!0;try{const e=await B.updateCase(b.caseId,ve.value);e.success?(ie("保存成功","案例信息已更新"),w("update")):_e("保存失败",e.error||"未知错误")}catch(a){_e("保存失败",a instanceof Error?a.message:"未知错误")}finally{me.value=!1}}})},De=()=>{var e;null==(e=pe.value)||e.resetFields()},Ee=e=>{switch(e){case"contract":return y;case"acceptance":return v;case"testimony":return f;case"photo":return m;default:return p}},Ie=e=>{switch(e){case"contract":return"#409eff";case"acceptance":return"#67c23a";case"testimony":return"#e6a23c";case"photo":return"#f56c6c";default:return"#909399"}},ze=e=>{switch(e){case"contract":return"primary";case"acceptance":return"success";case"testimony":return"warning";case"photo":return"danger";default:return"info"}},Ye=e=>{switch(e){case"contract":return"合同文件";case"acceptance":return"验收证明";case"testimony":return"客户证明";case"photo":return"项目照片";default:return"其他材料"}},Ae=async()=>{he.value=!0;try{const e=await B.getCaseAttachments(b.caseId);e.success&&e.data&&(ge.value=e.data)}catch(e){_e("加载失败",e instanceof Error?e.message:"未知错误")}finally{he.value=!1}},Fe=e=>{if(e.raw){const a=104857600;if(e.raw.size>a)return _e("文件过大","文件大小不能超过100MB"),ke.value=[],void(xe.value.file=null);xe.value.file=e.raw}},Me=()=>{xe.value.file=null},Pe=()=>{be.value=!0},qe=async()=>{we.value&&await we.value.validate(async e=>{if(e)if(xe.value.file){Ve.value=!0;try{let e=xe.value.file;if(e.type.startsWith("image/")){const a="photo"===xe.value.attachment_type?"photo":"default";e=await K(e,a)}const a=await B.uploadCaseAttachment(b.caseId,e,xe.value.attachment_type,xe.value.description||void 0);a.success?(ie("上传成功","附件已上传"),be.value=!1,await Ae(),w("update")):_e("上传失败",a.error||"未知错误")}catch(a){_e("上传失败",a instanceof Error?a.message:"未知错误")}finally{Ve.value=!1}}else _e("请选择文件","请先选择要上传的文件")})},Le=()=>{var e;ke.value=[],xe.value={attachment_type:"contract",description:"",file:null},null==(e=we.value)||e.resetFields()};return x(()=>{(async()=>{try{const e=await Q.getCompanies();e.success&&e.data&&(fe.value=e.data)}catch(e){}})(),Ae()}),(e,p)=>{const m=O,f=J,v=t,y=S,h=$,g=l,b=c,j=o,k=G,x=W,K=r,Q=a,Ne=X,Re=s,Be=T,We=Z,Ge=i;return U(),C("div",ee,[D(Ne,{style:{"margin-bottom":"20px"}},{header:E(()=>[...p[19]||(p[19]=[F("span",null,"案例基本信息",-1)])]),default:E(()=>[D(Q,{ref_key:"formRef",ref:pe,model:ve.value,rules:ye,"label-width":"140px"},{default:E(()=>[D(h,{gutter:20},{default:E(()=>[D(y,{span:12},{default:E(()=>[D(v,{label:"所属企业",prop:"company_id"},{default:E(()=>[D(f,{modelValue:ve.value.company_id,"onUpdate:modelValue":p[0]||(p[0]=e=>ve.value.company_id=e),placeholder:"请选择企业",filterable:"",style:{width:"100%"}},{default:E(()=>[(U(!0),C(I,null,z(fe.value,e=>(U(),Y(m,{key:e.company_id,label:e.company_name,value:e.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(h,{gutter:20},{default:E(()=>[D(y,{span:12},{default:E(()=>[D(v,{label:"案例标题",prop:"case_title"},{default:E(()=>[D(g,{modelValue:ve.value.case_title,"onUpdate:modelValue":p[1]||(p[1]=e=>ve.value.case_title=e),placeholder:"请输入案例标题/合同名称"},null,8,["modelValue"])]),_:1})]),_:1}),D(y,{span:12},{default:E(()=>[D(v,{label:"案例编号",prop:"case_number"},{default:E(()=>[D(g,{modelValue:ve.value.case_number,"onUpdate:modelValue":p[2]||(p[2]=e=>ve.value.case_number=e),placeholder:"请输入案例编号（可选）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(h,{gutter:20},{default:E(()=>[D(y,{span:12},{default:E(()=>[D(v,{label:"客户名称",prop:"customer_name"},{default:E(()=>[D(g,{modelValue:ve.value.customer_name,"onUpdate:modelValue":p[3]||(p[3]=e=>ve.value.customer_name=e),placeholder:"请输入甲方客户名称"},null,8,["modelValue"])]),_:1})]),_:1}),D(y,{span:12},{default:E(()=>[D(v,{label:"产品分类",prop:"product_category"},{default:E(()=>[D(f,{modelValue:ve.value.product_category,"onUpdate:modelValue":p[4]||(p[4]=e=>ve.value.product_category=e),placeholder:"请选择产品分类",clearable:"",style:{width:"100%"}},{default:E(()=>[D(m,{label:"风控产品",value:"风控产品"}),D(m,{label:"实修",value:"实修"}),D(m,{label:"免密",value:"免密"}),D(m,{label:"风控位置",value:"风控位置"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(h,{gutter:20},{default:E(()=>[D(y,{span:12},{default:E(()=>[D(v,{label:"所属行业",prop:"industry"},{default:E(()=>[D(f,{modelValue:ve.value.industry,"onUpdate:modelValue":p[5]||(p[5]=e=>ve.value.industry=e),placeholder:"请选择行业",clearable:"",style:{width:"100%"}},{default:E(()=>[D(m,{label:"科技",value:"科技"}),D(m,{label:"制造业",value:"制造业"}),D(m,{label:"金融",value:"金融"}),D(m,{label:"教育",value:"教育"}),D(m,{label:"医疗",value:"医疗"}),D(m,{label:"建筑",value:"建筑"}),D(m,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),D(y,{span:12},{default:E(()=>[D(v,{label:"合同类型",prop:"contract_type"},{default:E(()=>[D(j,{modelValue:ve.value.contract_type,"onUpdate:modelValue":p[6]||(p[6]=e=>ve.value.contract_type=e)},{default:E(()=>[D(b,{label:"合同"},{default:E(()=>[...p[20]||(p[20]=[A("合同",-1)])]),_:1}),D(b,{label:"订单"},{default:E(()=>[...p[21]||(p[21]=[A("订单",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(h,{gutter:20},{default:E(()=>[D(y,{span:12},{default:E(()=>[D(v,{label:"合同金额",prop:"contract_amount"},{default:E(()=>[D(g,{modelValue:ve.value.contract_amount,"onUpdate:modelValue":p[7]||(p[7]=e=>ve.value.contract_amount=e),placeholder:"如：100万元、百万级"},{append:E(()=>[...p[22]||(p[22]=[A("元",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(h,{gutter:20},{default:E(()=>[D(y,{span:12},{default:E(()=>[D(v,{label:"最终客户",prop:"final_customer_name"},{default:E(()=>[D(g,{modelValue:ve.value.final_customer_name,"onUpdate:modelValue":p[8]||(p[8]=e=>ve.value.final_customer_name=e),placeholder:"订单类型时填写最终客户",disabled:"订单"!==ve.value.contract_type},null,8,["modelValue","disabled"])]),_:1})]),_:1}),D(y,{span:12},{default:E(()=>[D(v,{label:"合同开始日期",prop:"contract_start_date"},{default:E(()=>[D(k,{modelValue:ve.value.contract_start_date,"onUpdate:modelValue":p[9]||(p[9]=e=>ve.value.contract_start_date=e),type:"date",placeholder:"选择开始日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(h,{gutter:20},{default:E(()=>[D(y,{span:12},{default:E(()=>[D(v,{label:"合同结束日期",prop:"contract_end_date"},{default:E(()=>[D(k,{modelValue:ve.value.contract_end_date,"onUpdate:modelValue":p[10]||(p[10]=e=>ve.value.contract_end_date=e),type:"date",placeholder:"选择结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(x,{"content-position":"left"},{default:E(()=>[...p[23]||(p[23]=[A("客户联系方式",-1)])]),_:1}),D(h,{gutter:20},{default:E(()=>[D(y,{span:8},{default:E(()=>[D(v,{label:"联系人姓名",prop:"party_a_contact_name"},{default:E(()=>[D(g,{modelValue:ve.value.party_a_contact_name,"onUpdate:modelValue":p[11]||(p[11]=e=>ve.value.party_a_contact_name=e),placeholder:"联系人"},null,8,["modelValue"])]),_:1})]),_:1}),D(y,{span:8},{default:E(()=>[D(v,{label:"联系电话",prop:"party_a_contact_phone"},{default:E(()=>[D(g,{modelValue:ve.value.party_a_contact_phone,"onUpdate:modelValue":p[12]||(p[12]=e=>ve.value.party_a_contact_phone=e),placeholder:"联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),D(y,{span:8},{default:E(()=>[D(v,{label:"联系邮箱",prop:"party_a_contact_email"},{default:E(()=>[D(g,{modelValue:ve.value.party_a_contact_email,"onUpdate:modelValue":p[13]||(p[13]=e=>ve.value.party_a_contact_email=e),placeholder:"邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),D(v,null,{default:E(()=>[D(K,{type:"primary",loading:me.value,onClick:Ue},{default:E(()=>[...p[24]||(p[24]=[A(" 保存 ",-1)])]),_:1},8,["loading"]),D(K,{onClick:De},{default:E(()=>[...p[25]||(p[25]=[A("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),D(Ne,null,{header:E(()=>[F("div",ae,[p[27]||(p[27]=F("span",null,"案例附件",-1)),D(K,{type:"primary",size:"small",onClick:Pe},{default:E(()=>[D(Re,null,{default:E(()=>[D(M(d))]),_:1}),p[26]||(p[26]=A(" 上传附件 ",-1))]),_:1})])]),default:E(()=>[he.value?(U(),Y(M(V),{key:0,text:"加载附件中..."})):ge.value.length?(U(),C("div",te,[(U(!0),C(I,null,z(ge.value,e=>(U(),C("div",{key:e.attachment_id,class:"attachment-card"},[F("div",le,[D(Re,{size:32,color:Ie(e.attachment_type)},{default:E(()=>[(U(),Y(P(Ee(e.attachment_type))))]),_:2},1032,["color"]),D(Be,{type:ze(e.attachment_type),size:"small"},{default:E(()=>[A(q(Ye(e.attachment_type)),1)]),_:2},1032,["type"])]),F("div",oe,[F("div",{class:"file-name",title:e.original_filename},q(e.original_filename),9,ce),F("div",re,[F("span",se,q(M(N)(e.file_size)),1),F("span",ue,q(M(R)(e.uploaded_at,"date")),1)]),e.attachment_description?(U(),C("div",ne,q(e.attachment_description),1)):L("",!0)]),F("div",de,[D(K,{size:"small",onClick:a=>(e=>{const a=B.downloadCaseAttachment(e.attachment_id);window.open(a,"_blank")})(e)},{default:E(()=>[D(Re,null,{default:E(()=>[D(M(u))]),_:1}),p[28]||(p[28]=A(" 下载 ",-1))]),_:1},8,["onClick"]),D(K,{size:"small",type:"danger",onClick:a=>(async e=>{try{if(!confirm(`确定要删除附件 "${e.original_filename}" 吗？`))return;const a=await B.deleteCaseAttachment(e.attachment_id);a.success?(ie("删除成功","附件已删除"),await Ae(),w("update")):_e("删除失败",a.error||"未知错误")}catch(a){_e("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:E(()=>[D(Re,null,{default:E(()=>[D(M(n))]),_:1}),p[29]||(p[29]=A(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])):(U(),Y(M(H),{key:1,type:"no-data",description:"暂无附件"}))]),_:1}),D(Ge,{modelValue:be.value,"onUpdate:modelValue":p[18]||(p[18]=e=>be.value=e),title:"上传案例附件",width:"500px",onClose:Le},{footer:E(()=>[D(K,{onClick:p[17]||(p[17]=e=>be.value=!1)},{default:E(()=>[...p[32]||(p[32]=[A("取消",-1)])]),_:1}),D(K,{type:"primary",loading:Ve.value,onClick:qe},{default:E(()=>[...p[33]||(p[33]=[A(" 确定上传 ",-1)])]),_:1},8,["loading"])]),default:E(()=>[D(Q,{ref_key:"uploadFormRef",ref:we,model:xe.value,rules:Ce,"label-width":"120px"},{default:E(()=>[D(v,{label:"附件类型",prop:"attachment_type"},{default:E(()=>[D(f,{modelValue:xe.value.attachment_type,"onUpdate:modelValue":p[14]||(p[14]=e=>xe.value.attachment_type=e),placeholder:"请选择附件类型",style:{width:"100%"}},{default:E(()=>[D(m,{label:"合同文件",value:"contract"}),D(m,{label:"验收证明",value:"acceptance"}),D(m,{label:"客户证明",value:"testimony"}),D(m,{label:"项目照片",value:"photo"}),D(m,{label:"其他材料",value:"other"})]),_:1},8,["modelValue"])]),_:1}),D(v,{label:"附件说明",prop:"description"},{default:E(()=>[D(g,{modelValue:xe.value.description,"onUpdate:modelValue":p[15]||(p[15]=e=>xe.value.description=e),type:"textarea",rows:2,placeholder:"请简要说明附件内容（可选）"},null,8,["modelValue"])]),_:1}),D(v,{label:"选择文件",prop:"file"},{default:E(()=>[D(We,{ref_key:"uploadRef",ref:je,"file-list":ke.value,"onUpdate:fileList":p[16]||(p[16]=e=>ke.value=e),"auto-upload":!1,limit:1,"on-change":Fe,"on-remove":Me,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",drag:""},{tip:E(()=>[...p[30]||(p[30]=[F("div",{class:"el-upload__tip"}," 支持PDF、DOC、DOCX、JPG、PNG格式，文件大小不超过100MB ",-1)])]),default:E(()=>[D(Re,{class:"el-icon--upload"},{default:E(()=>[D(M(_))]),_:1}),p[31]||(p[31]=F("div",{class:"el-upload__text"},[A(" 拖拽文件到这里 或 "),F("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-6f8e3b6e"]]),_e={class:"case-detail"},pe={class:"detail-header"},me={class:"header-title"},fe={key:1,class:"detail-content"},ve=h(w({__name:"CaseDetail",setup(a){const t=g(),l=b(),{error:o}=e(),c=j(!1),s=j(0),u=j({}),n=async()=>{c.value=!0;try{const e=await B.getCase(s.value);e.success&&e.data?u.value=e.data:(o("加载失败","无法获取案例信息"),i())}catch(e){o("加载失败",e instanceof Error?e.message:"未知错误"),i()}finally{c.value=!1}},d=async()=>{await n()},i=()=>{l.push("/knowledge/case-library")};return x(()=>{const e=t.params.id;if(e){if(s.value=parseInt(e,10),isNaN(s.value))return o("参数错误","无效的案例ID"),void i();n()}else o("参数错误","缺少案例ID"),i()}),(e,a)=>{const t=r,l=T;return U(),C("div",_e,[F("div",pe,[D(t,{onClick:i,icon:"ArrowLeft"},{default:E(()=>[...a[0]||(a[0]=[A("返回列表",-1)])]),_:1}),F("div",me,[F("h2",null,q(u.value.case_title||"案例详情"),1),u.value.contract_type?(U(),Y(l,{key:0,type:"合同"===u.value.contract_type?"primary":"success"},{default:E(()=>[A(q(u.value.contract_type),1)]),_:1},8,["type"])):L("",!0),u.value.product_category?(U(),Y(l,{key:1,type:"primary"},{default:E(()=>[A(q(u.value.product_category),1)]),_:1})):L("",!0)])]),c.value?(U(),Y(M(V),{key:0,text:"加载案例信息中..."})):(U(),C("div",fe,[D(ie,{"case-id":s.value,"case-data":u.value,onUpdate:d},null,8,["case-id","case-data"])]))])}}}),[["__scopeId","data-v-ea362180"]]);export{ve as default};
