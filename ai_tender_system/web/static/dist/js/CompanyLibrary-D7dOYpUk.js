import{M as a,O as e,g as t,ae as l,af as o,R as s,P as i,Q as r,U as n,q as d,ag as c,ah as p,ai as u,aj as m,_}from"./index.js";/* empty css                             *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                                                                        */import{E as f,a as y}from"./el-select-BRmwHaPV.js";/* empty css                */import{L as v}from"./Loading-DL9BB2_h.js";import{E as w}from"./Empty-y75EAW9K.js";/* empty css                */import{C as g}from"./Card-BYlt77WN.js";/* empty css                                                                          */import{aq as h,am as b,an as j,aV as x,aw as k,as as C,av as E,au as V,at as q,ay as z,aR as L,ar as I,aS as D}from"./editor-B2OO2pov.js";/* empty css                   *//* empty css                */import{c as P}from"./company-CgN_f2mJ.js";import{C as U}from"./CompanyInfoExtractorDialog-Ck_F8wgA.js";import{E as $}from"./index-DOF8wyI3.js";import{b as M,E as O,a as Q}from"./index-BGcrlS83.js";import{E as R,a as A}from"./index-DV_tRJ6B.js";import{E as F}from"./index-2BvDutB9.js";import{E as H}from"./index-nzMCCPZ_.js";import"./index-C2wRk8Ho.js";import"./strings-AttvWK4d.js";import"./index-C3Wd-RFA.js";import"./toNumber-BHhAPexX.js";import"./_baseFindIndex-BTqrMG7V.js";import"./_baseIteratee-C8pVAKYE.js";import"./el-tab-pane-CrT1S_Zl.js";import"./raf-B6jWGkGX.js";import"./clamp-DmrTTiq0.js";import"./index-BqOFd9Zn.js";import"./cloneDeep-syPWYH98.js";import"./index-D4leEHxh.js";import"./index-CVQCSiPO.js";import"./index-DxEuAmkt.js";import"./flatMap-IaJ8K9rw.js";import"./map-DjkI9_xQ.js";import"./_baseEach-CJbh0AmI.js";const S={class:"company-library"},G={class:"stats-bar"},K={class:"stat-content"},N={class:"stat-icon"},W={class:"stat-info"},X={class:"stat-value"},Y={class:"stat-content"},B={class:"stat-icon"},J={class:"stat-info"},T={class:"stat-value"},Z={class:"filter-section"},aa={class:"qualification-progress"},ea={class:"progress-text"},ta=_(h({__name:"CompanyLibrary",setup(_){const h=a(),{success:ta,error:la}=e(),oa=b(!1),sa=b([]),ia=b({keyword:"",industry:""}),ra=b(!1),na=j(()=>{let a=[...sa.value];if(ia.value.keyword){const e=ia.value.keyword.toLowerCase();a=a.filter(a=>{var t,l,o;return(null==(t=a.company_name)?void 0:t.toLowerCase().includes(e))||(null==(l=a.social_credit_code)?void 0:l.toLowerCase().includes(e))||(null==(o=a.company_code)?void 0:o.toLowerCase().includes(e))})}return ia.value.industry&&(a=a.filter(a=>a.industry_type===ia.value.industry)),a}),da=async()=>{oa.value=!0;try{const a=(await P.getCompanies()).data||[],e=await Promise.all(a.map(async a=>{let e=0;try{const t=await P.getCompanyQualifications(a.company_id);t.data&&(e=Object.keys(t.data).length)}catch(l){}const t=Math.round(e/17*100);return{company_id:a.company_id,company_name:a.company_name||"未命名",company_code:a.company_code||"",social_credit_code:a.social_credit_code||"-",legal_representative:a.legal_representative||"-",registered_capital:a.registered_capital||"-",employee_count:a.employee_count||"-",industry_type:a.industry_type||"",product_count:a.product_count||0,document_count:a.document_count||0,qualification_completed:e,qualification_total:17,qualification_progress:t,created_at:a.created_at||"-",updated_at:a.updated_at||"-",...a}}));sa.value=e}catch(a){la("加载失败",a instanceof Error?a.message:"未知错误")}finally{oa.value=!1}},ca=()=>{},pa=()=>{ia.value.keyword="",ia.value.industry=""},ua=()=>{h.push("/knowledge/company/new")},ma=a=>{"manual"===a?h.push("/knowledge/company/new"):"extract"===a&&(ra.value=!0)},_a=a=>{h.push(`/knowledge/company/${a}`)};return x(()=>{da()}),(a,e)=>{const _=t,b=$,j=r,x=i,fa=y,ya=f,va=d,wa=Q,ga=O,ha=M,ba=s,ja=A,xa=F,ka=H,Ca=R;return C(),k("div",S,[E("div",G,[V(b,{class:"stat-card"},{default:q(()=>[E("div",K,[E("div",N,[V(_,{size:32,color:"#409eff"},{default:q(()=>[V(z(l))]),_:1})]),E("div",W,[e[3]||(e[3]=E("div",{class:"stat-label"},"总企业数",-1)),E("div",X,L(sa.value.length),1)])])]),_:1}),V(b,{class:"stat-card"},{default:q(()=>[E("div",Y,[E("div",B,[V(_,{size:32,color:"#67c23a"},{default:q(()=>[V(z(o))]),_:1})]),E("div",J,[e[4]||(e[4]=E("div",{class:"stat-label"},"筛选结果",-1)),E("div",T,L(na.value.length),1)])])]),_:1})]),V(z(g),{title:"企业列表"},{default:q(()=>[E("div",Z,[V(ba,{inline:!0,model:ia.value},{default:q(()=>[V(x,{label:"搜索"},{default:q(()=>[V(j,{modelValue:ia.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>ia.value.keyword=a),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:ca},{prefix:q(()=>[V(_,null,{default:q(()=>[V(z(n))]),_:1})]),_:1},8,["modelValue"])]),_:1}),V(x,{label:"行业类型"},{default:q(()=>[V(ya,{modelValue:ia.value.industry,"onUpdate:modelValue":e[1]||(e[1]=a=>ia.value.industry=a),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:ca},{default:q(()=>[V(fa,{label:"全部行业",value:""}),V(fa,{label:"科技",value:"technology"}),V(fa,{label:"制造业",value:"manufacturing"}),V(fa,{label:"金融",value:"finance"}),V(fa,{label:"教育",value:"education"}),V(fa,{label:"医疗",value:"healthcare"}),V(fa,{label:"零售",value:"retail"}),V(fa,{label:"建筑",value:"construction"}),V(fa,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),V(x,null,{default:q(()=>[V(va,{onClick:pa},{default:q(()=>[V(_,null,{default:q(()=>[V(z(c))]),_:1}),e[5]||(e[5]=D(" 重置 ",-1))]),_:1})]),_:1}),V(x,{style:{"margin-left":"auto"}},{default:q(()=>[V(ha,{"split-button":"",type:"primary",onClick:ua,onCommand:ma},{dropdown:q(()=>[V(ga,null,{default:q(()=>[V(wa,{command:"manual"},{default:q(()=>[V(_,null,{default:q(()=>[V(z(u))]),_:1}),e[6]||(e[6]=D(" 手动创建 ",-1))]),_:1}),V(wa,{command:"extract",divided:""},{default:q(()=>[V(_,null,{default:q(()=>[V(z(m))]),_:1}),e[7]||(e[7]=D(" 从标书创建 ",-1))]),_:1})]),_:1})]),default:q(()=>[V(_,null,{default:q(()=>[V(z(p))]),_:1}),e[8]||(e[8]=D(" 新建企业 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),V(U,{modelValue:ra.value,"onUpdate:modelValue":e[2]||(e[2]=a=>ra.value=a),onSuccess:_a},null,8,["modelValue"]),oa.value?(C(),I(z(v),{key:0,text:"加载中..."})):na.value.length?(C(),I(Ca,{key:2,data:na.value,stripe:"",style:{width:"100%"}},{default:q(()=>[V(ja,{prop:"company_id",label:"ID",width:"70",fixed:""}),V(ja,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),V(ja,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),V(ja,{prop:"legal_representative",label:"法定代表人",width:"120"}),V(ja,{prop:"registered_capital",label:"注册资本",width:"120"}),V(ja,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),V(ja,{label:"资质完成度",width:"180",align:"center"},{default:q(({row:a})=>{return[E("div",aa,[V(xa,{percentage:a.qualification_progress||0,color:(e=a.qualification_progress||0,e<30?"#f56c6c":e<70?"#e6a23c":"#67c23a"),"stroke-width":8},null,8,["percentage","color"]),E("span",ea,L(a.qualification_completed||0)+"/"+L(a.qualification_total||17),1)])];var e}),_:1}),V(ja,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:q(({row:a})=>[V(ka,{size:"small",type:"info"},{default:q(()=>[D(L(a.product_count||0),1)]),_:2},1024)]),_:1}),V(ja,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:q(({row:a})=>[V(ka,{size:"small",type:"success"},{default:q(()=>[D(L(a.document_count||0),1)]),_:2},1024)]),_:1}),V(ja,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),V(ja,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),V(ja,{label:"操作",width:"220",fixed:"right"},{default:q(({row:a})=>[V(va,{text:"",type:"primary",size:"small",onClick:e=>(a=>{h.push(`/knowledge/company/${a.company_id}`)})(a)},{default:q(()=>[...e[9]||(e[9]=[D(" 查看详情 ",-1)])]),_:1},8,["onClick"]),V(va,{text:"",type:"warning",size:"small",onClick:e=>(a=>{h.push(`/knowledge/company/${a.company_id}`)})(a)},{default:q(()=>[...e[10]||(e[10]=[D(" 编辑 ",-1)])]),_:1},8,["onClick"]),V(va,{text:"",type:"danger",size:"small",onClick:e=>(async a=>{try{if(!confirm(`确定要删除企业 "${a.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`))return;await P.deleteCompany(a.company_id),ta("删除成功",`已删除企业: ${a.company_name}`),await da()}catch(e){la("删除失败",e instanceof Error?e.message:"未知错误")}})(a)},{default:q(()=>[...e[11]||(e[11]=[D(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(C(),I(z(w),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1})])}}}),[["__scopeId","data-v-08cfc62f"]]);export{ta as default};
