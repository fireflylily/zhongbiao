import{p as a,I as e,M as l,K as s,L as r,n as o,ae as d,o as t,$ as u,a8 as n,h as i,ac as p,af as f,ag as m,E as c,_ as w}from"./index.js";/* empty css                *//* empty css                *//* empty css               */import{E as _,a as g}from"./el-tab-pane-Dx3OAKSu.js";import{E as b}from"./el-space-Do2nvIg1.js";import{E as v}from"./el-text-CR-GKwxJ.js";import{P}from"./PageHeader-tEU05A6L.js";import{E as y}from"./strings-Bn-6jhOp.js";import{E as h}from"./index-Bx44ChEh.js";import{aw as j,am as V,bt as x,aC as U,az as E,aE as F,aO as I,aA as k,aF as q,aR as z,aQ as C}from"./editor-CksRIowP.js";import"./raf-B6jWGkGX.js";import"./toNumber-B9yGJSsa.js";const R={class:"user-settings-page"},H={class:"settings-container"},A={class:"tab-label"},D={class:"tab-label"},J=w(j({__name:"UserSettings",setup(w){const j=a(),J=e(),K=V("password"),L=V(),M=x({oldPassword:"",newPassword:"",confirmPassword:""}),N=V(!1),O={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"},{validator:(a,e,l)=>{e&&e===M.oldPassword?l(new Error("新密码不能与当前密码相同")):l()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(a,e,l)=>{e!==M.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]};function Q(){var a;null==(a=L.value)||a.resetFields(),M.oldPassword="",M.newPassword="",M.confirmPassword=""}async function S(){var a,e,l,s;if(!L.value)return;if(await L.value.validate().catch(()=>!1)){N.value=!0;try{const a=await m.changePassword({old_password:M.oldPassword,new_password:M.newPassword,confirm_password:M.confirmPassword});a.success?(c.success("密码修改成功，请重新登录"),Q(),setTimeout(async()=>{await J.logout(),j.push("/login")},2e3)):c.error(a.message||"修改密码失败")}catch(r){401===(null==(a=r.response)?void 0:a.status)?c.error((null==(e=r.response.data)?void 0:e.message)||"当前密码错误"):c.error((null==(s=null==(l=r.response)?void 0:l.data)?void 0:s.message)||"修改密码失败，请稍后重试")}finally{N.value=!1}}}return(a,e)=>{const m=o,c=r,w=s,j=v,V=t,x=b,T=l,W=i,$=g,B=y,G=_,X=h;return E(),U("div",R,[F(P,{title:"用户设置",icon:"bi-gear"}),I("div",H,[F(X,{class:"settings-card"},{default:k(()=>[F(G,{modelValue:K.value,"onUpdate:modelValue":e[3]||(e[3]=a=>K.value=a),class:"settings-tabs"},{default:k(()=>[F($,{label:"修改密码",name:"password"},{label:k(()=>[I("span",A,[F(m,null,{default:k(()=>[F(q(d))]),_:1}),e[4]||(e[4]=z(" 修改密码 ",-1))])]),default:k(()=>[F(T,{ref_key:"passwordFormRef",ref:L,model:M,rules:O,"label-width":"120px",class:"password-form"},{default:k(()=>[F(w,{label:"当前密码",prop:"oldPassword"},{default:k(()=>[F(c,{modelValue:M.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=a=>M.oldPassword=a),type:"password",placeholder:"请输入当前密码","show-password":"",clearable:""},{prefix:k(()=>[F(m,null,{default:k(()=>[F(q(d))]),_:1})]),_:1},8,["modelValue"])]),_:1}),F(w,{label:"新密码",prop:"newPassword"},{extra:k(()=>[F(j,{type:"info",size:"small"},{default:k(()=>[...e[5]||(e[5]=[z("密码长度至少为6个字符",-1)])]),_:1})]),default:k(()=>[F(c,{modelValue:M.newPassword,"onUpdate:modelValue":e[1]||(e[1]=a=>M.newPassword=a),type:"password",placeholder:"请输入新密码（至少6个字符）","show-password":"",clearable:""},{prefix:k(()=>[F(m,null,{default:k(()=>[F(q(d))]),_:1})]),_:1},8,["modelValue"])]),_:1}),F(w,{label:"确认新密码",prop:"confirmPassword"},{default:k(()=>[F(c,{modelValue:M.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>M.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":"",clearable:""},{prefix:k(()=>[F(m,null,{default:k(()=>[F(q(d))]),_:1})]),_:1},8,["modelValue"])]),_:1}),F(w,null,{default:k(()=>[F(x,null,{default:k(()=>[F(V,{type:"primary",loading:N.value,onClick:S},{default:k(()=>[F(m,null,{default:k(()=>[F(q(u))]),_:1}),e[6]||(e[6]=z(" 确认修改 ",-1))]),_:1},8,["loading"]),F(V,{onClick:Q},{default:k(()=>[F(m,null,{default:k(()=>[F(q(n))]),_:1}),e[7]||(e[7]=z(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),F(W,{title:"温馨提示",type:"warning",closable:!1,"show-icon":"",class:"mt-4"},{default:k(()=>[...e[8]||(e[8]=[I("ul",{class:"tips-list"},[I("li",null,"修改密码后需要重新登录"),I("li",null,"请妥善保管您的密码，不要告诉他人"),I("li",null,"建议定期更换密码，提高账号安全性")],-1)])]),_:1})]),_:1}),F($,{label:"基本信息",name:"profile"},{label:k(()=>[I("span",D,[F(m,null,{default:k(()=>[F(q(p))]),_:1}),e[9]||(e[9]=z(" 基本信息 ",-1))])]),default:k(()=>[F(T,{"label-width":"120px",class:"profile-form"},{default:k(()=>[F(w,{label:"用户名"},{default:k(()=>{var a;return[F(c,{"model-value":(null==(a=q(J).currentUser)?void 0:a.username)||"-",readonly:"",disabled:""},{prefix:k(()=>[F(m,null,{default:k(()=>[F(q(p))]),_:1})]),_:1},8,["model-value"])]}),_:1}),F(w,{label:"邮箱"},{default:k(()=>{var a;return[F(c,{"model-value":(null==(a=q(J).currentUser)?void 0:a.email)||"-",readonly:"",disabled:""},{prefix:k(()=>[F(m,null,{default:k(()=>[F(q(f))]),_:1})]),_:1},8,["model-value"])]}),_:1}),F(w,{label:"角色"},{default:k(()=>{var a,e;return[F(B,{type:(e=null==(a=q(J).currentUser)?void 0:a.role,{"管理员":"danger","高级管理":"danger","项目经理":"warning","内部员工":"success","普通用户":"info"}[e||""]||"info"),size:"large"},{default:k(()=>{var a;return[z(C((null==(a=q(J).currentUser)?void 0:a.role)||"-"),1)]}),_:1},8,["type"])]}),_:1}),F(w,{label:"用户ID"},{default:k(()=>[F(j,null,{default:k(()=>{var a;return[z(C((null==(a=q(J).currentUser)?void 0:a.id)||"-"),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])])}}}),[["__scopeId","data-v-9bea309a"]]);export{J as default};
