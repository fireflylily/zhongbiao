import{j as e,G as t,D as l,F as a,C as s,o as i,c as n,a as r,M as o,S as u,T as c,m as d,X as f,W as p,H as m,I as y,Y as _,L as h}from"./vendor-element-plus-CEQaQHNc.js";import{r as v,a as g,d as w,P as F,M as k,Q as b,c as x,R as I,N as C,F as z,V as H,L as $,O as j,a5 as B,I as T,H as M,X as S,f as L,ag as R}from"./vendor-vue-DnBj6vzG.js";import{dB as Y,cZ as E,ex as U,d2 as D,er as O,et as P}from"./vendor-other-CxXkF0Pk.js";/* empty css                                                                          */import{_ as V}from"./index.js";import"./vendor-editor-CGvuleas.js";/* empty css                                                                        */import{d as G}from"./vendor-dayjs-CeOjnJlt.js";function N(t={}){const{onFileLoaded:l,onFileCancelled:a,onSyncSuccess:s}=t,i=v(!1),n=v(null),r=v(!1),o=v(!1),u=g(()=>!!n.value),c=e=>({technicalFile:"ÊäÄÊúØÈúÄÊ±ÇÊñá‰ª∂",tenderFile:"ÊãõÊ†áÊñáÊ°£",templateFile:"Â∫îÁ≠îÊ®°Êùø",businessResponseFile:"ÂïÜÂä°Â∫îÁ≠îÊñá‰ª∂",p2pResponseFile:"ÁÇπÂØπÁÇπÂ∫îÁ≠îÊñá‰ª∂",techProposalFile:"ÊäÄÊúØÊñπÊ°àÊñá‰ª∂"}[e]||"Êñá‰ª∂");return{useHitlFile:i,hitlFileInfo:n,hasHitlFile:u,syncing:r,synced:o,loadFromHITL:(t,a="technicalFile")=>{const s=t[a];return s?(n.value={filename:s.filename||s.name||"Êú™Áü•Êñá‰ª∂",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},i.value=!0,o.value=!1,e.success({message:`Â∑≤Âä†ËΩΩHITL${c(a)}: ${n.value.filename}`,duration:3e3}),l&&l(n.value),!0):(e.warning(`ÂΩìÂâçÈ°πÁõÆÊ≤°Êúâ${c(a)}`),!1)},cancelHitlFile:()=>{i.value=!1,n.value=null,o.value=!1,e.info("Â∑≤ÂèñÊ∂à‰ΩøÁî®HITLÊñá‰ª∂"),a&&a()},syncToHitl:async(t,l,a)=>{if(!t)return e.error("È°πÁõÆIDÊó†Êïà"),!1;if(!l)return e.error("Êñá‰ª∂Ë∑ØÂæÑÊó†Êïà"),!1;r.value=!0;try{const i=await fetch(`/api/tender-processing/sync-file/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:l,file_type:a})}),n=i.headers.get("content-type");if(!(null==n?void 0:n.includes("application/json"))){await i.text();throw new Error(`ÊúçÂä°Âô®ËøîÂõûÂºÇÂ∏∏ÂìçÂ∫î (${i.status}): ${i.statusText}„ÄÇÂèØËÉΩÊòØÂêéÁ´ØÈÖçÁΩÆÈóÆÈ¢òÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëò„ÄÇ`)}const r=await i.json();if(r.success||i.ok)return o.value=!0,e.success({message:r.message||"Â∑≤ÊàêÂäüÂêåÊ≠•Âà∞ÊäïÊ†áÈ°πÁõÆ",duration:3e3}),s&&await s(),!0;throw new Error(r.error||r.message||"ÂêåÊ≠•Â§±Ë¥•")}catch(i){let t="ÂêåÊ≠•Âà∞È°πÁõÆÂ§±Ë¥•";return i.message?t=i.message:"TypeError"===i.name&&(t="ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•"),e.error({message:t,duration:5e3}),!1}finally{r.value=!1}},resetSyncStatus:()=>{o.value=!1}}}function W(e,t="YYYY-MM-DD"){return e?G(e).format(t):""}function X(e,t=2){if(null==e||0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,l)).toFixed(t)} ${["B","KB","MB","GB","TB","PB"][l]}`}const A={class:"stats-card"},J={key:0,class:"stats-title"},K={class:"stat-item"},Q={class:"stat-prefix"},Z={class:"stat-suffix"},q=V(w({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const s=e,i=[{key:"total_replacements",label:"ÊñáÊú¨ÊõøÊç¢",suffix:"Â§Ñ"},{key:"tables_processed",label:"Ë°®Ê†ºÂ§ÑÁêÜ",suffix:"‰∏™"},{key:"cells_filled",label:"ÂçïÂÖÉÊ†ºÂ°´ÂÖÖ",suffix:"‰∏™"},{key:"images_inserted",label:"ÂõæÁâáÊèíÂÖ•",suffix:"Âº†"}],n=g(()=>s.statItems||i),r=e=>{const t=e.split(".");let l=s.stats;for(const a of t)if(l=null==l?void 0:l[a],null==l)break;return"number"==typeof l?l:0};return(s,i)=>{const o=a,u=l,c=t;return k(),F("div",A,[e.title?(k(),F("h4",J,I(e.title),1)):b("",!0),x(c,{gutter:e.gutter},{default:C(()=>[(k(!0),F(z,null,H(n.value,t=>(k(),$(u,{key:t.key,span:e.span},{default:C(()=>[j("div",K,[x(o,{title:t.label,value:r(t.key),precision:t.precision,"value-style":e.valueStyle},B({_:2},[t.prefix?{name:"prefix",fn:C(()=>[j("span",Q,I(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:C(()=>[j("span",Z,I(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),ee={class:"alert-content"},te={class:"file-info"},le={class:"file-details"},ae={class:"file-label"},se={class:"file-name"},ie={key:0,class:"file-size"},ne={class:"alert-actions"},re=V(w({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"‰ΩøÁî®HITLÊñá‰ª∂:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"ÂèñÊ∂à‰ΩøÁî®"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:t}){const l=t,a=()=>{l("cancel")};return(t,l)=>{const o=s,u=i,c=r,d=n;return e.fileInfo?(k(),$(d,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:C(()=>[j("div",ee,[j("div",te,[x(o,{class:"file-icon"},{default:C(()=>[x(T(Y))]),_:1}),j("div",le,[j("span",ae,I(e.label),1),j("span",se,I(e.fileInfo.filename),1),e.fileInfo.file_size?(k(),F("span",ie," ("+I(T(X)(e.fileInfo.file_size))+") ",1)):b("",!0),e.showTag?(k(),$(u,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:C(()=>[...l[0]||(l[0]=[M(" Â∑≤‰ªéÊäïÊ†áÈ°πÁõÆÂä†ËΩΩ ",-1)])]),_:1})):b("",!0)])]),j("div",ne,[S(t.$slots,"actions",{},()=>[e.showCancel?(k(),$(c,{key:0,type:"text",size:"small",onClick:a},{default:C(()=>[x(o,null,{default:C(()=>[x(T(E))]),_:1}),M(" "+I(e.cancelText),1)]),_:1})):b("",!0)],!0)])])]),_:3},8,["type"])):b("",!0)}}}),[["__scopeId","data-v-1a132715"]]),oe={class:"history-files-panel"},ue={class:"card-header"},ce={class:"header-title"},de={class:"current-file-content"},fe={class:"history-actions"},pe={class:"collapse-header"},me={class:"filename-cell"},ye=V(w({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"ËØ•È°πÁõÆÂ∑≤ÊúâÁîüÊàêÊñá‰ª∂"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const t=v([]),l=e=>{if(!e)return"-";let t=e;try{t=decodeURIComponent(e)}catch{}const l=t.split("/");return l[l.length-1]||"-"};return(a,v)=>{const g=i,w=n,z=c,H=d,B=u,S=s,E=r,V=o,G=y,N=m,A=h,J=p,K=f,Q=_;return k(),F("div",oe,[e.currentFile?(k(),$(V,{key:0,shadow:"never",class:"current-file-card"},{header:C(()=>[j("div",ue,[j("div",ce,[j("span",null,I(e.title||"üìÑ ËØ•È°πÁõÆÁöÑÁîüÊàêÊñá‰ª∂"),1),x(g,{type:"info"},{default:C(()=>[...v[6]||(v[6]=[M("ÂéÜÂè≤Êñá‰ª∂",-1)])]),_:1})])])]),default:C(()=>[j("div",de,[x(w,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(k(),$(T(q),{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):b("",!0),x(B,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:C(()=>[x(z,{label:"Êñá‰ª∂Âêç"},{default:C(()=>[M(I(l(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),x(z,{label:"‰∏ãËΩΩÂú∞ÂùÄ"},{default:C(()=>[x(H,{href:e.currentFile.downloadUrl,type:"primary"},{default:C(()=>[M(I(l(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),j("div",fe,[e.showEditorOpen?(k(),$(E,{key:0,type:"primary",size:"large",onClick:v[0]||(v[0]=t=>a.$emit("openInEditor",e.currentFile))},{default:C(()=>[x(S,null,{default:C(()=>[x(T(U))]),_:1}),v[7]||(v[7]=M(" Âú®ÁºñËæëÂô®‰∏≠ÊâìÂºÄ ",-1))]),_:1})):b("",!0),x(E,{type:"primary",size:"large",icon:T(D),onClick:v[1]||(v[1]=t=>a.$emit("preview",e.currentFile))},{default:C(()=>[...v[8]||(v[8]=[M(" È¢ÑËßàWord ",-1)])]),_:1},8,["icon"]),x(E,{type:"success",size:"large",icon:T(O),onClick:v[2]||(v[2]=t=>a.$emit("download",e.currentFile))},{default:C(()=>[...v[9]||(v[9]=[M(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(k(),$(E,{key:1,size:"large",icon:T(P),onClick:v[3]||(v[3]=e=>a.$emit("regenerate"))},{default:C(()=>[...v[10]||(v[10]=[M(" ÈáçÊñ∞ÁîüÊàê ",-1)])]),_:1},8,["icon"])):b("",!0)])])]),_:1})):b("",!0),e.historyFiles.length>0?(k(),$(K,{key:1,modelValue:t.value,"onUpdate:modelValue":v[5]||(v[5]=e=>t.value=e),class:"history-collapse"},{default:C(()=>[x(J,{name:"history"},{title:C(()=>[j("div",pe,[j("span",null,"üìÇ Êü•ÁúãÊâÄÊúâÂéÜÂè≤Â§ÑÁêÜÊñá‰ª∂ ("+I(e.historyFiles.length)+")",1),t.value.includes("history")?(k(),$(E,{key:0,type:"primary",size:"small",loading:e.loading,onClick:v[4]||(v[4]=R(e=>a.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:C(()=>[...v[11]||(v[11]=[M(" Âà∑Êñ∞ÂàóË°® ",-1)])]),_:1},8,["loading"])):b("",!0)])]),default:C(()=>[x(V,{shadow:"never",style:{border:"none"}},{default:C(()=>[L((k(),$(N,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:C(()=>[x(G,{type:"index",label:"Â∫èÂè∑",width:"60"}),x(G,{prop:"filename",label:"Êñá‰ª∂Âêç","min-width":"300"},{default:C(({row:e})=>[j("div",me,[x(S,null,{default:C(()=>[x(T(Y))]),_:1}),j("span",null,I(e.filename),1)])]),_:1}),x(G,{prop:"size",label:"Êñá‰ª∂Â§ßÂ∞è",width:"120"},{default:C(({row:e})=>[M(I(T(X)(e.size)),1)]),_:1}),x(G,{prop:"process_time",label:"Â§ÑÁêÜÊó∂Èó¥",width:"180"},{default:C(({row:e})=>[M(I(T(W)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),x(G,{label:"Êìç‰Ωú",width:"200",fixed:"right"},{default:C(({row:e})=>[x(E,{type:"primary",size:"small",onClick:t=>a.$emit("preview",e)},{default:C(()=>[...v[12]||(v[12]=[M(" È¢ÑËßà ",-1)])]),_:1},8,["onClick"]),x(E,{type:"success",size:"small",onClick:t=>a.$emit("download",e)},{default:C(()=>[...v[13]||(v[13]=[M(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,e.loading]]),e.loading||0!==e.historyFiles.length?b("",!0):(k(),$(A,{key:0,description:"ÊöÇÊó†ÂéÜÂè≤Êñá‰ª∂","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):b("",!0)])}}}),[["__scopeId","data-v-6e6ba197"]]);function _e(e,t){const l="string"==typeof e?e:URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),"string"!=typeof e&&URL.revokeObjectURL(l)}export{re as H,q as S,ye as a,_e as d,N as u};
