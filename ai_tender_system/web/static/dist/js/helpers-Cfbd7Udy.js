import{Y as e,O as a,ap as t,an as s,X as l,aN as i,bx as n,u as o,S as r,aC as c,l as d,bf as u,P as p,by as f,n as m,w as y,aQ as v,E as h,_ as b,q as _,h as g,o as x,a0 as w,bz as k,z as F,A as C,H as I}from"./index.js";import{bB as $,bW as E,am as j,ax as z,an as S,bO as B,cc as H,aw as K,aC as T,az as A,aI as N,aN as M,aF as O,bN as P,aO as R,aE as L,aR as U,aQ as Y,aA as V,ay as D,aP as W,bv as q,aS as Q,aB as G,aT as J,bc as X,aD as Z,aU as ee,aV as ae,bI as te}from"./editor-B1Gv6Imt.js";/* empty css               */import{E as se}from"./strings-CWsqWnJP.js";/* empty css                                                                          *//* empty css                   *//* empty css                             *//* empty css                    *//* empty css                */import{a as le,E as ie}from"./index-BMD6JTpk.js";import{E as ne}from"./index-DTlQ1q15.js";import{E as oe}from"./index-CwMlfsED.js";import{E as re,a as ce}from"./index-CioEgcB2.js";import{E as de}from"./index-MILOfxAq.js";import{E as ue}from"./index-j1yneTUC.js";import{E as pe,a as fe}from"./index-DrfNVuW0.js";import{v as me}from"./directive-QSsGcSxE.js";import{E as ye}from"./index-Dt_5eAk0.js";const ve=a=>e(a)||$(a)||E(a),he=a({accordion:Boolean,modelValue:{type:l([Array,String,Number]),default:()=>i([])},expandIconPosition:{type:l([String]),default:"right"},beforeCollapse:{type:l(Function)}}),be={[s]:ve,[t]:ve},_e=Symbol("collapseContextKey"),ge=K({name:"ElCollapse"});var xe=d(K({...ge,props:he,emits:be,setup(e,{expose:a,emit:l}){const i=e,{activeNames:d,setActiveNames:u}=((e,a)=>{const l=j(n(e.modelValue)),i=i=>{l.value=i;const n=e.accordion?l.value[0]:l.value;a(s,n),a(t,n)},o=a=>{if(e.accordion)i([l.value[0]===a?"":a]);else{const e=[...l.value],t=e.indexOf(a);t>-1?e.splice(t,1):e.push(a),i(e)}};return z(()=>e.modelValue,()=>l.value=n(e.modelValue),{deep:!0}),B(_e,{activeNames:l,handleItemClick:async a=>{const{beforeCollapse:t}=e;if(!t)return void o(a);const s=t(a);[H(s),r(s)].includes(!0)||c("ElCollapse","beforeCollapse must return type `Promise<boolean>` or `boolean`"),H(s)?s.then(e=>{!1!==e&&o(a)}).catch(e=>{}):s&&o(a)}}),{activeNames:l,setActiveNames:i}})(i,l),{rootKls:p}=(e=>{const a=o("collapse");return{rootKls:S(()=>[a.b(),a.b(`icon-position-${e.expandIconPosition}`)])}})(i);return a({activeNames:d,setActiveNames:u}),(e,a)=>(A(),T("div",{class:M(O(p))},[N(e.$slots,"default")],2))}}),[["__file","collapse.vue"]]);const we=a({title:{type:String,default:""},name:{type:l([String,Number]),default:void 0},icon:{type:p,default:u},disabled:Boolean}),ke=K({name:"ElCollapseItem"});var Fe=d(K({...ke,props:we,setup(e,{expose:a}){const t=e,{focusing:s,id:l,isActive:i,handleFocus:n,handleHeaderClick:r,handleEnterClick:c}=(e=>{const a=P(_e),{namespace:t}=o("collapse"),s=j(!1),l=j(!1),i=f(),n=S(()=>i.current++),r=S(()=>{var a;return null!=(a=e.name)?a:`${t.value}-id-${i.prefix}-${O(n)}`}),c=S(()=>null==a?void 0:a.activeNames.value.includes(O(r)));return{focusing:s,id:n,isActive:c,handleFocus:()=>{setTimeout(()=>{l.value?l.value=!1:s.value=!0},50)},handleHeaderClick:t=>{if(e.disabled)return;const i=t.target;(null==i?void 0:i.closest("input, textarea, select"))||(null==a||a.handleItemClick(O(r)),s.value=!1,l.value=!0)},handleEnterClick:e=>{const t=e.target;(null==t?void 0:t.closest("input, textarea, select"))||(e.preventDefault(),null==a||a.handleItemClick(O(r)))}}})(t),{arrowKls:d,headKls:u,rootKls:p,itemTitleKls:y,itemWrapperKls:v,itemContentKls:h,scopedContentId:b,scopedHeadId:_}=((e,{focusing:a,isActive:t,id:s})=>{const l=o("collapse"),i=S(()=>[l.b("item"),l.is("active",O(t)),l.is("disabled",e.disabled)]),n=S(()=>[l.be("item","header"),l.is("active",O(t)),{focusing:O(a)&&!e.disabled}]),r=S(()=>[l.be("item","arrow"),l.is("active",O(t))]);return{itemTitleKls:S(()=>[l.be("item","title")]),arrowKls:r,headKls:n,rootKls:i,itemWrapperKls:S(()=>l.be("item","wrap")),itemContentKls:S(()=>l.be("item","content")),scopedContentId:S(()=>l.b(`content-${O(s)}`)),scopedHeadId:S(()=>l.b(`head-${O(s)}`))}})(t,{focusing:s,isActive:i,id:l});return a({isActive:i}),(e,a)=>(A(),T("div",{class:M(O(p))},[R("div",{id:O(_),class:M(O(u)),"aria-expanded":O(i),"aria-controls":O(b),"aria-describedby":O(b),tabindex:e.disabled?-1:0,role:"button",onClick:O(r),onKeydown:q(Q(O(c),["stop"]),["space","enter"]),onFocus:O(n),onBlur:e=>s.value=!1},[R("span",{class:M(O(y))},[N(e.$slots,"title",{isActive:O(i)},()=>[U(Y(e.title),1)])],2),N(e.$slots,"icon",{isActive:O(i)},()=>[L(O(m),{class:M(O(d))},{default:V(()=>[(A(),D(W(e.icon)))]),_:1},8,["class"])])],42,["id","aria-expanded","aria-controls","aria-describedby","tabindex","onClick","onKeydown","onFocus","onBlur"]),L(O(ue),null,{default:V(()=>[G(R("div",{id:O(b),role:"region",class:M(O(v)),"aria-hidden":!O(i),"aria-labelledby":O(_)},[R("div",{class:M(O(h))},[N(e.$slots,"default")],2)],10,["id","aria-hidden","aria-labelledby"]),[[J,O(i)]])]),_:3})],2))}}),[["__file","collapse-item.vue"]]);const Ce=y(xe,{CollapseItem:Fe}),Ie=v(Fe);function $e(e={}){const{onFileLoaded:a,onFileCancelled:t,onSyncSuccess:s}=e,l=j(!1),i=j(null),n=j(!1),o=j(!1),r=S(()=>!!i.value),c=e=>({technicalFile:"ÊäÄÊúØÈúÄÊ±ÇÊñá‰ª∂",tenderFile:"ÊãõÊ†áÊñáÊ°£",templateFile:"Â∫îÁ≠îÊ®°Êùø",businessResponseFile:"ÂïÜÂä°Â∫îÁ≠îÊñá‰ª∂",p2pResponseFile:"ÁÇπÂØπÁÇπÂ∫îÁ≠îÊñá‰ª∂",techProposalFile:"ÊäÄÊúØÊñπÊ°àÊñá‰ª∂"}[e]||"Êñá‰ª∂");return{useHitlFile:l,hitlFileInfo:i,hasHitlFile:r,syncing:n,synced:o,loadFromHITL:(e,t="technicalFile")=>{const s=e[t];return s?(i.value={filename:s.filename||s.name||"Êú™Áü•Êñá‰ª∂",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},l.value=!0,o.value=!1,h.success({message:`Â∑≤Âä†ËΩΩHITL${c(t)}: ${i.value.filename}`,duration:3e3}),a&&a(i.value),!0):(h.warning(`ÂΩìÂâçÈ°πÁõÆÊ≤°Êúâ${c(t)}`),!1)},cancelHitlFile:()=>{l.value=!1,i.value=null,o.value=!1,h.info("Â∑≤ÂèñÊ∂à‰ΩøÁî®HITLÊñá‰ª∂"),t&&t()},syncToHitl:async(e,a,t)=>{if(!e)return h.error("È°πÁõÆIDÊó†Êïà"),!1;if(!a)return h.error("Êñá‰ª∂Ë∑ØÂæÑÊó†Êïà"),!1;n.value=!0;try{const l=await fetch(`/api/tender-processing/sync-file/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:a,file_type:t})}),i=l.headers.get("content-type");if(!(null==i?void 0:i.includes("application/json"))){await l.text();throw new Error(`ÊúçÂä°Âô®ËøîÂõûÂºÇÂ∏∏ÂìçÂ∫î (${l.status}): ${l.statusText}„ÄÇÂèØËÉΩÊòØÂêéÁ´ØÈÖçÁΩÆÈóÆÈ¢òÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëò„ÄÇ`)}const n=await l.json();if(n.success||l.ok)return o.value=!0,h.success({message:n.message||"Â∑≤ÊàêÂäüÂêåÊ≠•Âà∞ÊäïÊ†áÈ°πÁõÆ",duration:3e3}),s&&await s(),!0;throw new Error(n.error||n.message||"ÂêåÊ≠•Â§±Ë¥•")}catch(l){let e="ÂêåÊ≠•Âà∞È°πÁõÆÂ§±Ë¥•";return l.message?e=l.message:"TypeError"===l.name&&(e="ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•"),h.error({message:e,duration:5e3}),!1}finally{n.value=!1}},resetSyncStatus:()=>{o.value=!1}}}function Ee(e,a="YYYY-MM-DD"){return e?X(e).format(a):""}function je(e,a=2){if(null==e||0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(a)} ${["B","KB","MB","GB","TB","PB"][t]}`}const ze={class:"stats-card"},Se={key:0,class:"stats-title"},Be={class:"stat-item"},He={class:"stat-prefix"},Ke={class:"stat-suffix"},Te=b(K({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const a=e,t=[{key:"total_replacements",label:"ÊñáÊú¨ÊõøÊç¢",suffix:"Â§Ñ"},{key:"tables_processed",label:"Ë°®Ê†ºÂ§ÑÁêÜ",suffix:"‰∏™"},{key:"cells_filled",label:"ÂçïÂÖÉÊ†ºÂ°´ÂÖÖ",suffix:"‰∏™"},{key:"images_inserted",label:"ÂõæÁâáÊèíÂÖ•",suffix:"Âº†"}],s=S(()=>a.statItems||t),l=e=>{const t=e.split(".");let s=a.stats;for(const a of t)if(s=null==s?void 0:s[a],null==s)break;return"number"==typeof s?s:0};return(a,t)=>{const i=ne,n=ie,o=le;return A(),T("div",ze,[e.title?(A(),T("h4",Se,Y(e.title),1)):Z("",!0),L(o,{gutter:e.gutter},{default:V(()=>[(A(!0),T(ee,null,ae(s.value,a=>(A(),D(n,{key:a.key,span:e.span},{default:V(()=>[R("div",Be,[L(i,{title:a.label,value:l(a.key),precision:a.precision,"value-style":e.valueStyle},te({_:2},[a.prefix?{name:"prefix",fn:V(()=>[R("span",He,Y(a.prefix),1)]),key:"0"}:void 0,a.suffix?{name:"suffix",fn:V(()=>[R("span",Ke,Y(a.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),Ae={class:"alert-content"},Ne={class:"file-info"},Me={class:"file-details"},Oe={class:"file-label"},Pe={class:"file-name"},Re={key:0,class:"file-size"},Le={class:"alert-actions"},Ue=b(K({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"‰ΩøÁî®HITLÊñá‰ª∂:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"ÂèñÊ∂à‰ΩøÁî®"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:a}){const t=a,s=()=>{t("cancel")};return(a,t)=>{const l=m,i=se,n=x,o=g;return e.fileInfo?(A(),D(o,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:V(()=>[R("div",Ae,[R("div",Ne,[L(l,{class:"file-icon"},{default:V(()=>[L(O(_))]),_:1}),R("div",Me,[R("span",Oe,Y(e.label),1),R("span",Pe,Y(e.fileInfo.filename),1),e.fileInfo.file_size?(A(),T("span",Re," ("+Y(O(je)(e.fileInfo.file_size))+") ",1)):Z("",!0),e.showTag?(A(),D(i,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:V(()=>[...t[0]||(t[0]=[U(" Â∑≤‰ªéÊäïÊ†áÈ°πÁõÆÂä†ËΩΩ ",-1)])]),_:1})):Z("",!0)])]),R("div",Le,[N(a.$slots,"actions",{},()=>[e.showCancel?(A(),D(n,{key:0,type:"text",size:"small",onClick:s},{default:V(()=>[L(l,null,{default:V(()=>[L(O(w))]),_:1}),U(" "+Y(e.cancelText),1)]),_:1})):Z("",!0)],!0)])])]),_:3},8,["type"])):Z("",!0)}}}),[["__scopeId","data-v-1a132715"]]),Ye={class:"history-files-panel"},Ve={class:"card-header"},De={class:"header-title"},We={class:"current-file-content"},qe={class:"history-actions"},Qe={class:"collapse-header"},Ge={class:"filename-cell"},Je=b(K({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"ËØ•È°πÁõÆÂ∑≤ÊúâÁîüÊàêÊñá‰ª∂"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const a=j([]),t=e=>{if(!e)return"-";let a=e;try{a=decodeURIComponent(e)}catch{}const t=a.split("/");return t[t.length-1]||"-"};return(s,l)=>{const i=se,n=g,o=ce,r=de,c=re,d=m,u=x,p=oe,f=fe,y=pe,v=ye,h=Ie,b=Ce,w=me;return A(),T("div",Ye,[e.currentFile?(A(),D(p,{key:0,shadow:"never",class:"current-file-card"},{header:V(()=>[R("div",Ve,[R("div",De,[R("span",null,Y(e.title||"üìÑ ËØ•È°πÁõÆÁöÑÁîüÊàêÊñá‰ª∂"),1),L(i,{type:"info"},{default:V(()=>[...l[6]||(l[6]=[U("ÂéÜÂè≤Êñá‰ª∂",-1)])]),_:1})])])]),default:V(()=>[R("div",We,[L(n,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(A(),D(Te,{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):Z("",!0),L(c,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:V(()=>[L(o,{label:"Êñá‰ª∂Âêç"},{default:V(()=>[U(Y(t(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),L(o,{label:"‰∏ãËΩΩÂú∞ÂùÄ"},{default:V(()=>[L(r,{href:e.currentFile.downloadUrl,type:"primary"},{default:V(()=>[U(Y(t(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),R("div",qe,[e.showEditorOpen?(A(),D(u,{key:0,type:"primary",size:"large",onClick:l[0]||(l[0]=a=>s.$emit("openInEditor",e.currentFile))},{default:V(()=>[L(d,null,{default:V(()=>[L(O(k))]),_:1}),l[7]||(l[7]=U(" Âú®ÁºñËæëÂô®‰∏≠ÊâìÂºÄ ",-1))]),_:1})):Z("",!0),L(u,{type:"primary",size:"large",icon:O(F),onClick:l[1]||(l[1]=a=>s.$emit("preview",e.currentFile))},{default:V(()=>[...l[8]||(l[8]=[U(" È¢ÑËßàWord ",-1)])]),_:1},8,["icon"]),L(u,{type:"success",size:"large",icon:O(C),onClick:l[2]||(l[2]=a=>s.$emit("download",e.currentFile))},{default:V(()=>[...l[9]||(l[9]=[U(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(A(),D(u,{key:1,size:"large",icon:O(I),onClick:l[3]||(l[3]=e=>s.$emit("regenerate"))},{default:V(()=>[...l[10]||(l[10]=[U(" ÈáçÊñ∞ÁîüÊàê ",-1)])]),_:1},8,["icon"])):Z("",!0)])])]),_:1})):Z("",!0),e.historyFiles.length>0?(A(),D(b,{key:1,modelValue:a.value,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value=e),class:"history-collapse"},{default:V(()=>[L(h,{name:"history"},{title:V(()=>[R("div",Qe,[R("span",null,"üìÇ Êü•ÁúãÊâÄÊúâÂéÜÂè≤Â§ÑÁêÜÊñá‰ª∂ ("+Y(e.historyFiles.length)+")",1),a.value.includes("history")?(A(),D(u,{key:0,type:"primary",size:"small",loading:e.loading,onClick:l[4]||(l[4]=Q(e=>s.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:V(()=>[...l[11]||(l[11]=[U(" Âà∑Êñ∞ÂàóË°® ",-1)])]),_:1},8,["loading"])):Z("",!0)])]),default:V(()=>[L(p,{shadow:"never",style:{border:"none"}},{default:V(()=>[G((A(),D(y,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:V(()=>[L(f,{type:"index",label:"Â∫èÂè∑",width:"60"}),L(f,{prop:"filename",label:"Êñá‰ª∂Âêç","min-width":"300"},{default:V(({row:e})=>[R("div",Ge,[L(d,null,{default:V(()=>[L(O(_))]),_:1}),R("span",null,Y(e.filename),1)])]),_:1}),L(f,{prop:"size",label:"Êñá‰ª∂Â§ßÂ∞è",width:"120"},{default:V(({row:e})=>[U(Y(O(je)(e.size)),1)]),_:1}),L(f,{prop:"process_time",label:"Â§ÑÁêÜÊó∂Èó¥",width:"180"},{default:V(({row:e})=>[U(Y(O(Ee)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),L(f,{label:"Êìç‰Ωú",width:"200",fixed:"right"},{default:V(({row:e})=>[L(u,{type:"primary",size:"small",onClick:a=>s.$emit("preview",e)},{default:V(()=>[...l[12]||(l[12]=[U(" È¢ÑËßà ",-1)])]),_:1},8,["onClick"]),L(u,{type:"success",size:"small",onClick:a=>s.$emit("download",e)},{default:V(()=>[...l[13]||(l[13]=[U(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[w,e.loading]]),e.loading||0!==e.historyFiles.length?Z("",!0):(A(),D(v,{key:0,description:"ÊöÇÊó†ÂéÜÂè≤Êñá‰ª∂","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):Z("",!0)])}}}),[["__scopeId","data-v-6814751e"]]);function Xe(e,a){const t="string"==typeof e?e:URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s),"string"!=typeof e&&URL.revokeObjectURL(t)}export{Ie as E,Ue as H,Te as S,Ce as a,Je as b,Xe as d,$e as u};
