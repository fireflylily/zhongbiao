import{O as e,e as a,ao as t,ap as l,d as o,ah as r,R as i,P as s,Q as d,h as c,_ as u}from"./index.js";import{E as m}from"./el-input-number-CxPHQW_D.js";/* empty css                                                                          *//* empty css                             *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                */import{am as n,an as p,ao as _,aX as v,au as y,ar as g,aw as f,ax as h,as as j,ay as V,aC as b,aq as w,az as x,aA as k,aD as C,aV as E}from"./editor-DtHwR8yc.js";import{L as U}from"./Loading-CEvPa6xQ.js";import{E as $}from"./Empty-CGgUzHTC.js";/* empty css                */import{C as z}from"./Card-LFFlZQNZ.js";/* empty css                                                        *//* empty css                   *//* empty css                */import{E as P}from"./index-DYtF0M78.js";import{a as T,E as O}from"./index-O5klVD5D.js";import{E as q,a as D}from"./index-2X3NYXDr.js";import{E as L}from"./index-BkIdrdH2.js";import"./index-BuyGakHy.js";import"./index-B1D0B4Gf.js";import"./index-CEDA0eDv.js";import"./index-BCSTGAKU.js";import"./flatMap-BdIFri63.js";import"./map-l56HRvAj.js";import"./_baseIteratee-ByQT0QPi.js";import"./_baseEach-Dq22CNAR.js";import"./index-CzeRX9sj.js";import"./toNumber-D7Yc6kTN.js";import"./index-DL_Xf39J.js";import"./raf-BZHcGSIv.js";const R={class:"product-categories"},S={class:"stats-bar"},F={class:"stat-content"},H={class:"stat-icon"},N={class:"stat-info"},A={class:"stat-value"},I={class:"stat-content"},J={class:"stat-icon"},Q={class:"stat-info"},G={class:"stat-value"},M={key:2,class:"categories-list"},X={class:"category-header"},B={class:"category-info"},K={class:"category-name"},W={class:"items-container"},Y="/api",Z=u(n({__name:"ProductCategories",setup(u){const{success:n,error:Z}=e(),ee=p(!1),ae=p(!1),te=p([]),le=p([]),oe=p(!1),re=p("create"),ie=p({category_id:null,category_name:"",category_code:"",category_description:"",category_order:999}),se=p(),de={category_name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],category_code:[{required:!0,message:"请输入分类代码",trigger:"blur"}]},ce=p(!1),ue=p("create"),me=p(null),ne=p({item_id:null,item_name:"",item_code:"",item_description:"",item_order:999}),pe=p(),_e={item_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},ve=_(()=>te.value.reduce((e,a)=>e+a.items.length,0)),ye=async()=>{ee.value=!0;try{const e=await fetch(`${Y}/product-categories`),a=await e.json();a.success?te.value=a.data||[]:Z("加载失败",a.error||"未知错误")}catch(e){Z("加载失败",e instanceof Error?e.message:"未知错误")}finally{ee.value=!1}},ge=()=>{re.value="create",ie.value={category_id:null,category_name:"",category_code:"",category_description:"",category_order:999},oe.value=!0},fe=async()=>{se.value&&await se.value.validate(async e=>{if(e){ae.value=!0;try{const e="edit"===re.value,a=e?`${Y}/product-categories/${ie.value.category_id}`:`${Y}/product-categories`,t=await fetch(a,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie.value)}),l=await t.json();l.success?(n(e?"更新成功":"创建成功",l.message),oe.value=!1,await ye()):Z(e?"更新失败":"创建失败",l.error||"未知错误")}catch(a){Z("保存失败",a instanceof Error?a.message:"未知错误")}finally{ae.value=!1}}})},he=async()=>{pe.value&&me.value&&await pe.value.validate(async e=>{if(e){ae.value=!0;try{const e="edit"===ue.value,a=e?`${Y}/product-category-items/${ne.value.item_id}`:`${Y}/product-categories/${me.value.category_id}/items`,t=await fetch(a,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne.value)}),l=await t.json();l.success?(n(e?"更新成功":"创建成功",l.message),ce.value=!1,await ye()):Z(e?"更新失败":"创建失败",l.error||"未知错误")}catch(a){Z("保存失败",a instanceof Error?a.message:"未知错误")}finally{ae.value=!1}}})};return v(()=>{ye()}),(e,u)=>{const p=a,_=P,v=o,je=L,Ve=D,be=q,we=O,xe=T,ke=d,Ce=s,Ee=m,Ue=i,$e=c;return g(),y("div",R,[f("div",S,[h(_,{class:"stat-card"},{default:j(()=>[f("div",F,[f("div",H,[h(p,{size:32,color:"#409eff"},{default:j(()=>[h(V(t))]),_:1})]),f("div",N,[u[14]||(u[14]=f("div",{class:"stat-label"},"产品分类",-1)),f("div",A,b(te.value.length),1)])])]),_:1}),h(_,{class:"stat-card"},{default:j(()=>[f("div",I,[f("div",J,[h(p,{size:32,color:"#67c23a"},{default:j(()=>[h(V(l))]),_:1})]),f("div",Q,[u[15]||(u[15]=f("div",{class:"stat-label"},"总项目数",-1)),f("div",G,b(ve.value),1)])])]),_:1})]),h(V(z),{title:"产品分类管理"},{extra:j(()=>[h(v,{type:"primary",onClick:ge},{default:j(()=>[h(p,null,{default:j(()=>[h(V(r))]),_:1}),u[16]||(u[16]=C(" 新建分类 ",-1))]),_:1})]),default:j(()=>[ee.value?(g(),w(V(U),{key:0,text:"加载中..."})):te.value.length?(g(),y("div",M,[h(xe,{modelValue:le.value,"onUpdate:modelValue":u[1]||(u[1]=e=>le.value=e),accordion:""},{default:j(()=>[(g(!0),y(x,null,k(te.value,e=>(g(),w(we,{key:e.category_id,name:e.category_id},{title:j(()=>[f("div",X,[f("div",B,[f("span",K,b(e.category_name),1),h(je,{size:"small",type:"info",class:"category-tag"},{default:j(()=>[C(b(e.items.length)+" 项 ",1)]),_:2},1024)]),f("div",{class:"category-actions",onClick:u[0]||(u[0]=E(()=>{},["stop"]))},[h(v,{text:"",type:"primary",size:"small",onClick:a=>(e=>{me.value=e,ue.value="create",ne.value={item_id:null,item_name:"",item_code:"",item_description:"",item_order:999},ce.value=!0})(e)},{default:j(()=>[h(p,null,{default:j(()=>[h(V(r))]),_:1}),u[17]||(u[17]=C(" 添加项 ",-1))]),_:1},8,["onClick"]),h(v,{text:"",type:"warning",size:"small",onClick:a=>(e=>{re.value="edit",ie.value={category_id:e.category_id,category_name:e.category_name,category_code:e.category_code,category_description:e.category_description||"",category_order:e.category_order||999},oe.value=!0})(e)},{default:j(()=>[...u[18]||(u[18]=[C(" 编辑 ",-1)])]),_:1},8,["onClick"]),h(v,{text:"",type:"danger",size:"small",onClick:a=>(async e=>{try{if(!confirm(`确定要删除分类 "${e.category_name}" 吗？此操作将同时删除该分类下的所有项目。`))return;const a=await fetch(`${Y}/product-categories/${e.category_id}`,{method:"DELETE"}),t=await a.json();t.success?(n("删除成功",t.message),await ye()):Z("删除失败",t.error||"未知错误")}catch(a){Z("删除失败",a instanceof Error?a.message:"未知错误")}})(e)},{default:j(()=>[...u[19]||(u[19]=[C(" 删除 ",-1)])]),_:1},8,["onClick"])])])]),default:j(()=>[f("div",W,[h(be,{data:e.items,stripe:""},{default:j(()=>[h(Ve,{prop:"item_name",label:"项目名称",width:"200"}),h(Ve,{prop:"item_code",label:"代码",width:"180"}),h(Ve,{prop:"item_description",label:"描述","show-overflow-tooltip":""}),h(Ve,{prop:"item_order",label:"排序",width:"80",align:"center"}),h(Ve,{label:"操作",width:"180",fixed:"right"},{default:j(({row:a})=>[h(v,{text:"",type:"warning",size:"small",onClick:t=>((e,a)=>{me.value=e,ue.value="edit",ne.value={item_id:a.item_id,item_name:a.item_name,item_code:a.item_code||"",item_description:a.item_description||"",item_order:a.item_order||999},ce.value=!0})(e,a)},{default:j(()=>[...u[20]||(u[20]=[C(" 编辑 ",-1)])]),_:1},8,["onClick"]),h(v,{text:"",type:"danger",size:"small",onClick:e=>(async(e,a)=>{try{if(!confirm(`确定要删除项目 "${a.item_name}" 吗？`))return;const e=await fetch(`${Y}/product-category-items/${a.item_id}`,{method:"DELETE"}),t=await e.json();t.success?(n("删除成功",t.message),await ye()):Z("删除失败",t.error||"未知错误")}catch(t){Z("删除失败",t instanceof Error?t.message:"未知错误")}})(0,a)},{default:j(()=>[...u[21]||(u[21]=[C(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])):(g(),w(V($),{key:1,type:"no-data",description:"暂无产品分类"}))]),_:1}),h($e,{modelValue:oe.value,"onUpdate:modelValue":u[7]||(u[7]=e=>oe.value=e),title:"create"===re.value?"新建分类":"编辑分类",width:"500px"},{footer:j(()=>[h(v,{onClick:u[6]||(u[6]=e=>oe.value=!1)},{default:j(()=>[...u[22]||(u[22]=[C("取消",-1)])]),_:1}),h(v,{type:"primary",onClick:fe,loading:ae.value},{default:j(()=>[...u[23]||(u[23]=[C(" 保存 ",-1)])]),_:1},8,["loading"])]),default:j(()=>[h(Ue,{model:ie.value,rules:de,ref_key:"categoryFormRef",ref:se,"label-width":"100px"},{default:j(()=>[h(Ce,{label:"分类名称",prop:"category_name"},{default:j(()=>[h(ke,{modelValue:ie.value.category_name,"onUpdate:modelValue":u[2]||(u[2]=e=>ie.value.category_name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),h(Ce,{label:"分类代码",prop:"category_code"},{default:j(()=>[h(ke,{modelValue:ie.value.category_code,"onUpdate:modelValue":u[3]||(u[3]=e=>ie.value.category_code=e),placeholder:"请输入分类代码（英文）",disabled:"edit"===re.value},null,8,["modelValue","disabled"])]),_:1}),h(Ce,{label:"分类描述",prop:"category_description"},{default:j(()=>[h(ke,{modelValue:ie.value.category_description,"onUpdate:modelValue":u[4]||(u[4]=e=>ie.value.category_description=e),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),h(Ce,{label:"排序",prop:"category_order"},{default:j(()=>[h(Ee,{modelValue:ie.value.category_order,"onUpdate:modelValue":u[5]||(u[5]=e=>ie.value.category_order=e),min:1,max:999},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),h($e,{modelValue:ce.value,"onUpdate:modelValue":u[13]||(u[13]=e=>ce.value=e),title:"create"===ue.value?"新建项目":"编辑项目",width:"500px"},{footer:j(()=>[h(v,{onClick:u[12]||(u[12]=e=>ce.value=!1)},{default:j(()=>[...u[24]||(u[24]=[C("取消",-1)])]),_:1}),h(v,{type:"primary",onClick:he,loading:ae.value},{default:j(()=>[...u[25]||(u[25]=[C(" 保存 ",-1)])]),_:1},8,["loading"])]),default:j(()=>[h(Ue,{model:ne.value,rules:_e,ref_key:"itemFormRef",ref:pe,"label-width":"100px"},{default:j(()=>[h(Ce,{label:"项目名称",prop:"item_name"},{default:j(()=>[h(ke,{modelValue:ne.value.item_name,"onUpdate:modelValue":u[8]||(u[8]=e=>ne.value.item_name=e),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),h(Ce,{label:"项目代码",prop:"item_code"},{default:j(()=>[h(ke,{modelValue:ne.value.item_code,"onUpdate:modelValue":u[9]||(u[9]=e=>ne.value.item_code=e),placeholder:"请输入项目代码（英文）"},null,8,["modelValue"])]),_:1}),h(Ce,{label:"项目描述",prop:"item_description"},{default:j(()=>[h(ke,{modelValue:ne.value.item_description,"onUpdate:modelValue":u[10]||(u[10]=e=>ne.value.item_description=e),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),h(Ce,{label:"排序",prop:"item_order"},{default:j(()=>[h(Ee,{modelValue:ne.value.item_order,"onUpdate:modelValue":u[11]||(u[11]=e=>ne.value.item_order=e),min:1,max:999},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-d7e3da5a"]]);export{Z as default};
