import{k as e,I as t,G as l,H as a,d as s,D as i,F as n,v as r,c as o,a9 as u,P as c,V as d,n as f,Y as p,aa as y,Z as m,_,a0 as h,a2 as v,a5 as g,J as w,K as F,O as k,a1 as b}from"./element-plus-ZLeSHaWT.js";import{r as x,c as I,v as z,x as C,I as $,O as H,L as B,F as T,M as S,aa as M,y as j,E as L,B as E,af as R,u as Y,K as O,z as U,G as D,S as P}from"./vue-core-CiAVTOOY.js";/* empty css                                                                          */import{_ as V}from"./index.js";import{d as G}from"./utils-CTJnFPw-.js";function K(t={}){const{onFileLoaded:l,onFileCancelled:a,onSyncSuccess:s}=t,i=x(!1),n=x(null),r=x(!1),o=x(!1),u=I(()=>!!n.value),c=e=>({technicalFile:"ÊäÄÊúØÈúÄÊ±ÇÊñá‰ª∂",tenderFile:"ÊãõÊ†áÊñáÊ°£",templateFile:"Â∫îÁ≠îÊ®°Êùø",businessResponseFile:"ÂïÜÂä°Â∫îÁ≠îÊñá‰ª∂",p2pResponseFile:"ÁÇπÂØπÁÇπÂ∫îÁ≠îÊñá‰ª∂",techProposalFile:"ÊäÄÊúØÊñπÊ°àÊñá‰ª∂"}[e]||"Êñá‰ª∂");return{useHitlFile:i,hitlFileInfo:n,hasHitlFile:u,syncing:r,synced:o,loadFromHITL:(t,a="technicalFile")=>{const s=t[a];return s?(n.value={filename:s.filename||s.name||"Êú™Áü•Êñá‰ª∂",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},i.value=!0,o.value=!1,e.success({message:`Â∑≤Âä†ËΩΩHITL${c(a)}: ${n.value.filename}`,duration:3e3}),l&&l(n.value),!0):(e.warning(`ÂΩìÂâçÈ°πÁõÆÊ≤°Êúâ${c(a)}`),!1)},cancelHitlFile:()=>{i.value=!1,n.value=null,o.value=!1,e.info("Â∑≤ÂèñÊ∂à‰ΩøÁî®HITLÊñá‰ª∂"),a&&a()},syncToHitl:async(t,l,a)=>{if(!t)return e.error("È°πÁõÆIDÊó†Êïà"),!1;if(!l)return e.error("Êñá‰ª∂Ë∑ØÂæÑÊó†Êïà"),!1;r.value=!0;try{const i=await fetch(`/api/tender-processing/sync-file/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:l,file_type:a})}),n=i.headers.get("content-type");if(!(null==n?void 0:n.includes("application/json"))){await i.text();throw new Error(`ÊúçÂä°Âô®ËøîÂõûÂºÇÂ∏∏ÂìçÂ∫î (${i.status}): ${i.statusText}„ÄÇÂèØËÉΩÊòØÂêéÁ´ØÈÖçÁΩÆÈóÆÈ¢òÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëò„ÄÇ`)}const r=await i.json();if(r.success||i.ok)return o.value=!0,e.success({message:r.message||"Â∑≤ÊàêÂäüÂêåÊ≠•Âà∞ÊäïÊ†áÈ°πÁõÆ",duration:3e3}),s&&await s(),!0;throw new Error(r.error||r.message||"ÂêåÊ≠•Â§±Ë¥•")}catch(i){let t="ÂêåÊ≠•Âà∞È°πÁõÆÂ§±Ë¥•";return i.message?t=i.message:"TypeError"===i.name&&(t="ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•"),e.error({message:t,duration:5e3}),!1}finally{r.value=!1}},resetSyncStatus:()=>{o.value=!1}}}function J(e,t="YYYY-MM-DD"){return e?G(e).format(t):""}function A(e,t=2){if(null==e||0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,l)).toFixed(t)} ${["B","KB","MB","GB","TB","PB"][l]}`}const N={class:"stats-card"},W={key:0,class:"stats-title"},Z={class:"stat-item"},q={class:"stat-prefix"},Q={class:"stat-suffix"},X=V(z({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const s=e,i=[{key:"total_replacements",label:"ÊñáÊú¨ÊõøÊç¢",suffix:"Â§Ñ"},{key:"tables_processed",label:"Ë°®Ê†ºÂ§ÑÁêÜ",suffix:"‰∏™"},{key:"cells_filled",label:"ÂçïÂÖÉÊ†ºÂ°´ÂÖÖ",suffix:"‰∏™"},{key:"images_inserted",label:"ÂõæÁâáÊèíÂÖ•",suffix:"Âº†"}],n=I(()=>s.statItems||i),r=e=>{const t=e.split(".");let l=s.stats;for(const a of t)if(l=null==l?void 0:l[a],null==l)break;return"number"==typeof l?l:0};return(s,i)=>{const o=a,u=l,c=t;return j(),C("div",N,[e.title?(j(),C("h4",W,B(e.title),1)):$("",!0),H(c,{gutter:e.gutter},{default:T(()=>[(j(!0),C(S,null,M(n.value,t=>(j(),L(u,{key:t.key,span:e.span},{default:T(()=>[E("div",Z,[H(o,{title:t.label,value:r(t.key),precision:t.precision,"value-style":e.valueStyle},R({_:2},[t.prefix?{name:"prefix",fn:T(()=>[E("span",q,B(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:T(()=>[E("span",Q,B(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),ee={class:"alert-content"},te={class:"file-info"},le={class:"file-details"},ae={class:"file-label"},se={class:"file-name"},ie={key:0,class:"file-size"},ne={class:"alert-actions"},re=V(z({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"‰ΩøÁî®HITLÊñá‰ª∂:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"ÂèñÊ∂à‰ΩøÁî®"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:t}){const l=t,a=()=>{l("cancel")};return(t,l)=>{const c=i,d=r,f=o,p=s;return e.fileInfo?(j(),L(p,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:T(()=>[E("div",ee,[E("div",te,[H(c,{class:"file-icon"},{default:T(()=>[H(Y(n))]),_:1}),E("div",le,[E("span",ae,B(e.label),1),E("span",se,B(e.fileInfo.filename),1),e.fileInfo.file_size?(j(),C("span",ie," ("+B(Y(A)(e.fileInfo.file_size))+") ",1)):$("",!0),e.showTag?(j(),L(d,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:T(()=>[...l[0]||(l[0]=[O(" Â∑≤‰ªéÊäïÊ†áÈ°πÁõÆÂä†ËΩΩ ",-1)])]),_:1})):$("",!0)])]),E("div",ne,[U(t.$slots,"actions",{},()=>[e.showCancel?(j(),L(f,{key:0,type:"text",size:"small",onClick:a},{default:T(()=>[H(c,null,{default:T(()=>[H(Y(u))]),_:1}),O(" "+B(e.cancelText),1)]),_:1})):$("",!0)],!0)])])]),_:3},8,["type"])):$("",!0)}}}),[["__scopeId","data-v-1a132715"]]),oe={class:"history-files-panel"},ue={class:"card-header"},ce={class:"header-title"},de={class:"current-file-content"},fe={class:"history-actions"},pe={class:"collapse-header"},ye={class:"filename-cell"},me=V(z({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"ËØ•È°πÁõÆÂ∑≤ÊúâÁîüÊàêÊñá‰ª∂"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const t=x([]),l=e=>{if(!e)return"-";let t=e;try{t=decodeURIComponent(e)}catch{}const l=t.split("/");return l[l.length-1]||"-"};return(a,u)=>{const x=r,I=s,z=d,S=f,M=p,R=i,U=o,V=c,G=F,K=w,N=k,W=b,Z=v,q=g;return j(),C("div",oe,[e.currentFile?(j(),L(V,{key:0,shadow:"never",class:"current-file-card"},{header:T(()=>[E("div",ue,[E("div",ce,[E("span",null,B(e.title||"üìÑ ËØ•È°πÁõÆÁöÑÁîüÊàêÊñá‰ª∂"),1),H(x,{type:"info"},{default:T(()=>[...u[6]||(u[6]=[O("ÂéÜÂè≤Êñá‰ª∂",-1)])]),_:1})])])]),default:T(()=>[E("div",de,[H(I,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(j(),L(X,{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):$("",!0),H(M,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:T(()=>[H(z,{label:"Êñá‰ª∂Âêç"},{default:T(()=>[O(B(l(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),H(z,{label:"‰∏ãËΩΩÂú∞ÂùÄ"},{default:T(()=>[H(S,{href:e.currentFile.downloadUrl,type:"primary"},{default:T(()=>[O(B(l(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),E("div",fe,[e.showEditorOpen?(j(),L(U,{key:0,type:"primary",size:"large",onClick:u[0]||(u[0]=t=>a.$emit("openInEditor",e.currentFile))},{default:T(()=>[H(R,null,{default:T(()=>[H(Y(y))]),_:1}),u[7]||(u[7]=O(" Âú®ÁºñËæëÂô®‰∏≠ÊâìÂºÄ ",-1))]),_:1})):$("",!0),H(U,{type:"primary",size:"large",icon:Y(m),onClick:u[1]||(u[1]=t=>a.$emit("preview",e.currentFile))},{default:T(()=>[...u[8]||(u[8]=[O(" È¢ÑËßàWord ",-1)])]),_:1},8,["icon"]),H(U,{type:"success",size:"large",icon:Y(_),onClick:u[2]||(u[2]=t=>a.$emit("download",e.currentFile))},{default:T(()=>[...u[9]||(u[9]=[O(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(j(),L(U,{key:1,size:"large",icon:Y(h),onClick:u[3]||(u[3]=e=>a.$emit("regenerate"))},{default:T(()=>[...u[10]||(u[10]=[O(" ÈáçÊñ∞ÁîüÊàê ",-1)])]),_:1},8,["icon"])):$("",!0)])])]),_:1})):$("",!0),e.historyFiles.length>0?(j(),L(Z,{key:1,modelValue:t.value,"onUpdate:modelValue":u[5]||(u[5]=e=>t.value=e),class:"history-collapse"},{default:T(()=>[H(W,{name:"history"},{title:T(()=>[E("div",pe,[E("span",null,"üìÇ Êü•ÁúãÊâÄÊúâÂéÜÂè≤Â§ÑÁêÜÊñá‰ª∂ ("+B(e.historyFiles.length)+")",1),t.value.includes("history")?(j(),L(U,{key:0,type:"primary",size:"small",loading:e.loading,onClick:u[4]||(u[4]=P(e=>a.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:T(()=>[...u[11]||(u[11]=[O(" Âà∑Êñ∞ÂàóË°® ",-1)])]),_:1},8,["loading"])):$("",!0)])]),default:T(()=>[H(V,{shadow:"never",style:{border:"none"}},{default:T(()=>[D((j(),L(K,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:T(()=>[H(G,{type:"index",label:"Â∫èÂè∑",width:"60"}),H(G,{prop:"filename",label:"Êñá‰ª∂Âêç","min-width":"300"},{default:T(({row:e})=>[E("div",ye,[H(R,null,{default:T(()=>[H(Y(n))]),_:1}),E("span",null,B(e.filename),1)])]),_:1}),H(G,{prop:"size",label:"Êñá‰ª∂Â§ßÂ∞è",width:"120"},{default:T(({row:e})=>[O(B(Y(A)(e.size)),1)]),_:1}),H(G,{prop:"process_time",label:"Â§ÑÁêÜÊó∂Èó¥",width:"180"},{default:T(({row:e})=>[O(B(Y(J)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),H(G,{label:"Êìç‰Ωú",width:"200",fixed:"right"},{default:T(({row:e})=>[H(U,{type:"primary",size:"small",onClick:t=>a.$emit("preview",e)},{default:T(()=>[...u[12]||(u[12]=[O(" È¢ÑËßà ",-1)])]),_:1},8,["onClick"]),H(U,{type:"success",size:"small",onClick:t=>a.$emit("download",e)},{default:T(()=>[...u[13]||(u[13]=[O(" ‰∏ãËΩΩ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,e.loading]]),e.loading||0!==e.historyFiles.length?$("",!0):(j(),L(N,{key:0,description:"ÊöÇÊó†ÂéÜÂè≤Êñá‰ª∂","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])):$("",!0)])}}}),[["__scopeId","data-v-6814751e"]]);function _e(e,t){const l="string"==typeof e?e:URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),"string"!=typeof e&&URL.revokeObjectURL(l)}export{re as H,X as S,me as a,_e as d,K as u};
