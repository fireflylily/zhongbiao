import{d as ve,I as ye,G as ge,f as he,i as be,aq as Le,q as $e,o as xe,Y as Te,a as oe,D as ne,ar as Ie,p as Me,as as Ge,F as ee,$ as te,at as ae,M as Je,a0 as de,Q as Ye,au as ze,b as Re,ak as He,av as De,aw as Se,ax as We,K as Xe,h as Ze,J as Ke,P as ea,ay as aa,V as la,an as ta,az as oa,aA as na,U as sa}from"./element-plus-IkZgpaz4.js";import{bT as se,bt as k,bA as Ee,bU as U,bV as y,c8 as e,bv as d,c0 as a,c5 as x,bu as fe,b$ as A,bY as s,c4 as ia,c6 as N,c3 as ce,c7 as _e,cC as pe,c2 as Pe,bG as ke,gd as ra,gi as da}from"./vendor-CdA3MjAt.js";import{L as Qe}from"./Loading-CmykbBZp.js";/* empty css                                                                          */import"./umo-editor-BmhDOXHm.js";/* empty css                                                                        */import{a as me,_ as ie}from"./index.js";import{c as O}from"./company-B1QhkZBS.js";import{C as W}from"./Card-BYP2BB2j.js";import{D as ue}from"./DocumentUploader-BBjdsRhi.js";import"./onnxruntime-DkHy2lK3.js";import"./mermaid-e-fO57px.js";import"./echarts-Cqw1j_Z-.js";import"./imageCompressor-D9CndpqW.js";const ua={class:"basic-info-tab"},ca=se({__name:"BasicInfoTab",props:{companyId:{},companyData:{}},emits:["update"],setup(R,{emit:L}){const v=R,q=L,{success:F,error:D}=me(),T=k(),I=k(!1),t=k({company_name:"",establish_date:"",legal_representative:"",legal_representative_position:"",legal_representative_gender:"",legal_representative_age:void 0,social_credit_code:"",registered_capital:"",company_type:"",registered_address:"",fixed_phone:"",fax:"",postal_code:"",email:"",business_scope:"",description:""}),E={company_name:[{required:!0,message:"请输入企业名称",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],postal_code:[{pattern:/^\d{6}$/,message:"邮政编码必须是6位数字",trigger:"blur"}]};Ee(()=>v.companyData,V=>{V&&(t.value={company_name:V.company_name||"",establish_date:V.establish_date||"",legal_representative:V.legal_representative||"",legal_representative_position:V.legal_representative_position||"",legal_representative_gender:V.legal_representative_gender||"",legal_representative_age:V.legal_representative_age||void 0,social_credit_code:V.social_credit_code||"",registered_capital:V.registered_capital||"",company_type:V.company_type||"",registered_address:V.registered_address||"",fixed_phone:V.fixed_phone||"",fax:V.fax||"",postal_code:V.postal_code||"",email:V.email||"",business_scope:V.business_scope||"",description:V.description||""})},{immediate:!0,deep:!0});const P=async()=>{T.value&&await T.value.validate(async V=>{if(V){I.value=!0;try{(await O.updateCompany(v.companyId,{companyName:t.value.company_name,establishDate:t.value.establish_date,legalRepresentative:t.value.legal_representative,legalRepresentativePosition:t.value.legal_representative_position,legalRepresentativeGender:t.value.legal_representative_gender,legalRepresentativeAge:t.value.legal_representative_age,socialCreditCode:t.value.social_credit_code,registeredCapital:t.value.registered_capital,companyType:t.value.company_type,registeredAddress:t.value.registered_address,fixedPhone:t.value.fixed_phone,fax:t.value.fax,postalCode:t.value.postal_code,email:t.value.email,businessScope:t.value.business_scope,companyDescription:t.value.description})).success&&(F("保存成功","基础信息已更新"),q("update"))}catch(i){console.error("保存基础信息失败:",i),D("保存失败",i instanceof Error?i.message:"未知错误")}finally{I.value=!1}}})};return(V,i)=>{const w=be,r=he,c=ge,o=Le,l=ye,p=xe,g=$e,z=Te,$=ne,_=oe,f=ve;return y(),U("div",ua,[e(d(W),{title:"基础信息"},{default:a(()=>[e(f,{ref_key:"formRef",ref:T,model:t.value,rules:E,"label-width":"140px",class:"basic-form"},{default:a(()=>[e(l,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(r,{label:"企业名称",prop:"company_name"},{default:a(()=>[e(w,{modelValue:t.value.company_name,"onUpdate:modelValue":i[0]||(i[0]=u=>t.value.company_name=u),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(r,{label:"成立日期",prop:"establish_date"},{default:a(()=>[e(o,{modelValue:t.value.establish_date,"onUpdate:modelValue":i[1]||(i[1]=u=>t.value.establish_date=u),type:"date",placeholder:"选择日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(r,{label:"法定代表人",prop:"legal_representative"},{default:a(()=>[e(w,{modelValue:t.value.legal_representative,"onUpdate:modelValue":i[2]||(i[2]=u=>t.value.legal_representative=u),placeholder:"请输入法定代表人"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(r,{label:"法定代表人职务",prop:"legal_representative_position"},{default:a(()=>[e(w,{modelValue:t.value.legal_representative_position,"onUpdate:modelValue":i[3]||(i[3]=u=>t.value.legal_representative_position=u),placeholder:"请输入职务"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(r,{label:"法定代表人性别",prop:"legal_representative_gender"},{default:a(()=>[e(g,{modelValue:t.value.legal_representative_gender,"onUpdate:modelValue":i[4]||(i[4]=u=>t.value.legal_representative_gender=u),placeholder:"请选择性别",style:{width:"100%"}},{default:a(()=>[e(p,{label:"男",value:"男"}),e(p,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(r,{label:"法定代表人年龄",prop:"legal_representative_age"},{default:a(()=>[e(z,{modelValue:t.value.legal_representative_age,"onUpdate:modelValue":i[5]||(i[5]=u=>t.value.legal_representative_age=u),min:18,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(r,{label:"统一社会信用代码",prop:"social_credit_code"},{default:a(()=>[e(w,{modelValue:t.value.social_credit_code,"onUpdate:modelValue":i[6]||(i[6]=u=>t.value.social_credit_code=u),placeholder:"请输入统一社会信用代码"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(r,{label:"注册资本",prop:"registered_capital"},{default:a(()=>[e(w,{modelValue:t.value.registered_capital,"onUpdate:modelValue":i[7]||(i[7]=u=>t.value.registered_capital=u),placeholder:"如：1000万元"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(r,{label:"企业类型",prop:"company_type"},{default:a(()=>[e(w,{modelValue:t.value.company_type,"onUpdate:modelValue":i[8]||(i[8]=u=>t.value.company_type=u),placeholder:"如：有限责任公司"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(r,{label:"注册地址",prop:"registered_address"},{default:a(()=>[e(w,{modelValue:t.value.registered_address,"onUpdate:modelValue":i[9]||(i[9]=u=>t.value.registered_address=u),placeholder:"请输入注册地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(r,{label:"联系电话",prop:"fixed_phone"},{default:a(()=>[e(w,{modelValue:t.value.fixed_phone,"onUpdate:modelValue":i[10]||(i[10]=u=>t.value.fixed_phone=u),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(r,{label:"传真",prop:"fax"},{default:a(()=>[e(w,{modelValue:t.value.fax,"onUpdate:modelValue":i[11]||(i[11]=u=>t.value.fax=u),placeholder:"请输入传真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(r,{label:"邮政编码",prop:"postal_code"},{default:a(()=>[e(w,{modelValue:t.value.postal_code,"onUpdate:modelValue":i[12]||(i[12]=u=>t.value.postal_code=u),placeholder:"请输入邮政编码",maxlength:"6"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(r,{label:"电子邮箱",prop:"email"},{default:a(()=>[e(w,{modelValue:t.value.email,"onUpdate:modelValue":i[13]||(i[13]=u=>t.value.email=u),placeholder:"请输入电子邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,null,{default:a(()=>[e(c,{span:24},{default:a(()=>[e(r,{label:"经营范围",prop:"business_scope"},{default:a(()=>[e(w,{modelValue:t.value.business_scope,"onUpdate:modelValue":i[14]||(i[14]=u=>t.value.business_scope=u),type:"textarea",rows:5,placeholder:"请输入经营范围"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,null,{default:a(()=>[e(c,{span:24},{default:a(()=>[e(r,{label:"企业简介",prop:"description"},{default:a(()=>[e(w,{modelValue:t.value.description,"onUpdate:modelValue":i[15]||(i[15]=u=>t.value.description=u),type:"textarea",rows:5,placeholder:"请输入企业简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l,null,{default:a(()=>[e(c,{span:24},{default:a(()=>[e(r,null,{default:a(()=>[e(_,{type:"primary",loading:I.value,onClick:P},{default:a(()=>[e($,null,{default:a(()=>[e(d(Ie))]),_:1}),i[16]||(i[16]=x(" 保存基础信息 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),_a=ie(ca,[["__scopeId","data-v-cf1705e1"]]),pa={class:"card-header"},ma={class:"qual-info"},fa={class:"qual-name"},va={class:"badges"},ya={key:0,class:"file-status"},ga={key:0,class:"single-file"},ha={class:"file-item"},ba={class:"file-details"},ka={class:"file-name"},Va={class:"file-meta"},wa={class:"file-actions"},za={key:1,class:"multiple-files"},Ca={class:"file-details"},$a={class:"file-name"},xa={class:"file-meta"},Ia={class:"file-actions"},Ea={key:1,class:"no-file"},Ua={class:"card-footer"},qa={class:"upload-section"},Fa={class:"upload-tips"},Da=se({__name:"QualificationCard",props:{qualification:{},fileInfo:{},isCustom:{type:Boolean},onUpload:{type:Function}},emits:["upload","download","delete","remove-custom"],setup(R,{emit:L}){const v=R,q=L,F=k(),D=fe(()=>v.fileInfo?v.fileInfo.allow_multiple_files?v.fileInfo.files&&v.fileInfo.files.length>0:!!v.fileInfo.original_filename:!1),T=fe(()=>{var o,l;return((o=v.fileInfo)==null?void 0:o.allow_multiple_files)&&((l=v.fileInfo)==null?void 0:l.files)}),I=fe(()=>v.qualification.key==="financial_audit_report"?".pdf,.xls,.xlsx,.jpg,.jpeg,.png":".pdf,.jpg,.jpeg,.png"),t=fe(()=>{const o=v.qualification.key;return o==="business_license"?"license":o.includes("id")||o==="legal_id_front"||o==="legal_id_back"?"id_card":o.includes("seal")?"seal":o.includes("iso")||o.includes("cmmi")||o.includes("certificate")||o.includes("qualification")||o.includes("认证")?"qualification":"default"}),E=async o=>{const{file:l,onSuccess:p,onError:g}=o;try{v.onUpload?await v.onUpload(l):q("upload",l),p({success:!0})}catch(z){g(z)}},P=()=>{q("download",v.qualification.key)},V=o=>{q("download",v.qualification.key,o)},i=()=>{q("delete",v.qualification.key)},w=o=>{q("delete",v.qualification.key,o)},r=o=>{if(!o)return"0 B";const l=1024,p=["B","KB","MB","GB"],g=Math.floor(Math.log(o)/Math.log(l));return Math.round(o/Math.pow(l,g)*100)/100+" "+p[g]},c=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return(o,l)=>{const p=ne,g=Me,z=oe,$=Je,_=Ye;return y(),A(_,{class:Pe(["qualification-card",{required:R.qualification.required,"has-file":D.value}])},{default:a(()=>[s("div",pa,[s("div",ma,[e(p,{class:"qual-icon",size:20},{default:a(()=>[(y(),A(ia(R.qualification.icon)))]),_:1}),s("span",fa,N(R.qualification.name),1)]),s("div",va,[R.qualification.required?(y(),A(g,{key:0,type:"warning",size:"small"},{default:a(()=>[...l[1]||(l[1]=[x("必需",-1)])]),_:1})):ce("",!0),R.qualification.allowMultiple?(y(),A(g,{key:1,type:"info",size:"small"},{default:a(()=>[e(p,null,{default:a(()=>[e(d(Ge))]),_:1}),l[2]||(l[2]=x(" 多文件 ",-1))]),_:1})):ce("",!0)])]),D.value?(y(),U("div",ya,[T.value?(y(),U("div",za,[(y(!0),U(_e,null,pe(R.fileInfo.files,f=>(y(),U("div",{key:f.qualification_id,class:"file-item"},[e(p,{class:"file-icon"},{default:a(()=>[e(d(ee))]),_:1}),s("div",Ca,[s("div",$a,N(f.original_filename),1),s("div",xa,[s("span",null,N(r(f.file_size)),1),l[4]||(l[4]=s("span",{class:"divider"},"•",-1)),s("span",null,N(c(f.upload_time)),1)])]),s("div",Ia,[e(z,{text:"",type:"primary",size:"small",onClick:u=>V(f.qualification_id)},{default:a(()=>[e(p,null,{default:a(()=>[e(d(te))]),_:1})]),_:1},8,["onClick"]),e(z,{text:"",type:"danger",size:"small",onClick:u=>w(f.qualification_id)},{default:a(()=>[e(p,null,{default:a(()=>[e(d(ae))]),_:1})]),_:1},8,["onClick"])])]))),128))])):(y(),U("div",ga,[s("div",ha,[e(p,{class:"file-icon"},{default:a(()=>[e(d(ee))]),_:1}),s("div",ba,[s("div",ka,N(R.fileInfo.original_filename),1),s("div",Va,[s("span",null,N(r(R.fileInfo.file_size)),1),l[3]||(l[3]=s("span",{class:"divider"},"•",-1)),s("span",null,N(c(R.fileInfo.upload_time)),1)])]),s("div",wa,[e(z,{text:"",type:"primary",size:"small",onClick:P},{default:a(()=>[e(p,null,{default:a(()=>[e(d(te))]),_:1})]),_:1}),e(z,{text:"",type:"danger",size:"small",onClick:i},{default:a(()=>[e(p,null,{default:a(()=>[e(d(ae))]),_:1})]),_:1})])])]))])):(y(),U("div",Ea,[e($,{type:"info",size:"small"},{default:a(()=>[...l[5]||(l[5]=[x("未上传文件",-1)])]),_:1})])),s("div",Ua,[s("div",qa,[e(d(ue),{ref_key:"uploaderRef",ref:F,accept:I.value,multiple:R.qualification.allowMultiple,"show-file-list":!1,"http-request":E,"max-size":20,"auto-compress-image":!0,"image-type":t.value},{trigger:a(()=>[e(z,{type:"primary",size:"small"},{default:a(()=>[e(p,null,{default:a(()=>[e(d(de))]),_:1}),x(" "+N(R.qualification.allowMultiple?"批量上传":"上传文件"),1)]),_:1})]),_:1},8,["accept","multiple","image-type"]),R.isCustom?(y(),A(z,{key:0,type:"danger",size:"small",onClick:l[0]||(l[0]=f=>o.$emit("remove-custom"))},{default:a(()=>[e(p,null,{default:a(()=>[e(d(ae))]),_:1}),l[6]||(l[6]=x(" 移除 ",-1))]),_:1})):ce("",!0)]),s("div",Fa,[e($,{type:"info",size:"small"},{default:a(()=>[...l[7]||(l[7]=[x(" 支持JPG、PNG、PDF格式 ",-1),s("span",{class:"pdf-tip"},"（PDF将自动转换为图片）",-1)])]),_:1})])])]),_:1},8,["class"])}}}),Ce=ie(Da,[["__scopeId","data-v-1923de96"]]),Ta={class:"qualification-tab"},Ma={key:1},Ra={class:"qualification-category"},Sa={class:"category-title text-secondary"},Pa=se({__name:"QualificationTab",props:{companyId:{},companyData:{}},emits:["update"],setup(R,{emit:L}){const v=R,q=L,{success:F,error:D}=me(),T=k(!1),I=k({}),t=k([]),E=k(!1),P=k({name:""}),V=[{key:"basic",name:"基本证件资质",color:"primary"},{key:"iso",name:"ISO体系认证",color:"success"},{key:"credit",name:"信用资质证明",color:"info"},{key:"industry",name:"行业专业资质",color:"danger"}],i=[{key:"business_license",name:"营业执照",icon:"Document",category:"basic",required:!0},{key:"legal_id_front",name:"法人身份证(正面)",icon:"CreditCard",category:"basic",required:!0},{key:"legal_id_back",name:"法人身份证(反面)",icon:"CreditCard",category:"basic",required:!0},{key:"bank_account_permit",name:"银行开户许可证",icon:"CreditCard",category:"basic"},{key:"tax_registration",name:"税务登记证",icon:"DocumentChecked",category:"basic"},{key:"iso9001",name:"ISO 9001质量管理体系认证",icon:"Medal",category:"iso"},{key:"iso14001",name:"ISO 14001环境管理体系认证",icon:"Medal",category:"iso"},{key:"iso27001",name:"ISO 27001信息安全管理体系认证",icon:"Lock",category:"iso"},{key:"iso20000",name:"ISO 20000 IT服务管理体系认证",icon:"Monitor",category:"iso"},{key:"dishonest_executor",name:"失信被执行人名单（信用中国）",icon:"WarningFilled",category:"credit"},{key:"tax_violation_check",name:"重大税收违法案件当事人名单（信用中国）",icon:"WarningFilled",category:"credit"},{key:"gov_procurement_creditchina",name:"政府采购严重违法失信（信用中国）",icon:"Flag",category:"credit"},{key:"gov_procurement_ccgp",name:"政府采购严重违法失信行为信息记录（政府采购网）",icon:"CircleCheck",category:"credit"},{key:"basic_telecom_permit",name:"基础电信业务许可证",icon:"PhoneFilled",category:"industry"},{key:"value_added_telecom_permit",name:"增值电信业务许可证",icon:"PhoneFilled",category:"industry"},{key:"software_copyright",name:"软件著作权登记证书",icon:"Document",category:"industry",allowMultiple:!0},{key:"patent_certificate",name:"专利证书",icon:"TrophyBase",category:"industry",allowMultiple:!0},{key:"high_tech",name:"高新技术企业证书",icon:"Star",category:"industry"},{key:"software_enterprise",name:"软件企业认定证书",icon:"Monitor",category:"industry"},{key:"cmmi",name:"CMMI成熟度等级证书",icon:"Trophy",category:"industry"}],w=_=>i.filter(f=>f.category===_),r=async()=>{T.value=!0;try{const _=await O.getCompanyQualifications(v.companyId);_.success&&_.data&&(I.value=_.data,console.log("加载资质文件:",I.value))}catch(_){console.error("加载资质文件失败:",_),D("加载失败",_ instanceof Error?_.message:"未知错误")}finally{T.value=!1}},c=async(_,f)=>{const u=i.find(h=>h.key===_)||t.value.find(h=>h.key===_);try{const h=await O.uploadQualification(v.companyId,_,f,{});if(h.success)F("上传成功",`${(u==null?void 0:u.name)||"资质文件"}上传成功`),await r(),q("update");else throw new Error(h.message||"上传失败")}catch(h){console.error("上传资质文件失败:",h);const S=h instanceof Error?h.message:"未知错误";throw D("上传失败",S),h}},o=_=>f=>c(_,f),l=async(_,f)=>{try{f?await O.downloadQualification(f,""):window.open(`/api/companies/${v.companyId}/qualifications/${_}/download`)}catch(u){console.error("下载资质文件失败:",u),D("下载失败",u instanceof Error?u.message:"未知错误")}},p=async(_,f)=>{try{if(!confirm("确定要删除此资质文件吗？"))return;if(f)await O.deleteQualification(f);else if(!(await fetch(`/api/companies/${v.companyId}/qualifications/${_}`,{method:"DELETE"})).ok)throw new Error("删除失败");F("删除成功","资质文件已删除"),await r(),q("update")}catch(u){console.error("删除资质文件失败:",u),D("删除失败",u instanceof Error?u.message:"未知错误")}},g=()=>{P.value.name="",E.value=!0},z=()=>{if(!P.value.name.trim()){D("错误","请输入资质名称");return}const _=`custom_${Date.now()}`;t.value.push({key:_,name:P.value.name.trim(),icon:"Document",category:"custom"}),E.value=!1,F("添加成功","自定义资质已添加")},$=_=>{confirm("确定要移除此自定义资质吗？")&&(t.value.splice(_,1),F("移除成功","自定义资质已移除"))};return ke(()=>{r()}),(_,f)=>{const u=ne,h=ge,S=ye,X=oe,M=be,Ve=he,re=ve,we=Re;return y(),U("div",Ta,[e(d(W),{title:"资质信息管理"},{default:a(()=>[T.value?(y(),A(d(Qe),{key:0,text:"加载资质信息..."})):(y(),U("div",Ma,[(y(),U(_e,null,pe(V,Q=>s("div",{key:Q.key,class:"qualification-category"},[s("h6",{class:Pe(["category-title",`text-${Q.color}`])},[e(u,null,{default:a(()=>[e(d(He))]),_:1}),x(" "+N(Q.name),1)],2),e(S,{gutter:16},{default:a(()=>[(y(!0),U(_e,null,pe(w(Q.key),J=>(y(),A(h,{key:J.key,span:12},{default:a(()=>[e(Ce,{qualification:J,"file-info":I.value[J.key],"on-upload":o(J.key),onDownload:l,onDelete:p},null,8,["qualification","file-info","on-upload"])]),_:2},1024))),128))]),_:2},1024)])),64)),s("div",Ra,[s("h6",Sa,[e(u,null,{default:a(()=>[e(d(ze))]),_:1}),f[3]||(f[3]=x(" 自定义资质 ",-1))]),e(X,{type:"primary",onClick:g},{default:a(()=>[e(u,null,{default:a(()=>[e(d(ze))]),_:1}),f[4]||(f[4]=x(" 添加自定义资质 ",-1))]),_:1}),t.value.length>0?(y(),A(S,{key:0,gutter:16,class:"mt-3"},{default:a(()=>[(y(!0),U(_e,null,pe(t.value,(Q,J)=>(y(),A(h,{key:Q.key,span:12},{default:a(()=>[e(Ce,{qualification:Q,"file-info":I.value[Q.key],"is-custom":!0,"on-upload":o(Q.key),onDownload:l,onDelete:p,onRemoveCustom:Ue=>$(J)},null,8,["qualification","file-info","on-upload","onRemoveCustom"])]),_:2},1024))),128))]),_:1})):ce("",!0)])]))]),_:1}),e(we,{modelValue:E.value,"onUpdate:modelValue":f[2]||(f[2]=Q=>E.value=Q),title:"添加自定义资质",width:"400px"},{footer:a(()=>[e(X,{onClick:f[1]||(f[1]=Q=>E.value=!1)},{default:a(()=>[...f[5]||(f[5]=[x("取消",-1)])]),_:1}),e(X,{type:"primary",onClick:z},{default:a(()=>[...f[6]||(f[6]=[x("确定",-1)])]),_:1})]),default:a(()=>[e(re,{model:P.value,"label-width":"100px"},{default:a(()=>[e(Ve,{label:"资质名称"},{default:a(()=>[e(M,{modelValue:P.value.name,"onUpdate:modelValue":f[0]||(f[0]=Q=>P.value.name=Q),placeholder:"请输入资质名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Qa=ie(Pa,[["__scopeId","data-v-d0a8e1b6"]]),Ba={class:"personnel-tab"},Na={class:"attachments-grid"},Aa={class:"attachment-item"},ja={class:"attachment-header"},Oa={key:0,class:"file-info"},La={class:"file-name"},Ga={class:"file-actions"},Ja={key:1,class:"no-file"},Ya={class:"attachment-item"},Ha={class:"attachment-header"},Wa={key:0,class:"file-info"},Xa={class:"file-name"},Za={class:"file-actions"},Ka={key:1,class:"no-file"},el={class:"attachment-item"},al={class:"attachment-header"},ll={key:0,class:"file-info"},tl={class:"file-name"},ol={class:"file-actions"},nl={key:1,class:"no-file"},sl={class:"attachment-item"},il={class:"attachment-header"},rl={key:0,class:"file-info"},dl={class:"file-name"},ul={class:"file-actions"},cl={key:1,class:"no-file"},_l=se({__name:"PersonnelTab",props:{companyId:{},companyData:{}},emits:["update"],setup(R,{emit:L}){const v=R,q=L,{success:F,error:D}=me(),T=k(),I=k(!1),t=k({authorized_person_name:"",authorized_person_id:"",authorized_person_gender:"",authorized_person_age:void 0,authorized_person_position:"",authorized_person_title:""}),E=k({id_card_front:null,id_card_back:null,manager_resume:null,social_security:null}),P={authorized_person_id:[{pattern:/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/,message:"请输入正确的身份证号",trigger:"blur"}]};Ee(()=>v.companyData,o=>{o&&(t.value={authorized_person_name:o.authorized_person_name||"",authorized_person_id:o.authorized_person_id||"",authorized_person_gender:o.authorized_person_gender||"",authorized_person_age:o.authorized_person_age||void 0,authorized_person_position:o.authorized_person_position||"",authorized_person_title:o.authorized_person_title||""})},{immediate:!0,deep:!0});const V=async()=>{T.value&&await T.value.validate(async o=>{if(o){I.value=!0;try{(await O.updateCompany(v.companyId,{authorizedPersonName:t.value.authorized_person_name,authorizedPersonId:t.value.authorized_person_id,authorizedPersonGender:t.value.authorized_person_gender,authorizedPersonAge:t.value.authorized_person_age,authorizedPersonPosition:t.value.authorized_person_position,authorizedPersonTitle:t.value.authorized_person_title})).success&&(F("保存成功","被授权人信息已更新"),q("update"))}catch(l){console.error("保存被授权人信息失败:",l),D("保存失败",l instanceof Error?l.message:"未知错误")}finally{I.value=!1}}})},i=o=>async l=>{const{file:p,onSuccess:g,onError:z}=l;try{const $=await O.uploadQualification(v.companyId,o,p,{});if($.success)F("上传成功","附件上传成功"),c(),q("update"),g($);else throw new Error($.error||"上传失败")}catch($){console.error("上传附件失败:",$);const _=$ instanceof Error?$.message:"未知错误";D("上传失败",_),z($)}},w=o=>{window.open(`/api/companies/${v.companyId}/qualifications/${o}/download`)},r=async o=>{if(confirm("确定要删除此附件吗？"))try{if(!(await fetch(`/api/companies/${v.companyId}/qualifications/${o}`,{method:"DELETE"})).ok)throw new Error("删除失败");F("删除成功","附件已删除"),c(),q("update")}catch(l){console.error("删除附件失败:",l),D("删除失败",l instanceof Error?l.message:"未知错误")}},c=async()=>{try{const o=await O.getCompanyQualifications(v.companyId);if(o.success&&o.data){const l=o.data;E.value={id_card_front:l.id_card_front?{name:l.id_card_front.original_filename}:null,id_card_back:l.id_card_back?{name:l.id_card_back.original_filename}:null,manager_resume:l.manager_resume?{name:l.manager_resume.original_filename}:null,social_security:l.social_security?{name:l.social_security.original_filename}:null}}}catch(o){console.error("加载附件失败:",o)}};return ke(()=>{c()}),(o,l)=>{const p=be,g=he,z=ge,$=ye,_=xe,f=$e,u=Te,h=ne,S=oe,X=ve;return y(),U("div",Ba,[e(d(W),{title:"被授权人基本信息"},{default:a(()=>[e(X,{ref_key:"formRef",ref:T,model:t.value,rules:P,"label-width":"140px",class:"personnel-form"},{default:a(()=>[e($,{gutter:20},{default:a(()=>[e(z,{span:12},{default:a(()=>[e(g,{label:"姓名",prop:"authorized_person_name"},{default:a(()=>[e(p,{modelValue:t.value.authorized_person_name,"onUpdate:modelValue":l[0]||(l[0]=M=>t.value.authorized_person_name=M),placeholder:"请输入被授权人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(z,{span:12},{default:a(()=>[e(g,{label:"身份证号",prop:"authorized_person_id"},{default:a(()=>[e(p,{modelValue:t.value.authorized_person_id,"onUpdate:modelValue":l[1]||(l[1]=M=>t.value.authorized_person_id=M),placeholder:"请输入身份证号",maxlength:"18"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,{gutter:20},{default:a(()=>[e(z,{span:12},{default:a(()=>[e(g,{label:"性别",prop:"authorized_person_gender"},{default:a(()=>[e(f,{modelValue:t.value.authorized_person_gender,"onUpdate:modelValue":l[2]||(l[2]=M=>t.value.authorized_person_gender=M),placeholder:"请选择性别",style:{width:"100%"}},{default:a(()=>[e(_,{label:"男",value:"男"}),e(_,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(z,{span:12},{default:a(()=>[e(g,{label:"年龄",prop:"authorized_person_age"},{default:a(()=>[e(u,{modelValue:t.value.authorized_person_age,"onUpdate:modelValue":l[3]||(l[3]=M=>t.value.authorized_person_age=M),min:18,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,{gutter:20},{default:a(()=>[e(z,{span:12},{default:a(()=>[e(g,{label:"职位",prop:"authorized_person_position"},{default:a(()=>[e(p,{modelValue:t.value.authorized_person_position,"onUpdate:modelValue":l[4]||(l[4]=M=>t.value.authorized_person_position=M),placeholder:"请输入职位"},null,8,["modelValue"])]),_:1})]),_:1}),e(z,{span:12},{default:a(()=>[e(g,{label:"职称",prop:"authorized_person_title"},{default:a(()=>[e(p,{modelValue:t.value.authorized_person_title,"onUpdate:modelValue":l[5]||(l[5]=M=>t.value.authorized_person_title=M),placeholder:"请输入职称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,null,{default:a(()=>[e(z,{span:24},{default:a(()=>[e(g,null,{default:a(()=>[e(S,{type:"primary",loading:I.value,onClick:V},{default:a(()=>[e(h,null,{default:a(()=>[e(d(Ie))]),_:1}),l[14]||(l[14]=x(" 保存被授权人信息 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(d(W),{title:"相关附件",class:"mt-4"},{default:a(()=>[s("div",Na,[s("div",Aa,[s("div",ja,[e(h,{class:"icon"},{default:a(()=>[e(d(De))]),_:1}),l[15]||(l[15]=s("span",{class:"title"},"被授权人身份证（正面）",-1))]),E.value.id_card_front?(y(),U("div",Oa,[e(h,{class:"file-icon"},{default:a(()=>[e(d(ee))]),_:1}),s("span",La,N(E.value.id_card_front.name),1),s("div",Ga,[e(S,{text:"",type:"primary",size:"small",onClick:l[6]||(l[6]=M=>w("id_card_front"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(te))]),_:1})]),_:1}),e(S,{text:"",type:"danger",size:"small",onClick:l[7]||(l[7]=M=>r("id_card_front"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(ae))]),_:1})]),_:1})])])):(y(),U("div",Ja,"未上传")),e(d(ue),{accept:".jpg,.jpeg,.png,.pdf","show-file-list":!1,"http-request":i("id_card_front"),"auto-compress-image":!0,"image-type":"id_card","max-size":10},{trigger:a(()=>[e(S,{size:"small"},{default:a(()=>[e(h,null,{default:a(()=>[e(d(de))]),_:1}),l[16]||(l[16]=x(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),s("div",Ya,[s("div",Ha,[e(h,{class:"icon"},{default:a(()=>[e(d(De))]),_:1}),l[17]||(l[17]=s("span",{class:"title"},"被授权人身份证（反面）",-1))]),E.value.id_card_back?(y(),U("div",Wa,[e(h,{class:"file-icon"},{default:a(()=>[e(d(ee))]),_:1}),s("span",Xa,N(E.value.id_card_back.name),1),s("div",Za,[e(S,{text:"",type:"primary",size:"small",onClick:l[8]||(l[8]=M=>w("id_card_back"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(te))]),_:1})]),_:1}),e(S,{text:"",type:"danger",size:"small",onClick:l[9]||(l[9]=M=>r("id_card_back"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(ae))]),_:1})]),_:1})])])):(y(),U("div",Ka,"未上传")),e(d(ue),{accept:".jpg,.jpeg,.png,.pdf","show-file-list":!1,"http-request":i("id_card_back"),"auto-compress-image":!0,"image-type":"id_card","max-size":10},{trigger:a(()=>[e(S,{size:"small"},{default:a(()=>[e(h,null,{default:a(()=>[e(d(de))]),_:1}),l[18]||(l[18]=x(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),s("div",el,[s("div",al,[e(h,{class:"icon"},{default:a(()=>[e(d(Se))]),_:1}),l[19]||(l[19]=s("span",{class:"title"},"项目经理简历",-1))]),E.value.manager_resume?(y(),U("div",ll,[e(h,{class:"file-icon"},{default:a(()=>[e(d(ee))]),_:1}),s("span",tl,N(E.value.manager_resume.name),1),s("div",ol,[e(S,{text:"",type:"primary",size:"small",onClick:l[10]||(l[10]=M=>w("manager_resume"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(te))]),_:1})]),_:1}),e(S,{text:"",type:"danger",size:"small",onClick:l[11]||(l[11]=M=>r("manager_resume"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(ae))]),_:1})]),_:1})])])):(y(),U("div",nl,"未上传")),e(d(ue),{accept:".pdf,.doc,.docx","show-file-list":!1,"http-request":i("manager_resume"),"auto-compress-image":!1,"max-size":20},{trigger:a(()=>[e(S,{size:"small"},{default:a(()=>[e(h,null,{default:a(()=>[e(d(de))]),_:1}),l[20]||(l[20]=x(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])]),s("div",sl,[s("div",il,[e(h,{class:"icon"},{default:a(()=>[e(d(We))]),_:1}),l[21]||(l[21]=s("span",{class:"title"},"社保证明",-1))]),E.value.social_security?(y(),U("div",rl,[e(h,{class:"file-icon"},{default:a(()=>[e(d(ee))]),_:1}),s("span",dl,N(E.value.social_security.name),1),s("div",ul,[e(S,{text:"",type:"primary",size:"small",onClick:l[12]||(l[12]=M=>w("social_security"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(te))]),_:1})]),_:1}),e(S,{text:"",type:"danger",size:"small",onClick:l[13]||(l[13]=M=>r("social_security"))},{default:a(()=>[e(h,null,{default:a(()=>[e(d(ae))]),_:1})]),_:1})])])):(y(),U("div",cl,"未上传")),e(d(ue),{accept:".pdf,.jpg,.jpeg,.png","show-file-list":!1,"http-request":i("social_security"),"auto-compress-image":!0,"image-type":"default","max-size":20},{trigger:a(()=>[e(S,{size:"small"},{default:a(()=>[e(h,null,{default:a(()=>[e(d(de))]),_:1}),l[22]||(l[22]=x(" 上传文件 ",-1))]),_:1})]),_:1},8,["http-request"])])])]),_:1})])}}}),pl=ie(_l,[["__scopeId","data-v-0b3ffc62"]]),ml={class:"financial-tab"},fl={class:"shareholders-section"},vl={class:"section-header"},yl={class:"save-section"},gl=se({__name:"FinancialTab",props:{companyId:{},companyData:{}},emits:["update"],setup(R,{emit:L}){const v=R,q=L,{success:F,error:D}=me(),T=k(),I=k(),t=k(),E=k(),P=k(!1),V=k(!1),i=k([{key:"audit_report",name:"财务审计报告",icon:ee,required:!1,allowMultiple:!0},{key:"taxpayer_certificate",name:"纳税人资格证明",icon:aa,required:!1,allowMultiple:!1}]),w=k({}),r=k({bank_name:"",bank_account:""}),c=k({actual_controller:"",controlling_shareholder:""}),o=k({managing_unit_name:"",managed_unit_name:""}),l=k([]),p=k(-1),g=k(-1),z=k(!1),$=k(-1),_=k({name:"",type:"",ratio:""}),f={name:[{required:!0,message:"请输入股东名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],ratio:[{required:!0,message:"请输入出资比例",trigger:"blur"}]};Ee(()=>v.companyData,m=>{if(m){r.value={bank_name:m.bank_name||"",bank_account:m.bank_account||""},c.value={actual_controller:m.actual_controller||"",controlling_shareholder:m.controlling_shareholder||""},o.value={managing_unit_name:m.managing_unit_name||"",managed_unit_name:m.managed_unit_name||""};try{const n=m.shareholders_info;n?(l.value=typeof n=="string"?JSON.parse(n):n,p.value=l.value.findIndex(b=>b.is_controlling===!0),g.value=l.value.findIndex(b=>b.is_actual_controller===!0)):(l.value=[],p.value=-1,g.value=-1)}catch(n){console.error("解析股东信息失败:",n),l.value=[],p.value=-1,g.value=-1}}},{immediate:!0,deep:!0});const u=()=>{$.value=-1,_.value={name:"",type:"",ratio:""},z.value=!0},h=m=>{$.value=m;const n=l.value[m];_.value={name:n.name,type:n.type,ratio:n.ratio},z.value=!0},S=m=>{confirm("确定要删除此股东吗？")&&(m===p.value&&(p.value=-1),m===g.value&&(g.value=-1),l.value.splice(m,1),m<p.value&&p.value--,m<g.value&&g.value--,F("删除成功","股东已删除，请点击保存按钮保存更改"))},X=()=>{l.value.forEach(m=>{m.is_controlling=!1}),p.value!==-1&&(l.value[p.value].is_controlling=!0)},M=()=>{l.value.forEach(m=>{m.is_actual_controller=!1}),g.value!==-1&&(l.value[g.value].is_actual_controller=!0)},Ve=async()=>{E.value&&await E.value.validate(m=>{if(m){if($.value===-1)l.value.push({..._.value,is_controlling:!1,is_actual_controller:!1}),F("添加成功","股东已添加，请点击保存按钮保存更改");else{const n=l.value[$.value];l.value[$.value]={..._.value,is_controlling:n.is_controlling||!1,is_actual_controller:n.is_actual_controller||!1},F("编辑成功","股东信息已更新，请点击保存按钮保存更改")}z.value=!1}})},re=async()=>{try{V.value=!0;const m=await O.getCompanyQualifications(v.companyId);m.success&&(w.value=m.data||{})}catch(m){console.error("加载资质文件失败:",m)}finally{V.value=!1}},we=async(m,n)=>{try{const b=i.value.find(K=>K.key===m);let G=null;if(b!=null&&b.allowMultiple){if(G=prompt(`请输入 "${n.name}" 的年份:
例如：2023、2024`),G===null)return;if(!G.trim()){D("上传失败","年份不能为空");return}}const j=new FormData;j.append(`qualifications[${m}]`,n),j.append("qualification_names",JSON.stringify({[m]:(b==null?void 0:b.name)||m})),G&&j.append("file_versions",JSON.stringify({[m]:G.trim()}));const B=await fetch(`/api/companies/${v.companyId}/qualifications/upload`,{method:"POST",body:j,credentials:"include",headers:{}});if(!B.ok){const K=B.headers.get("content-type");if(K&&K.includes("application/json")){const Y=await B.json();throw new Error(Y.error||`服务器错误: ${B.status}`)}else throw new Error(`上传失败: 服务器返回错误 ${B.status}`)}const Z=await B.json();if(Z.success)F("上传成功",`${(b==null?void 0:b.name)||"资质文件"}上传成功`),await re(),q("update");else throw new Error(Z.error||"上传失败")}catch(b){console.error("上传资质文件失败:",b),D("上传失败",b instanceof Error?b.message:"未知错误")}},Q=async(m,n)=>{try{let b;n?b=`/api/qualifications/${n}/download`:b=`/api/companies/${v.companyId}/qualifications/${m}/download`,window.open(b,"_blank")}catch(b){console.error("下载资质文件失败:",b),D("下载失败",b instanceof Error?b.message:"未知错误")}},J=async(m,n)=>{try{if(!confirm("确定要删除此资质文件吗？"))return;if(n)await O.deleteQualification(n);else if(!(await fetch(`/api/companies/${v.companyId}/qualifications/${m}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("删除失败");F("删除成功","资质文件已删除"),await re(),q("update")}catch(b){console.error("删除资质文件失败:",b),D("删除失败",b instanceof Error?b.message:"未知错误")}},Ue=async()=>{P.value=!0;try{(await O.updateCompany(v.companyId,{bank_name:r.value.bank_name,bank_account:r.value.bank_account,actual_controller:c.value.actual_controller,controlling_shareholder:c.value.controlling_shareholder,shareholders_info:JSON.stringify(l.value),managing_unit_name:o.value.managing_unit_name,managed_unit_name:o.value.managed_unit_name})).success&&(F("保存成功","财务信息已更新"),q("update"))}catch(m){console.error("保存财务信息失败:",m),D("保存失败",m instanceof Error?m.message:"未知错误")}finally{P.value=!1}};return ke(()=>{re()}),(m,n)=>{const b=ge,G=ye,j=be,B=he,Z=ve,K=ne,Y=oe,le=Xe,qe=Ze,Be=Ke,Ne=ea,Fe=xe,Ae=$e,je=Re;return y(),U("div",ml,[e(d(W),{title:"财务资质文件",class:"mb-4"},{default:a(()=>[e(G,{gutter:20},{default:a(()=>[(y(!0),U(_e,null,pe(i.value,C=>(y(),A(b,{key:C.key,span:12},{default:a(()=>[e(Ce,{qualification:C,"file-info":w.value[C.key],onUpload:H=>we(C.key,H),onDownload:Q,onDelete:J},null,8,["qualification","file-info","onUpload"])]),_:2},1024))),128))]),_:1})]),_:1}),e(d(W),{title:"银行账户信息"},{default:a(()=>[e(Z,{ref_key:"bankFormRef",ref:T,model:r.value,"label-width":"140px",class:"bank-form"},{default:a(()=>[e(G,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(B,{label:"开户行全称"},{default:a(()=>[e(j,{modelValue:r.value.bank_name,"onUpdate:modelValue":n[0]||(n[0]=C=>r.value.bank_name=C),placeholder:"请输入开户行全称"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(B,{label:"银行账号"},{default:a(()=>[e(j,{modelValue:r.value.bank_account,"onUpdate:modelValue":n[1]||(n[1]=C=>r.value.bank_account=C),placeholder:"请输入银行账号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(d(W),{title:"股权结构信息",class:"mt-4"},{default:a(()=>[e(Z,{ref_key:"equityFormRef",ref:I,model:c.value,"label-width":"140px",class:"equity-form"},{default:a(()=>[e(G,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(B,{label:"实际控制人"},{default:a(()=>[e(j,{modelValue:c.value.actual_controller,"onUpdate:modelValue":n[2]||(n[2]=C=>c.value.actual_controller=C),placeholder:"请输入实际控制人"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(B,{label:"控股股东"},{default:a(()=>[e(j,{modelValue:c.value.controlling_shareholder,"onUpdate:modelValue":n[3]||(n[3]=C=>c.value.controlling_shareholder=C),placeholder:"请输入控股股东"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),s("div",fl,[s("div",vl,[n[14]||(n[14]=s("h6",null,"股东/投资人列表",-1)),e(Y,{type:"primary",size:"small",onClick:u},{default:a(()=>[e(K,null,{default:a(()=>[e(d(ze))]),_:1}),n[13]||(n[13]=x(" 添加股东 ",-1))]),_:1})]),l.value.length>0?(y(),A(Be,{key:0,data:l.value,stripe:""},{default:a(()=>[e(le,{prop:"name",label:"股东名称","min-width":"150"}),e(le,{prop:"type",label:"类型",width:"100"}),e(le,{prop:"ratio",label:"出资比例",width:"120"}),e(le,{label:"控股股东",width:"100",align:"center"},{default:a(({$index:C})=>[e(qe,{modelValue:p.value,"onUpdate:modelValue":n[4]||(n[4]=H=>p.value=H),label:C,onChange:X},{default:a(()=>[...n[15]||(n[15]=[s("span",null,null,-1)])]),_:1},8,["modelValue","label"])]),_:1}),e(le,{label:"实际控制人",width:"110",align:"center"},{default:a(({$index:C})=>[e(qe,{modelValue:g.value,"onUpdate:modelValue":n[5]||(n[5]=H=>g.value=H),label:C,onChange:M},{default:a(()=>[...n[16]||(n[16]=[s("span",null,null,-1)])]),_:1},8,["modelValue","label"])]),_:1}),e(le,{label:"操作",width:"150"},{default:a(({row:C,$index:H})=>[e(Y,{text:"",type:"primary",size:"small",onClick:Oe=>h(H)},{default:a(()=>[...n[17]||(n[17]=[x(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(Y,{text:"",type:"danger",size:"small",onClick:Oe=>S(H)},{default:a(()=>[...n[18]||(n[18]=[x(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(y(),A(Ne,{key:1,description:"暂无股东信息","image-size":100}))])]),_:1}),e(d(W),{title:"管理关系信息",class:"mt-4"},{default:a(()=>[e(Z,{ref_key:"managementFormRef",ref:t,model:o.value,"label-width":"140px",class:"management-form"},{default:a(()=>[e(G,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(B,{label:"管理单位名称"},{default:a(()=>[e(j,{modelValue:o.value.managing_unit_name,"onUpdate:modelValue":n[6]||(n[6]=C=>o.value.managing_unit_name=C),placeholder:"如有管理单位请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(B,{label:"被管理单位名称"},{default:a(()=>[e(j,{modelValue:o.value.managed_unit_name,"onUpdate:modelValue":n[7]||(n[7]=C=>o.value.managed_unit_name=C),placeholder:"如有被管理单位请输入"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s("div",yl,[e(Y,{type:"primary",size:"large",loading:P.value,onClick:Ue},{default:a(()=>[e(K,null,{default:a(()=>[e(d(Ie))]),_:1}),n[19]||(n[19]=x(" 保存财务信息 ",-1))]),_:1},8,["loading"])]),e(je,{modelValue:z.value,"onUpdate:modelValue":n[12]||(n[12]=C=>z.value=C),title:$.value===-1?"添加股东":"编辑股东",width:"500px"},{footer:a(()=>[e(Y,{onClick:n[11]||(n[11]=C=>z.value=!1)},{default:a(()=>[...n[20]||(n[20]=[x("取消",-1)])]),_:1}),e(Y,{type:"primary",onClick:Ve},{default:a(()=>[...n[21]||(n[21]=[x("确定",-1)])]),_:1})]),default:a(()=>[e(Z,{ref_key:"shareholderFormRef",ref:E,model:_.value,rules:f,"label-width":"100px"},{default:a(()=>[e(B,{label:"股东名称",prop:"name"},{default:a(()=>[e(j,{modelValue:_.value.name,"onUpdate:modelValue":n[8]||(n[8]=C=>_.value.name=C),placeholder:"请输入股东名称"},null,8,["modelValue"])]),_:1}),e(B,{label:"类型",prop:"type"},{default:a(()=>[e(Ae,{modelValue:_.value.type,"onUpdate:modelValue":n[9]||(n[9]=C=>_.value.type=C),placeholder:"请选择类型",style:{width:"100%"}},{default:a(()=>[e(Fe,{label:"企业",value:"企业"}),e(Fe,{label:"自然人",value:"自然人"})]),_:1},8,["modelValue"])]),_:1}),e(B,{label:"出资比例",prop:"ratio"},{default:a(()=>[e(j,{modelValue:_.value.ratio,"onUpdate:modelValue":n[10]||(n[10]=C=>_.value.ratio=C),placeholder:"如：30%"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),hl=ie(gl,[["__scopeId","data-v-5b1f60f2"]]),bl={class:"company-detail"},kl={class:"detail-header"},Vl={class:"header-title"},wl={key:1,class:"detail-content"},zl={class:"tab-label"},Cl={class:"tab-label"},$l={class:"tab-label"},xl={class:"tab-label"},Il=se({__name:"CompanyDetail",setup(R){const L=ra(),v=da(),{error:q}=me(),F=k(!1),D=k("basic"),T=k(0),I=k({}),t={technology:"科技",manufacturing:"制造业",finance:"金融",education:"教育",healthcare:"医疗",retail:"零售",construction:"建筑",other:"其他"},E=r=>t[r]||r,P=async()=>{F.value=!0;try{const r=await O.getCompany(T.value);r.success&&r.data?I.value=r.data:(q("加载失败","无法获取企业信息"),w())}catch(r){console.error("加载企业数据失败:",r),q("加载失败",r instanceof Error?r.message:"未知错误"),w()}finally{F.value=!1}},V=r=>{console.log("切换到Tab:",r)},i=async()=>{await P()},w=()=>{v.push("/knowledge/company-library")};return ke(()=>{const r=L.params.id;if(r){if(T.value=parseInt(r,10),isNaN(T.value)){q("参数错误","无效的企业ID"),w();return}P()}else q("参数错误","缺少企业ID"),w()}),(r,c)=>{const o=oe,l=Me,p=ne,g=la,z=sa;return y(),U("div",bl,[s("div",kl,[e(o,{onClick:w,icon:"ArrowLeft"},{default:a(()=>[...c[1]||(c[1]=[x("返回列表",-1)])]),_:1}),s("div",Vl,[s("h2",null,N(I.value.company_name||"企业详情"),1),I.value.industry_type?(y(),A(l,{key:0,type:"info"},{default:a(()=>[x(N(E(I.value.industry_type)),1)]),_:1})):ce("",!0)])]),F.value?(y(),A(d(Qe),{key:0,text:"加载企业信息中..."})):(y(),U("div",wl,[e(z,{modelValue:D.value,"onUpdate:modelValue":c[0]||(c[0]=$=>D.value=$),class:"company-tabs",onTabChange:V},{default:a(()=>[e(g,{name:"basic"},{label:a(()=>[s("span",zl,[e(p,null,{default:a(()=>[e(d(ta))]),_:1}),c[2]||(c[2]=x(" 基础信息 ",-1))])]),default:a(()=>[e(_a,{"company-id":T.value,"company-data":I.value,onUpdate:i},null,8,["company-id","company-data"])]),_:1}),e(g,{name:"qualification"},{label:a(()=>[s("span",Cl,[e(p,null,{default:a(()=>[e(d(oa))]),_:1}),c[3]||(c[3]=x(" 资质信息 ",-1))])]),default:a(()=>[e(Qa,{"company-id":T.value,"company-data":I.value,onUpdate:i},null,8,["company-id","company-data"])]),_:1}),e(g,{name:"personnel"},{label:a(()=>[s("span",$l,[e(p,null,{default:a(()=>[e(d(Se))]),_:1}),c[4]||(c[4]=x(" 被授权人信息 ",-1))])]),default:a(()=>[e(pl,{"company-id":T.value,"company-data":I.value,onUpdate:i},null,8,["company-id","company-data"])]),_:1}),e(g,{name:"financial"},{label:a(()=>[s("span",xl,[e(p,null,{default:a(()=>[e(d(na))]),_:1}),c[5]||(c[5]=x(" 财务信息 ",-1))])]),default:a(()=>[e(hl,{"company-id":T.value,"company-data":I.value,onUpdate:i},null,8,["company-id","company-data"])]),_:1})]),_:1},8,["modelValue"])]))])}}}),jl=ie(Il,[["__scopeId","data-v-8d9df7e4"]]);export{jl as default};
