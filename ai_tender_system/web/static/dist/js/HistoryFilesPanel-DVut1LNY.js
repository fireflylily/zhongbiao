import{t as e}from"./tender-B2_G1CPt.js";import{u as l}from"./project-D1NKtbTH.js";import{av as t,aw as s,b7 as a,aL as i,aM as o,aO as n,aN as r,aZ as u,aY as c,aT as d,bl as p,bm as f,aS as m,aR as _,cE as h,a_ as v,aX as y,aV as g,b8 as w,b0 as F,a$ as b,c8 as x,b1 as j,c0 as k,dm as C,bi as z,bj as I,bv as P,b4 as $,b2 as T}from"./index.js";/* empty css               */import{f as E,a as H}from"./helpers-BsogEk_7.js";import{E as D}from"./index-5dFIUF4u.js";/* empty css                                                                          */import"./DocumentPreview.vue_vue_type_style_index_0_scoped_056f7814_lang-CJRCEOay.js";/* empty css                             *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                *//* empty css                */import{a as L,E as R}from"./index-B-vavaW6.js";import{E as S}from"./index-CSVRQ7Lr.js";import{E as U}from"./index-D2m2pKqu.js";import{E as M,a as B}from"./index-CZDBeWNi.js";import{E as O}from"./index-CKL8-Dtp.js";import{E as Y,a as W}from"./index-BHUH9FgH.js";import{E as V,a as N}from"./index-l-UpVxRy.js";import{v as J}from"./DocumentPreview-BVX8lDJX.js";import{E as q}from"./index-DG0KKHwq.js";function A(){const i=l(),o=t([]),n=t(!1),r=t(null),u=t({tenderFile:null,templateFile:null,technicalFile:null,businessResponseFile:null,p2pResponseFile:null,techProposalFile:null}),c=s(()=>o.value.find(e=>e.id===i.projectId)),d=s(()=>o.value.length>0),p=s(()=>null!==u.value.tenderFile),f=s(()=>null!==u.value.templateFile),m=s(()=>null!==u.value.technicalFile),_=async(l,t)=>{if(v(),(null==t?void 0:t.onClear)&&t.onClear(),l){try{const t=await e.getProject(l);t.data&&i.setCurrentProject(t.data)}catch(s){a.error("è·å–é¡¹ç›®è¯¦æƒ…å¤±è´¥")}await h(l,t)}else i.clearCurrentProject()},h=async(l,t)=>{var s,i,o,c,d,p,f,m,_;n.value=!0;try{const n=(await e.getProject(l)).data;if(!n)return void a.warning("æœªæ‰¾åˆ°é¡¹ç›®æ•°æ®");const r=n.step1_data,h={tenderFile:null,templateFile:null,technicalFile:null,businessResponseFile:null,p2pResponseFile:null,techProposalFile:null};if(null==r?void 0:r.file_path){const e=(null==(s=(r.file_name||r.file_path.split("/").pop()||"æ‹›æ ‡æ–‡æ¡£").split(".").pop())?void 0:s.toLowerCase())||"doc";["doc","docx"].includes(e);h.tenderFile={name:r.file_name||"æ‹›æ ‡æ–‡æ¡£",url:r.file_path,status:"success",uid:Date.now()+Math.random(),size:r.file_size||0}}if(null==r?void 0:r.response_file_path){const e=r.response_file_path.split("/").pop()||"åº”ç­”æ¨¡æ¿",l=(null==(i=e.split(".").pop())?void 0:i.toLowerCase())||"doc";["doc","docx"].includes(l);h.templateFile={name:e,url:r.response_file_path,status:"success",uid:Date.now()+Math.random()+1,size:0}}if(null==r?void 0:r.technical_file_path){const e=r.technical_file_path.split("/").pop()||"æŠ€æœ¯éœ€æ±‚æ–‡æ¡£",l=(null==(o=e.split(".").pop())?void 0:o.toLowerCase())||"doc";["doc","docx"].includes(l);h.technicalFile={name:e,url:r.technical_file_path,status:"success",uid:Date.now()+Math.random()+2,size:0}}if(null==r?void 0:r.business_response_file){const e=r.business_response_file,t=(null==(d=((null==(c=e.file_path)?void 0:c.split("/").pop())||"å•†åŠ¡åº”ç­”æ–‡ä»¶").split(".").pop())?void 0:d.toLowerCase())||"docx",s=["doc","docx"].includes(t);h.businessResponseFile={success:!0,outputFile:e.file_path,downloadUrl:y(e.file_path),previewUrl:s?`/api/business-response/preview/${l}`:void 0,stats:e.stats||{},message:"è¯¥é¡¹ç›®å·²æœ‰å•†åŠ¡åº”ç­”æ–‡ä»¶",isHistory:!0,generated_at:e.generated_at||r.updated_at}}if(null==r?void 0:r.technical_point_to_point_file){const e=r.technical_point_to_point_file,t=(null==(f=((null==(p=e.file_path)?void 0:p.split("/").pop())||"ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶").split(".").pop())?void 0:f.toLowerCase())||"docx",s=["doc","docx"].includes(t);h.p2pResponseFile={success:!0,outputFile:e.file_path,downloadUrl:y(e.file_path),previewUrl:s?`/api/point-to-point/preview/${l}`:void 0,stats:e.stats||{},message:"è¯¥é¡¹ç›®å·²æœ‰ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶",isHistory:!0,generated_at:e.generated_at||r.updated_at}}if(null==r?void 0:r.technical_proposal_file){const e=r.technical_proposal_file,t=(null==(_=((null==(m=e.file_path)?void 0:m.split("/").pop())||"æŠ€æœ¯æ–¹æ¡ˆæ–‡ä»¶").split(".").pop())?void 0:_.toLowerCase())||"docx",s=["doc","docx"].includes(t);h.techProposalFile={success:!0,outputFile:e.file_path,downloadUrl:y(e.file_path),previewUrl:s?`/api/tech-proposal/preview/${l}`:void 0,stats:e.stats||{},message:"è¯¥é¡¹ç›®å·²æœ‰æŠ€æœ¯æ–¹æ¡ˆæ–‡ä»¶",isHistory:!0,generated_at:e.generated_at||r.updated_at}}u.value=h,(null==t?void 0:t.onDocumentsLoaded)&&t.onDocumentsLoaded(h)}catch(h){r.value="åŠ è½½é¡¹ç›®æ–‡æ¡£å¤±è´¥",a.error(r.value)}finally{n.value=!1}},v=()=>{u.value={tenderFile:null,templateFile:null,technicalFile:null,businessResponseFile:null,p2pResponseFile:null,techProposalFile:null}},y=e=>{if(e.startsWith("/api/"))return e.includes("?")?`${e}&download=true`:`${e}?download=true`;let l=e;const t="/Users/lvhe/Downloads/zhongbiao/zhongbiao/";return l.startsWith(t)&&(l=l.substring(42)),l.startsWith("ai_tender_system/data/")?l=l.substring(22):l.startsWith("data/")&&(l=l.substring(5)),`/api/files/serve/${l}?download=true`};return{projects:o,loading:n,error:r,currentDocuments:u,selectedProject:c,hasProjects:d,hasTenderFile:p,hasTemplateFile:f,hasTechnicalFile:m,loadProjects:async l=>{var t;n.value=!0,r.value=null;try{const s=await e.getProjects({page:1,page_size:100,...l});o.value=(null==(t=s.data)?void 0:t.items)||[],0===o.value.length&&a.warning("æš‚æ— é¡¹ç›®æ•°æ®")}catch(s){r.value="åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥",a.error(r.value)}finally{n.value=!1}},handleProjectChange:_,loadProjectDocuments:h,clearDocuments:v,restoreProjectFromStore:async e=>i.projectId?(await _(i.projectId,e),i.projectId):null,filePathToUploadFile:(e,l)=>({name:l||e.split("/").pop()||"æ–‡ä»¶",url:e,status:"success",uid:Date.now()+Math.random(),size:0}),getDownloadUrl:y}}function K(e={}){const{onFileLoaded:l,onFileCancelled:i,onSyncSuccess:o}=e,n=t(!1),r=t(null),u=t(!1),c=t(!1),d=s(()=>!!r.value),p=e=>({technicalFile:"æŠ€æœ¯éœ€æ±‚æ–‡ä»¶",tenderFile:"æ‹›æ ‡æ–‡æ¡£",templateFile:"åº”ç­”æ¨¡æ¿",businessResponseFile:"å•†åŠ¡åº”ç­”æ–‡ä»¶",p2pResponseFile:"ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶",techProposalFile:"æŠ€æœ¯æ–¹æ¡ˆæ–‡ä»¶"}[e]||"æ–‡ä»¶");return{useHitlFile:n,hitlFileInfo:r,hasHitlFile:d,syncing:u,synced:c,loadFromHITL:(e,t="technicalFile")=>{const s=e[t];return s?(r.value={filename:s.filename||s.name||"æœªçŸ¥æ–‡ä»¶",file_path:s.file_path||s.url||"",file_size:s.file_size||s.size,file_url:s.file_url||s.url},n.value=!0,c.value=!1,a.success({message:`å·²åŠ è½½HITL${p(t)}: ${r.value.filename}`,duration:3e3}),l&&l(r.value),!0):(a.warning(`å½“å‰é¡¹ç›®æ²¡æœ‰${p(t)}`),!1)},cancelHitlFile:()=>{n.value=!1,r.value=null,c.value=!1,a.info("å·²å–æ¶ˆä½¿ç”¨HITLæ–‡ä»¶"),i&&i()},syncToHitl:async(e,l,t)=>{if(!e)return a.error("é¡¹ç›®IDæ— æ•ˆ"),!1;if(!l)return a.error("æ–‡ä»¶è·¯å¾„æ— æ•ˆ"),!1;u.value=!0;try{const s=await fetch(`/api/tender-processing/sync-file/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:l,file_type:t})}),i=s.headers.get("content-type");if(!(null==i?void 0:i.includes("application/json"))){await s.text();throw new Error(`æœåŠ¡å™¨è¿”å›å¼‚å¸¸å“åº” (${s.status}): ${s.statusText}ã€‚å¯èƒ½æ˜¯åç«¯é…ç½®é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚`)}const n=await s.json();if(n.success||s.ok)return c.value=!0,a.success({message:n.message||"å·²æˆåŠŸåŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›®",duration:3e3}),o&&await o(),!0;throw new Error(n.error||n.message||"åŒæ­¥å¤±è´¥")}catch(s){let e="åŒæ­¥åˆ°é¡¹ç›®å¤±è´¥";return s.message?e=s.message:"TypeError"===s.name&&(e="ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"),a.error({message:e,duration:5e3}),!1}finally{u.value=!1}},resetSyncStatus:()=>{c.value=!1}}}const Q={class:"stats-card"},X={key:0,class:"stats-title"},Z={class:"stat-item"},G={class:"stat-prefix"},ee={class:"stat-suffix"},le=v(i({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const l=e,t=[{key:"total_replacements",label:"æ–‡æœ¬æ›¿æ¢",suffix:"å¤„"},{key:"tables_processed",label:"è¡¨æ ¼å¤„ç†",suffix:"ä¸ª"},{key:"cells_filled",label:"å•å…ƒæ ¼å¡«å……",suffix:"ä¸ª"},{key:"images_inserted",label:"å›¾ç‰‡æ’å…¥",suffix:"å¼ "}],a=s(()=>l.statItems||t),i=e=>{const t=e.split(".");let s=l.stats;for(const l of t)if(s=null==s?void 0:s[l],null==s)break;return"number"==typeof s?s:0};return(l,t)=>{const s=S,v=R,y=L;return n(),o("div",Q,[e.title?(n(),o("h4",X,c(e.title),1)):r("",!0),u(y,{gutter:e.gutter},{default:d(()=>[(n(!0),o(p,null,f(a.value,l=>(n(),m(v,{key:l.key,span:e.span},{default:d(()=>[_("div",Z,[u(s,{title:l.label,value:i(l.key),precision:l.precision,"value-style":e.valueStyle},h({_:2},[l.prefix?{name:"prefix",fn:d(()=>[_("span",G,c(l.prefix),1)]),key:"0"}:void 0,l.suffix?{name:"suffix",fn:d(()=>[_("span",ee,c(l.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]),te={class:"alert-content"},se={class:"file-info"},ae={class:"file-details"},ie={class:"file-label"},oe={class:"file-name"},ne={key:0,class:"file-size"},re={class:"alert-actions"},ue=v(i({__name:"HitlFileAlert",props:{fileInfo:{},type:{default:"success"},label:{default:"ä½¿ç”¨HITLæ–‡ä»¶:"},showCancel:{type:Boolean,default:!0},cancelText:{default:"å–æ¶ˆä½¿ç”¨"},showTag:{type:Boolean,default:!0}},emits:["cancel"],setup(e,{emit:l}){const t=l,s=()=>{t("cancel")};return(l,t)=>{const a=y,i=D,p=j,f=x;return e.fileInfo?(n(),m(f,{key:0,type:e.type,closable:!1,class:"hitl-file-alert"},{title:d(()=>[_("div",te,[_("div",se,[u(a,{class:"file-icon"},{default:d(()=>[u(g(w))]),_:1}),_("div",ae,[_("span",ie,c(e.label),1),_("span",oe,c(e.fileInfo.filename),1),e.fileInfo.file_size?(n(),o("span",ne," ("+c(g(E)(e.fileInfo.file_size))+") ",1)):r("",!0),e.showTag?(n(),m(i,{key:1,type:"success",size:"small",class:"hitl-tag"},{default:d(()=>[...t[0]||(t[0]=[F(" å·²ä»æŠ•æ ‡é¡¹ç›®åŠ è½½ ",-1)])]),_:1})):r("",!0)])]),_("div",re,[b(l.$slots,"actions",{},()=>[e.showCancel?(n(),m(p,{key:0,type:"text",size:"small",onClick:s},{default:d(()=>[u(a,null,{default:d(()=>[u(g(k))]),_:1}),F(" "+c(e.cancelText),1)]),_:1})):r("",!0)],!0)])])]),_:3},8,["type"])):r("",!0)}}}),[["__scopeId","data-v-1a132715"]]),ce={class:"history-files-panel"},de={class:"card-header"},pe={class:"header-title"},fe={class:"current-file-content"},me={class:"history-actions"},_e={class:"collapse-header"},he={class:"filename-cell"},ve=v(i({__name:"HistoryFilesPanel",props:{title:{default:""},currentFile:{},historyFiles:{},loading:{type:Boolean,default:!1},showRegenerate:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},statItems:{},currentFileMessage:{default:"è¯¥é¡¹ç›®å·²æœ‰ç”Ÿæˆæ–‡ä»¶"},showEditorOpen:{type:Boolean,default:!1}},emits:["openInEditor","preview","download","regenerate","refresh"],setup(e){const l=t([]),s=e=>{if(!e)return"-";let l=e;try{l=decodeURIComponent(e)}catch{}const t=l.split("/");return t[t.length-1]||"-"};return(t,a)=>{const i=D,p=x,f=B,h=O,v=M,b=y,k=j,L=U,R=N,S=V,A=q,K=Y,Q=W,X=J;return n(),o("div",ce,[e.currentFile?(n(),m(L,{key:0,shadow:"never",class:"current-file-card"},{header:d(()=>[_("div",de,[_("div",pe,[_("span",null,c(e.title||"ğŸ“„ è¯¥é¡¹ç›®çš„ç”Ÿæˆæ–‡ä»¶"),1),u(i,{type:"info"},{default:d(()=>[...a[6]||(a[6]=[F("å†å²æ–‡ä»¶",-1)])]),_:1})])])]),default:d(()=>[_("div",fe,[u(p,{type:"info",title:e.currentFile.message||e.currentFileMessage,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),e.currentFile.stats&&e.showStats?(n(),m(g(le),{key:0,stats:e.currentFile.stats,"stat-items":e.statItems},null,8,["stats","stat-items"])):r("",!0),u(v,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:d(()=>[u(f,{label:"æ–‡ä»¶å"},{default:d(()=>[F(c(s(e.currentFile.outputFile||e.currentFile.file_path)),1)]),_:1}),u(f,{label:"ä¸‹è½½åœ°å€"},{default:d(()=>[u(h,{href:e.currentFile.downloadUrl,type:"primary"},{default:d(()=>[F(c(s(e.currentFile.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1}),_("div",me,[e.showEditorOpen?(n(),m(k,{key:0,type:"primary",size:"large",onClick:a[0]||(a[0]=l=>t.$emit("openInEditor",e.currentFile))},{default:d(()=>[u(b,null,{default:d(()=>[u(g(C))]),_:1}),a[7]||(a[7]=F(" åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ",-1))]),_:1})):r("",!0),u(k,{type:"primary",size:"large",icon:g(z),onClick:a[1]||(a[1]=l=>t.$emit("preview",e.currentFile))},{default:d(()=>[...a[8]||(a[8]=[F(" é¢„è§ˆWord ",-1)])]),_:1},8,["icon"]),u(k,{type:"success",size:"large",icon:g(I),onClick:a[2]||(a[2]=l=>t.$emit("download",e.currentFile))},{default:d(()=>[...a[9]||(a[9]=[F(" ä¸‹è½½ ",-1)])]),_:1},8,["icon"]),e.showRegenerate?(n(),m(k,{key:1,size:"large",icon:g(P),onClick:a[3]||(a[3]=e=>t.$emit("regenerate"))},{default:d(()=>[...a[10]||(a[10]=[F(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])):r("",!0)])])]),_:1})):r("",!0),u(Q,{modelValue:l.value,"onUpdate:modelValue":a[5]||(a[5]=e=>l.value=e),class:"history-collapse"},{default:d(()=>[u(K,{name:"history"},{title:d(()=>[_("div",_e,[_("span",null,"ğŸ“‚ æŸ¥çœ‹æ‰€æœ‰å†å²å¤„ç†æ–‡ä»¶ ("+c(e.historyFiles.length)+")",1),l.value.includes("history")?(n(),m(k,{key:0,type:"primary",size:"small",loading:e.loading,onClick:a[4]||(a[4]=T(e=>t.$emit("refresh"),["stop"])),style:{"margin-left":"16px"}},{default:d(()=>[...a[11]||(a[11]=[F(" åˆ·æ–°åˆ—è¡¨ ",-1)])]),_:1},8,["loading"])):r("",!0)])]),default:d(()=>[u(L,{shadow:"never",style:{border:"none"}},{default:d(()=>[$((n(),m(S,{data:e.historyFiles,border:"",stripe:"","max-height":"400"},{default:d(()=>[u(R,{type:"index",label:"åºå·",width:"60"}),u(R,{prop:"filename",label:"æ–‡ä»¶å","min-width":"300"},{default:d(({row:e})=>[_("div",he,[u(b,null,{default:d(()=>[u(g(w))]),_:1}),_("span",null,c(e.filename),1)])]),_:1}),u(R,{prop:"size",label:"æ–‡ä»¶å¤§å°",width:"120"},{default:d(({row:e})=>[F(c(g(E)(e.size)),1)]),_:1}),u(R,{prop:"process_time",label:"å¤„ç†æ—¶é—´",width:"180"},{default:d(({row:e})=>[F(c(g(H)(e.process_time||e.generated_at,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),u(R,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:d(({row:e})=>[u(k,{type:"primary",size:"small",onClick:l=>t.$emit("preview",e)},{default:d(()=>[...a[12]||(a[12]=[F(" é¢„è§ˆ ",-1)])]),_:1},8,["onClick"]),u(k,{type:"success",size:"small",onClick:l=>t.$emit("download",e)},{default:d(()=>[...a[13]||(a[13]=[F(" ä¸‹è½½ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,e.loading]]),e.loading||0!==e.historyFiles.length?r("",!0):(n(),m(A,{key:0,description:"æš‚æ— å†å²æ–‡ä»¶","image-size":100}))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-69e4d361"]]);export{ue as H,le as S,K as a,ve as b,A as u};
