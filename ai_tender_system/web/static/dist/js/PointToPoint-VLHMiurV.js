import{d as wt,I as bt,G as xt,f as Ft,q as Ct,o as kt,i as Vt,Q as Et,z as It,g as jt,h as Pt,a as St,a4 as Tt,Z as Ut,c as Dt,W as $t,X as Rt,n as qt,_ as zt,$ as Se,a0 as Mt,p as Lt,a1 as Ot,a2 as Ht,J as At,K as Nt,D as Wt,af as Bt,b as Gt,F as Jt,a3 as Kt,P as Qt,k as r}from"./element-plus-IkZgpaz4.js";import{bT as Xt,bt as u,bu as ne,bA as Yt,bG as Zt,bU as q,bV as f,c8 as l,b$ as y,c3 as _,c0 as o,c7 as Te,cC as Ue,bv as d,bY as n,c5 as c,c6 as h,c1 as el,ce as tl}from"./vendor-CdA3MjAt.js";/* empty css                                                                          */import{S as K}from"./SSEStreamViewer-BoeXFWk-.js";import{D as ll}from"./DocumentUploader-BBjdsRhi.js";import{D as ol}from"./DocumentPreview-BbjmwCia.js";import{R as al}from"./RichTextEditor-BDdJ_J7M.js";import{u as sl,H as nl,S as rl,a as il,d as re}from"./helpers-Btlcunlb.js";import{_ as ul}from"./index.js";import{t as dl}from"./tender-2TSD_jRl.js";import{u as cl}from"./useProjectDocuments-BId2nzjv.js";import"./onnxruntime-DkHy2lK3.js";import"./imageCompressor-D9CndpqW.js";import"./umo-editor-BmhDOXHm.js";import"./mermaid-e-fO57px.js";import"./echarts-Cqw1j_Z-.js";/* empty css                                                                        */import"./project-C4LB9E9r.js";const pl={class:"point-to-point"},vl={class:"card-header"},ml={class:"action-controls"},fl={class:"card-header"},gl={class:"card-header"},yl={class:"header-actions"},_l={class:"result-content"},hl={class:"file-info-section"},wl={class:"card-header"},bl={class:"header-actions"},xl={class:"requirement-text"},Fl={class:"card-header"},Cl={class:"card-header"},kl={class:"header-actions"},Vl={class:"collapse-title"},El={class:"requirement-preview"},Il={class:"response-content"},jl={class:"response-item"},Pl={class:"requirement-detail"},Sl={class:"response-item"},Tl={key:0,class:"response-item"},Ul={key:0,class:"response-dialog"},Dl={class:"dialog-section"},$l={class:"requirement-detail"},Rl={class:"dialog-section"},ql={key:0,class:"dialog-section"},zl={class:"collapse-header"},Ml={class:"filename-cell"},Ll=Xt({__name:"PointToPoint",setup(Ol){const{projects:De,selectedProject:k,currentDocuments:ie,loadProjects:$e,handleProjectChange:Re,restoreProjectFromStore:qe}=cl(),{useHitlFile:j,hitlFileInfo:ue,syncing:ze,synced:Me,loadFromHITL:de,cancelHitlFile:Q,syncToHitl:X}=sl({onFileLoaded:()=>{v.value.tenderFiles=[]}}),v=u({projectId:null,tenderFiles:[]}),b=u({bidRole:"primary",responseFrequency:"every_paragraph",responseMode:"simple",aiModel:"shihuang-gpt4o-mini"}),z=u(!1),H=u(0),Y=u(""),x=u([]),P=u([]),A=u(""),N=u(""),Le=ne(()=>{let t=x.value;return A.value&&(t=t.filter(e=>e.requirement.toLowerCase().includes(A.value.toLowerCase()))),N.value&&(t=t.filter(e=>e.category===N.value)),t}),V=u(!1),M=u(0),Z=u(""),Oe=u(""),He=u(""),Ae=u(null),g=u(null),S=u(!1),L=u(null),T=u(""),ce=u(!1),ee=u([]),w=u(null),$=u([]),R=u(!1),W=u([]),O=u(!1),B=u(""),G=u(""),Ne=ne(()=>x.value.some(t=>t.response)),pe=u([]),te=u(!1),D=u(null),ve=ne(()=>v.value.projectId&&(v.value.tenderFiles.length>0||j.value)),We=async t=>{var m;const{file:e,onSuccess:s,onError:i}=t;if(!v.value.projectId){const p=new Error("è¯·å…ˆé€‰æ‹©é¡¹ç›®");i(p),r.error("è¯·å…ˆé€‰æ‹©é¡¹ç›®");return}if(!((m=k.value)!=null&&m.company_id)){const p=new Error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸");i(p),r.error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸");return}try{const p=new FormData;p.append("file",e),p.append("company_id",k.value.company_id.toString()),p.append("project_id",v.value.projectId.toString());const E=await dl.parseDocumentStructure(p);if(E.success)s(E.data),r.success("æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ æˆåŠŸ");else throw new Error(E.message||"ä¸Šä¼ å¤±è´¥")}catch(p){i(p),r.error(p.message||"æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ å¤±è´¥")}},Be=async()=>{await Re(v.value.projectId,{onClear:()=>{v.value.tenderFiles=[],x.value=[],P.value=[],w.value=null,g.value=null,S.value=!1,T.value="",ee.value=[],j.value&&Q()},onDocumentsLoaded:me})},Ge=()=>{r.success("æ–‡æ¡£ä¸Šä¼ æˆåŠŸ")},me=t=>{t.technicalFile?de(t,"technicalFile"):t.tenderFile&&(v.value.tenderFiles=[t.tenderFile]),t.p2pResponseFile&&(w.value=t.p2pResponseFile,S.value=!1,console.log("[PointToPoint] æ£€æµ‹åˆ°å†å²ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶:",t.p2pResponseFile.outputFile),r.info('æ£€æµ‹åˆ°å†å²ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶ï¼Œç‚¹å‡»"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€"å¯ç¼–è¾‘'))},Je=async()=>{z.value=!0,H.value=0,Y.value="",x.value=[];try{await Ke(),r.success("æ‹›æ ‡è¦æ±‚æå–å®Œæˆ")}catch(t){console.error("æå–å¤±è´¥:",t),r.error("æå–å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{z.value=!1}},Ke=async()=>new Promise(t=>{const e=[{progress:25,message:"æ­£åœ¨è§£ææ‹›æ ‡æ–‡æ¡£..."},{progress:50,message:"æ­£åœ¨è¯†åˆ«æ‹›æ ‡è¦æ±‚..."},{progress:75,message:"æ­£åœ¨åˆ†ç±»æ•´ç†..."},{progress:100,message:"æå–å®Œæˆï¼"}];let s=0;const i=setInterval(()=>{if(s<e.length){const m=e[s];H.value=m.progress,Y.value+=`
[${m.progress}%] ${m.message}`,s++}else clearInterval(i),x.value=[{id:1,category:"technical",requirement:"ç³»ç»Ÿåº”æ”¯æŒä¸å°‘äº10000ä¸ªå¹¶å‘ç”¨æˆ·åŒæ—¶åœ¨çº¿è®¿é—®",priority:"é«˜",status:"pending"},{id:2,category:"technical",requirement:"ç³»ç»Ÿå“åº”æ—¶é—´åº”ä¸è¶…è¿‡3ç§’",priority:"é«˜",status:"pending"},{id:3,category:"business",requirement:"é¡¹ç›®å®æ–½å‘¨æœŸä¸è¶…è¿‡6ä¸ªæœˆ",priority:"é«˜",status:"pending"},{id:4,category:"qualification",requirement:"æŠ•æ ‡äººåº”å…·æœ‰ISO 9001è´¨é‡ç®¡ç†ä½“ç³»è®¤è¯",priority:"ä¸­",status:"pending"},{id:5,category:"qualification",requirement:"æŠ•æ ‡äººåº”å…·æœ‰ä¿¡æ¯å®‰å…¨ç­‰çº§ä¿æŠ¤ä¸‰çº§èµ„è´¨",priority:"ä¸­",status:"pending"},{id:6,category:"business",requirement:"è´¨ä¿æœŸä¸å°‘äº2å¹´",priority:"ä¸­",status:"pending"},{id:7,category:"technical",requirement:"ç³»ç»Ÿåº”æ”¯æŒç§»åŠ¨ç«¯è®¿é—®ï¼ˆiOSå’ŒAndroidï¼‰",priority:"ä¸­",status:"pending"},{id:8,category:"other",requirement:"æŠ•æ ‡æ–‡ä»¶åº”åŒ…å«è¯¦ç»†çš„åŸ¹è®­è®¡åˆ’",priority:"ä½",status:"pending"}],t()},600)}),Qe=t=>{P.value=t},Xe=async()=>{if(P.value.length===0){r.warning("è¯·é€‰æ‹©è¦ç”Ÿæˆåº”ç­”çš„è¦æ±‚");return}V.value=!0,M.value=0,Z.value="";try{await Ye(),r.success("ç‚¹å¯¹ç‚¹åº”ç­”ç”Ÿæˆå®Œæˆ")}catch(t){console.error("ç”Ÿæˆå¤±è´¥:",t),r.error("ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{V.value=!1}},Ye=async()=>new Promise(t=>{const e=P.value.length;let s=0;const i=setInterval(()=>{if(s<e){const m=P.value[s];M.value=Math.round((s+1)/e*100),Z.value+=`
[${s+1}/${e}] æ­£åœ¨ç”Ÿæˆ"${m.requirement.substring(0,20)}..."çš„åº”ç­”`;const p=x.value.findIndex(E=>E.id===m.id);p!==-1&&(x.value[p]={...x.value[p],status:"generated",response:Ze(m),compliance:Math.random()>.3?"å®Œå…¨ç¬¦åˆ":"éƒ¨åˆ†ç¬¦åˆ"}),s++}else clearInterval(i),t()},800)}),fe=async()=>{if(!v.value.projectId||!k.value){r.error("è¯·å…ˆé€‰æ‹©é¡¹ç›®");return}if(!j.value&&v.value.tenderFiles.length===0){r.error("è¯·å…ˆä¸Šä¼ æ‹›æ ‡æ–‡æ¡£æˆ–ä½¿ç”¨æŠ€æœ¯æ–‡ä»¶");return}V.value=!0,M.value=0,g.value=null,S.value=!0,T.value='<h1>ğŸ“„ ç‚¹å¯¹ç‚¹åº”ç­”æ–‡æ¡£</h1><p style="color: #909399;">AIæ­£åœ¨ç”Ÿæˆå†…è”åº”ç­”ï¼Œè¯·ç¨å€™...</p>',setTimeout(()=>{var t;(t=document.querySelector(".editor-section"))==null||t.scrollIntoView({behavior:"smooth",block:"start"})},100);try{const t=new FormData;j.value&&ue.value?(t.append("use_hitl_technical_file","true"),t.append("project_id",v.value.projectId.toString())):v.value.tenderFiles.length>0&&v.value.tenderFiles[0].raw&&t.append("file",v.value.tenderFiles[0].raw),t.append("companyId",k.value.company_id.toString()),t.append("projectName",k.value.project_name||""),t.append("responseFrequency",b.value.responseFrequency),t.append("responseMode",b.value.responseMode),t.append("aiModel",b.value.aiModel);const e=await fetch("/api/process-point-to-point",{method:"POST",body:t});console.log("ç‚¹å¯¹ç‚¹åº”ç­”APIå“åº”çŠ¶æ€:",e.status,e.statusText);const s=await e.json();if(console.log("ç‚¹å¯¹ç‚¹åº”ç­”APIå“åº”æ•°æ®:",s),s.success)Oe.value=s.output_file,He.value=s.download_url,Ae.value=s.stats,g.value={success:!0,outputFile:s.output_file,downloadUrl:s.download_url,stats:s.stats||{},message:s.message||"ç‚¹å¯¹ç‚¹åº”ç­”ç”Ÿæˆå®Œæˆ"},await ge(s.output_file),r.success("ç‚¹å¯¹ç‚¹åº”ç­”ç”Ÿæˆå®Œæˆï¼å¯ä»¥ç¼–è¾‘äº†"),s.output_file&&await X(v.value.projectId,s.output_file,"point_to_point");else{let i="å¤„ç†å¤±è´¥";throw s.error?typeof s.error=="object"&&s.error.message?i=s.error.message:typeof s.error=="string"?i=s.error:i=JSON.stringify(s.error):s.message&&(i=s.message),console.error("å¤„ç†å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯:",i,"å®Œæ•´ç»“æœ:",s),new Error(i)}}catch(t){console.error("ç‚¹å¯¹ç‚¹åº”ç­”å¤„ç†å¤±è´¥:",t);let e="å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•";typeof t=="string"?e=t:t!=null&&t.message?e=t.message:t!=null&&t.error?e=t.error:typeof t=="object"&&(e=JSON.stringify(t)),L.value&&L.value.appendContent(`<p style="color: red;">âŒ é”™è¯¯: ${e}</p>`),r.error({message:e,duration:5e3})}finally{V.value=!1}},Ze=t=>({technical:`## æŠ€æœ¯å“åº”

æˆ‘æ–¹ç³»ç»Ÿå®Œå…¨æ»¡è¶³è¯¥æŠ€æœ¯è¦æ±‚ï¼š

### æ–¹æ¡ˆè¯´æ˜
1. é‡‡ç”¨xxxæ¶æ„è®¾è®¡ï¼Œæ”¯æŒé«˜å¹¶å‘è®¿é—®
2. ç»è¿‡å‹åŠ›æµ‹è¯•ï¼Œå¯æ”¯æŒxxxå¹¶å‘ç”¨æˆ·
3. é…ç½®xxxæœåŠ¡å™¨é›†ç¾¤ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

### æŠ€æœ¯æŒ‡æ ‡
- å¹¶å‘å¤„ç†èƒ½åŠ›ï¼šæ»¡è¶³è¦æ±‚
- å“åº”æ—¶é—´ï¼šå¹³å‡2ç§’ä»¥å†…
- ç³»ç»Ÿå¯ç”¨æ€§ï¼š99.9%

### è¯æ˜ææ–™
è¯¦è§é™„ä»¶ã€ŠæŠ€æœ¯æ–¹æ¡ˆä¹¦ã€‹ç¬¬xxé¡µ`,business:`## å•†åŠ¡å“åº”

æˆ‘æ–¹å®Œå…¨æ¥å—è¯¥å•†åŠ¡æ¡æ¬¾ï¼š

### æ‰¿è¯ºå†…å®¹
1. ä¸¥æ ¼æŒ‰ç…§è¦æ±‚æ‰§è¡Œ
2. æä¾›ç›¸åº”çš„ä¿éšœæªæ–½
3. ç¡®ä¿æŒ‰æ—¶å®Œæˆ

### å…·ä½“å®‰æ’
- é¡¹ç›®å‘¨æœŸï¼šç¬¦åˆè¦æ±‚
- è´¨ä¿æœŸï¼šæ»¡è¶³è¦æ±‚
- éªŒæ”¶æ ‡å‡†ï¼šæŒ‰ç…§æ‹›æ ‡æ–‡ä»¶æ‰§è¡Œ

### æœåŠ¡ä¿éšœ
è¯¦è§é™„ä»¶ã€Šå•†åŠ¡åº”ç­”ä¹¦ã€‹ç¬¬xxé¡µ`,qualification:`## èµ„è´¨å“åº”

æˆ‘æ–¹å…·å¤‡è¯¥é¡¹èµ„è´¨è¦æ±‚ï¼š

### èµ„è´¨è¯æ˜
1. æŒæœ‰xxxè¯ä¹¦ï¼Œè¯ä¹¦ç¼–å·ï¼šxxx
2. è¯ä¹¦æœ‰æ•ˆæœŸï¼šxxxxå¹´xxæœˆè‡³xxxxå¹´xxæœˆ
3. è®¤è¯èŒƒå›´ï¼šè¦†ç›–æœ¬é¡¹ç›®éœ€æ±‚

### ç›¸å…³ä¸šç»©
- è¿‘ä¸‰å¹´å®Œæˆç±»ä¼¼é¡¹ç›®xxä¸ª
- é¡¹ç›®éªŒæ”¶åˆæ ¼ç‡100%

### é™„ä»¶ææ–™
è¯¦è§é™„ä»¶ã€Šèµ„è´¨è¯æ˜æ–‡ä»¶ã€‹`,other:`## å…¶ä»–è¦æ±‚å“åº”

æˆ‘æ–¹æ‰¿è¯ºæ»¡è¶³è¯¥è¦æ±‚ï¼š

### å…·ä½“å®‰æ’
1. åˆ¶å®šè¯¦ç»†è®¡åˆ’
2. é…å¤‡ä¸“ä¸šäººå‘˜
3. æä¾›å®Œæ•´æ–‡æ¡£

### æ‰§è¡Œæ ‡å‡†
- ä¸¥æ ¼æŒ‰ç…§æ‹›æ ‡æ–‡ä»¶è¦æ±‚
- ç¡®ä¿è´¨é‡å’Œè¿›åº¦

### ç›¸å…³æ–‡ä»¶
è¯¦è§é™„ä»¶ç›¸å…³ç« èŠ‚`})[t.category]||"æˆ‘æ–¹å®Œå…¨å“åº”è¯¥è¦æ±‚ã€‚",et=()=>{V.value=!1,r.info("å·²åœæ­¢ç”Ÿæˆ")},ge=async t=>{try{T.value='<p style="color: #409EFF;">æ­£åœ¨è½¬æ¢Wordæ–‡æ¡£ä¸ºå¯ç¼–è¾‘æ ¼å¼...</p>';const s=await(await fetch("/api/editor/convert-word-to-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t})})).json();if(s.success&&s.html_content)T.value=s.html_content,L.value&&L.value.setContent(s.html_content),console.log("[PointToPoint] Wordæ–‡æ¡£å·²åŠ è½½åˆ°ç¼–è¾‘å™¨");else throw new Error(s.error||"è½¬æ¢å¤±è´¥")}catch(e){console.error("[PointToPoint] åŠ è½½æ–‡æ¡£åˆ°ç¼–è¾‘å™¨å¤±è´¥:",e),T.value=`
      <h1>ğŸ“„ ç‚¹å¯¹ç‚¹åº”ç­”æ–‡æ¡£</h1>
      <div style="padding: 20px; background: #FFF3E0; border-left: 4px solid #FF9800; margin: 16px 0;">
        <p><strong>âš ï¸ æç¤ºï¼š</strong>Wordæ–‡æ¡£è½¬æ¢å¤±è´¥</p>
        <p>åŸå› ï¼š${e.message}</p>
        <p>æ‚¨å¯ä»¥ï¼š</p>
        <ul>
          <li>ç‚¹å‡»ä¸‹æ–¹"æŸ¥çœ‹åŸå§‹ç”Ÿæˆç»“æœ"ä¸‹è½½Wordæ–‡æ¡£æŸ¥çœ‹</li>
          <li>Wordæ–‡æ¡£ä¸­å·²åŒ…å«å†…è”å›å¤ï¼ˆç°è‰²åº•çº¹æ ‡è®°ï¼‰</li>
        </ul>
      </div>
    `,r.warning("Wordè½¬æ¢HTMLå¤±è´¥ï¼Œè¯·ä½¿ç”¨ä¸‹è½½åŠŸèƒ½æŸ¥çœ‹")}},tt=async t=>{var e,s;if(!v.value.projectId){r.error("é¡¹ç›®IDæ— æ•ˆ");return}ce.value=!0;try{const m=await(await fetch("/api/editor/save-html-to-word",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html_content:t,project_id:v.value.projectId,document_type:"point_to_point",original_file:(e=g.value)==null?void 0:e.outputFile})})).json();if(m.success)g.value={success:!0,outputFile:m.output_file,downloadUrl:m.download_url,stats:((s=g.value)==null?void 0:s.stats)||{},message:"æ–‡æ¡£å·²ä¿å­˜"},console.log("[PointToPoint] ç¼–è¾‘å†…å®¹å·²ä¿å­˜:",m.output_file),m.output_file&&await X(v.value.projectId,m.output_file,"point_to_point");else throw new Error(m.error||"ä¿å­˜å¤±è´¥")}catch(i){throw console.error("[PointToPoint] ä¿å­˜ç¼–è¾‘å†…å®¹å¤±è´¥:",i),i}finally{ce.value=!1}},lt=t=>{D.value=t,te.value=!0},ye=()=>{var t;if(!g.value){r.warning("æš‚æ— æ–‡æ¡£å¯é¢„è§ˆ");return}if(!g.value.downloadUrl){r.warning("æ–‡æ¡£åœ°å€æ— æ•ˆ");return}B.value=g.value.outputFile,G.value=`ç‚¹å¯¹ç‚¹åº”ç­”-${((t=k.value)==null?void 0:t.project_name)||"æ–‡æ¡£"}.docx`,O.value=!0},_e=()=>{var t;if(!g.value){r.warning("æš‚æ— æ–‡æ¡£å¯ä¸‹è½½");return}try{const e=g.value.downloadUrl,s=`ç‚¹å¯¹ç‚¹åº”ç­”-${((t=k.value)==null?void 0:t.project_name)||"æ–‡æ¡£"}-${Date.now()}.docx`;re(e,s),r.success("Wordæ–‡æ¡£ä¸‹è½½æˆåŠŸ")}catch(e){console.error("ä¸‹è½½å¤±è´¥:",e),r.error("æ–‡æ¡£ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}},ot=async()=>{var t;if(!((t=g.value)!=null&&t.outputFile)){r.warning("æ²¡æœ‰å¯åŒæ­¥çš„æ–‡ä»¶");return}if(!v.value.projectId){r.error("é¡¹ç›®IDæ— æ•ˆ");return}await X(v.value.projectId,g.value.outputFile,"point_to_point")},at=()=>{var m;const t=x.value.filter(p=>p.response).map((p,E)=>`${E+1}. ã€${le(p.category)}ã€‘${p.requirement}

${p.response}

ç¬¦åˆæ€§ï¼š${p.compliance}

---
`).join(`
`),e=new Blob([`# ç‚¹å¯¹ç‚¹åº”ç­”æ–‡æ¡£

${t}`],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(e),i=document.createElement("a");i.href=s,i.download=`ç‚¹å¯¹ç‚¹åº”ç­”-${((m=k.value)==null?void 0:m.project_name)||"export"}-${Date.now()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),r.success("å¯¼å‡ºæˆåŠŸ")},le=t=>({technical:"æŠ€æœ¯è¦æ±‚",business:"å•†åŠ¡è¦æ±‚",qualification:"èµ„è´¨è¦æ±‚",other:"å…¶ä»–è¦æ±‚"})[t]||t,he=t=>({technical:"primary",business:"success",qualification:"warning",other:"info"})[t]||"",st=t=>({é«˜:"danger",ä¸­:"warning",ä½:"info"})[t]||"",we=t=>({pending:"å¾…ç”Ÿæˆ",generated:"å·²ç”Ÿæˆ",reviewed:"å·²å®¡æ ¸"})[t]||t,be=t=>({pending:"info",generated:"success",reviewed:"primary"})[t]||"",xe=t=>{if(!t)return"-";let e=t;try{e=decodeURIComponent(t)}catch{}const s=e.split("/");return s[s.length-1]||"-"},Fe=async()=>{R.value=!0;try{const e=await(await fetch("/api/point-to-point/files")).json();if(e.success)$.value=e.data||[],r.success(`åŠ è½½äº† ${$.value.length} ä¸ªå†å²æ–‡ä»¶`);else throw new Error(e.error||"åŠ è½½å¤±è´¥")}catch(t){console.error("åŠ è½½å†å²æ–‡ä»¶å¤±è´¥:",t),r.error(t.message||"åŠ è½½å†å²æ–‡ä»¶å¤±è´¥")}finally{R.value=!1}},nt=t=>{const e=["B","KB","MB","GB"];let s=t,i=0;for(;s>=1024&&i<e.length-1;)s/=1024,i++;return`${s.toFixed(1)} ${e[i]}`},rt=t=>{try{return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return t}},it=t=>{if(!t.file_path){r.warning("æ— æ³•è·å–æ–‡ä»¶ä¿¡æ¯");return}B.value=t.file_path,G.value=t.filename,O.value=!0},ut=()=>{var t;w.value&&(B.value=w.value.outputFile,G.value=`ç‚¹å¯¹ç‚¹åº”ç­”-${((t=k.value)==null?void 0:t.project_name)||"æ–‡æ¡£"}.docx`,O.value=!0)},dt=()=>{var t;if(w.value)try{const e=`ç‚¹å¯¹ç‚¹åº”ç­”-${((t=k.value)==null?void 0:t.project_name)||"æ–‡æ¡£"}-${Date.now()}.docx`;re(w.value.downloadUrl,e),r.success("æ–‡æ¡£ä¸‹è½½æˆåŠŸ")}catch(e){console.error("ä¸‹è½½å¤±è´¥:",e),r.error("æ–‡æ¡£ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}},ct=()=>{w.value=null,r.info('è¯·é…ç½®å‚æ•°åç‚¹å‡»"ç›´æ¥ç”ŸæˆWordæ–‡æ¡£"æŒ‰é’®é‡æ–°ç”Ÿæˆ')},pt=async()=>{var t;if(!((t=w.value)!=null&&t.outputFile)){r.error("å†å²æ–‡ä»¶ä¿¡æ¯æ— æ•ˆ");return}try{S.value=!0,g.value={success:!0,outputFile:w.value.outputFile,downloadUrl:w.value.downloadUrl||"",stats:w.value.stats||{},message:w.value.message||"å†å²ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶"},await ge(w.value.outputFile),r.success("å†å²æ–‡ä»¶å·²åŠ è½½åˆ°ç¼–è¾‘å™¨"),setTimeout(()=>{var e;(e=document.querySelector(".editor-section"))==null||e.scrollIntoView({behavior:"smooth",block:"start"})},100)}catch(e){console.error("[PointToPoint] æ‰“å¼€å†å²æ–‡ä»¶å¤±è´¥:",e),r.error("æ‰“å¼€å†å²æ–‡ä»¶å¤±è´¥: "+e.message)}};return Yt(W,t=>{t.includes("history")&&$.value.length===0&&!R.value&&Fe()}),Zt(async()=>{await $e();const t=await qe({onClear:()=>{v.value.tenderFiles=[],x.value=[],P.value=[],w.value=null,g.value=null,S.value=!1,T.value="",j.value&&Q()},onDocumentsLoaded:me});t&&(v.value.projectId=t,console.log("âœ… å·²ä»Storeæ¢å¤é¡¹ç›®:",t))}),(t,e)=>{const s=kt,i=Ct,m=Ft,p=xt,E=Vt,oe=bt,Ce=wt,I=Et,F=St,vt=It,J=Pt,ke=jt,Ve=Tt,U=Lt,mt=Dt,Ee=Rt,ft=qt,gt=$t,ae=Ut,se=Ht,Ie=Wt,C=Nt,je=At,yt=Gt,_t=Qt,ht=Kt;return f(),q("div",pl,[l(I,{class:"project-section",shadow:"never"},{header:o(()=>[...e[15]||(e[15]=[n("div",{class:"card-header"},[n("span",null,"Step 1: é€‰æ‹©é¡¹ç›®")],-1)])]),default:o(()=>[l(Ce,{model:v.value,"label-width":"100px"},{default:o(()=>[l(oe,{gutter:20},{default:o(()=>[l(p,{span:12},{default:o(()=>[l(m,{label:"é¡¹ç›®"},{default:o(()=>[l(i,{modelValue:v.value.projectId,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value.projectId=a),placeholder:"è¯·é€‰æ‹©é¡¹ç›®",filterable:"",onChange:Be,style:{width:"100%"}},{default:o(()=>[(f(!0),q(Te,null,Ue(d(De),a=>(f(),y(s,{key:a.id,label:`${a.project_name} (${a.project_number||"-"})`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,{span:12},{default:o(()=>[l(m,{label:"å…¬å¸"},{default:o(()=>{var a;return[l(E,{value:((a=d(k))==null?void 0:a.company_name)||"-",disabled:""},null,8,["value"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),v.value.projectId?(f(),y(I,{key:0,class:"upload-section",shadow:"never"},{header:o(()=>[n("div",vl,[e[17]||(e[17]=n("span",null,"Step 2: é€‰æ‹©æŠ€æœ¯éœ€æ±‚æ–‡æ¡£",-1)),d(ie).technicalFile&&!d(j)?(f(),y(F,{key:0,type:"primary",size:"small",onClick:e[1]||(e[1]=a=>d(de)(d(ie),"technicalFile"))},{default:o(()=>[...e[16]||(e[16]=[c(" ä½¿ç”¨æŠ€æœ¯éœ€æ±‚æ–‡ä»¶ ",-1)])]),_:1})):_("",!0)])]),default:o(()=>[d(j)?(f(),y(d(nl),{key:0,"file-info":d(ue),label:"æŠ€æœ¯éœ€æ±‚æ–‡ä»¶:",onCancel:d(Q)},null,8,["file-info","onCancel"])):_("",!0),d(j)?_("",!0):(f(),y(d(ll),{key:1,modelValue:v.value.tenderFiles,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value.tenderFiles=a),"http-request":We,accept:".pdf,.doc,.docx",limit:5,"max-size":50,drag:"","tip-text":"ä¸Šä¼ æŠ€æœ¯éœ€æ±‚æ–‡æ¡£",onSuccess:Ge},null,8,["modelValue"])),l(vt,null,{default:o(()=>[...e[18]||(e[18]=[c("å¤„ç†é…ç½®",-1)])]),_:1}),l(Ce,{model:b.value,"label-width":"100px",class:"config-form"},{default:o(()=>[l(oe,{gutter:20},{default:o(()=>[l(p,{span:12},{default:o(()=>[l(m,{label:"æŠ•æ ‡è§’è‰²"},{default:o(()=>[l(ke,{modelValue:b.value.bidRole,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value.bidRole=a)},{default:o(()=>[l(J,{label:"primary"},{default:o(()=>[...e[19]||(e[19]=[c("åº”æ ‡",-1)])]),_:1}),l(J,{label:"secondary"},{default:o(()=>[...e[20]||(e[20]=[c("é™ªæ ‡",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,{span:12},{default:o(()=>[l(m,{label:"åº”ç­”é¢‘ç‡"},{default:o(()=>[l(i,{modelValue:b.value.responseFrequency,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value.responseFrequency=a),style:{width:"100%"}},{default:o(()=>[l(s,{label:"æ¯æ®µåº”ç­”",value:"every_paragraph"}),l(s,{label:"æ¯é¡µåº”ç­”",value:"every_page"}),l(s,{label:"æ¯ç« èŠ‚åº”ç­”",value:"every_section"}),l(s,{label:"æ–‡æ¡£æœ«å°¾ç»Ÿä¸€åº”ç­”",value:"end_of_document"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(oe,{gutter:20},{default:o(()=>[l(p,{span:12},{default:o(()=>[l(m,{label:"åº”ç­”æ–¹å¼"},{default:o(()=>[l(ke,{modelValue:b.value.responseMode,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value.responseMode=a)},{default:o(()=>[l(J,{label:"simple"},{default:o(()=>[...e[21]||(e[21]=[c("ç®€å•æ¨¡æ¿åº”ç­”",-1)])]),_:1}),l(J,{label:"ai"},{default:o(()=>[...e[22]||(e[22]=[c("AIæ™ºèƒ½åº”ç­”",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),b.value.responseMode==="ai"?(f(),y(p,{key:0,span:12},{default:o(()=>[l(m,{label:"AIæ¨¡å‹"},{default:o(()=>[l(i,{modelValue:b.value.aiModel,"onUpdate:modelValue":e[6]||(e[6]=a=>b.value.aiModel=a),style:{width:"100%"}},{default:o(()=>[l(s,{label:"GPT5ï¼ˆæœ€å¼ºæ¨ç†ï¼‰",value:"shihuang-gpt5"}),l(s,{label:"Claude Sonnet 4.5ï¼ˆæ ‡ä¹¦ä¸“ç”¨ï¼‰",value:"shihuang-claude-sonnet-45"}),l(s,{label:"GPT4o Miniï¼ˆæ¨è-é»˜è®¤ï¼‰",value:"shihuang-gpt4o-mini"})]),_:1},8,["modelValue"])]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1},8,["model"]),n("div",ml,[l(F,{type:"primary",size:"large",disabled:!ve.value,loading:z.value,onClick:Je},{default:o(()=>[...e[23]||(e[23]=[c(" æå–æ‹›æ ‡è¦æ±‚ ",-1)])]),_:1},8,["disabled","loading"]),l(F,{type:"success",size:"large",disabled:!ve.value,loading:V.value,onClick:fe},{default:o(()=>[...e[24]||(e[24]=[c(" ç›´æ¥ç”ŸæˆWordæ–‡æ¡£ ",-1)])]),_:1},8,["disabled","loading"])])]),_:1})):_("",!0),z.value?(f(),y(I,{key:1,class:"extracting-section",shadow:"never"},{header:o(()=>[n("div",fl,[e[25]||(e[25]=n("span",null,"æ­£åœ¨æå–æ‹›æ ‡è¦æ±‚...",-1)),l(Ve,{percentage:H.value,status:H.value===100?"success":void 0,style:{width:"300px"}},null,8,["percentage","status"])])]),default:o(()=>[l(d(K),{content:Y.value,"is-streaming":z.value},null,8,["content","is-streaming"])]),_:1})):_("",!0),S.value?(f(),y(I,{key:2,class:"editor-section",shadow:"never"},{default:o(()=>[l(d(al),{ref_key:"editorRef",ref:L,modelValue:T.value,"onUpdate:modelValue":e[7]||(e[7]=a=>T.value=a),title:"ç‚¹å¯¹ç‚¹åº”ç­”æ–‡æ¡£",streaming:V.value,height:700,onSave:tt,onPreview:ye,onExport:_e},null,8,["modelValue","streaming"])]),_:1})):_("",!0),S.value&&g.value?(f(),y(se,{key:3,modelValue:ee.value,"onUpdate:modelValue":e[8]||(e[8]=a=>ee.value=a),class:"result-collapse"},{default:o(()=>[l(ae,{name:"result",title:"ğŸ“„ æŸ¥çœ‹åŸå§‹ç”Ÿæˆç»“æœ"},{default:o(()=>[l(I,{class:"result-section",shadow:"never"},{header:o(()=>[n("div",gl,[e[31]||(e[31]=n("span",null,"âœ… ç”Ÿæˆç»“æœ",-1)),n("div",yl,[l(F,{type:"primary",size:"large",icon:d(zt),onClick:ye},{default:o(()=>[...e[26]||(e[26]=[c(" é¢„è§ˆæ–‡æ¡£ ",-1)])]),_:1},8,["icon"]),l(F,{type:"success",size:"large",icon:d(Se),onClick:_e},{default:o(()=>[...e[27]||(e[27]=[c(" ä¸‹è½½Wordæ–‡æ¡£ ",-1)])]),_:1},8,["icon"]),d(Me)?(f(),y(U,{key:1,type:"success",size:"large"},{default:o(()=>[...e[29]||(e[29]=[c(" å·²åŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›® ",-1)])]),_:1})):(f(),y(F,{key:0,type:"info",size:"large",icon:d(Mt),loading:d(ze),onClick:ot},{default:o(()=>[...e[28]||(e[28]=[c(" åŒæ­¥åˆ°æŠ•æ ‡é¡¹ç›® ",-1)])]),_:1},8,["icon","loading"])),l(F,{type:"primary",size:"large",icon:d(Ot),onClick:fe},{default:o(()=>[...e[30]||(e[30]=[c(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])])])]),default:o(()=>[n("div",_l,[l(mt,{type:"success",title:g.value.message,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),g.value.stats&&Object.keys(g.value.stats).length>0?(f(),y(d(rl),{key:0,title:"å¤„ç†ç»Ÿè®¡",stats:g.value.stats},null,8,["stats"])):_("",!0),n("div",hl,[e[32]||(e[32]=n("h4",null,"ç”Ÿæˆæ–‡ä»¶",-1)),l(gt,{column:2,border:""},{default:o(()=>[l(Ee,{label:"æ–‡ä»¶å"},{default:o(()=>[c(h(xe(g.value.outputFile)),1)]),_:1}),l(Ee,{label:"ä¸‹è½½åœ°å€"},{default:o(()=>[l(ft,{href:g.value.downloadUrl,type:"primary"},{default:o(()=>[c(h(xe(g.value.downloadUrl)),1)]),_:1},8,["href"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1},8,["modelValue"])):_("",!0),x.value.length>0?(f(),y(I,{key:4,class:"requirements-section",shadow:"never"},{header:o(()=>[n("div",wl,[n("span",null,"æ‹›æ ‡è¦æ±‚åˆ—è¡¨ (å…± "+h(x.value.length)+" æ¡)",1),n("div",bl,[l(E,{modelValue:A.value,"onUpdate:modelValue":e[9]||(e[9]=a=>A.value=a),placeholder:"æœç´¢è¦æ±‚...",clearable:"",style:{width:"200px"}},{prefix:o(()=>[l(Ie,null,{default:o(()=>[l(d(Bt))]),_:1})]),_:1},8,["modelValue"]),l(i,{modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=a=>N.value=a),placeholder:"ç­›é€‰åˆ†ç±»",clearable:"",style:{width:"150px"}},{default:o(()=>[l(s,{label:"å…¨éƒ¨",value:""}),l(s,{label:"æŠ€æœ¯è¦æ±‚",value:"technical"}),l(s,{label:"å•†åŠ¡è¦æ±‚",value:"business"}),l(s,{label:"èµ„è´¨è¦æ±‚",value:"qualification"}),l(s,{label:"å…¶ä»–è¦æ±‚",value:"other"})]),_:1},8,["modelValue"]),l(F,{type:"primary",disabled:P.value.length===0,loading:V.value,onClick:Xe},{default:o(()=>[c(" ç”Ÿæˆåº”ç­” ("+h(P.value.length)+") ",1)]),_:1},8,["disabled","loading"])])])]),default:o(()=>[l(je,{data:Le.value,border:"",onSelectionChange:Qe,"max-height":"500"},{default:o(()=>[l(C,{type:"selection",width:"55"}),l(C,{type:"index",label:"åºå·",width:"60"}),l(C,{prop:"category",label:"åˆ†ç±»",width:"100"},{default:o(({row:a})=>[l(U,{type:he(a.category),size:"small"},{default:o(()=>[c(h(le(a.category)),1)]),_:2},1032,["type"])]),_:1}),l(C,{prop:"requirement",label:"æ‹›æ ‡è¦æ±‚","min-width":"300"},{default:o(({row:a})=>[n("div",xl,h(a.requirement),1)]),_:1}),l(C,{prop:"priority",label:"ä¼˜å…ˆçº§",width:"100"},{default:o(({row:a})=>[l(U,{type:st(a.priority),size:"small"},{default:o(()=>[c(h(a.priority),1)]),_:2},1032,["type"])]),_:1}),l(C,{prop:"status",label:"åº”ç­”çŠ¶æ€",width:"100"},{default:o(({row:a})=>[l(U,{type:be(a.status),size:"small"},{default:o(()=>[c(h(we(a.status)),1)]),_:2},1032,["type"])]),_:1}),l(C,{label:"æ“ä½œ",width:"100",fixed:"right"},{default:o(({row:a})=>[a.response?(f(),y(F,{key:0,type:"primary",size:"small",text:"",onClick:Pe=>lt(a)},{default:o(()=>[...e[33]||(e[33]=[c(" æŸ¥çœ‹ ",-1)])]),_:1},8,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])]),_:1})):_("",!0),V.value?(f(),y(I,{key:5,class:"generation-output",shadow:"never"},{header:o(()=>[n("div",Fl,[e[34]||(e[34]=n("span",null,"AIæ­£åœ¨ç”Ÿæˆç‚¹å¯¹ç‚¹åº”ç­”...",-1)),l(Ve,{percentage:M.value,status:M.value===100?"success":void 0,style:{width:"300px"}},null,8,["percentage","status"])])]),default:o(()=>[l(d(K),{content:Z.value,"is-streaming":V.value,onStop:et},null,8,["content","is-streaming"])]),_:1})):_("",!0),Ne.value?(f(),y(I,{key:6,class:"responses-section",shadow:"never"},{header:o(()=>[n("div",Cl,[e[36]||(e[36]=n("span",null,"ç‚¹å¯¹ç‚¹åº”ç­”ç»“æœ",-1)),n("div",kl,[l(F,{type:"success",icon:d(Se),onClick:at},{default:o(()=>[...e[35]||(e[35]=[c(" å¯¼å‡ºåº”ç­”æ–‡æ¡£ ",-1)])]),_:1},8,["icon"])])])]),default:o(()=>[l(se,{modelValue:pe.value,"onUpdate:modelValue":e[11]||(e[11]=a=>pe.value=a),accordion:""},{default:o(()=>[(f(!0),q(Te,null,Ue(x.value.filter(a=>a.response),a=>(f(),y(ae,{key:a.id,name:a.id},{title:o(()=>[n("div",Vl,[l(U,{type:he(a.category),size:"small"},{default:o(()=>[c(h(le(a.category)),1)]),_:2},1032,["type"]),n("span",El,h(a.requirement),1),l(U,{type:be(a.status),size:"small"},{default:o(()=>[c(h(we(a.status)),1)]),_:2},1032,["type"])])]),default:o(()=>[n("div",Il,[n("div",jl,[e[37]||(e[37]=n("h4",null,"æ‹›æ ‡è¦æ±‚",-1)),n("div",Pl,h(a.requirement),1)]),n("div",Sl,[e[38]||(e[38]=n("h4",null,"æˆ‘æ–¹åº”ç­”",-1)),l(d(K),{content:a.response||"","is-streaming":!1,"enable-markdown":!0},null,8,["content"])]),a.compliance?(f(),q("div",Tl,[e[39]||(e[39]=n("h4",null,"ç¬¦åˆæ€§è¯´æ˜",-1)),l(U,{type:a.compliance==="å®Œå…¨ç¬¦åˆ"?"success":"warning",size:"large"},{default:o(()=>[c(h(a.compliance),1)]),_:2},1032,["type"])])):_("",!0)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1})):_("",!0),l(yt,{modelValue:te.value,"onUpdate:modelValue":e[12]||(e[12]=a=>te.value=a),title:"åº”ç­”è¯¦æƒ…",width:"800px","destroy-on-close":""},{default:o(()=>[D.value?(f(),q("div",Ul,[n("div",Dl,[e[40]||(e[40]=n("h4",null,"æ‹›æ ‡è¦æ±‚",-1)),n("div",$l,h(D.value.requirement),1)]),n("div",Rl,[e[41]||(e[41]=n("h4",null,"æˆ‘æ–¹åº”ç­”",-1)),l(d(K),{content:D.value.response||"","is-streaming":!1,"enable-markdown":!0},null,8,["content"])]),D.value.compliance?(f(),q("div",ql,[e[42]||(e[42]=n("h4",null,"ç¬¦åˆæ€§",-1)),l(U,{type:D.value.compliance==="å®Œå…¨ç¬¦åˆ"?"success":"warning"},{default:o(()=>[c(h(D.value.compliance),1)]),_:1},8,["type"])])):_("",!0)])):_("",!0)]),_:1},8,["modelValue"]),w.value&&!S.value?(f(),y(d(il),{key:7,title:"ğŸ“„ è¯¥é¡¹ç›®å·²æœ‰ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶","current-file":w.value,"history-files":[],"show-editor-open":!0,"show-stats":!0,"current-file-message":"æ£€æµ‹åˆ°è¯¥é¡¹ç›®çš„å†å²ç‚¹å¯¹ç‚¹åº”ç­”æ–‡ä»¶",onOpenInEditor:pt,onPreview:ut,onDownload:dt,onRegenerate:ct},null,8,["current-file"])):_("",!0),l(se,{modelValue:W.value,"onUpdate:modelValue":e[13]||(e[13]=a=>W.value=a),class:"history-collapse"},{default:o(()=>[l(ae,{name:"history"},{title:o(()=>[n("div",zl,[n("span",null,"ğŸ“‚ æŸ¥çœ‹æ‰€æœ‰å†å²å¤„ç†æ–‡ä»¶ ("+h($.value.length)+")",1),W.value?(f(),y(F,{key:0,type:"primary",size:"small",loading:R.value,onClick:tl(Fe,["stop"]),style:{"margin-left":"16px"}},{default:o(()=>[...e[43]||(e[43]=[c(" åˆ·æ–°åˆ—è¡¨ ",-1)])]),_:1},8,["loading"])):_("",!0)])]),default:o(()=>[l(I,{shadow:"never",style:{border:"none"}},{default:o(()=>[el((f(),y(je,{data:$.value,border:"",stripe:"","max-height":"400"},{default:o(()=>[l(C,{type:"index",label:"åºå·",width:"60"}),l(C,{prop:"filename",label:"æ–‡ä»¶å","min-width":"300"},{default:o(({row:a})=>[n("div",Ml,[l(Ie,null,{default:o(()=>[l(d(Jt))]),_:1}),n("span",null,h(a.filename),1)])]),_:1}),l(C,{prop:"size",label:"æ–‡ä»¶å¤§å°",width:"120"},{default:o(({row:a})=>[c(h(nt(a.size)),1)]),_:1}),l(C,{prop:"process_time",label:"å¤„ç†æ—¶é—´",width:"180"},{default:o(({row:a})=>[c(h(rt(a.process_time)),1)]),_:1}),l(C,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:o(({row:a})=>[l(F,{type:"primary",size:"small",onClick:Pe=>it(a)},{default:o(()=>[...e[44]||(e[44]=[c(" é¢„è§ˆ ",-1)])]),_:1},8,["onClick"]),l(F,{type:"success",size:"small",onClick:Pe=>d(re)(a)},{default:o(()=>[...e[45]||(e[45]=[c(" ä¸‹è½½ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ht,R.value]]),!R.value&&$.value.length===0?(f(),y(_t,{key:0,description:"æš‚æ— å†å²æ–‡ä»¶","image-size":100})):_("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(d(ol),{modelValue:O.value,"onUpdate:modelValue":e[14]||(e[14]=a=>O.value=a),"file-url":B.value,"file-name":G.value},null,8,["modelValue","file-url","file-name"])])}}}),no=ul(Ll,[["__scopeId","data-v-024be538"]]);export{no as default};
