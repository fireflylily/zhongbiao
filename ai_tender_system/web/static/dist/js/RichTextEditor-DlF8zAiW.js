import{aK as e,av as a,aw as l,bd as t,be as o,bf as s,aL as i,aN as u,aP as n,aQ as d,aR as r,aX as v,aS as c,aY as f,a$ as m,aU as y,aV as p,aW as g,bg as h,b0 as b,bh as _,bi as k,b3 as w,aM as C,b4 as x,bj as T,bk as S,bl as I,bm as V,bn as z,b5 as O,bo as R,bp as E,b6 as M,aZ as j}from"./index.js";/* empty css                                                                          *//* empty css               */import{E as L}from"./index-DwbH8caQ.js";import{E as H}from"./index-CtMmaQjp.js";const A={class:"editor-header"},B={class:"header-left"},W={class:"header-actions"},F={class:"editor-body"},U={class:"outline-sidebar"},$={class:"outline-header"},D={class:"outline-list"},P=["onClick"],Q={class:"outline-text"},Y={class:"outline-footer"},K={class:"editor-main"},N={key:0,class:"streaming-indicator"},X=j(e({__name:"RichTextEditor",props:{modelValue:{},title:{default:"æ–‡æ¡£ç¼–è¾‘"},height:{default:600},readonly:{type:Boolean,default:!1},streaming:{type:Boolean,default:!1}},emits:["update:modelValue","save","preview","export","ready"],setup(e,{expose:j,emit:X}){const Z=e,q=X,G=a(null),J=a(Z.modelValue),ee=a(!1),ae=a(!1),le=a(!1),te=l(()=>Z.streaming),oe=l(()=>!!J.value&&"<p></p>"!==J.value),se=a(!1),ie=l(()=>({dicts:{pageSizes:[{label:"A4",width:21,height:29.7,default:!0}]},page:{layouts:["page"],showBreakMarks:!0,size:{width:21,height:29.7,label:"A4"},defaultMargin:{left:3.18,right:3.18,top:2.54,bottom:2.54},defaultOrientation:"portrait",defaultBackground:"#ffffff"},document:{title:Z.title||"å•†åŠ¡åº”ç­”æ–‡æ¡£",enableSpellcheck:!1,enableMarkdown:!1,readOnly:Z.readonly,autoSave:{enabled:!1,interval:0}},file:{maxSize:10485760,allowedMimeTypes:["image/jpeg","image/png","image/gif","image/webp"]},onFileUpload:async e=>new Promise((a,l)=>{const t=new FileReader;t.onload=e=>{var l;const t=null==(l=e.target)?void 0:l.result;a({id:`img-${Date.now()}`,url:t})},t.onerror=()=>l(new Error("è¯»å–å¤±è´¥")),t.readAsDataURL(e)}),onFileDelete:e=>!0})),ue=a([]),ne=a(!1),de=a(""),re=a(!1);l(()=>le.value?"calc(100vh - 120px)":"number"==typeof Z.height?`${Z.height}px`:Z.height),t(()=>Z.modelValue,e=>{e&&e!==J.value&&(J.value=e,ee.value=!1,G.value&&me(e))}),t(te,e=>{G.value&&"function"==typeof G.value.setReadOnly&&G.value.setReadOnly(e||Z.readonly)});const ve=()=>{setTimeout(()=>{ce()},300),Z.modelValue&&setTimeout(()=>{me(Z.modelValue)},100),(Z.readonly||Z.streaming)&&G.value&&"function"==typeof G.value.setReadOnly&&G.value.setReadOnly(!0),q("ready"),setTimeout(()=>{he()},800)},ce=()=>{if(G.value)try{"function"==typeof G.value.setLayout&&(G.value.setLayout("page"),se.value=!1,setTimeout(()=>{},500))}catch(e){}},fe=()=>{if(G.value)try{const e=G.value.getHTML();e!==J.value&&(J.value=e,ee.value=!0,q("update:modelValue",e),ge())}catch(e){}},me=e=>{if(G.value)try{ke(),"function"==typeof G.value.setContent&&(G.value.setContent(e),setTimeout(()=>{ke()},100))}catch(a){if("QuotaExceededError"===a.name){ke();try{G.value.setContent(e)}catch(l){}}}},ye=()=>{var e;try{const a=null==(e=G.value)?void 0:e.getEditor();if(a&&a.view){const{dom:e}=a.view;e.scrollTop=e.scrollHeight}}catch(a){}};let pe=null;const ge=()=>{pe&&clearTimeout(pe),pe=window.setTimeout(()=>{he()},500)},he=async()=>{if(G.value){re.value=!0;try{if("function"==typeof G.value.getTableOfContents){const e=G.value.getTableOfContents();ue.value=e||[]}else ue.value=[]}catch(e){ue.value=[]}finally{re.value=!1}}},be=async()=>{if(ee.value&&!te.value){ae.value=!0;try{q("save",J.value),await E(),ee.value=!1}catch(e){M.error("ä¿å­˜å¤±è´¥")}finally{ae.value=!1}}},_e=()=>{le.value=!le.value,le.value?document.body.style.overflow="hidden":document.body.style.overflow=""};j({getContent:()=>{try{if(G.value&&"function"==typeof G.value.getHTML)return G.value.getHTML()}catch(e){}return J.value},setContent:e=>{J.value=e,me(e),ee.value=!1,setTimeout(()=>{he()},300)},appendContent:e=>{if(G.value)try{const a=G.value.getHTML()+e;G.value.setContent(a),J.value=a,E(()=>{ye()}),ge()}catch(a){}else J.value+=e},clear:()=>{J.value="",me(""),ue.value=[],ee.value=!1},refreshOutline:he,setStreaming:e=>{}});const ke=()=>{try{const e=Object.keys(localStorage);for(const a of e)a.startsWith("umo-editor:")&&localStorage.removeItem(a)}catch(e){}},we=localStorage.setItem;let Ce=!1;return o(()=>{localStorage.setItem=function(e,a){if(!e.startsWith("umo-editor:"))return we.call(localStorage,e,a);Ce||(Ce=!0)},ke()}),s(()=>{le.value&&(document.body.style.overflow=""),pe&&clearTimeout(pe),localStorage.setItem=we,ke()}),(a,l)=>{const t=g,o=L,s=b,E=H;return u(),i("div",{class:n(["rich-text-editor",{fullscreen:le.value,streaming:te.value}])},[d("div",A,[d("div",B,[d("h3",null,"âœï¸ "+v(e.title),1),te.value?(u(),r(o,{key:0,type:"primary",effect:"plain"},{default:c(()=>[f(t,{class:"is-loading"},{default:c(()=>[f(y(p))]),_:1}),l[4]||(l[4]=m(" AIç”Ÿæˆä¸­... ",-1))]),_:1})):ee.value?(u(),r(o,{key:1,type:"warning"},{default:c(()=>[...l[5]||(l[5]=[m("æœ‰æœªä¿å­˜çš„ä¿®æ”¹",-1)])]),_:1})):(u(),r(o,{key:2,type:"success"},{default:c(()=>[...l[6]||(l[6]=[m("å·²ä¿å­˜",-1)])]),_:1}))]),d("div",W,[f(s,{onClick:_e,size:"small"},{default:c(()=>[f(t,null,{default:c(()=>[f(y(h))]),_:1}),m(" "+v(le.value?"é€€å‡ºå…¨å±":"å…¨å±ç¼–è¾‘"),1)]),_:1}),f(s,{type:"primary",onClick:l[0]||(l[0]=e=>q("preview")),size:"small",disabled:!oe.value||te.value},{default:c(()=>[f(t,null,{default:c(()=>[f(y(_))]),_:1}),l[7]||(l[7]=m(" é¢„è§ˆWord ",-1))]),_:1},8,["disabled"]),f(s,{type:"success",onClick:l[1]||(l[1]=e=>q("export")),size:"small",disabled:!oe.value||te.value},{default:c(()=>[f(t,null,{default:c(()=>[f(y(k))]),_:1}),l[8]||(l[8]=m(" å¯¼å‡ºWord ",-1))]),_:1},8,["disabled"]),f(s,{type:"primary",loading:ae.value,disabled:!oe.value||te.value,onClick:be,size:"small"},{default:c(()=>[...l[9]||(l[9]=[m(" ä¿å­˜ ",-1)])]),_:1},8,["loading","disabled"])])]),d("div",F,[w(d("div",U,[d("div",$,[l[10]||(l[10]=d("h4",null,"ğŸ“‘ ç›®å½•",-1)),f(s,{text:"",size:"small",onClick:he,loading:re.value},{default:c(()=>[f(t,null,{default:c(()=>[f(y(T))]),_:1})]),_:1},8,["loading"])]),d("div",D,[(u(!0),i(S,null,I(ue.value,(e,a)=>(u(),i("div",{key:e.id||a,class:n(["outline-item",`level-${e.level}`,{active:de.value===e.id}]),onClick:a=>(e=>{if(e)try{if(e.dom&&"function"==typeof e.dom.scrollIntoView)return e.dom.scrollIntoView({behavior:"smooth",block:"start"}),void(de.value=e.id);if(e.id){const a=document.getElementById(e.id);if(a)return a.scrollIntoView({behavior:"smooth",block:"start"}),void(de.value=e.id)}}catch(a){}})(e)},[d("span",Q,v(e.textContent),1)],10,P))),128)),0!==ue.value.length||te.value?C("",!0):(u(),r(E,{key:0,description:"æš‚æ— æ ‡é¢˜","image-size":60}))]),d("div",Y,[f(s,{text:"",size:"small",onClick:l[2]||(l[2]=e=>ne.value=!0)},{default:c(()=>[f(t,null,{default:c(()=>[f(y(V))]),_:1}),l[11]||(l[11]=m(" æŠ˜å ç›®å½• ",-1))]),_:1})])],512),[[x,!ne.value]]),ne.value?(u(),i("div",{key:0,class:"outline-toggle",onClick:l[3]||(l[3]=e=>ne.value=!1)},[f(t,null,{default:c(()=>[f(y(z))]),_:1}),l[12]||(l[12]=d("span",{class:"toggle-text"},"å±•å¼€ç›®å½•",-1))])):C("",!0),d("div",K,[te.value?(u(),i("div",N,[f(t,{class:"is-loading"},{default:c(()=>[f(y(p))]),_:1}),l[13]||(l[13]=d("span",null,"AI æ­£åœ¨ç”Ÿæˆå†…å®¹ï¼Œè¯·ç¨å€™...",-1))])):C("",!0),f(y(R),O({ref_key:"umoEditorRef",ref:G},ie.value,{onChanged:fe,onCreated:ve}),null,16)])])],2)}}}),[["__scopeId","data-v-b4e8e84e"]]);export{X as R};
