import{aN as e,e as a,p as t,aO as s,q as i,K as l,M as o,d as n,G as c}from"./index.js";import{E as r}from"./el-pagination-B2kZAGN2.js";/* empty css               */import"./el-select-OYnihe3P.js";/* empty css                     *//* empty css                             *//* empty css                    *//* empty css                */import{u as d}from"./project-l6r_bqav.js";import{t as p}from"./tender-DY5X_q7i.js";import{am as u,ao as m,aq as f,ar as _,as as b,ax as y,aw as g,au as v,aT as k,ay as j,aS as h,aB as w,an as x,aW as z,aC as P,aD as C,az as T,bc as M}from"./editor-TazJhAAN.js";import{L as D}from"./Loading-BeReBNvy.js";import{E}from"./Empty-VlzT6V_U.js";/* empty css                */import{C as B}from"./Card-Cv-82T4J.js";/* empty css                                                        *//* empty css                                                                            *//* empty css                *//* empty css                   */import{a as S,E as $}from"./index-BDJETU77.js";import{E as I,a as Y}from"./index-CEGNKDhc.js";import{E as q}from"./index-Cv74LvuH.js";import{E as N}from"./strings-X7bymAdO.js";import{c as G}from"./company-CHa0NuIL.js";import"./index-ChK61zXh.js";import"./toNumber-C9XTs0cM.js";import"./_baseIteratee-DK-XCWub.js";import"./index-ByYpZ62U.js";import"./flatMap-B556EPsX.js";import"./map-DlvCx75E.js";import"./_baseEach-uBBvXMMp.js";import"./index-DYIGgvz_.js";import"./raf-BZHcGSIv.js";const H=["disabled"],L=i(u({__name:"IconButton",props:{icon:{default:"bi-question-circle"},tooltip:{default:""},tooltipPlacement:{default:"top"},type:{default:"default"},size:{default:"default"},circle:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},badge:{default:""},badgeMax:{default:99},badgeType:{default:"danger"}},emits:["click"],setup(i,{emit:l}){const o=i,n=l,c=m(()=>({[`icon-button--${o.type}`]:!0,[`icon-button--${o.size}`]:!0,"icon-button--circle":o.circle,"is-disabled":o.disabled,"is-loading":o.loading})),r=m(()=>({large:20,default:18,small:16}[o.size])),d=m(()=>({fontSize:`${r.value}px`}));function p(e){o.disabled||o.loading||n("click",e)}return(l,o)=>{const n=a,u=e,m=s;return _(),f(m,{content:i.tooltip,placement:i.tooltipPlacement,disabled:!i.tooltip},{default:b(()=>[y(u,{value:i.badge,hidden:!i.badge,max:i.badgeMax,type:i.badgeType},{default:b(()=>[g("button",{class:w(["icon-button",c.value]),disabled:i.disabled||i.loading,onClick:p},[i.loading?(_(),f(n,{key:0,class:"is-loading",size:r.value},{default:b(()=>[(_(),f(k(j(t))))]),_:1},8,["size"])):(_(),v("i",{key:1,class:w([i.icon,"icon-button-icon"]),style:h(d.value)},null,6))],10,H)]),_:1},8,["value","hidden","max","type"])]),_:1},8,["content","placement","disabled"])}}}),[["__scopeId","data-v-628ec5f8"]]),O={class:"dashboard-page"},Q={class:"kpi-card"},U={class:"kpi-info"},W={class:"kpi-value"},A={class:"kpi-card"},F={class:"kpi-info"},J={class:"kpi-value"},K={class:"kpi-card"},R={class:"kpi-info"},X={class:"kpi-value"},Z={class:"kpi-card"},V={class:"kpi-info"},ee={class:"kpi-value"},ae={class:"pagination-wrapper"},te=i(u({__name:"Dashboard",setup(e){const a=l(),t=d(),{success:s,error:i}=o(),u=x(!1),m=x(!1),k=x(!1),h=x({totalProjects:0,inProgressProjects:0,wonThisMonth:0,pendingTasks:0}),w=x([]),H=x(1),te=x(10),se=x(0);async function ie(){m.value=!0;try{const e=await p.getProjects({page:H.value,page_size:te.value});if(e.success&&e.data){const a=e.data.items||e.data||[];w.value=a.map(e=>({id:e.project_id,project_name:e.project_name,project_number:e.project_number,company_name:e.company_name,tenderer:e.tenderer,authorized_person_name:e.authorized_person_name,status:e.status,created_at:e.created_at,...e})),se.value=e.data.total||w.value.length}}catch(e){i("加载项目列表失败: "+e.message)}finally{m.value=!1}}async function le(){await ie(),s("刷新成功")}async function oe(){k.value=!0;try{const e=(await G.getCompanies()).data||[];if(0===e.length)return void i("无法创建项目：请先添加公司信息");const t=(await p.createProject({project_name:"新项目",project_number:`PRJ-${Date.now()}`,company_id:e[0].company_id})).project_id;s("创建成功"),a.push({name:"TenderManagementDetail",params:{id:t}})}catch(e){i("创建项目失败: "+e.message)}finally{k.value=!1}}function ne(e){t.setCurrentProject(e),a.push({name:"TenderManagementDetail",params:{id:e.id}})}function ce(e){te.value=e,H.value=1,ie()}function re(e){H.value=e,ie()}return z(()=>{!async function(){u.value=!0;try{const e=await p.getDashboardStatistics();e.success&&e.data&&(h.value={totalProjects:e.data.totalProjects,inProgressProjects:e.data.inProgressProjects,wonThisMonth:e.data.wonThisMonth,pendingTasks:e.data.pendingTasks})}catch(e){i("加载统计数据失败: "+e.message)}finally{u.value=!1}}(),ie()}),(e,a)=>{const t=S,l=$,o=n,d=Y,u=q,x=N,z=I,G=r;return _(),v("div",O,[y(l,{gutter:12,class:"kpi-cards"},{default:b(()=>[y(t,{xs:12,sm:6,md:6,lg:6},{default:b(()=>[g("div",Q,[a[3]||(a[3]=g("div",{class:"kpi-icon",style:{background:"#ecf5ff",color:"#409eff"}},[g("i",{class:"bi bi-folder-fill"})],-1)),g("div",U,[g("div",W,P(h.value.totalProjects),1),a[2]||(a[2]=g("div",{class:"kpi-label"},"总项目数",-1))])])]),_:1}),y(t,{xs:12,sm:6,md:6,lg:6},{default:b(()=>[g("div",A,[a[5]||(a[5]=g("div",{class:"kpi-icon",style:{background:"#fdf6ec",color:"#e6a23c"}},[g("i",{class:"bi bi-clock-fill"})],-1)),g("div",F,[g("div",J,P(h.value.inProgressProjects),1),a[4]||(a[4]=g("div",{class:"kpi-label"},"进行中",-1))])])]),_:1}),y(t,{xs:12,sm:6,md:6,lg:6},{default:b(()=>[g("div",K,[a[7]||(a[7]=g("div",{class:"kpi-icon",style:{background:"#f0f9eb",color:"#67c23a"}},[g("i",{class:"bi bi-trophy-fill"})],-1)),g("div",R,[g("div",X,P(h.value.wonThisMonth),1),a[6]||(a[6]=g("div",{class:"kpi-label"},"本月中标",-1))])])]),_:1}),y(t,{xs:12,sm:6,md:6,lg:6},{default:b(()=>[g("div",Z,[a[9]||(a[9]=g("div",{class:"kpi-icon",style:{background:"#fef0f0",color:"#f56c6c"}},[g("i",{class:"bi bi-list-task"})],-1)),g("div",V,[g("div",ee,P(h.value.pendingTasks),1),a[8]||(a[8]=g("div",{class:"kpi-label"},"待处理",-1))])])]),_:1})]),_:1}),y(j(B),{title:"项目列表",class:"projects-card"},{actions:b(()=>[y(o,{type:"primary",loading:k.value,onClick:oe},{default:b(()=>[...a[10]||(a[10]=[g("i",{class:"bi bi-plus-lg"},null,-1),C(" 新建项目 ",-1)])]),_:1},8,["loading"]),y(j(L),{icon:"bi-arrow-clockwise",tooltip:"刷新",onClick:le})]),default:b(()=>[m.value?(_(),f(j(D),{key:0,visible:!0,fullscreen:!1,text:"加载项目列表..."})):0===w.value.length?(_(),f(j(E),{key:1,type:"no-data",description:"暂无项目"},{action:b(()=>[y(o,{type:"primary",onClick:oe},{default:b(()=>[...a[11]||(a[11]=[C("创建第一个项目",-1)])]),_:1})]),_:1})):(_(),v(T,{key:2},[y(z,{data:w.value,stripe:"",style:{width:"100%"}},{default:b(()=>[y(d,{prop:"id",label:"ID",width:"70",fixed:""}),y(d,{prop:"project_name",label:"项目名称","min-width":"200",fixed:""},{default:b(({row:e})=>[y(u,{type:"primary",onClick:a=>ne(e)},{default:b(()=>[C(P(e.project_name),1)]),_:2},1032,["onClick"])]),_:1}),y(d,{prop:"tenderer",label:"招标人","min-width":"180","show-overflow-tooltip":""}),y(d,{prop:"authorized_person_name",label:"被授权人",width:"100"}),y(d,{label:"商务应答",width:"100",align:"center"},{default:b(({row:e})=>{return[(t=e,t.business_response_file||"completed"===t.business_response_status?(_(),f(x,{key:0,type:"success",size:"small"},{default:b(()=>[...a[12]||(a[12]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),C(" 已生成 ",-1)])]),_:1})):(_(),f(x,{key:1,type:"info",size:"small"},{default:b(()=>[...a[13]||(a[13]=[g("i",{class:"bi bi-dash-circle"},null,-1),C(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),y(d,{label:"技术点对点",width:"110",align:"center"},{default:b(({row:e})=>{return[(t=e,t.point_to_point_file||"completed"===t.point_to_point_status?(_(),f(x,{key:0,type:"success",size:"small"},{default:b(()=>[...a[14]||(a[14]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),C(" 已生成 ",-1)])]),_:1})):(_(),f(x,{key:1,type:"info",size:"small"},{default:b(()=>[...a[15]||(a[15]=[g("i",{class:"bi bi-dash-circle"},null,-1),C(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),y(d,{label:"技术方案",width:"100",align:"center"},{default:b(({row:e})=>{return[(t=e,t.tech_proposal_file||"completed"===t.tech_proposal_status||t.technical_data?(_(),f(x,{key:0,type:"success",size:"small"},{default:b(()=>[...a[16]||(a[16]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),C(" 已生成 ",-1)])]),_:1})):(_(),f(x,{key:1,type:"info",size:"small"},{default:b(()=>[...a[17]||(a[17]=[g("i",{class:"bi bi-dash-circle"},null,-1),C(" 未生成 ",-1)])]),_:1})))];var t}),_:1}),y(d,{label:"最后融合",width:"100",align:"center"},{default:b(({row:e})=>{return[(t=e,t.final_merge_file||"completed"===t.merge_status?(_(),f(x,{key:0,type:"success",size:"small"},{default:b(()=>[...a[18]||(a[18]=[g("i",{class:"bi bi-check-circle-fill"},null,-1),C(" 已融合 ",-1)])]),_:1})):(_(),f(x,{key:1,type:"info",size:"small"},{default:b(()=>[...a[19]||(a[19]=[g("i",{class:"bi bi-dash-circle"},null,-1),C(" 未融合 ",-1)])]),_:1})))];var t}),_:1}),y(d,{prop:"status",label:"项目状态",width:"100",align:"center"},{default:b(({row:e})=>["active"===e.status?(_(),f(x,{key:0,type:"success"},{default:b(()=>[...a[20]||(a[20]=[C("进行中",-1)])]),_:1})):"completed"===e.status?(_(),f(x,{key:1,type:"primary"},{default:b(()=>[...a[21]||(a[21]=[C("已完成",-1)])]),_:1})):"archived"===e.status?(_(),f(x,{key:2,type:"info"},{default:b(()=>[...a[22]||(a[22]=[C("已归档",-1)])]),_:1})):(_(),f(x,{key:3,type:"info"},{default:b(()=>[...a[23]||(a[23]=[C("草稿",-1)])]),_:1}))]),_:1}),y(d,{prop:"created_at",label:"创建时间",width:"160"},{default:b(({row:e})=>{return[C(P((a=e.created_at,a?M(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),y(d,{label:"操作",width:"120",fixed:"right"},{default:b(({row:e})=>[y(j(L),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:a=>ne(e)},null,8,["onClick"]),y(j(L),{icon:"bi-trash",type:"danger",tooltip:"删除项目",onClick:a=>async function(e){try{await c.confirm(`确定要删除项目 "${e.project_name}" 吗？此操作将同时删除项目的所有文档，且不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await p.deleteProject(e.id),s(`已删除项目: ${e.project_name}`),await ie()}catch(a){"cancel"!==a&&i("删除失败: "+(a.message||"未知错误"))}}(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),g("div",ae,[y(G,{"current-page":H.value,"onUpdate:currentPage":a[0]||(a[0]=e=>H.value=e),"page-size":te.value,"onUpdate:pageSize":a[1]||(a[1]=e=>te.value=e),total:se.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ce,onCurrentChange:re},null,8,["current-page","page-size","total"])])],64))]),_:1})])}}}),[["__scopeId","data-v-159b8a37"]]);export{te as default};
