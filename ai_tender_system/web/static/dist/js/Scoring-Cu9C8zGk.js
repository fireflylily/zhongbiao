import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";/* empty css               *//* empty css                             *//* empty css                    *//* empty css                   *//* empty css                 */import{E as a}from"./el-input-number-B8FepDQW.js";/* empty css                */import"./el-form-item-CVdTmnJr.js";import{c as l,d as n}from"./el-select-BSk6f2dL.js";import{d as t,r as s,x as r,L as o,c as i,g as d,B as u,a0 as c,w as p,aA as m,o as v,a6 as h,aB as g,E as w,e as _,l as f,k as y,I as j,t as b,F as x,aV as $}from"./index.js";import{k}from"./HistoryFilesPanel.vue_vue_type_style_index_0_scoped_8037c805_lang-DZHVYQUE.js";import"./DocumentPreview.vue_vue_type_style_index_0_scoped_3e333bda_lang-DmpRfM6z.js";import{S as V}from"./SSEStreamViewer-B_dDjhsA.js";/* empty css                 *//* empty css                */import{t as S}from"./tender-lE9zOws1.js";import{E as I}from"./index-CnzisJd6.js";import{E as U,a as E}from"./index-ZXEwf31d.js";import{E as A,a as C}from"./index-CLnWWCfK.js";import{a as L,E as z}from"./index-QKZXHMAQ.js";import{E as M}from"./strings-DBU9TC1F.js";import"./_commonjsHelpers-lGe4XDVY.js";import"./castArray-COSn9LfO.js";import"./_baseClone-BxWT40wp.js";import"./omit-CX340h9Z.js";import"./index-Csos-qsJ.js";import"./raf-D3yCAO_k.js";const B={class:"tender-scoring"},D={class:"card-header"},F={class:"scoring-actions"},H={class:"weight-summary"},P={key:0,class:"weight-tip"},R={class:"card-header"},O={class:"header-actions"},T={class:"dimension-scores"},q=["innerHTML"],K={class:"risk-analysis"},N={class:"improvement-suggestions"},X=e(t({__name:"Scoring",setup(e){const t=s({projectId:null}),X=s([]),G=r(()=>X.value.find(e=>e.id===t.value.projectId)),J=s([{name:"技术方案完整性",weight:30,description:"技术方案的完整性和可行性"},{name:"商务响应度",weight:25,description:"商务条款的响应程度"},{name:"资质匹配度",weight:20,description:"公司资质与项目要求的匹配程度"},{name:"成本合理性",weight:15,description:"报价的合理性和竞争力"},{name:"风险控制",weight:10,description:"项目风险的识别和控制措施"}]),Q=r(()=>J.value.reduce((e,a)=>e+a.weight,0)),W=r(()=>t.value.projectId&&100===Q.value&&J.value.length>0),Y=s(!1),Z=s(""),ee=s(null),ae=()=>{ee.value=null,Z.value=""},le=()=>{J.value.push({name:"",weight:0,description:""})},ne=async()=>{if(t.value.projectId)if(100===Q.value){Y.value=!0,Z.value="",ee.value=null;try{await te(),m.success("评分完成")}catch(e){m.error("评分失败，请重试")}finally{Y.value=!1}}else m.warning("评分维度权重总和必须为100%");else m.warning("请先选择项目")},te=async()=>new Promise(e=>{let a=0;const l=setInterval(()=>{if(a+=10,Z.value+=`\n正在分析第 ${a/10} 个维度...`,a>=100){clearInterval(l);const a=J.value.map(e=>{const a=30*Math.random()+70;return{...e,score:Math.round(a),weightedScore:a*e.weight/100,analysis:`该维度表现${a>=85?"优秀":a>=70?"良好":"一般"}，${a>=85?"完全满足招标要求，具有明显竞争优势。":a>=70?"基本满足招标要求，但仍有改进空间。":"存在一定差距，需要重点改进。"}\n\n**优势：**\n- 方案设计合理\n- 团队经验丰富\n\n**不足：**\n- 部分细节需要完善`}}),n=a.reduce((e,a)=>e+a.weightedScore,0);ee.value={totalScore:Math.round(n),dimensions:a,riskAnalysis:"# 风险评估\n\n## 技术风险\n- **中等风险**: 部分技术方案需要进一步细化\n- 建议加强技术团队的配置\n\n## 商务风险\n- **低风险**: 商务条款基本符合要求\n- 价格竞争力较强\n\n## 执行风险\n- **中等风险**: 项目周期较紧\n- 需要合理安排资源和进度",suggestions:"# 改进建议\n\n## 技术方案优化\n1. 完善系统架构设计文档\n2. 补充性能测试方案\n3. 加强数据安全保障措施\n\n## 商务条款完善\n1. 明确验收标准\n2. 补充售后服务承诺\n\n## 团队能力提升\n1. 增加项目相关经验人员\n2. 提供更详细的团队简历"},e()}},300)}),se=()=>{Y.value=!1,m.info("已停止评分")},re=e=>e>=90?"success":e>=80?"":e>=70?"warning":"danger",oe=e=>{try{return k.parse(e)}catch(a){return e}},ie=()=>{var e;if(!ee.value)return;const a=de(),l=new Blob([a],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(l),t=document.createElement("a");t.href=n,t.download=`标书评分报告-${(null==(e=G.value)?void 0:e.project_name)||"report"}-${Date.now()}.txt`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n),m.success("报告导出成功")},de=()=>{var e,a,l;if(!ee.value)return"";let n="# 标书评分报告\n\n";return n+="## 项目信息\n",n+=`- 项目名称: ${null==(e=G.value)?void 0:e.project_name}\n`,n+=`- 项目编号: ${null==(a=G.value)?void 0:a.project_number}\n`,n+=`- 公司名称: ${null==(l=G.value)?void 0:l.company_name}\n`,n+=`- 评分时间: ${(new Date).toLocaleString()}\n\n`,n+="## 总体评分\n",n+=`**总分: ${ee.value.totalScore} / 100**\n\n`,n+="## 各维度评分\n\n",ee.value.dimensions.forEach((e,a)=>{n+=`### ${a+1}. ${e.name} (权重: ${e.weight}%)\n`,n+=`- 得分: ${e.score}\n`,n+=`- 加权得分: ${e.weightedScore.toFixed(2)}\n`,n+=`- 分析:\n${e.analysis}\n\n`}),n+=`## ${ee.value.riskAnalysis}\n\n`,n+=`## ${ee.value.suggestions}\n`,n};return o(()=>{(async()=>{var e;try{const a=await S.getProjects({page:1,page_size:100});X.value=(null==(e=a.data)?void 0:e.items)||[]}catch(a){m.error("加载项目列表失败")}})()}),(e,s)=>{const r=n,o=l,m=E,k=C,S=w,te=A,de=U,ue=I,ce=f,pe=L,me=a,ve=z,he=M;return v(),i("div",B,[d(ue,{class:"project-selector",shadow:"never"},{header:p(()=>[...s[1]||(s[1]=[_("div",{class:"card-header"},[_("span",null,"选择项目")],-1)])]),default:p(()=>[d(de,{model:t.value,"label-width":"100px"},{default:p(()=>[d(te,{gutter:20},{default:p(()=>[d(k,{span:12},{default:p(()=>[d(m,{label:"项目"},{default:p(()=>[d(o,{modelValue:t.value.projectId,"onUpdate:modelValue":s[0]||(s[0]=e=>t.value.projectId=e),placeholder:"请选择项目",filterable:"",onChange:ae,style:{width:"100%"}},{default:p(()=>[(v(!0),i(h,null,g(X.value,e=>(v(),u(r,{key:e.id,label:`${e.project_name} (${e.project_number})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),d(k,{span:12},{default:p(()=>[d(m,{label:"公司"},{default:p(()=>{var e;return[d(S,{value:(null==(e=G.value)?void 0:e.company_name)||"-",disabled:""},null,8,["value"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t.value.projectId?(v(),u(ue,{key:0,class:"scoring-config",shadow:"never"},{header:p(()=>[_("div",D,[s[3]||(s[3]=_("span",null,"评分维度配置",-1)),d(ce,{type:"primary",size:"small",onClick:le},{default:p(()=>[...s[2]||(s[2]=[y(" 添加维度 ",-1)])]),_:1})])]),default:p(()=>[d(ve,{data:J.value,border:""},{default:p(()=>[d(pe,{type:"index",label:"序号",width:"60"}),d(pe,{prop:"name",label:"评分维度","min-width":"150"},{default:p(({row:e})=>[d(S,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"请输入评分维度"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),d(pe,{prop:"weight",label:"权重 (%)",width:"120"},{default:p(({row:e})=>[d(me,{modelValue:e.weight,"onUpdate:modelValue":a=>e.weight=a,min:0,max:100,step:5,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),d(pe,{prop:"description",label:"评分说明","min-width":"200"},{default:p(({row:e})=>[d(S,{modelValue:e.description,"onUpdate:modelValue":a=>e.description=a,type:"textarea",rows:2,placeholder:"请输入评分说明"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),d(pe,{label:"操作",width:"100",fixed:"right"},{default:p(({$index:e})=>[d(ce,{type:"danger",size:"small",text:"",onClick:a=>{return l=e,void J.value.splice(l,1);var l}},{default:p(()=>[...s[4]||(s[4]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),_("div",F,[_("div",H,[s[5]||(s[5]=y(" 总权重: ",-1)),_("strong",{class:j({error:100!==Q.value})},b(Q.value)+"%",3),100!==Q.value?(v(),i("span",P," (权重总和应为 100%) ")):c("",!0)]),d(ce,{type:"primary",disabled:!W.value,loading:Y.value,onClick:ne},{default:p(()=>[...s[6]||(s[6]=[y(" 开始AI评分 ",-1)])]),_:1},8,["disabled","loading"])])]),_:1})):c("",!0),ee.value?(v(),u(ue,{key:1,class:"scoring-result",shadow:"never"},{header:p(()=>[_("div",R,[s[8]||(s[8]=_("span",null,"评分结果",-1)),_("div",O,[d(he,{type:re(ee.value.totalScore),size:"large"},{default:p(()=>[y(" 总分: "+b(ee.value.totalScore)+" / 100 ",1)]),_:1},8,["type"]),d(ce,{type:"success",size:"small",icon:x($),onClick:ie},{default:p(()=>[...s[7]||(s[7]=[y(" 导出报告 ",-1)])]),_:1},8,["icon"])])])]),default:p(()=>[_("div",T,[s[9]||(s[9]=_("h4",null,"各维度评分详情",-1)),d(ve,{data:ee.value.dimensions,border:""},{default:p(()=>[d(pe,{type:"index",label:"序号",width:"60"}),d(pe,{prop:"name",label:"评分维度","min-width":"150"}),d(pe,{prop:"weight",label:"权重",width:"100"},{default:p(({row:e})=>[y(b(e.weight)+"% ",1)]),_:1}),d(pe,{prop:"score",label:"得分",width:"100"},{default:p(({row:e})=>[d(he,{type:re(e.score)},{default:p(()=>[y(b(e.score),1)]),_:2},1032,["type"])]),_:1}),d(pe,{prop:"weightedScore",label:"加权得分",width:"120"},{default:p(({row:e})=>[y(b(e.weightedScore.toFixed(2)),1)]),_:1}),d(pe,{prop:"analysis",label:"AI分析","min-width":"300"},{default:p(({row:e})=>[_("div",{class:"analysis-content",innerHTML:oe(e.analysis)},null,8,q)]),_:1})]),_:1},8,["data"])]),_("div",K,[s[10]||(s[10]=_("h4",null,"风险分析",-1)),d(x(V),{content:ee.value.riskAnalysis,"is-streaming":!1,"enable-markdown":!0},null,8,["content"])]),_("div",N,[s[11]||(s[11]=_("h4",null,"改进建议",-1)),d(x(V),{content:ee.value.suggestions,"is-streaming":!1,"enable-markdown":!0},null,8,["content"])])]),_:1})):c("",!0),Y.value?(v(),u(ue,{key:2,class:"streaming-output",shadow:"never"},{header:p(()=>[...s[12]||(s[12]=[_("div",{class:"card-header"},[_("span",null,"AI正在评分...")],-1)])]),default:p(()=>[d(x(V),{content:Z.value,"is-streaming":Y.value,onStop:se},null,8,["content","is-streaming"])]),_:1})):c("",!0)])}}}),[["__scopeId","data-v-187df135"]]);export{X as default};
