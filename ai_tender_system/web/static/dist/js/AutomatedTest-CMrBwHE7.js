import{Q as a,as as e,d as s,p as l,aq as t,r as i,i as r,G as n,q as o}from"./index.js";/* empty css                                                        */import{E as c}from"./el-text-BBUgZhzi.js";import{E as u}from"./el-pagination-DLlNht_A.js";/* empty css               */import"./el-select-DZeK41OH.js";/* empty css                     *//* empty css                             *//* empty css                    */import{t as d}from"./test-runner-BDl9wZQx.js";/* empty css                *//* empty css                                                                          *//* empty css                */import{C as v}from"./Card-DjWxEjgq.js";import{am as p,an as m,ao as f,aX as g,bI as _,au as h,ar as y,ax as w,as as b,aw as x,av as k,aC as j,aB as C,aD as z,ay as E,aq as F,aF as I}from"./editor-CkQC1Uq_.js";/* empty css                   *//* empty css                */import{E as T}from"./index-CPjPqG6g.js";import{E as V}from"./index-lVhqCxeU.js";import{E as D}from"./index-Jdk3-L3D.js";import{E as H,a as U}from"./index-Ct_FIOsr.js";import{E as q}from"./index-DzllSHb7.js";import{E as A}from"./index-CwbKUXgF.js";import"./index-DO7-lxyV.js";import"./strings-DygAwr0H.js";import"./index-C1LY3n9p.js";import"./toNumber-B_atpBHU.js";import"./_baseFindIndex-BTqrMG7V.js";import"./_baseIteratee-CwtmDzoV.js";import"./flatMap-D7uPVDtS.js";import"./map-B_SlaKiF.js";import"./_baseEach-V8knk74i.js";import"./raf-BZHcGSIv.js";const P={class:"automated-test"},S={class:"quick-info-grid"},Q={class:"info-content"},G={class:"info-text"},N={class:"info-value"},B={class:"info-content"},M={class:"info-text"},O={class:"info-value"},R={class:"info-content"},X={class:"info-text"},Z={class:"info-content"},J={class:"info-text"},K={class:"info-value small"},L={class:"control-panel"},W={class:"run-options"},Y={key:0,class:"results-panel"},$={class:"stats-header"},aa={class:"test-stats"},ea={class:"stat-item success"},sa={class:"stat-content"},la={class:"stat-value"},ta={class:"stat-item danger"},ia={class:"stat-content"},ra={class:"stat-value"},na={class:"stat-item warning"},oa={class:"stat-content"},ca={class:"stat-value"},ua={class:"stat-item info"},da={class:"stat-content"},va={class:"stat-value"},pa={class:"stat-item"},ma={class:"stat-content"},fa={class:"stat-value"},ga={key:1,class:"coverage-section"},_a={class:"coverage-header"},ha={class:"coverage-summary"},ya={class:"summary-item"},wa={class:"summary-value"},ba={class:"summary-item"},xa={class:"summary-value success"},ka={class:"summary-item"},ja={class:"summary-value danger"},Ca={class:"pagination-wrapper"},za={class:"history-section"},Ea={class:"history-header"},Fa={class:"header-actions"},Ia={key:0,class:"result-summary"},Ta={class:"result-item success"},Va={class:"result-item danger"},Da={class:"result-item warning"},Ha={key:1,class:"text-muted"},Ua={key:0},qa={key:1,class:"text-muted"},Aa={key:0,class:"empty-state"},Pa={key:2,class:"logs-section"},Sa={class:"logs-header"},Qa={class:"header-actions"},Ga={key:0,class:"logs-content"},Na={key:1,class:"empty-logs"},Ba=o(p({__name:"AutomatedTest",setup(o){const p=m(null),Ba=m("unit"),Ma=m(!0),Oa=m(!1),Ra=m(null),Xa=m(null),Za=m(null),Ja=m(null),Ka=m([]),La=m(null),Wa=m(1),Ya=m(20),$a=f(()=>{if(!Ja.value)return[];const a=(Wa.value-1)*Ya.value,e=a+Ya.value;return Ja.value.files.slice(a,e)}),ae=async()=>{try{const a=await d.getQuickInfo();a.success&&(p.value=a.info)}catch(a){}},ee=async()=>{var a,e;if(!Oa.value)try{const a=await d.runTests(Ba.value,Ma.value,!0);a.success&&(Xa.value=a.task_id,Oa.value=!0,r.success("æµ‹è¯•å·²å¼€å§‹è¿è¡Œ"),se())}catch(s){r.error((null==(e=null==(a=s.response)?void 0:a.data)?void 0:e.error)||"å¯åŠ¨æµ‹è¯•å¤±è´¥")}},se=()=>{Za.value&&clearInterval(Za.value),Za.value=window.setInterval(async()=>{if(Xa.value)try{const a=await d.getTestStatus(Xa.value);a.success&&(Ra.value=a.task,await I(),La.value&&(La.value.scrollTop=La.value.scrollHeight),"completed"!==Ra.value.status&&"failed"!==Ra.value.status||(le(),Oa.value=!1,Ma.value&&"completed"===Ra.value.status&&await te(),await ae(),await ie(),"completed"===Ra.value.status?r.success("æµ‹è¯•è¿è¡Œå®Œæˆ"):r.error("æµ‹è¯•è¿è¡Œå¤±è´¥")))}catch(a){}},1e3)},le=()=>{Za.value&&(clearInterval(Za.value),Za.value=null)},te=async()=>{try{const a=await d.getCoverageData();a.success&&(Ja.value=a.coverage)}catch(a){}},ie=async()=>{try{const a=await d.getTestHistory(20);a.success&&(Ka.value=a.history)}catch(a){}},re=async()=>{try{await n.confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•åŽ†å²è®°å½•å—ï¼Ÿ","ç¡®è®¤æ¸…é™¤",{type:"warning"}),await d.clearHistory(),Ka.value=[],r.success("åŽ†å²è®°å½•å·²æ¸…é™¤")}catch(a){}},ne=()=>{var a;if(!(null==(a=Ra.value)?void 0:a.logs))return;const e=Ra.value.logs.join("\n");navigator.clipboard.writeText(e).then(()=>{r.success("æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")})},oe=a=>a>=80?"coverage-excellent":a>=50?"coverage-good":a>=30?"coverage-fair":"coverage-poor",ce=a=>a>=80?"#67C23A":a>=50?"#409EFF":a>=30?"#E6A23C":"#F56C6C",ue=a=>({pending:"ç­‰å¾…ä¸­",running:"è¿è¡Œä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"}[a]||a),de=a=>{Ya.value=a,Wa.value=1},ve=a=>{Wa.value=a};return g(async()=>{await ae(),await ie(),await te()}),_(()=>{le()}),(n,o)=>{const d=s,m=T,f=e,g=a,_=V,I=D,Xa=q,Za=U,se=H,le=u,te=c,pe=A;return y(),h("div",P,[w(E(v),{title:"ðŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œå™¨"},{extra:b(()=>[w(d,{onClick:ae,icon:E(i),circle:"",size:"small",title:"åˆ·æ–°"},null,8,["icon"])]),default:b(()=>{var a;return[x("div",S,[w(m,{class:"info-card",shadow:"hover"},{default:b(()=>{var a;return[x("div",Q,[o[5]||(o[5]=x("i",{class:"bi-list-check info-icon"},null,-1)),x("div",G,[o[4]||(o[4]=x("div",{class:"info-label"},"æ€»æµ‹è¯•æ•°",-1)),x("div",N,j((null==(a=p.value)?void 0:a.total_tests)||0),1)])])]}),_:1}),w(m,{class:"info-card",shadow:"hover"},{default:b(()=>{var a;return[x("div",B,[o[7]||(o[7]=x("i",{class:"bi-file-earmark-code info-icon"},null,-1)),x("div",M,[o[6]||(o[6]=x("div",{class:"info-label"},"æµ‹è¯•æ–‡ä»¶",-1)),x("div",O,j((null==(a=p.value)?void 0:a.test_files)||0),1)])])]}),_:1}),w(m,{class:"info-card",shadow:"hover"},{default:b(()=>{var a,e;return[x("div",R,[o[9]||(o[9]=x("i",{class:"bi-pie-chart info-icon"},null,-1)),x("div",X,[o[8]||(o[8]=x("div",{class:"info-label"},"æµ‹è¯•è¦†ç›–çŽ‡",-1)),x("div",{class:C(["info-value",oe((null==(a=p.value)?void 0:a.coverage_percent)||0)])},j(((null==(e=p.value)?void 0:e.coverage_percent)||0).toFixed(2))+"% ",3)])])]}),_:1}),w(m,{class:"info-card",shadow:"hover"},{default:b(()=>{var a;return[x("div",Z,[o[11]||(o[11]=x("i",{class:"bi-clock-history info-icon"},null,-1)),x("div",J,[o[10]||(o[10]=x("div",{class:"info-label"},"æœ€åŽè¿è¡Œ",-1)),x("div",K,j((null==(a=p.value)?void 0:a.last_run)||"æœªè¿è¡Œ"),1)])])]}),_:1})]),x("div",L,[w(m,{shadow:"never"},{header:b(()=>[...o[12]||(o[12]=[x("span",null,"è¿è¡Œæµ‹è¯•",-1)])]),default:b(()=>[x("div",W,[w(g,{modelValue:Ba.value,"onUpdate:modelValue":o[0]||(o[0]=a=>Ba.value=a),disabled:Oa.value},{default:b(()=>[w(f,{value:"unit"},{default:b(()=>[...o[13]||(o[13]=[z("å•å…ƒæµ‹è¯•",-1)])]),_:1}),w(f,{value:"integration"},{default:b(()=>[...o[14]||(o[14]=[z("é›†æˆæµ‹è¯•",-1)])]),_:1}),w(f,{value:"all"},{default:b(()=>[...o[15]||(o[15]=[z("å…¨éƒ¨æµ‹è¯•",-1)])]),_:1})]),_:1},8,["modelValue","disabled"]),w(_,{modelValue:Ma.value,"onUpdate:modelValue":o[1]||(o[1]=a=>Ma.value=a),disabled:Oa.value},{default:b(()=>[...o[16]||(o[16]=[z(" ç”Ÿæˆè¦†ç›–çŽ‡æŠ¥å‘Š ",-1)])]),_:1},8,["modelValue","disabled"]),w(d,{type:"primary",icon:Oa.value?E(l):E(t),loading:Oa.value,onClick:ee,size:"large"},{default:b(()=>[z(j(Oa.value?"æµ‹è¯•è¿è¡Œä¸­...":"å¼€å§‹æµ‹è¯•"),1)]),_:1},8,["icon","loading"])])]),_:1})]),(null==(a=Ra.value)?void 0:a.result)?(y(),h("div",Y,[w(m,{shadow:"never",class:"stats-card"},{header:b(()=>[x("div",$,[o[17]||(o[17]=x("span",null,"æµ‹è¯•ç»“æžœ",-1)),w(I,{type:Ra.value.result.passed?"success":"danger",effect:"dark"},{default:b(()=>[z(j(Ra.value.result.passed?"âœ… é€šè¿‡":"âŒ å¤±è´¥"),1)]),_:1},8,["type"])])]),default:b(()=>{var a;return[x("div",aa,[x("div",ea,[o[19]||(o[19]=x("i",{class:"bi-check-circle"},null,-1)),x("div",sa,[o[18]||(o[18]=x("div",{class:"stat-label"},"é€šè¿‡",-1)),x("div",la,j(Ra.value.result.passed),1)])]),x("div",ta,[o[21]||(o[21]=x("i",{class:"bi-x-circle"},null,-1)),x("div",ia,[o[20]||(o[20]=x("div",{class:"stat-label"},"å¤±è´¥",-1)),x("div",ra,j(Ra.value.result.failed),1)])]),x("div",na,[o[23]||(o[23]=x("i",{class:"bi-skip-forward-circle"},null,-1)),x("div",oa,[o[22]||(o[22]=x("div",{class:"stat-label"},"è·³è¿‡",-1)),x("div",ca,j(Ra.value.result.skipped),1)])]),x("div",ua,[o[25]||(o[25]=x("i",{class:"bi-exclamation-circle"},null,-1)),x("div",da,[o[24]||(o[24]=x("div",{class:"stat-label"},"é”™è¯¯",-1)),x("div",va,j(Ra.value.result.errors),1)])]),x("div",pa,[o[27]||(o[27]=x("i",{class:"bi-stopwatch"},null,-1)),x("div",ma,[o[26]||(o[26]=x("div",{class:"stat-label"},"è€—æ—¶",-1)),x("div",fa,j(null==(a=Ra.value.result.duration)?void 0:a.toFixed(2))+"s",1)])])])]}),_:1})])):k("",!0),Ja.value?(y(),h("div",ga,[w(m,{shadow:"never"},{header:b(()=>[x("div",_a,[o[28]||(o[28]=x("span",null,"æµ‹è¯•è¦†ç›–çŽ‡",-1)),w(Xa,{percentage:Ja.value.coverage_percent,color:ce(Ja.value.coverage_percent),"stroke-width":20,"text-inside":""},null,8,["percentage","color"])])]),default:b(()=>[x("div",ha,[x("div",ya,[o[29]||(o[29]=x("span",{class:"summary-label"},"æ€»ä»£ç è¡Œæ•°:",-1)),x("span",wa,j(Ja.value.total_statements),1)]),x("div",ba,[o[30]||(o[30]=x("span",{class:"summary-label"},"å·²è¦†ç›–:",-1)),x("span",xa,j(Ja.value.covered_statements),1)]),x("div",ka,[o[31]||(o[31]=x("span",{class:"summary-label"},"æœªè¦†ç›–:",-1)),x("span",ja,j(Ja.value.missing_statements),1)])]),w(se,{data:$a.value,border:"",stripe:"","max-height":"400"},{default:b(()=>[w(Za,{prop:"file",label:"æ–‡ä»¶","min-width":"300","show-overflow-tooltip":""}),w(Za,{prop:"statements",label:"æ€»è¡Œæ•°",width:"100",align:"center"}),w(Za,{prop:"covered",label:"å·²è¦†ç›–",width:"100",align:"center"}),w(Za,{prop:"missing",label:"æœªè¦†ç›–",width:"100",align:"center"}),w(Za,{label:"è¦†ç›–çŽ‡",width:"150",align:"center"},{default:b(({row:a})=>[w(Xa,{percentage:a.coverage,color:ce(a.coverage),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),x("span",{class:C(oe(a.coverage)),style:{"margin-left":"8px"}},j(a.coverage.toFixed(1))+"% ",3)]),_:1})]),_:1},8,["data"]),x("div",Ca,[w(le,{"current-page":Wa.value,"onUpdate:currentPage":o[2]||(o[2]=a=>Wa.value=a),"page-size":Ya.value,"onUpdate:pageSize":o[3]||(o[3]=a=>Ya.value=a),"page-sizes":[10,20,50,100],total:Ja.value.files.length,layout:"total, sizes, prev, pager, next",onSizeChange:de,onCurrentChange:ve},null,8,["current-page","page-size","total"])])]),_:1})])):k("",!0),x("div",za,[w(m,{shadow:"never"},{header:b(()=>[x("div",Ea,[o[34]||(o[34]=x("span",null,"æµ‹è¯•åŽ†å²",-1)),x("div",Fa,[w(d,{size:"small",onClick:ie},{default:b(()=>[...o[32]||(o[32]=[z("åˆ·æ–°",-1)])]),_:1}),w(d,{size:"small",type:"danger",onClick:re},{default:b(()=>[...o[33]||(o[33]=[z("æ¸…é™¤",-1)])]),_:1})])])]),default:b(()=>[w(se,{data:Ka.value,border:"",stripe:""},{default:b(()=>[w(Za,{label:"ä»»åŠ¡ID",width:"200","show-overflow-tooltip":""},{default:b(({row:a})=>[w(te,{size:"small",type:"info"},{default:b(()=>[z(j(a.task_id),1)]),_:2},1024)]),_:1}),w(Za,{prop:"test_type",label:"æµ‹è¯•ç±»åž‹",width:"120",align:"center"},{default:b(({row:a})=>[w(I,{size:"small",effect:"plain"},{default:b(()=>{return[z(j((e=a.test_type,{unit:"å•å…ƒæµ‹è¯•",integration:"é›†æˆæµ‹è¯•",all:"å…¨éƒ¨æµ‹è¯•"}[e]||e)),1)];var e}),_:2},1024)]),_:1}),w(Za,{label:"çŠ¶æ€",width:"100",align:"center"},{default:b(({row:a})=>{return[w(I,{type:(e=a.status,{pending:"info",running:"warning",completed:"success",failed:"danger"}[e]||"info"),size:"small"},{default:b(()=>[z(j(ue(a.status)),1)]),_:2},1032,["type"])];var e}),_:1}),w(Za,{label:"ç»“æžœ",width:"200",align:"center"},{default:b(({row:a})=>[a.result?(y(),h("div",Ia,[x("span",Ta,"âœ“ "+j(a.result.passed),1),x("span",Va,"âœ— "+j(a.result.failed),1),x("span",Da,"âŠ™ "+j(a.result.skipped),1)])):(y(),h("span",Ha,"-"))]),_:1}),w(Za,{prop:"created_time",label:"åˆ›å»ºæ—¶é—´",width:"180"}),w(Za,{label:"è€—æ—¶",width:"100",align:"center"},{default:b(({row:a})=>{var e;return[a.result?(y(),h("span",Ua,j(null==(e=a.result.duration)?void 0:e.toFixed(2))+"s",1)):(y(),h("span",qa,"-"))]}),_:1}),w(Za,{label:"æ“ä½œ",width:"120",fixed:"right",align:"center"},{default:b(({row:a})=>[w(d,{size:"small",onClick:e=>{return s=a,Ra.value=s,void r.info("å·²åŠ è½½æµ‹è¯•è¯¦æƒ…");var s}},{default:b(()=>[...o[35]||(o[35]=[z("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),0===Ka.value.length?(y(),h("div",Aa,[w(pe,{description:"æš‚æ— æµ‹è¯•åŽ†å²"})])):k("",!0)]),_:1})]),Ra.value?(y(),h("div",Pa,[w(m,{shadow:"never",class:"logs-card"},{header:b(()=>[x("div",Sa,[o[38]||(o[38]=x("span",null,"ðŸ“ æµ‹è¯•æ—¥å¿—",-1)),x("div",Qa,[Oa.value?(y(),F(I,{key:0,type:"info",effect:"plain"},{default:b(()=>[...o[36]||(o[36]=[x("i",{class:"bi-arrow-clockwise rotating"},null,-1),z(" è¿è¡Œä¸­... ",-1)])]),_:1})):k("",!0),w(d,{size:"small",onClick:ne},{default:b(()=>[...o[37]||(o[37]=[z("å¤åˆ¶æ—¥å¿—",-1)])]),_:1})])])]),default:b(()=>[x("div",{class:"logs-container",ref_key:"logsContainer",ref:La},[Ra.value.logs&&Ra.value.logs.length>0?(y(),h("pre",Ga,j(Ra.value.logs.join("\n")),1)):(y(),h("div",Na,[...o[39]||(o[39]=[x("i",{class:"bi-terminal"},null,-1),x("p",null,"ç­‰å¾…æµ‹è¯•å¼€å§‹...",-1)])]))],512)]),_:1})])):k("",!0)]}),_:1})])}}}),[["__scopeId","data-v-b06c4246"]]);export{Ba as default};
