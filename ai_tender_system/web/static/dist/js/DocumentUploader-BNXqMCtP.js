import{aK as e,av as a,aw as t,aL as s,aN as l,aY as i,b5 as o,aS as r,a_ as u,b6 as p,aQ as d,aR as c,aM as m,aW as n,aU as f,b7 as g,aX as x,b8 as v,b9 as y,a$ as _,ba as b,b0 as h,bb as w,bc as k,aZ as $}from"./index.js";/* empty css                                                                          *//* empty css                             */import{s as z}from"./imageCompressor-CTkRt5bg.js";import{E as T}from"./index-Ck60z3mc.js";import{E as V}from"./index-CiTGQxVM.js";const j={class:"document-uploader"},F={key:1,class:"upload-drag-area"},B={key:0,class:"upload-hint"},C={key:0,class:"upload-tip"},L={class:"upload-file-item"},R={class:"file-name"},S=$(e({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(e,{expose:$,emit:S}){const q=e,D=S,U=a(),H=t({get:()=>q.modelValue||[],set:e=>D("update:modelValue",e)}),I=async e=>{var a;if(q.maxSize&&e.size/1024/1024>q.maxSize)return p.error(`文件大小不能超过 ${q.maxSize}MB`),!1;if(q.accept){const t=q.accept.split(",").map(e=>e.trim()),s="."+(null==(a=e.name.split(".").pop())?void 0:a.toLowerCase());if(!t.some(e=>s===e.toLowerCase()))return p.error(`不支持的文件格式：${s}`),!1}if(q.autoCompressImage&&e.type.startsWith("image/"))try{const a=await z(e,q.imageType),t=e.size,s=a.size;((t-s)/t*100).toFixed(1);if(s<t)return a}catch(t){p.warning("图片压缩失败，将上传原文件")}return!0},W=(e,a,t)=>{},E=(e,a,t)=>{D("success",a,t),D("update:modelValue",t)},M=(e,a,t)=>{p.error("文件上传失败："+e.message),D("error",e,a,t)},X=(e,a)=>{p.warning(`最多只能上传 ${q.limit} 个文件`),D("exceed",e,a)},Y=(e,a)=>{D("remove",e,a),D("update:modelValue",a)};return $({clearFiles:()=>{var e;null==(e=U.value)||e.clearFiles(),D("update:modelValue",[])},submit:()=>{var e;null==(e=U.value)||e.submit()},abort:e=>{var a;null==(a=U.value)||a.abort(e)}}),(a,t)=>{const p=h,$=n,z=V,S=T;return l(),s("div",j,[i(S,o({ref_key:"uploadRef",ref:U,action:e.uploadUrl,"http-request":e.httpRequest,headers:e.uploadHeaders,data:e.uploadData,accept:e.accept,limit:e.limit,multiple:e.multiple,drag:e.drag,"show-file-list":e.showFileList,"before-upload":I,"on-progress":W,"on-success":E,"on-error":M,"on-exceed":X,"on-remove":Y,"file-list":H.value},a.$attrs),{default:r(()=>[u(a.$slots,"trigger",{},()=>[e.drag?(l(),s("div",F,[i($,{class:"upload-icon"},{default:r(()=>[i(f(k))]),_:1}),t[0]||(t[0]=d("div",{class:"upload-text"},[_(" 将文件拖到此处，或"),d("em",null,"点击上传")],-1)),e.accept?(l(),s("div",B," 支持的文件格式："+x(e.accept),1)):m("",!0)])):(l(),c(p,{key:0,type:"primary",icon:f(w)},{default:r(()=>[_(x(e.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:r(()=>[u(a.$slots,"tip",{},()=>[e.tipText?(l(),s("div",C,[i($,null,{default:r(()=>[i(f(b))]),_:1}),_(" "+x(e.tipText),1)])):m("",!0)],!0)]),file:r(({file:e})=>[u(a.$slots,"file",{file:e},()=>[d("div",L,[i($,{class:"file-icon"},{default:r(()=>[i(f(g))]),_:1}),d("span",R,x(e.name),1),"uploading"===e.status?(l(),c(z,{key:0,percentage:e.percentage,"stroke-width":2},null,8,["percentage"])):m("",!0),"success"===e.status?(l(),c($,{key:1,class:"status-icon success"},{default:r(()=>[i(f(v))]),_:1})):m("",!0),"fail"===e.status?(l(),c($,{key:2,class:"status-icon error"},{default:r(()=>[i(f(y))]),_:1})):m("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),[["__scopeId","data-v-7c33a36b"]]);export{S as D};
