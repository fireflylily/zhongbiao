import{ax as e,T as a,az as l,aB as t,aC as o,aD as u,aV as d,a2 as s,a_ as r,U as n,a$ as i,_ as c,as as p,u as m,b0 as v,e as _,aI as f,aK as y,b1 as b,b2 as h,w as g,M as V,s as w,aS as x,b3 as j,O as k,S as C,d as U,y as z,P as S,N as T,Q as E,R as $,h as B,G as I,q as D}from"./index.js";/* empty css                             */import{E as M}from"./el-date-picker-panel-D54Ka2r_.js";/* empty css                     */import{E as P,a as q,b as F}from"./el-select-BJBcYONu.js";/* empty css                                                                            *//* empty css                *//* empty css                    */import{a as O,E as L}from"./el-tab-pane-CDDyJbHC.js";import{E as R}from"./el-pagination-MlW_urNO.js";/* empty css               *//* empty css                */import{am as N,bO as A,an as Y,ao as H,bR as K,bC as J,bU as W,bB as G,ap as Q,au as X,ar as Z,av as ee,az as ae,aA as le,aB as te,ay as oe,ax as ue,as as de,at as se,aq as re,aT as ne,aV as ie,aS as ce,aC as pe,bt as me,aW as ve,aw as _e,bv as fe,aD as ye}from"./editor-DIU3HkCl.js";import{L as be}from"./Loading-BaeFx9Sd.js";import{E as he}from"./Empty-BzFzMpvB.js";/* empty css                                                        */import{_ as ge}from"./DocumentPreview.vue_vue_type_script_setup_true_lang-t5AFBzO7.js";/* empty css                   *//* empty css                */import{u as Ve}from"./company-CwGwL1q9.js";import{E as we}from"./index-CyT3SlO3.js";import{E as xe,a as je}from"./index-BNNUloTG.js";import{E as ke}from"./strings-BtUgbwSu.js";import{E as Ce}from"./index-8o1yQINi.js";import{c as Ue}from"./clamp-BAEQQ5va.js";import{E as ze}from"./index-CNRcJ6ka.js";import{E as Se,a as Te}from"./index-DHunEAIg.js";import"./advancedFormat-BdWlDp46.js";import"./index-E3rjqy71.js";import"./index-tSogorqz.js";import"./toNumber-D3tTWSp1.js";import"./_baseIteratee-DHzWGqJL.js";import"./raf-BZHcGSIv.js";import"./index-DUONv1q7.js";import"./index-BEtJVLvu.js";import"./directive-CcWiTPRI.js";import"./company-CHa0NuIL.js";import"./flatMap-2JDpzW_x.js";import"./map-BGIEIDPF.js";import"./_baseEach-BByE8SyV.js";import"./cloneDeep-syPWYH98.js";const Ee=a({modelValue:{type:Number,default:0},id:{type:String,default:void 0},lowThreshold:{type:Number,default:2},highThreshold:{type:Number,default:4},max:{type:Number,default:5},colors:{type:s([Array,Object]),default:()=>d(["","",""])},voidColor:{type:String,default:""},disabledVoidColor:{type:String,default:""},icons:{type:s([Array,Object]),default:()=>[r,r,r]},voidIcon:{type:n,default:()=>i},disabledVoidIcon:{type:n,default:()=>r},disabled:Boolean,allowHalf:Boolean,showText:Boolean,showScore:Boolean,textColor:{type:String,default:""},texts:{type:s(Array),default:()=>d(["Extremely bad","Disappointed","Fair","Satisfied","Surprise"])},scoreTemplate:{type:String,default:"{value}"},size:u,clearable:Boolean,...o(["ariaLabel"])}),$e={[t]:a=>e(a),[l]:a=>e(a)},Be=N({name:"ElRate"});const Ie=g(c(N({...Be,props:Ee,emits:$e,setup(e,{expose:a,emit:o}){const u=e;function d(e,a){const l=e=>J(e),t=Object.keys(a).map(e=>+e).filter(t=>{const o=a[t];return!!l(o)&&o.excluded?e<t:e<=t}).sort((e,a)=>e-a),o=a[t[0]];return l(o)&&o.value||o}const s=A(b,void 0),r=A(h,void 0),n=p(),i=m("rate"),{inputId:c,isLabeledByFormItem:g}=v(u,{formItemContext:r}),V=Y(u.modelValue),w=Y(-1),x=Y(!0),j=Y([]),k=H(()=>j.value.map(e=>e.$el.clientWidth)),C=H(()=>[i.b(),i.m(n.value)]),U=H(()=>u.disabled||(null==s?void 0:s.disabled)),z=H(()=>i.cssVarBlock({"void-color":u.voidColor,"disabled-void-color":u.disabledVoidColor,"fill-color":$.value})),S=H(()=>{let e="";return u.showScore?e=u.scoreTemplate.replace(/\{\s*value\s*\}/,U.value?`${u.modelValue}`:`${V.value}`):u.showText&&(e=u.texts[Math.ceil(V.value)-1]),e}),T=H(()=>100*u.modelValue-100*Math.floor(u.modelValue)),E=H(()=>K(u.colors)?{[u.lowThreshold]:u.colors[0],[u.highThreshold]:{value:u.colors[1],excluded:!0},[u.max]:u.colors[2]}:u.colors),$=H(()=>{const e=d(V.value,E.value);return J(e)?"":e}),B=H(()=>{let e="";return U.value?e=`${T.value}%`:u.allowHalf&&(e="50%"),{color:$.value,width:e}}),I=H(()=>{let e=K(u.icons)?[...u.icons]:{...u.icons};return e=W(e),K(e)?{[u.lowThreshold]:e[0],[u.highThreshold]:{value:e[1],excluded:!0},[u.max]:e[2]}:e}),D=H(()=>d(u.modelValue,I.value)),M=H(()=>U.value?G(u.disabledVoidIcon)?u.disabledVoidIcon:W(u.disabledVoidIcon):G(u.voidIcon)?u.voidIcon:W(u.voidIcon)),P=H(()=>d(V.value,I.value));function q(e){const a=U.value&&T.value>0&&e-1<u.modelValue&&e>u.modelValue,l=u.allowHalf&&x.value&&e-.5<=V.value&&e>V.value;return a||l}function F(e){u.clearable&&e===u.modelValue&&(e=0),o(l,e),u.modelValue!==e&&o(t,e)}function O(e){if(U.value)return;const a=f(e),d=u.allowHalf?.5:1;let s=V.value;switch(a){case y.up:case y.right:s+=d;break;case y.left:case y.down:s-=d}return s=Ue(s,0,u.max),s!==V.value?(e.stopPropagation(),e.preventDefault(),o(l,s),o(t,s),s):void 0}function L(e,a){U.value||(u.allowHalf&&a?(x.value=2*a.offsetX<=k.value[e-1],V.value=x.value?e-.5:e):V.value=e,w.value=e)}function R(){U.value||(u.allowHalf&&(x.value=u.modelValue!==Math.floor(u.modelValue)),V.value=u.modelValue,w.value=-1)}return Q(()=>u.modelValue,e=>{V.value=e,x.value=u.modelValue!==Math.floor(u.modelValue)}),u.modelValue||o(l,0),a({setCurrentValue:L,resetCurrentValue:R}),(e,a)=>{var l;return Z(),X("div",{id:oe(c),class:te([oe(C),oe(i).is("disabled",oe(U))]),role:"slider","aria-label":oe(g)?void 0:e.ariaLabel||"rating","aria-labelledby":oe(g)?null==(l=oe(r))?void 0:l.labelId:void 0,"aria-valuenow":V.value,"aria-valuetext":oe(S)||void 0,"aria-valuemin":"0","aria-valuemax":e.max,tabindex:"0",style:ce(oe(z)),onKeydown:O},[(Z(!0),X(ae,null,le(e.max,(e,a)=>(Z(),X("span",{key:a,class:te(oe(i).e("item")),onMousemove:a=>L(e,a),onMouseleave:R,onClick:a=>{return l=e,void(U.value||(u.allowHalf&&x.value?F(V.value):F(l)));var l}},[ue(oe(_),{ref_for:!0,ref_key:"iconRefs",ref:j,class:te([oe(i).e("icon"),{hover:w.value===e},oe(i).is("active",e<=V.value),oe(i).is("focus-visible",e===Math.ceil(V.value||1))])},{default:de(()=>[se((Z(),re(ne(oe(P)),null,null,512)),[[ie,!q(e)&&e<=V.value]]),se((Z(),re(ne(oe(M)),null,null,512)),[[ie,!q(e)&&e>V.value]]),se((Z(),re(ne(oe(M)),{class:te([oe(i).em("decimal","box")])},null,8,["class"])),[[ie,q(e)]]),se(ue(oe(_),{style:ce(oe(B)),class:te([oe(i).e("icon"),oe(i).e("decimal")])},{default:de(()=>[(Z(),re(ne(oe(D))))]),_:2},1032,["style","class"]),[[ie,q(e)]])]),_:2},1032,["class"])],42,["onMousemove","onClick"]))),128)),e.showText||e.showScore?(Z(),X("span",{key:0,class:te(oe(i).e("text")),style:ce({color:e.textColor})},pe(oe(S)),7)):ee("v-if",!0)],46,["id","aria-label","aria-labelledby","aria-valuenow","aria-valuetext","aria-valuemax"])}}}),[["__file","rate.vue"]])),De={class:"tender-library"},Me={class:"stats-bar"},Pe={class:"stat-content"},qe={class:"stat-icon docs"},Fe={class:"stat-info"},Oe={class:"stat-value"},Le={class:"stat-content"},Re={class:"stat-icon excerpts"},Ne={class:"stat-info"},Ae={class:"stat-value"},Ye={class:"stat-content"},He={class:"stat-icon won"},Ke={class:"stat-info"},Je={class:"stat-value"},We={class:"tab-toolbar"},Ge={key:3,class:"pagination-wrapper"},Qe={class:"tab-toolbar"},Xe={key:2,class:"excerpts-list"},Ze={class:"excerpt-header"},ea={class:"excerpt-title"},aa={class:"chapter-title"},la={class:"excerpt-meta"},ta={class:"doc-name"},oa={class:"excerpt-content"},ua={class:"excerpt-footer"},da={class:"excerpt-tags"},sa={class:"excerpt-actions"},ra={key:3,class:"pagination-wrapper"},na={class:"excerpt-full-content"},ia={class:"content-box"},ca="/api/tender-library",pa=D(N({__name:"TenderLibrary",setup(e){const{success:a,error:l}=V(),t=Ve(),o=H(()=>t.companyId||1),u=Y([]),d=me({docCount:0,excerptCount:0,wonCount:0}),s=Y("documents"),r=Y(!1),n=Y([]),i=Y(""),c=Y(""),p=Y(1),m=Y(10),v=Y(0),f=Y(!1),y=Y([]),b=Y(""),h=Y(""),g=Y(!1),D=Y(1),N=Y(10),A=Y(0),K=Y(!1),J=Y(),W=Y(),G=me({file:null,company_id:null,related_products:[],project_name:"",bid_result:"待定",bid_date:"",notes:""}),te={company_id:[{required:!0,message:"请选择所属公司",trigger:"change"}],project_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},se=Y(!1),ne=Y(!1),ie=Y(""),ce=Y(""),Ue=Y(!1),Ee=me({tender_doc_id:null,project_name:"",bid_result:"",bid_date:"",notes:""}),$e=Y(!1),Be=Y(!1),pa=Y("view"),ma=Y(null),va=me({excerpt_id:null,chapter_title:"",category:"",quality_score:0,tags:"",content:""}),_a=async()=>{r.value=!0;try{const e=new URLSearchParams({company_id:String(o.value),page:String(p.value),page_size:String(m.value)});i.value&&e.append("keyword",i.value),c.value&&e.append("bid_result",c.value);const a=await fetch(`${ca}/documents?${e}`),t=await a.json();t.success?(n.value=t.data||[],v.value=t.total||0,d.docCount=v.value,d.wonCount=n.value.filter(e=>"中标"===e.bid_result).length):l("加载失败",t.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{r.value=!1}},fa=async()=>{f.value=!0;try{const e=new URLSearchParams({company_id:String(o.value),page:String(D.value),page_size:String(N.value)});b.value&&e.append("keyword",b.value),h.value&&e.append("category",h.value),g.value&&e.append("won_only","true");const a=await fetch(`${ca}/excerpts?${e}`),t=await a.json();t.success?(y.value=t.data||[],A.value=t.total||0,d.excerptCount=A.value):l("加载失败",t.error||"未知错误")}catch(e){l("加载失败",e instanceof Error?e.message:"未知错误")}finally{f.value=!1}},ya=()=>{G.file=null,G.company_id=t.companyId||null,G.related_products=[],G.project_name="",G.bid_result="待定",G.bid_date="",G.notes="",J.value&&J.value.clearFiles(),K.value=!0},ba=(e,a)=>{e&&e.raw&&(G.file=e.raw)},ha=()=>{G.file=null},ga=async()=>{if(G.file)if(G.company_id){se.value=!0;try{const e=new FormData;e.append("file",G.file),e.append("company_id",String(G.company_id)),e.append("project_name",G.project_name),e.append("bid_result",G.bid_result),G.bid_date&&e.append("bid_date",G.bid_date),G.notes&&e.append("notes",G.notes),G.related_products.length>0&&e.append("related_products",JSON.stringify(G.related_products));const t=await fetch(`${ca}/documents/upload`,{method:"POST",body:e}),o=await t.json();o.success?(a("上传成功",o.message),K.value=!1,_a()):l("上传失败",o.error||"未知错误")}catch(e){l("上传失败",e instanceof Error?e.message:"未知错误")}finally{se.value=!1}}else l("请选择所属公司");else l("请选择文件")},Va=async()=>{$e.value=!0;try{const e=await fetch(`${ca}/documents/${Ee.tender_doc_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ee)}),t=await e.json();t.success?(a("保存成功"),Ue.value=!1,_a()):l("保存失败",t.error||"未知错误")}catch(e){l("保存失败",e instanceof Error?e.message:"未知错误")}finally{$e.value=!1}},wa=async()=>{$e.value=!0;try{const e=await fetch(`${ca}/excerpts/${va.excerpt_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(va)}),t=await e.json();t.success?(a("保存成功"),Be.value=!1,fa()):l("保存失败",t.error||"未知错误")}catch(e){l("保存失败",e instanceof Error?e.message:"未知错误")}finally{$e.value=!1}},xa=e=>"中标"===e?"success":"未中标"===e?"danger":"info";return ve(()=>{t.fetchCompanies(),(async()=>{try{const e=await fetch("/api/product-categories"),a=await e.json();a.success&&(u.value=a.data||[])}catch(e){}})(),_a(),fa()}),Q(s,e=>{"documents"===e?_a():fa()}),Q(o,()=>{_a(),fa()}),(e,o)=>{const V=_,Y=we,H=k,Q=q,me=P,ve=U,Ve=je,ja=ke,ka=xe,Ca=R,Ua=O,za=Ce,Sa=Ie,Ta=L,Ea=ze,$a=T,Ba=F,Ia=$,Da=E,Ma=M,Pa=S,qa=B,Fa=Te,Oa=Se;return Z(),X("div",De,[_e("div",Me,[ue(Y,{class:"stat-card"},{default:de(()=>[_e("div",Pe,[_e("div",qe,[ue(V,{size:32,color:"#409eff"},{default:de(()=>[ue(oe(w))]),_:1})]),_e("div",Fe,[o[33]||(o[33]=_e("div",{class:"stat-label"},"标书文档",-1)),_e("div",Oe,pe(d.docCount),1)])])]),_:1}),ue(Y,{class:"stat-card"},{default:de(()=>[_e("div",Le,[_e("div",Re,[ue(V,{size:32,color:"#67c23a"},{default:de(()=>[ue(oe(x))]),_:1})]),_e("div",Ne,[o[34]||(o[34]=_e("div",{class:"stat-label"},"素材片段",-1)),_e("div",Ae,pe(d.excerptCount),1)])])]),_:1}),ue(Y,{class:"stat-card"},{default:de(()=>[_e("div",Ye,[_e("div",He,[ue(V,{size:32,color:"#e6a23c"},{default:de(()=>[ue(oe(j))]),_:1})]),_e("div",Ke,[o[35]||(o[35]=_e("div",{class:"stat-label"},"中标标书",-1)),_e("div",Je,pe(d.wonCount),1)])])]),_:1})]),ue(Ta,{modelValue:s.value,"onUpdate:modelValue":o[9]||(o[9]=e=>s.value=e),type:"border-card"},{default:de(()=>[ue(Ua,{label:"标书文档",name:"documents"},{default:de(()=>[_e("div",We,[ue(H,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),placeholder:"搜索文档名称...",clearable:"",style:{width:"200px"},onKeyup:fe(_a,["enter"])},{prefix:de(()=>[ue(V,null,{default:de(()=>[ue(oe(C))]),_:1})]),_:1},8,["modelValue"]),ue(me,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=e=>c.value=e),placeholder:"投标结果",clearable:"",style:{width:"120px"},onChange:_a},{default:de(()=>[ue(Q,{label:"全部",value:""}),ue(Q,{label:"中标",value:"中标"}),ue(Q,{label:"未中标",value:"未中标"}),ue(Q,{label:"待定",value:"待定"})]),_:1},8,["modelValue"]),ue(ve,{type:"primary",onClick:ya},{default:de(()=>[ue(V,null,{default:de(()=>[ue(oe(z))]),_:1}),o[36]||(o[36]=ye(" 上传标书 ",-1))]),_:1})]),r.value?(Z(),re(oe(be),{key:0,text:"加载中..."})):n.value.length?(Z(),re(ka,{key:2,data:n.value,stripe:""},{default:de(()=>[ue(Ve,{prop:"doc_name",label:"文档名称","min-width":"200","show-overflow-tooltip":""}),ue(Ve,{prop:"project_name",label:"项目名称",width:"180","show-overflow-tooltip":""}),ue(Ve,{prop:"bid_result",label:"投标结果",width:"100",align:"center"},{default:de(({row:e})=>[ue(ja,{type:xa(e.bid_result)},{default:de(()=>[ye(pe(e.bid_result||"待定"),1)]),_:2},1032,["type"])]),_:1}),ue(Ve,{prop:"excerpt_count",label:"片段数",width:"80",align:"center"}),ue(Ve,{prop:"bid_date",label:"投标日期",width:"120"}),ue(Ve,{prop:"created_at",label:"上传时间",width:"160"}),ue(Ve,{label:"操作",width:"200",fixed:"right"},{default:de(({row:e})=>[ue(ve,{link:"",type:"primary",size:"small",onClick:a=>{return l=e,ie.value=l.file_path||"",ce.value=l.doc_name||"文档预览",void(ne.value=!0);var l}},{default:de(()=>[...o[37]||(o[37]=[ye(" 查看 ",-1)])]),_:1},8,["onClick"]),ue(ve,{link:"",type:"success",size:"small",onClick:t=>(async e=>{try{await I.confirm(`确定要从 "${e.doc_name}" 提取素材片段吗？`,"提取素材",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"})}catch{return}try{const t=await fetch(`${ca}/documents/${e.tender_doc_id}/extract`,{method:"POST"}),o=await t.json();o.success?(a("提取完成",`成功提取 ${o.extracted_count||0} 个片段`),_a(),fa()):l("提取失败",o.error||"未知错误")}catch(t){l("提取失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:de(()=>[...o[38]||(o[38]=[ye(" 提取 ",-1)])]),_:1},8,["onClick"]),ue(ve,{link:"",type:"warning",size:"small",onClick:a=>{return l=e,Ee.tender_doc_id=l.tender_doc_id,Ee.project_name=l.project_name||"",Ee.bid_result=l.bid_result||"待定",Ee.bid_date=l.bid_date||"",Ee.notes=l.notes||"",void(Ue.value=!0);var l}},{default:de(()=>[...o[39]||(o[39]=[ye(" 编辑 ",-1)])]),_:1},8,["onClick"]),ue(ve,{link:"",type:"danger",size:"small",onClick:t=>(async e=>{try{await I.confirm(`确定要删除 "${e.doc_name}" 吗？关联的素材片段也会被删除。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${ca}/documents/${e.tender_doc_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功"),_a(),fa()):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:de(()=>[...o[40]||(o[40]=[ye(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(Z(),re(oe(he),{key:1,type:"no-data",description:"暂无标书文档"})),v.value>m.value?(Z(),X("div",Ge,[ue(Ca,{"current-page":p.value,"onUpdate:currentPage":o[2]||(o[2]=e=>p.value=e),"page-size":m.value,"onUpdate:pageSize":o[3]||(o[3]=e=>m.value=e),total:v.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:_a,onCurrentChange:_a},null,8,["current-page","page-size","total"])])):ee("",!0)]),_:1}),ue(Ua,{label:"素材片段",name:"excerpts"},{default:de(()=>[_e("div",Qe,[ue(H,{modelValue:b.value,"onUpdate:modelValue":o[4]||(o[4]=e=>b.value=e),placeholder:"搜索素材内容...",clearable:"",style:{width:"250px"},onKeyup:fe(fa,["enter"])},{prefix:de(()=>[ue(V,null,{default:de(()=>[ue(oe(C))]),_:1})]),_:1},8,["modelValue"]),ue(me,{modelValue:h.value,"onUpdate:modelValue":o[5]||(o[5]=e=>h.value=e),placeholder:"分类",clearable:"",style:{width:"120px"},onChange:fa},{default:de(()=>[ue(Q,{label:"全部",value:""}),ue(Q,{label:"技术方案",value:"技术方案"}),ue(Q,{label:"项目管理",value:"项目管理"}),ue(Q,{label:"售后服务",value:"售后服务"}),ue(Q,{label:"企业资质",value:"企业资质"}),ue(Q,{label:"团队介绍",value:"团队介绍"}),ue(Q,{label:"其他",value:"其他"})]),_:1},8,["modelValue"]),ue(za,{modelValue:g.value,"onUpdate:modelValue":o[6]||(o[6]=e=>g.value=e),onChange:fa},{default:de(()=>[...o[41]||(o[41]=[ye("仅中标",-1)])]),_:1},8,["modelValue"])]),f.value?(Z(),re(oe(be),{key:0,text:"加载中..."})):y.value.length?(Z(),X("div",Xe,[(Z(!0),X(ae,null,le(y.value,e=>(Z(),re(Y,{key:e.excerpt_id,class:"excerpt-card",shadow:"hover"},{header:de(()=>{return[_e("div",Ze,[_e("div",ea,[_e("span",aa,pe(e.chapter_title||"无标题"),1),ue(ja,{size:"small",type:(a=e.category,{"技术方案":"primary","项目管理":"success","售后服务":"warning","企业资质":"info","团队介绍":"","其他":"info"}[a]||"info")},{default:de(()=>[ye(pe(e.category||"未分类"),1)]),_:2},1032,["type"]),"中标"===e.bid_result?(Z(),re(ja,{key:0,size:"small",type:"success"},{default:de(()=>[...o[42]||(o[42]=[ye(" 中标 ",-1)])]),_:1})):ee("",!0)]),_e("div",la,[_e("span",ta,pe(e.doc_name),1),ue(Sa,{modelValue:e.quality_score,"onUpdate:modelValue":a=>e.quality_score=a,disabled:"",max:5,size:"small",colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue","onUpdate:modelValue"])])])];var a}),default:de(()=>{var t,u;return[_e("div",oa,pe(null==(t=e.content)?void 0:t.substring(0,300))+pe((null==(u=e.content)?void 0:u.length)>300?"...":""),1),_e("div",ua,[_e("div",da,[(Z(!0),X(ae,null,le((e.tags||"").split(",").filter(Boolean).slice(0,3),e=>(Z(),re(ja,{key:e,size:"small",type:"info"},{default:de(()=>[ye(pe(e),1)]),_:2},1024))),128))]),_e("div",sa,[ue(ve,{link:"",type:"primary",size:"small",onClick:a=>(e=>{ma.value=e,pa.value="view",Be.value=!0})(e)},{default:de(()=>[...o[43]||(o[43]=[ye(" 查看全文 ",-1)])]),_:1},8,["onClick"]),ue(ve,{link:"",type:"primary",size:"small",onClick:t=>(async e=>{try{await navigator.clipboard.writeText(e.content||""),a("已复制到剪贴板")}catch(t){l("复制失败")}})(e)},{default:de(()=>[...o[44]||(o[44]=[ye(" 复制 ",-1)])]),_:1},8,["onClick"]),ue(ve,{link:"",type:"warning",size:"small",onClick:a=>(e=>{ma.value=e,va.excerpt_id=e.excerpt_id,va.chapter_title=e.chapter_title||"",va.category=e.category||"",va.quality_score=e.quality_score||0,va.tags=e.tags||"",va.content=e.content||"",pa.value="edit",Be.value=!0})(e)},{default:de(()=>[...o[45]||(o[45]=[ye(" 编辑 ",-1)])]),_:1},8,["onClick"]),ue(ve,{link:"",type:"danger",size:"small",onClick:t=>(async e=>{try{await I.confirm(`确定要删除素材片段 "${e.chapter_title||"未命名"}" 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const t=await fetch(`${ca}/excerpts/${e.excerpt_id}`,{method:"DELETE"}),o=await t.json();o.success?(a("删除成功"),fa()):l("删除失败",o.error||"未知错误")}catch(t){l("删除失败",t instanceof Error?t.message:"未知错误")}})(e)},{default:de(()=>[...o[46]||(o[46]=[ye(" 删除 ",-1)])]),_:1},8,["onClick"])])])]}),_:2},1024))),128))])):(Z(),re(oe(he),{key:1,type:"no-data",description:"暂无素材片段"})),A.value>N.value?(Z(),X("div",ra,[ue(Ca,{"current-page":D.value,"onUpdate:currentPage":o[7]||(o[7]=e=>D.value=e),"page-size":N.value,"onUpdate:pageSize":o[8]||(o[8]=e=>N.value=e),total:A.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:fa,onCurrentChange:fa},null,8,["current-page","page-size","total"])])):ee("",!0)]),_:1})]),_:1},8,["modelValue"]),ue(qa,{modelValue:K.value,"onUpdate:modelValue":o[17]||(o[17]=e=>K.value=e),title:"上传标书文档",width:"600px"},{footer:de(()=>[ue(ve,{onClick:o[16]||(o[16]=e=>K.value=!1)},{default:de(()=>[...o[52]||(o[52]=[ye("取消",-1)])]),_:1}),ue(ve,{type:"primary",onClick:ga,loading:se.value},{default:de(()=>[...o[53]||(o[53]=[ye(" 上传 ",-1)])]),_:1},8,["loading"])]),default:de(()=>[ue(Pa,{model:G,rules:te,ref_key:"uploadFormRef",ref:W,"label-width":"100px"},{default:de(()=>[ue($a,{label:"文档文件",prop:"file"},{default:de(()=>[ue(Ea,{ref_key:"uploadRef",ref:J,"auto-upload":!1,limit:1,"on-change":ba,"on-remove":ha,accept:".docx,.doc,.pdf"},{trigger:de(()=>[ue(ve,{type:"primary"},{default:de(()=>[...o[47]||(o[47]=[ye("选择文件",-1)])]),_:1})]),tip:de(()=>[...o[48]||(o[48]=[_e("div",{class:"el-upload__tip"},"支持 .docx, .doc, .pdf 格式",-1)])]),_:1},512)]),_:1}),ue($a,{label:"所属公司",prop:"company_id"},{default:de(()=>[ue(me,{modelValue:G.company_id,"onUpdate:modelValue":o[10]||(o[10]=e=>G.company_id=e),placeholder:"请选择公司",style:{width:"100%"},filterable:""},{default:de(()=>[(Z(!0),X(ae,null,le(oe(t).companiesOptions,e=>(Z(),re(Q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),ue($a,{label:"关联产品",prop:"related_products"},{default:de(()=>[ue(me,{modelValue:G.related_products,"onUpdate:modelValue":o[11]||(o[11]=e=>G.related_products=e),placeholder:"请选择产品分类（可多选）",style:{width:"100%"},multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:de(()=>[(Z(!0),X(ae,null,le(u.value,e=>(Z(),re(Ba,{key:e.category_id,label:e.category_name},{default:de(()=>[(Z(!0),X(ae,null,le(e.items,e=>(Z(),re(Q,{key:e.item_id,label:e.item_name,value:e.item_code},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),ue($a,{label:"项目名称",prop:"project_name"},{default:de(()=>[ue(H,{modelValue:G.project_name,"onUpdate:modelValue":o[12]||(o[12]=e=>G.project_name=e),placeholder:"投标项目名称"},null,8,["modelValue"])]),_:1}),ue($a,{label:"投标结果",prop:"bid_result"},{default:de(()=>[ue(Da,{modelValue:G.bid_result,"onUpdate:modelValue":o[13]||(o[13]=e=>G.bid_result=e)},{default:de(()=>[ue(Ia,{label:"中标"},{default:de(()=>[...o[49]||(o[49]=[ye("中标",-1)])]),_:1}),ue(Ia,{label:"未中标"},{default:de(()=>[...o[50]||(o[50]=[ye("未中标",-1)])]),_:1}),ue(Ia,{label:"待定"},{default:de(()=>[...o[51]||(o[51]=[ye("待定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),ue($a,{label:"投标日期",prop:"bid_date"},{default:de(()=>[ue(Ma,{modelValue:G.bid_date,"onUpdate:modelValue":o[14]||(o[14]=e=>G.bid_date=e),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),ue($a,{label:"备注",prop:"notes"},{default:de(()=>[ue(H,{modelValue:G.notes,"onUpdate:modelValue":o[15]||(o[15]=e=>G.notes=e),type:"textarea",rows:2,placeholder:"可选备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),ue(qa,{modelValue:Ue.value,"onUpdate:modelValue":o[23]||(o[23]=e=>Ue.value=e),title:"编辑标书信息",width:"500px"},{footer:de(()=>[ue(ve,{onClick:o[22]||(o[22]=e=>Ue.value=!1)},{default:de(()=>[...o[57]||(o[57]=[ye("取消",-1)])]),_:1}),ue(ve,{type:"primary",onClick:Va,loading:$e.value},{default:de(()=>[...o[58]||(o[58]=[ye(" 保存 ",-1)])]),_:1},8,["loading"])]),default:de(()=>[ue(Pa,{model:Ee,"label-width":"100px"},{default:de(()=>[ue($a,{label:"项目名称"},{default:de(()=>[ue(H,{modelValue:Ee.project_name,"onUpdate:modelValue":o[18]||(o[18]=e=>Ee.project_name=e)},null,8,["modelValue"])]),_:1}),ue($a,{label:"投标结果"},{default:de(()=>[ue(Da,{modelValue:Ee.bid_result,"onUpdate:modelValue":o[19]||(o[19]=e=>Ee.bid_result=e)},{default:de(()=>[ue(Ia,{label:"中标"},{default:de(()=>[...o[54]||(o[54]=[ye("中标",-1)])]),_:1}),ue(Ia,{label:"未中标"},{default:de(()=>[...o[55]||(o[55]=[ye("未中标",-1)])]),_:1}),ue(Ia,{label:"待定"},{default:de(()=>[...o[56]||(o[56]=[ye("待定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),ue($a,{label:"投标日期"},{default:de(()=>[ue(Ma,{modelValue:Ee.bid_date,"onUpdate:modelValue":o[20]||(o[20]=e=>Ee.bid_date=e),type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),ue($a,{label:"备注"},{default:de(()=>[ue(H,{modelValue:Ee.notes,"onUpdate:modelValue":o[21]||(o[21]=e=>Ee.notes=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),ue(qa,{modelValue:Be.value,"onUpdate:modelValue":o[31]||(o[31]=e=>Be.value=e),title:"view"===pa.value?"素材详情":"编辑素材",width:"700px"},{footer:de(()=>[ue(ve,{onClick:o[29]||(o[29]=e=>Be.value=!1)},{default:de(()=>[...o[60]||(o[60]=[ye("关闭",-1)])]),_:1}),"view"===pa.value?(Z(),re(ve,{key:0,type:"primary",onClick:o[30]||(o[30]=e=>pa.value="edit")},{default:de(()=>[...o[61]||(o[61]=[ye(" 编辑 ",-1)])]),_:1})):(Z(),re(ve,{key:1,type:"primary",onClick:wa,loading:$e.value},{default:de(()=>[...o[62]||(o[62]=[ye(" 保存 ",-1)])]),_:1},8,["loading"]))]),default:de(()=>{var e;return["view"===pa.value?(Z(),X(ae,{key:0},[ue(Oa,{column:2,border:""},{default:de(()=>[ue(Fa,{label:"章节标题",span:2},{default:de(()=>{var e;return[ye(pe(null==(e=ma.value)?void 0:e.chapter_title),1)]}),_:1}),ue(Fa,{label:"分类"},{default:de(()=>{var e;return[ye(pe((null==(e=ma.value)?void 0:e.category)||"未分类"),1)]}),_:1}),ue(Fa,{label:"质量评分"},{default:de(()=>{var e;return[ue(Sa,{"model-value":null==(e=ma.value)?void 0:e.quality_score,disabled:"",max:5},null,8,["model-value"])]}),_:1}),ue(Fa,{label:"来源文档",span:2},{default:de(()=>{var e;return[ye(pe(null==(e=ma.value)?void 0:e.doc_name),1)]}),_:1}),ue(Fa,{label:"投标结果"},{default:de(()=>{var e;return[ue(ja,{type:xa(null==(e=ma.value)?void 0:e.bid_result)},{default:de(()=>{var e;return[ye(pe((null==(e=ma.value)?void 0:e.bid_result)||"待定"),1)]}),_:1},8,["type"])]}),_:1}),ue(Fa,{label:"标签"},{default:de(()=>{var e;return[ye(pe((null==(e=ma.value)?void 0:e.tags)||"无"),1)]}),_:1})]),_:1}),_e("div",na,[o[59]||(o[59]=_e("h4",null,"素材内容",-1)),_e("div",ia,pe(null==(e=ma.value)?void 0:e.content),1)])],64)):(Z(),re(Pa,{key:1,model:va,"label-width":"100px"},{default:de(()=>[ue($a,{label:"章节标题"},{default:de(()=>[ue(H,{modelValue:va.chapter_title,"onUpdate:modelValue":o[24]||(o[24]=e=>va.chapter_title=e)},null,8,["modelValue"])]),_:1}),ue($a,{label:"分类"},{default:de(()=>[ue(me,{modelValue:va.category,"onUpdate:modelValue":o[25]||(o[25]=e=>va.category=e),style:{width:"100%"}},{default:de(()=>[ue(Q,{label:"技术方案",value:"技术方案"}),ue(Q,{label:"项目管理",value:"项目管理"}),ue(Q,{label:"售后服务",value:"售后服务"}),ue(Q,{label:"企业资质",value:"企业资质"}),ue(Q,{label:"团队介绍",value:"团队介绍"}),ue(Q,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),ue($a,{label:"质量评分"},{default:de(()=>[ue(Sa,{modelValue:va.quality_score,"onUpdate:modelValue":o[26]||(o[26]=e=>va.quality_score=e),max:5},null,8,["modelValue"])]),_:1}),ue($a,{label:"标签"},{default:de(()=>[ue(H,{modelValue:va.tags,"onUpdate:modelValue":o[27]||(o[27]=e=>va.tags=e),placeholder:"逗号分隔的标签"},null,8,["modelValue"])]),_:1}),ue($a,{label:"内容"},{default:de(()=>[ue(H,{modelValue:va.content,"onUpdate:modelValue":o[28]||(o[28]=e=>va.content=e),type:"textarea",rows:10},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]))]}),_:1},8,["modelValue","title"]),ue(ge,{modelValue:ne.value,"onUpdate:modelValue":o[32]||(o[32]=e=>ne.value=e),"file-url":ie.value,"file-name":ce.value},null,8,["modelValue","file-url","file-name"])])}}}),[["__scopeId","data-v-bd638af1"]]);export{pa as default};
