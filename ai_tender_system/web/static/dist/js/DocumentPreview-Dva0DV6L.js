import{bO as e,aL as t,bS as a,aS as l,aO as s,aT as o,a$ as n,bh as i,d4 as r,aV as d,b3 as u,bT as c,av as g,bD as v,d5 as m,d6 as p,d7 as b,cP as f,b4 as y,aZ as x,b5 as h,d8 as w,az as _,bj as k,c1 as B,d9 as C,da as T,db as H,dc as P,dd as L,aw as $,b6 as A,aM as V,aN as E,aR as O,c8 as W,aP as I,ca as z,bk as N,a_ as j}from"./index.js";import{r as D}from"./DocumentPreview.vue_vue_type_style_index_0_scoped_3e333bda_lang-e-Hg8YbH.js";const U=t({name:"ElCollapseTransition"});const R=c(e(t({...U,setup(e){const t=a("collapse-transition"),c=e=>{e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom},g={beforeEnter(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.height&&(e.dataset.elExistsHeight=e.style.height),e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0},enter(e){requestAnimationFrame(()=>{e.dataset.oldOverflow=e.style.overflow,e.dataset.elExistsHeight?e.style.maxHeight=e.dataset.elExistsHeight:0!==e.scrollHeight?e.style.maxHeight=`${e.scrollHeight}px`:e.style.maxHeight=0,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom,e.style.overflow="hidden"})},afterEnter(e){e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow},enterCancelled(e){c(e)},beforeLeave(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.maxHeight=`${e.scrollHeight}px`,e.style.overflow="hidden"},leave(e){0!==e.scrollHeight&&(e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0)},afterLeave(e){c(e)},leaveCancelled(e){c(e)}};return(e,a)=>(s(),l(u,i({name:d(t).b()},r(g)),{default:o(()=>[n(e.$slots,"default")]),_:3},16,["name"]))}}),[["__file","collapse-transition.vue"]]));function S(e,a){let l;const s=g(!1),n=v({...e,originalPosition:"",originalOverflow:"",visible:!1});function i(){var e,t;null==(t=null==(e=_.$el)?void 0:e.parentNode)||t.removeChild(_.$el)}function r(){if(!s.value)return;const e=n.parent;s.value=!1,e.vLoadingAddClassList=void 0,function(){const e=n.parent,t=_.ns;if(!e.vLoadingAddClassList){let a=e.getAttribute("loading-number");a=Number.parseInt(a)-1,a?e.setAttribute("loading-number",a.toString()):(w(e,t.bm("parent","relative")),e.removeAttribute("loading-number")),w(e,t.bm("parent","hidden"))}i(),c.unmount()}()}const d=t({name:"ElLoading",setup(e,{expose:t}){const{ns:a,zIndex:l}=b("loading");return t({ns:a,zIndex:l}),()=>{const e=n.spinner||n.svg,t=f("svg",{class:"circular",viewBox:n.svgViewBox?n.svgViewBox:"0 0 50 50",...e?{innerHTML:e}:{}},[f("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),l=n.text?f("p",{class:a.b("text")},[n.text]):void 0;return f(u,{name:a.b("fade"),onAfterLeave:r},{default:o(()=>[y(x("div",{style:{backgroundColor:n.background||""},class:[a.b("mask"),n.customClass,n.fullscreen?"is-fullscreen":""]},[f("div",{class:a.b("spinner")},[t,l])]),[[h,n.visible]])])})}}}),c=m(d);Object.assign(c._context,null!=a?a:{});const _=c.mount(document.createElement("div"));return{...p(n),setText:function(e){n.text=e},removeElLoadingChild:i,close:function(){var t;e.beforeClose&&!e.beforeClose()||(s.value=!0,clearTimeout(l),l=setTimeout(r,400),n.visible=!1,null==(t=e.closed)||t.call(e))},handleAfterLeave:r,vm:_,get $el(){return _.$el}}}let M;const q=function(e={},t){if(!_)return;const a=F(e);if(a.fullscreen&&M)return M;const l=S({...a,closed:()=>{var e;null==(e=a.closed)||e.call(a),a.fullscreen&&(M=void 0)}},null!=t?t:q._context);Z(a,a.parent,l),X(a,a.parent,l),a.parent.vLoadingAddClassList=()=>X(a,a.parent,l);let s=a.parent.getAttribute("loading-number");return s=s?`${Number.parseInt(s)+1}`:"1",a.parent.setAttribute("loading-number",s),a.parent.appendChild(l.$el),k(()=>l.visible.value=a.visible),a.fullscreen&&(M=l),l},F=e=>{var t,a,l,s;let o;return o=B(e.target)?null!=(t=document.querySelector(e.target))?t:document.body:e.target||document.body,{parent:o===document.body||e.body?document.body:o,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:o===document.body&&(null==(a=e.fullscreen)||a),lock:null!=(l=e.lock)&&l,customClass:e.customClass||"",visible:null==(s=e.visible)||s,beforeClose:e.beforeClose,closed:e.closed,target:o}},Z=async(e,t,a)=>{const{nextZIndex:l}=a.vm.zIndex||a.vm._.exposed.zIndex,s={};if(e.fullscreen)a.originalPosition.value=C(document.body,"position"),a.originalOverflow.value=C(document.body,"overflow"),s.zIndex=l();else if(e.parent===document.body){a.originalPosition.value=C(document.body,"position"),await k();for(const t of["top","left"]){const a="top"===t?"scrollTop":"scrollLeft";s[t]=e.target.getBoundingClientRect()[t]+document.body[a]+document.documentElement[a]-Number.parseInt(C(document.body,`margin-${t}`),10)+"px"}for(const t of["height","width"])s[t]=`${e.target.getBoundingClientRect()[t]}px`}else a.originalPosition.value=C(t,"position");for(const[o,n]of Object.entries(s))a.$el.style[o]=n},X=(e,t,a)=>{const l=a.vm.ns||a.vm._.exposed.ns;["absolute","fixed","sticky"].includes(a.originalPosition.value)?w(t,l.bm("parent","relative")):T(t,l.bm("parent","relative")),e.fullscreen&&e.lock?T(t,l.bm("parent","hidden")):w(t,l.bm("parent","hidden"))};q._context=null;const G=Symbol("ElLoading"),J=e=>`element-loading-${L(e)}`,K=(e,t)=>{var a,l,s,o;const n=t.instance,i=e=>H(t.value)?t.value[e]:void 0,r=t=>(e=>{const t=B(e)&&(null==n?void 0:n[e])||e;return g(t)})(i(t)||e.getAttribute(J(t))),d=null!=(a=i("fullscreen"))?a:t.modifiers.fullscreen,u={text:r("text"),svg:r("svg"),svgViewBox:r("svgViewBox"),spinner:r("spinner"),background:r("background"),customClass:r("customClass"),fullscreen:d,target:null!=(l=i("target"))?l:d?void 0:e,body:null!=(s=i("body"))?s:t.modifiers.body,lock:null!=(o=i("lock"))?o:t.modifiers.lock},c=q(u);c._context=Q._context,e[G]={options:u,instance:c}},Q={mounted(e,t){t.value&&K(e,t)},updated(e,t){const a=e[G];if(!t.value)return null==a||a.instance.close(),void(e[G]=null);a?((e,t)=>{for(const a of Object.keys(e))P(e[a])&&(e[a].value=t[a])})(a.options,H(t.value)?t.value:{text:e.getAttribute(J("text")),svg:e.getAttribute(J("svg")),svgViewBox:e.getAttribute(J("svgViewBox")),spinner:e.getAttribute(J("spinner")),background:e.getAttribute(J("background")),customClass:e.getAttribute(J("customClass"))}):K(e,t)},unmounted(e){var t;null==(t=e[G])||t.instance.close(),e[G]=null},_context:null},Y={"element-loading-text":"正在加载文档...",class:"preview-container"},ee=j(t({__name:"DocumentPreview",props:{modelValue:{type:Boolean,default:!1},fileUrl:{default:""},fileName:{default:"文档预览"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,n=t,i=g(!1),r=g(""),d=g(null),u=$({get:()=>a.modelValue,set:e=>n("update:modelValue",e)}),c=$(()=>`文档预览 - ${a.fileName||"未命名文档"}`),v=()=>{u.value=!1};return A(()=>a.modelValue,async e=>{e&&a.fileUrl?(await k(),(async()=>{if(a.fileUrl){i.value=!0,r.value="";try{const e=(e=>{if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/api/"))return e;if(e.startsWith("/download/"))return`/api/files/serve/download/${e.substring(10)}`;let t=e;const a="/Users/lvhe/Downloads/zhongbiao/zhongbiao/";return t.startsWith(a)&&(t=t.substring(42)),t.startsWith("ai_tender_system/data/")?t=t.substring(22):t.startsWith("data/")&&(t=t.substring(5)),t.startsWith("outputs/")?t="download/"+t.substring(8):t.startsWith("uploads/")||(t="download/"+t),`/api/files/serve/${t}`})(a.fileUrl),t=await fetch(e);if(!t.ok)throw new Error(`HTTP错误: ${t.status}`);const l=await t.arrayBuffer();if(await k(),!d.value)throw new Error("预览容器未找到");d.value.innerHTML="",await D(l,d.value,void 0,{className:"docx-preview",inWrapper:!0,ignoreWidth:!1,ignoreHeight:!1,ignoreFonts:!1,breakPages:!0,ignoreLastRenderedPageBreak:!0,experimental:!0,trimXmlDeclaration:!0})}catch(e){r.value=`文档预览失败: ${e.message||"未知错误"}`,N.error("文档预览失败，请检查文件是否正确或尝试下载后查看")}finally{i.value=!1}}else r.value="文档地址不能为空"})()):(r.value="",d.value&&(d.value.innerHTML=""))}),(e,t)=>{const a=W,n=z,g=Q;return s(),l(n,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),title:c.value,width:"80%","before-close":v,"destroy-on-close":""},{default:o(()=>[y((s(),V("div",Y,[r.value?(s(),l(a,{key:0,type:"error",title:r.value,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):E("",!0),O("div",{ref_key:"previewContentRef",ref:d,class:"preview-content",style:I({display:r.value?"none":"block"})},null,4)])),[[g,i.value]])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-3e333bda"]]);export{ee as D,R as E,Q as v};
