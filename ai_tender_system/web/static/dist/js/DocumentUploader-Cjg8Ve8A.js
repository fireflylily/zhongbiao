import{aL as e,av as a,aw as t,aM as s,aO as l,aZ as o,b6 as i,aT as r,a$ as u,b7 as d,aR as p,aS as c,aN as m,aX as n,aV as f,b8 as g,aY as x,b9 as v,ba as y,b0 as _,bb as b,b1 as h,bc as w,bd as k,a_ as T}from"./index.js";/* empty css                                                                          *//* empty css                */import{s as V}from"./imageCompressor-CTkRt5bg.js";import{E as $}from"./index-GkPVVSWW.js";import{E as z}from"./index-Czx3rhy5.js";const j={class:"document-uploader"},F={key:1,class:"upload-drag-area"},B={key:0,class:"upload-hint"},C={key:0,class:"upload-tip"},L={class:"upload-file-item"},S={class:"file-name"},q=T(e({__name:"DocumentUploader",props:{uploadUrl:{default:"/api/upload"},uploadHeaders:{},uploadData:{},httpRequest:{},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},limit:{default:10},maxSize:{default:50},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},triggerText:{default:"选择文件"},tipText:{default:""},modelValue:{},autoCompressImage:{type:Boolean,default:!0},imageType:{default:"default"}},emits:["update:modelValue","success","error","exceed","remove"],setup(e,{expose:T,emit:q}){const D=e,R=q,U=a(),H=t({get:()=>D.modelValue||[],set:e=>R("update:modelValue",e)}),I=async e=>{var a;if(D.maxSize&&e.size/1024/1024>D.maxSize)return d.error(`文件大小不能超过 ${D.maxSize}MB`),!1;if(D.accept){const t=D.accept.split(",").map(e=>e.trim()),s="."+(null==(a=e.name.split(".").pop())?void 0:a.toLowerCase());if(!t.some(e=>s===e.toLowerCase()))return d.error(`不支持的文件格式：${s}`),!1}if(D.autoCompressImage&&e.type.startsWith("image/"))try{const a=await V(e,D.imageType),t=e.size,s=a.size;((t-s)/t*100).toFixed(1);if(s<t)return a}catch(t){d.warning("图片压缩失败，将上传原文件")}return!0},E=(e,a,t)=>{},M=(e,a,t)=>{R("success",a,t),R("update:modelValue",t)},Y=(e,a,t)=>{d.error("文件上传失败："+e.message),R("error",e,a,t)},Z=(e,a)=>{d.warning(`最多只能上传 ${D.limit} 个文件`),R("exceed",e,a)},N=(e,a)=>{R("remove",e,a),R("update:modelValue",a)};return T({clearFiles:()=>{var e;null==(e=U.value)||e.clearFiles(),R("update:modelValue",[])},submit:()=>{var e;null==(e=U.value)||e.submit()},abort:e=>{var a;null==(a=U.value)||a.abort(e)}}),(a,t)=>{const d=h,T=n,V=z,q=$;return l(),s("div",j,[o(q,i({ref_key:"uploadRef",ref:U,action:e.uploadUrl,"http-request":e.httpRequest,headers:e.uploadHeaders,data:e.uploadData,accept:e.accept,limit:e.limit,multiple:e.multiple,drag:e.drag,"show-file-list":e.showFileList,"before-upload":I,"on-progress":E,"on-success":M,"on-error":Y,"on-exceed":Z,"on-remove":N,"file-list":H.value},a.$attrs),{default:r(()=>[u(a.$slots,"trigger",{},()=>[e.drag?(l(),s("div",F,[o(T,{class:"upload-icon"},{default:r(()=>[o(f(k))]),_:1}),t[0]||(t[0]=p("div",{class:"upload-text"},[_(" 将文件拖到此处，或"),p("em",null,"点击上传")],-1)),e.accept?(l(),s("div",B," 支持的文件格式："+x(e.accept),1)):m("",!0)])):(l(),c(d,{key:0,type:"primary",icon:f(w)},{default:r(()=>[_(x(e.triggerText),1)]),_:1},8,["icon"]))],!0)]),tip:r(()=>[u(a.$slots,"tip",{},()=>[e.tipText?(l(),s("div",C,[o(T,null,{default:r(()=>[o(f(b))]),_:1}),_(" "+x(e.tipText),1)])):m("",!0)],!0)]),file:r(({file:e})=>[u(a.$slots,"file",{file:e},()=>[p("div",L,[o(T,{class:"file-icon"},{default:r(()=>[o(f(g))]),_:1}),p("span",S,x(e.name),1),"uploading"===e.status?(l(),c(V,{key:0,percentage:e.percentage,"stroke-width":2},null,8,["percentage"])):m("",!0),"success"===e.status?(l(),c(T,{key:1,class:"status-icon success"},{default:r(()=>[o(f(v))]),_:1})):m("",!0),"fail"===e.status?(l(),c(T,{key:2,class:"status-icon error"},{default:r(()=>[o(f(y))]),_:1})):m("",!0)])],!0)]),_:3},16,["action","http-request","headers","data","accept","limit","multiple","drag","show-file-list","file-list"])])}}}),[["__scopeId","data-v-7c33a36b"]]);export{q as D};
