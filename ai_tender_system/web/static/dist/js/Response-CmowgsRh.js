import{_ as e}from"./_plugin-vue_export-helper-BZqs1yfm.js";/* empty css                             */import{E as a}from"./el-link-BuPnVljO.js";import{E as t}from"./el-statistic-DCfNmxCT.js";import"./el-alert-CXP7XODY.js";/* empty css                */import{E as s,a as l}from"./el-form-item-BSZXyn1L.js";import{E as r,a as o}from"./el-col-DR3qk7qZ.js";/* empty css                 *//* empty css               */import{E as n,a as i}from"./el-select-zgwPLghA.js";import"./el-scrollbar-COliMHv4.js";/* empty css                   */import{aZ as u,d,r as c,x as p,L as m,c as v,g as _,B as f,a0 as j,w as h,F as w,aA as g,o as y,a6 as x,aB as b,E as F,e as E,k as I,l as S,t as D,a_ as V,a$ as k,b0 as U}from"./index.js";import"./DocumentPreview.vue_vue_type_style_index_0_scoped_e3ac2352_lang-aAcHzWd0.js";/* empty css                 */import{S as $}from"./SSEStreamViewer-DyLy_mPE.js";import{D as C}from"./DocumentUploader-DhuVAY-9.js";import{D as P}from"./DocumentPreview-Bd_e1FFL.js";import{t as z}from"./tender-CTTmwiee.js";import{u as B}from"./project-ngnLYivh.js";import{E as H}from"./index-ELBiC1Q4.js";import{E as q}from"./index-DzZX4pf4.js";import{E as A}from"./index-Xyju9K6B.js";import{E as M,a as R}from"./index-Co1ZqTs4.js";import"./castArray-pal66jBx.js";import"./_baseClone-DZAH0W8r.js";import"./index-_IbxD8AI.js";import"./strings-DTuDRpJG.js";import"./index-IN6Zpv5z.js";import"./index-CUnJzTFi.js";import"./refs-Cw5r5QN8.js";const W={async processBusinessResponse(e){const a=new FormData;return a.append("company_id",e.company_id.toString()),a.append("project_name",e.project_name),e.tender_no&&a.append("tender_no",e.tender_no),e.date_text&&a.append("date_text",e.date_text),a.append("hitl_file_path",e.hitl_file_path),a.append("use_mcp",!1!==e.use_mcp?"true":"false"),u.post("/process-business-response",a,{headers:{"Content-Type":"multipart/form-data"}})}},L={class:"business-response"},Z={class:"upload-item"},G={class:"upload-item"},N={class:"generation-controls"},O={class:"card-header"},Q={class:"card-header"},T={class:"header-actions"},Y={class:"result-content"},J={class:"stats-section"},K={class:"file-info-section"},X=e(d({__name:"Response",setup(e){const u=B(),d=c({projectId:null,tenderFiles:[],templateFiles:[]}),X=c([]),ee=p(()=>X.value.find(e=>e.id===d.value.projectId)),ae=p(()=>d.value.projectId&&d.value.templateFiles.length>0),te=c(!1),se=c(0),le=c(""),re=c(null),oe=c(!1),ne=async e=>{var a;const{file:t,onSuccess:s,onError:l}=e;if(!d.value.projectId){return l(new Error("è¯·å…ˆé€‰æ‹©é¡¹ç›®")),void g.error("è¯·å…ˆé€‰æ‹©é¡¹ç›®")}if(!(null==(a=ee.value)?void 0:a.company_id)){return l(new Error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸")),void g.error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸")}try{const e=new FormData;e.append("file",t),e.append("company_id",ee.value.company_id.toString()),e.append("project_id",d.value.projectId.toString());const a=await z.parseDocumentStructure(e);if(!a.success)throw new Error(a.message||"ä¸Šä¼ å¤±è´¥");s(a.data),g.success("å•†åŠ¡åº”ç­”æ¨¡æ¿ä¸Šä¼ æˆåŠŸ")}catch(r){l(r),g.error(r.message||"æ¨¡æ¿ä¸Šä¼ å¤±è´¥")}},ie=async e=>{var a;const{file:t,onSuccess:s,onError:l}=e;if(!d.value.projectId){return l(new Error("è¯·å…ˆé€‰æ‹©é¡¹ç›®")),void g.error("è¯·å…ˆé€‰æ‹©é¡¹ç›®")}if(!(null==(a=ee.value)?void 0:a.company_id)){return l(new Error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸")),void g.error("é¡¹ç›®æ²¡æœ‰å…³è”å…¬å¸")}try{const e=new FormData;e.append("file",t),e.append("company_id",ee.value.company_id.toString()),e.append("project_id",d.value.projectId.toString());const a=await z.parseDocumentStructure(e);if(!a.success)throw new Error(a.message||"ä¸Šä¼ å¤±è´¥");s(a.data),g.success("æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ æˆåŠŸ")}catch(r){l(r),g.error(r.message||"æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ å¤±è´¥")}},ue=async()=>{if(re.value=null,le.value="",d.value.projectId){const e=X.value.find(e=>e.id===d.value.projectId);e&&u.setCurrentProject(e),await de(d.value.projectId)}},de=async e=>{var a;try{const t=(await z.getProject(e)).data;if(d.value.tenderFiles=[],d.value.templateFiles=[],!t)return;let s=0,l=!1;if(t.step1_data&&t.step1_data.file_path){const e=t.step1_data;d.value.tenderFiles.push({name:e.file_name||e.original_filename||"æ‹›æ ‡æ–‡æ¡£",url:e.file_path,status:"success",uid:Date.now()+Math.random(),size:e.file_size||0}),s++,l=!0}if(!l&&t.tender_document_path&&(d.value.tenderFiles.push({name:t.original_filename||"æ‹›æ ‡æ–‡æ¡£",url:t.tender_document_path,status:"success",uid:Date.now()+Math.random()}),s++),t.step1_data){const e=t.step1_data;e.response_file_path&&(d.value.templateFiles.push({name:e.response_filename||"å•†åŠ¡åº”ç­”æ¨¡æ¿",url:e.response_file_path,status:"success",uid:Date.now()+Math.random(),size:e.response_file_size||0}),s++)}if(null==(a=t.step1_data)?void 0:a.business_response_file){const e=t.step1_data.business_response_file,a=e.file_path.split("/").pop();re.value={success:!0,outputFile:e.file_path||"",downloadUrl:`/download/${a}`,stats:{},message:"è¯¥é¡¹ç›®å·²æœ‰å•†åŠ¡åº”ç­”æ–‡ä»¶",isHistory:!0},s++}else await pe(t.project_name);s>0&&g.success(`å·²åŠ è½½ ${s} ä¸ªæ–‡ä»¶`)}catch(t){d.value.tenderFiles=[],d.value.templateFiles=[]}},ce=()=>{g.success("æ‹›æ ‡æ–‡æ¡£ä¸Šä¼ æˆåŠŸ")},pe=async e=>{try{const a=await fetch("/api/business-files"),t=await a.json();if(!t.success||!t.files||0===t.files.length)return;const s=t.files.find(a=>a.name.includes(e)||a.name.includes("å•†åŠ¡åº”ç­”"));s&&(re.value={success:!0,outputFile:s.name,downloadUrl:s.download_url,stats:{},message:`æ‰¾åˆ°å†å²å•†åŠ¡åº”ç­”æ–‡ä»¶ï¼ˆ${s.date}ï¼‰`,isHistory:!0},g.success("å·²åŠ è½½å†å²å•†åŠ¡åº”ç­”æ–‡ä»¶"))}catch(a){}},me=()=>{g.success("å•†åŠ¡åº”ç­”æ¨¡æ¿ä¸Šä¼ æˆåŠŸ")},ve=async()=>{var e;if(d.value.projectId)if(0!==d.value.templateFiles.length){te.value=!0,se.value=0,le.value="",re.value=null;try{le.value="æ­£åœ¨åŠ è½½é¡¹ç›®ä¿¡æ¯...\n";const a=(await z.getProject(d.value.projectId)).data,t=null==(e=a.step1_data)?void 0:e.response_file_path;if(!t)throw new Error("æœªæ‰¾åˆ°å•†åŠ¡åº”ç­”æ¨¡æ¿æ–‡ä»¶è·¯å¾„ï¼Œè¯·å…ˆåœ¨æ ‡ä¹¦ç®¡ç†ä¸­ä¸Šä¼ æ¨¡æ¿");le.value+="æ­£åœ¨å¤„ç†å•†åŠ¡åº”ç­”æ–‡æ¡£...\n",se.value=30;const s=await W.processBusinessResponse({company_id:a.company_id,project_name:a.project_name,tender_no:a.project_number||"",date_text:a.bidding_time||"",hitl_file_path:t,use_mcp:!0});se.value=80,le.value+="å¤„ç†å®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆç»“æœ...\n";const l=s.data?s.data:s;if(!l.success)throw new Error(l.message||l.error||"å¤„ç†å¤±è´¥");se.value=100,le.value+=l.message+"\n",re.value={success:!0,outputFile:l.output_file,downloadUrl:l.download_url,stats:l.stats||{},message:l.message},g.success("å•†åŠ¡åº”ç­”ç”Ÿæˆå®Œæˆï¼")}catch(a){le.value+=`\nâŒ é”™è¯¯: ${a.message}\n`,g.error(a.message||"ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{te.value=!1,se.value<100&&(se.value=0)}}else g.warning("è¯·å…ˆä¸Šä¼ å•†åŠ¡åº”ç­”æ¨¡æ¿");else g.warning("è¯·å…ˆé€‰æ‹©é¡¹ç›®")},_e=()=>{te.value=!1,g.info("å·²åœæ­¢ç”Ÿæˆ")},fe=()=>{re.value?re.value.downloadUrl?oe.value=!0:g.warning("æ–‡æ¡£åœ°å€æ— æ•ˆ"):g.warning("æš‚æ— æ–‡æ¡£å¯é¢„è§ˆ")},je=()=>{var e;if(re.value)try{const a=re.value.downloadUrl,t=`å•†åŠ¡åº”ç­”-${(null==(e=ee.value)?void 0:e.project_name)||"æ–‡æ¡£"}-${Date.now()}.docx`,s=document.createElement("a");s.href=a,s.download=t,s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s),g.success("Wordæ–‡æ¡£ä¸‹è½½æˆåŠŸ")}catch(a){g.error("æ–‡æ¡£ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}else g.warning("æš‚æ— æ–‡æ¡£å¯ä¸‹è½½")};return m(async()=>{await(async()=>{var e;try{const a=await z.getProjects({page:1,page_size:100});X.value=(null==(e=a.data)?void 0:e.items)||[]}catch(a){g.error("åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥")}})(),u.currentProject&&u.currentProject.id&&(d.value.projectId=u.currentProject.id,await ue())}),(e,u)=>{var c,p;const m=i,g=n,z=l,B=o,W=F,de=r,pe=s,he=H,we=S,ge=q,ye=A,xe=t,be=M,Fe=a,Ee=R;return y(),v("div",L,[_(he,{class:"project-section",shadow:"never"},{header:h(()=>[...u[4]||(u[4]=[E("div",{class:"card-header"},[E("span",null,"Step 1: é€‰æ‹©é¡¹ç›®")],-1)])]),default:h(()=>[_(pe,{model:d.value,"label-width":"100px"},{default:h(()=>[_(de,{gutter:20},{default:h(()=>[_(B,{span:12},{default:h(()=>[_(z,{label:"é¡¹ç›®"},{default:h(()=>[_(g,{modelValue:d.value.projectId,"onUpdate:modelValue":u[0]||(u[0]=e=>d.value.projectId=e),placeholder:"è¯·é€‰æ‹©é¡¹ç›®",filterable:"",onChange:ue,style:{width:"100%"}},{default:h(()=>[(y(!0),v(x,null,b(X.value,e=>(y(),f(m,{key:e.id,label:`${e.project_name} (${e.project_number||"-"})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),_(B,{span:12},{default:h(()=>[_(z,{label:"å…¬å¸"},{default:h(()=>{var e;return[_(W,{value:(null==(e=ee.value)?void 0:e.company_name)||"-",disabled:""},null,8,["value"])]}),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),d.value.projectId?(y(),f(he,{key:0,class:"upload-section",shadow:"never"},{header:h(()=>[...u[5]||(u[5]=[E("div",{class:"card-header"},[E("span",null,"Step 2: ä¸Šä¼ ç›¸å…³æ–‡æ¡£")],-1)])]),default:h(()=>[_(de,{gutter:20},{default:h(()=>[_(B,{span:12},{default:h(()=>[E("div",Z,[u[6]||(u[6]=E("h4",null,[I("å•†åŠ¡åº”ç­”æ¨¡æ¿ "),E("span",{class:"required"},"*")],-1)),_(w(C),{modelValue:d.value.templateFiles,"onUpdate:modelValue":u[1]||(u[1]=e=>d.value.templateFiles=e),"http-request":ne,accept:".doc,.docx",limit:1,"max-size":20,drag:"","tip-text":"å¿…é¡»ä¸Šä¼ å•†åŠ¡åº”ç­”æ¨¡æ¿ï¼Œç”¨äºç”Ÿæˆåº”ç­”æ–‡æ¡£",onSuccess:me},null,8,["modelValue"])])]),_:1}),_(B,{span:12},{default:h(()=>[E("div",G,[u[7]||(u[7]=E("h4",null,"æ‹›æ ‡æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰",-1)),_(w(C),{modelValue:d.value.tenderFiles,"onUpdate:modelValue":u[2]||(u[2]=e=>d.value.tenderFiles=e),"http-request":ie,accept:".pdf,.doc,.docx",limit:5,"max-size":50,drag:"","tip-text":"å¯é€‰ä¸Šä¼ æ‹›æ ‡æ–‡æ¡£ä½œä¸ºå‚è€ƒï¼Œæ”¯æŒPDFã€Wordæ ¼å¼ï¼Œæœ€å¤§50MB",onSuccess:ce},null,8,["modelValue"])])]),_:1})]),_:1}),E("div",N,[_(we,{type:"primary",size:"large",disabled:!ae.value,loading:te.value,onClick:ve},{default:h(()=>[...u[8]||(u[8]=[I(" å¼€å§‹ç”Ÿæˆå•†åŠ¡åº”ç­” ",-1)])]),_:1},8,["disabled","loading"])])]),_:1})):j("",!0),te.value?(y(),f(he,{key:1,class:"generation-output",shadow:"never"},{header:h(()=>[E("div",O,[u[9]||(u[9]=E("span",null,"AIæ­£åœ¨ç”Ÿæˆå•†åŠ¡åº”ç­”...",-1)),_(ge,{percentage:se.value,status:100===se.value?"success":void 0,style:{width:"300px"}},null,8,["percentage","status"])])]),default:h(()=>[_(w($),{content:le.value,"is-streaming":te.value,onStop:_e,onRegenerate:ve},null,8,["content","is-streaming"])]),_:1})):j("",!0),re.value?(y(),f(he,{key:2,class:"result-section",shadow:"never"},{header:h(()=>[E("div",Q,[E("span",null,D(re.value.isHistory?"ğŸ“„ å†å²åº”ç­”æ–‡ä»¶":"âœ… ç”Ÿæˆç»“æœ"),1),E("div",T,[_(we,{type:"primary",icon:w(V),onClick:fe},{default:h(()=>[...u[10]||(u[10]=[I(" é¢„è§ˆæ–‡æ¡£ ",-1)])]),_:1},8,["icon"]),_(we,{type:"success",icon:w(k),onClick:je},{default:h(()=>[...u[11]||(u[11]=[I(" ä¸‹è½½Wordæ–‡æ¡£ ",-1)])]),_:1},8,["icon"]),_(we,{type:"primary",icon:w(U),onClick:ve},{default:h(()=>[...u[12]||(u[12]=[I(" é‡æ–°ç”Ÿæˆ ",-1)])]),_:1},8,["icon"])])])]),default:h(()=>[E("div",Y,[_(ye,{type:re.value.isHistory?"info":"success",title:re.value.message,closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["type","title"]),E("div",J,[u[17]||(u[17]=E("h4",null,"å¤„ç†ç»Ÿè®¡",-1)),_(de,{gutter:20},{default:h(()=>[_(B,{span:6},{default:h(()=>[_(xe,{title:"æ–‡æœ¬æ›¿æ¢",value:re.value.stats.total_replacements||0},{suffix:h(()=>[...u[13]||(u[13]=[I("å¤„",-1)])]),_:1},8,["value"])]),_:1}),_(B,{span:6},{default:h(()=>[_(xe,{title:"è¡¨æ ¼å¤„ç†",value:re.value.stats.tables_processed||0},{suffix:h(()=>[...u[14]||(u[14]=[I("ä¸ª",-1)])]),_:1},8,["value"])]),_:1}),_(B,{span:6},{default:h(()=>[_(xe,{title:"å•å…ƒæ ¼å¡«å……",value:re.value.stats.cells_filled||0},{suffix:h(()=>[...u[15]||(u[15]=[I("ä¸ª",-1)])]),_:1},8,["value"])]),_:1}),_(B,{span:6},{default:h(()=>[_(xe,{title:"å›¾ç‰‡æ’å…¥",value:re.value.stats.images_inserted||0},{suffix:h(()=>[...u[16]||(u[16]=[I("å¼ ",-1)])]),_:1},8,["value"])]),_:1})]),_:1})]),E("div",K,[u[19]||(u[19]=E("h4",null,"ç”Ÿæˆæ–‡ä»¶",-1)),_(Ee,{column:2,border:""},{default:h(()=>[_(be,{label:"æ–‡ä»¶è·¯å¾„"},{default:h(()=>[I(D(re.value.outputFile),1)]),_:1}),_(be,{label:"ä¸‹è½½åœ°å€"},{default:h(()=>[_(Fe,{href:re.value.downloadUrl,type:"primary"},{default:h(()=>[...u[18]||(u[18]=[I(" ç‚¹å‡»ä¸‹è½½ ",-1)])]),_:1},8,["href"])]),_:1})]),_:1})])])]),_:1})):j("",!0),_(w(P),{modelValue:oe.value,"onUpdate:modelValue":u[3]||(u[3]=e=>oe.value=e),"file-url":null==(c=re.value)?void 0:c.downloadUrl,"file-name":`å•†åŠ¡åº”ç­”-${(null==(p=ee.value)?void 0:p.project_name)||"æ–‡æ¡£"}.docx`},null,8,["modelValue","file-url","file-name"])])}}}),[["__scopeId","data-v-9dc20492"]]);export{X as default};
