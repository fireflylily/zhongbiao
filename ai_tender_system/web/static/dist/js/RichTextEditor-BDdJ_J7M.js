import{p as ue,N,D as de,a9 as fe,a as ve,_ as ge,$ as me,aa as he,P as ye,ab as pe,ac as Te,k as Ee}from"./element-plus-IkZgpaz4.js";import{bT as xe,bt as u,bu as C,bA as U,bG as Re,cg as _e,bU as b,bV as f,c2 as W,bY as n,b$ as S,c6 as H,c0 as r,c8 as l,c5 as m,bv as v,c1 as be,c3 as M,c9 as we,c7 as ke,cC as Ce,bX as Se,bH as A}from"./vendor-CdA3MjAt.js";import{m as Be}from"./umo-editor-BmhDOXHm.js";/* empty css                                                                          */import{_ as Le}from"./index.js";const Oe={class:"editor-header"},Ie={class:"header-left"},Ve={class:"header-actions"},He={class:"editor-body"},Me={class:"outline-sidebar"},ze={class:"outline-header"},De={class:"outline-list"},Pe=["onClick"],$e={class:"outline-text"},Fe={class:"outline-footer"},Ne={class:"editor-main"},Ue={key:0,class:"streaming-indicator"},We=xe({__name:"RichTextEditor",props:{modelValue:{},title:{default:"æ–‡æ¡£ç¼–è¾‘"},height:{default:600},readonly:{type:Boolean,default:!1},streaming:{type:Boolean,default:!1}},emits:["update:modelValue","save","preview","export","ready"],setup(z,{expose:j,emit:q}){const i=z,E=q,o=u(null),s=u(i.modelValue),h=u(!1),B=u(!1),y=u(!1),d=C(()=>i.streaming),L=C(()=>!!s.value&&s.value!=="<p></p>"),G=u(!1),Q=C(()=>({toolbar:{defaultMode:"ribbon"},page:{layouts:["page","web"],defaultMargin:{left:3.18,right:3.18,top:2.54,bottom:2.54},defaultOrientation:"portrait",defaultBackground:"#ffffff",showBreakMarks:!0,showLineNumber:!1,showToc:!0,watermark:{type:"compact",alpha:.2,fontColor:"#000",fontSize:16,fontFamily:"SimSun",fontWeight:"normal",text:""}},document:{enableSpellcheck:!1,readOnly:i.readonly},file:{maxSize:10*1024*1024,allowedMimeTypes:["image/jpeg","image/png","image/gif","image/webp"]},onFileUpload:async e=>(console.log("[RichTextEditor] æ–‡ä»¶ä¸Šä¼ :",e.name,e.type),new Promise((t,a)=>{const T=new FileReader;T.onload=g=>{var c;const V=(c=g.target)==null?void 0:c.result;t({id:`img-${Date.now()}`,url:V})},T.onerror=()=>a(new Error("è¯»å–å¤±è´¥")),T.readAsDataURL(e)})),onFileDelete:e=>(e&&console.log("[RichTextEditor] æ–‡ä»¶åˆ é™¤:",e),!0)})),p=u([]),w=u(!1),O=u(""),I=u(!1);C(()=>y.value?"calc(100vh - 120px)":typeof i.height=="number"?`${i.height}px`:i.height),U(()=>i.modelValue,e=>{e&&e!==s.value&&(s.value=e,h.value=!1,o.value&&k(e))}),U(d,e=>{console.log("[RichTextEditor] æµå¼çŠ¶æ€å˜åŒ–:",e),o.value&&typeof o.value.setReadOnly=="function"&&o.value.setReadOnly(e||i.readonly)});const X=()=>{console.log("[RichTextEditor] âœ… ç¼–è¾‘å™¨åˆ›å»ºå®Œæˆ (@createdäº‹ä»¶)"),setTimeout(()=>{Y()},300),i.modelValue&&setTimeout(()=>{k(i.modelValue)},100),(i.readonly||i.streaming)&&o.value&&typeof o.value.setReadOnly=="function"&&o.value.setReadOnly(!0),E("ready"),console.log("[RichTextEditor] ç¼–è¾‘å™¨å°±ç»ª"),setTimeout(()=>{R()},800)},Y=()=>{if(o.value)try{typeof o.value.setLayout=="function"?(o.value.setLayout("page"),console.log("[RichTextEditor] âœ… å·²åˆ‡æ¢åˆ°åˆ†é¡µæ¨¡å¼"),G.value=!1,setTimeout(()=>{const e=document.querySelector(".umo-editor-container");e&&(e.classList.add("umo-page-mode"),e.classList.remove("umo-continuous-mode"),console.log("[RichTextEditor] å·²æ·»åŠ  umo-page-mode ç±»")),console.log("[RichTextEditor] åˆ†é¡µæ¨¡å¼DOMåº”è¯¥å·²æ›´æ–°")},500)):console.warn("[RichTextEditor] setLayoutæ–¹æ³•ä¸å¯ç”¨")}catch(e){console.error("[RichTextEditor] åˆ‡æ¢åˆ†é¡µæ¨¡å¼å¤±è´¥:",e)}},J=()=>{if(console.log("[RichTextEditor] âœ¨ å†…å®¹å˜åŒ– (@changedäº‹ä»¶)"),!!o.value)try{const e=o.value.getHTML();console.log("[RichTextEditor] å½“å‰å†…å®¹é•¿åº¦:",e.length),console.log("[RichTextEditor] ä¹‹å‰å†…å®¹é•¿åº¦:",s.value.length),e!==s.value?(s.value=e,h.value=!0,console.log("[RichTextEditor] âœ… isDirtyè®¾ç½®ä¸ºtrue"),E("update:modelValue",e),D()):console.log("[RichTextEditor] âš ï¸ å†…å®¹æœªå˜åŒ–ï¼Œä¸æ›´æ–°isDirty")}catch(e){console.error("[RichTextEditor] å¤„ç†å†…å®¹å˜åŒ–å¤±è´¥:",e)}},k=e=>{if(!o.value){console.warn("[RichTextEditor] ç¼–è¾‘å™¨æœªå°±ç»ª");return}try{_(),typeof o.value.setContent=="function"?(o.value.setContent(e),console.log("[RichTextEditor] å†…å®¹å·²æ›´æ–°ï¼Œé•¿åº¦:",e.length),setTimeout(()=>{_()},100)):console.error("[RichTextEditor] setContentæ–¹æ³•ä¸å­˜åœ¨")}catch(t){if(console.error("[RichTextEditor] è®¾ç½®å†…å®¹å¤±è´¥:",t),t.name==="QuotaExceededError"){console.warn("[RichTextEditor] localStorageè¶…é™ï¼Œæ¸…ç†åé‡è¯•"),_();try{o.value.setContent(e)}catch(a){console.error("[RichTextEditor] é‡è¯•ä»ç„¶å¤±è´¥:",a)}}}},K=e=>{if(!o.value){console.warn("[RichTextEditor] ç¼–è¾‘å™¨æœªå°±ç»ªï¼Œå†…å®¹å·²ç¼“å­˜"),s.value+=e;return}try{const a=o.value.getHTML()+e;o.value.setContent(a),s.value=a,console.log("[RichTextEditor] å†…å®¹å·²è¿½åŠ ï¼Œå½“å‰é•¿åº¦:",a.length),A(()=>{Z()}),D()}catch(t){console.error("[RichTextEditor] è¿½åŠ å†…å®¹å¤±è´¥:",t)}},Z=()=>{var e;try{const t=(e=o.value)==null?void 0:e.getEditor();if(t&&t.view){const{dom:a}=t.view;a.scrollTop=a.scrollHeight}}catch(t){console.error("[RichTextEditor] æ»šåŠ¨å¤±è´¥:",t)}};let x=null;const D=()=>{x&&clearTimeout(x),x=window.setTimeout(()=>{R()},500)},R=async()=>{if(o.value){I.value=!0;try{if(typeof o.value.getTableOfContents=="function"){const e=o.value.getTableOfContents();p.value=e||[],console.log("[RichTextEditor] ç›®å½•æ›´æ–°:",p.value.length,"é¡¹",e)}else console.warn("[RichTextEditor] getTableOfContentsæ–¹æ³•ä¸å¯ç”¨"),p.value=[]}catch(e){console.error("[RichTextEditor] è·å–ç›®å½•å¤±è´¥:",e),p.value=[]}finally{I.value=!1}}},ee=e=>{if(e)try{if(e.dom&&typeof e.dom.scrollIntoView=="function"){e.dom.scrollIntoView({behavior:"smooth",block:"start"}),O.value=e.id;return}if(e.id){const t=document.getElementById(e.id);if(t){t.scrollIntoView({behavior:"smooth",block:"start"}),O.value=e.id;return}}console.warn("[RichTextEditor] æ— æ³•æ»šåŠ¨åˆ°æ ‡é¢˜:",e)}catch(t){console.error("[RichTextEditor] æ»šåŠ¨å¤±è´¥:",t)}},te=async()=>{if(!(!h.value||d.value)){B.value=!0;try{E("save",s.value),await A(),h.value=!1}catch(e){console.error("[RichTextEditor] ä¿å­˜å¤±è´¥:",e),Ee.error("ä¿å­˜å¤±è´¥")}finally{B.value=!1}}},oe=()=>{y.value=!y.value,y.value?document.body.style.overflow="hidden":document.body.style.overflow=""},le=()=>{s.value="",k(""),p.value=[],h.value=!1},ae=()=>{try{if(o.value&&typeof o.value.getHTML=="function")return o.value.getHTML()}catch(e){console.error("[RichTextEditor] è·å–å†…å®¹å¤±è´¥:",e)}return s.value},re=e=>{s.value=e,k(e),h.value=!1,setTimeout(()=>{R()},300)},ne=e=>{console.log("[RichTextEditor] è®¾ç½®æµå¼çŠ¶æ€:",e)},P=()=>{var e,t;return(t=(e=o.value)==null?void 0:e.getEditor)==null?void 0:t.call(e)};j({getContent:ae,setContent:re,appendContent:K,clear:le,refreshOutline:R,setStreaming:ne,getEditor:P,insertPageBreak:()=>{try{let e=P();return e&&e.__v_isRef&&(e=e.value),e&&e.commands&&e.commands.setPageBreak?(e.commands.setPageBreak(),console.log("[RichTextEditor] å·²æ’å…¥åŸç”Ÿåˆ†é¡µç¬¦"),!0):(console.warn("[RichTextEditor] setPageBreak å‘½ä»¤ä¸å¯ç”¨"),!1)}catch(e){return console.error("[RichTextEditor] æ’å…¥åˆ†é¡µç¬¦å¤±è´¥:",e),!1}}});const _=()=>{try{const e=Object.keys(localStorage);for(const t of e)t.startsWith("umo-editor:")&&localStorage.removeItem(t)}catch(e){console.error("[RichTextEditor] æ¸…ç†localStorageå¤±è´¥:",e)}},$=localStorage.setItem;let F=!1;const se=()=>{localStorage.setItem=function(e,t){if(e.startsWith("umo-editor:")){F||(console.warn("[RichTextEditor] å·²é˜»æ­¢ Umo Editor å†™å…¥ localStorageï¼ˆå¤§å°:",t.length,"å­—èŠ‚ï¼‰ï¼Œåç»­å°†é™é»˜é˜»æ­¢"),F=!0);return}return $.call(localStorage,e,t)},console.log("[RichTextEditor] localStorage ä¿æŠ¤å·²å¯ç”¨")},ie=()=>{localStorage.setItem=$,console.log("[RichTextEditor] localStorageæ‹¦æˆªå™¨å·²ç§»é™¤")};return Re(()=>{se(),_()}),_e(()=>{y.value&&(document.body.style.overflow=""),x&&clearTimeout(x),ie(),_()}),(e,t)=>{const a=de,T=ue,g=ve,V=ye;return f(),b("div",{class:W(["rich-text-editor",{fullscreen:y.value,streaming:d.value}])},[n("div",Oe,[n("div",Ie,[n("h3",null,"âœï¸ "+H(z.title),1),d.value?(f(),S(T,{key:0,type:"primary",effect:"plain"},{default:r(()=>[l(a,{class:"is-loading"},{default:r(()=>[l(v(N))]),_:1}),t[4]||(t[4]=m(" AIç”Ÿæˆä¸­... ",-1))]),_:1})):h.value?(f(),S(T,{key:1,type:"warning"},{default:r(()=>[...t[5]||(t[5]=[m("æœ‰æœªä¿å­˜çš„ä¿®æ”¹",-1)])]),_:1})):(f(),S(T,{key:2,type:"success"},{default:r(()=>[...t[6]||(t[6]=[m("å·²ä¿å­˜",-1)])]),_:1}))]),n("div",Ve,[l(g,{onClick:oe,size:"small"},{default:r(()=>[l(a,null,{default:r(()=>[l(v(fe))]),_:1}),m(" "+H(y.value?"é€€å‡ºå…¨å±":"å…¨å±ç¼–è¾‘"),1)]),_:1}),l(g,{type:"primary",onClick:t[0]||(t[0]=c=>E("preview")),size:"small",disabled:!L.value||d.value},{default:r(()=>[l(a,null,{default:r(()=>[l(v(ge))]),_:1}),t[7]||(t[7]=m(" é¢„è§ˆWord ",-1))]),_:1},8,["disabled"]),l(g,{type:"success",onClick:t[1]||(t[1]=c=>E("export")),size:"small",disabled:!L.value||d.value},{default:r(()=>[l(a,null,{default:r(()=>[l(v(me))]),_:1}),t[8]||(t[8]=m(" å¯¼å‡ºWord ",-1))]),_:1},8,["disabled"]),l(g,{type:"primary",loading:B.value,disabled:!L.value||d.value,onClick:te,size:"small"},{default:r(()=>[...t[9]||(t[9]=[m(" ä¿å­˜ ",-1)])]),_:1},8,["loading","disabled"])])]),n("div",He,[be(n("div",Me,[n("div",ze,[t[10]||(t[10]=n("h4",null,"ğŸ“‘ ç›®å½•",-1)),l(g,{text:"",size:"small",onClick:R,loading:I.value},{default:r(()=>[l(a,null,{default:r(()=>[l(v(he))]),_:1})]),_:1},8,["loading"])]),n("div",De,[(f(!0),b(ke,null,Ce(p.value,(c,ce)=>(f(),b("div",{key:c.id||ce,class:W(["outline-item",`level-${c.level}`,{active:O.value===c.id}]),onClick:je=>ee(c)},[n("span",$e,H(c.textContent),1)],10,Pe))),128)),p.value.length===0&&!d.value?(f(),S(V,{key:0,description:"æš‚æ— æ ‡é¢˜","image-size":60})):M("",!0)]),n("div",Fe,[l(g,{text:"",size:"small",onClick:t[2]||(t[2]=c=>w.value=!0)},{default:r(()=>[l(a,null,{default:r(()=>[l(v(pe))]),_:1}),t[11]||(t[11]=m(" æŠ˜å ç›®å½• ",-1))]),_:1})])],512),[[we,!w.value]]),w.value?(f(),b("div",{key:0,class:"outline-toggle",onClick:t[3]||(t[3]=c=>w.value=!1)},[l(a,null,{default:r(()=>[l(v(Te))]),_:1}),t[12]||(t[12]=n("span",{class:"toggle-text"},"å±•å¼€ç›®å½•",-1))])):M("",!0),n("div",Ne,[d.value?(f(),b("div",Ue,[l(a,{class:"is-loading"},{default:r(()=>[l(v(N))]),_:1}),t[13]||(t[13]=n("span",null,"AI æ­£åœ¨ç”Ÿæˆå†…å®¹ï¼Œè¯·ç¨å€™...",-1))])):M("",!0),l(v(Be),Se({ref_key:"umoEditorRef",ref:o},Q.value,{onChanged:J,onCreated:X}),null,16)])])],2)}}}),Je=Le(We,[["__scopeId","data-v-a3e1a96e"]]);export{Je as R};
