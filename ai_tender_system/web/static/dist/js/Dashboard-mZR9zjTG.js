import{M as e,N as t,r as a,n as l,d as n,x as o,o as s,w as i,g as c,i as r,e as u,c as d,K as p,O as g,P as v,I as f,s as m,a as y,p as b,l as _,F as h,z as j,t as w,j as k,Q as P}from"./index.js";import{L as S}from"./Loading-Bw-X2_Rb.js";import{P as x,C,E as T}from"./IconButton.vue_vue_type_style_index_0_scoped_628ec5f8_lang-u6gZwdjM.js";import{_ as $}from"./_plugin-vue_export-helper-BCo6x5W8.js";const z={getProjects:async t=>e.get("/tender-projects",t),getProject:async t=>e.get(`/tender-projects/${t}`),createProject:async t=>e.post("/tender-projects",t),updateProject:async(t,a)=>e.put(`/tender-projects/${t}`,a),deleteProject:async t=>e.delete(`/tender-projects/${t}`),async uploadTenderDocument(t,a,l){const n=new FormData;return n.append("file",a),n.append("project_id",t.toString()),e.upload("/upload/tender-document",n,e=>{if(l&&e.total){const t=Math.round(100*e.loaded/e.total);l(t)}})},async uploadBusinessTemplate(t,a,l){const n=new FormData;return n.append("file",a),n.append("project_id",t.toString()),e.upload("/upload/business-template",n,e=>{if(l&&e.total){const t=Math.round(100*e.loaded/e.total);l(t)}})},async uploadTechnicalTemplate(t,a,l){const n=new FormData;return n.append("file",a),n.append("project_id",t.toString()),e.upload("/upload/technical-template",n,e=>{if(l&&e.total){const t=Math.round(100*e.loaded/e.total);l(t)}})},getProjectDocuments:async t=>e.get(`/tender-projects/${t}/documents`),deleteDocument:async t=>e.delete(`/documents/${t}`),downloadDocument:async(t,a,l)=>e.download(`/documents/${t}/download`,a,e=>{if(l&&e.total){const t=Math.round(100*e.loaded/e.total);l(t)}}),startTenderProcessing:async t=>e.post("/tender-processing/start",t),getTaskStatus:async t=>e.get(`/tasks/${t}/status`),cancelTask:async t=>e.post(`/tasks/${t}/cancel`),getTaskResult:async t=>e.get(`/tasks/${t}/result`),getSourceDocuments:async t=>e.get(`/document-merger/source-documents/${t}`),startDocumentMerge:async t=>e.post("/document-merger/merge",t),getMergeTaskResult:async t=>e.get(`/document-merger/tasks/${t}/result`),downloadMergedDocument:async(t,a,l)=>e.download(`/document-merger/tasks/${t}/download`,a,e=>{if(l&&e.total){const t=Math.round(100*e.loaded/e.total);l(t)}}),getHITLTask:async t=>e.get(`/hitl/${t}`),updateHITLTask:async(t,a)=>e.put(`/hitl/${t}`,a),submitHITLReview:async(t,a)=>e.post(`/hitl/${t}/submit`,a),getProjectStatistics:async t=>e.get(`/tender-projects/${t}/statistics`)},D=t("project",()=>{const e=a(null),t=a([]),n=a(!1),o=a(null),s=a({page:1,pageSize:10,total:0}),i=l(()=>{var t;return(null==(t=e.value)?void 0:t.id)||null}),c=l(()=>{var t;return(null==(t=e.value)?void 0:t.name)||""}),r=l(()=>{var t;return(null==(t=e.value)?void 0:t.project_number)||""}),u=l(()=>{var t;return(null==(t=e.value)?void 0:t.status)||null}),d=l(()=>!!e.value),p=l(()=>t.value.length),g=l(()=>t.value.map(e=>({label:`${e.name} (${e.project_number})`,value:e.id}))),v=l(()=>Math.ceil(s.value.total/s.value.pageSize));function f(t){e.value=t,_()}function m(){e.value=null,localStorage.removeItem("current_project")}async function y(e){n.value=!0,o.value=null,(null==e?void 0:e.page)&&(s.value.page=e.page),(null==e?void 0:e.page_size)&&(s.value.pageSize=e.page_size);try{const e=await z.getProjects({page:s.value.page,page_size:s.value.pageSize});e.success&&e.data&&(t.value=e.data.items||e.data,s.value.total=e.data.total||t.value.length)}catch(a){o.value=a.message||"获取项目列表失败"}finally{n.value=!1}}async function b(e){n.value=!0,o.value=null;try{const a=await z.getProject(e);if(a.success&&a.data){const l=t.value.findIndex(t=>t.id===e);return-1!==l&&Object.assign(t.value[l],{name:a.data.name,status:a.data.status,project_number:a.data.project_number}),a.data}return o.value=a.message||"获取项目详情失败",null}catch(a){return o.value=a.message||"获取项目详情失败",null}finally{n.value=!1}}function _(){try{e.value&&localStorage.setItem("current_project",JSON.stringify(e.value))}catch(t){}}return{currentProject:e,projects:t,loading:n,error:o,pagination:s,projectId:i,projectName:c,projectNumber:r,projectStatus:u,hasCurrentProject:d,projectsCount:p,projectsOptions:g,totalPages:v,setCurrentProject:f,setCurrentProjectById:async function(e){n.value=!0,o.value=null;try{const t=await z.getProject(e);return t.success&&t.data?(f(t.data),!0):(o.value=t.message||"获取项目详情失败",!1)}catch(t){return o.value=t.message||"获取项目详情失败",!1}finally{n.value=!1}},clearCurrentProject:m,fetchProjects:y,fetchProject:b,createProject:async function(e){n.value=!0,o.value=null;try{const a=await z.createProject(e);return a.success&&a.data?(t.value.unshift(a.data),s.value.total+=1,a.data):(o.value=a.message||"创建项目失败",null)}catch(a){return o.value=a.message||"创建项目失败",null}finally{n.value=!1}},updateProject:async function(a,l){var s;n.value=!0,o.value=null;try{const n=await z.updateProject(a,l);if(n.success&&n.data){const l=t.value.findIndex(e=>e.id===a);return-1!==l&&Object.assign(t.value[l],n.data),(null==(s=e.value)?void 0:s.id)===a&&(Object.assign(e.value,n.data),_()),!0}return o.value=n.message||"更新项目失败",!1}catch(i){return o.value=i.message||"更新项目失败",!1}finally{n.value=!1}},deleteProject:async function(a){var l;n.value=!0,o.value=null;try{const n=await z.deleteProject(a);return n.success?(t.value=t.value.filter(e=>e.id!==a),s.value.total=Math.max(0,s.value.total-1),(null==(l=e.value)?void 0:l.id)===a&&m(),!0):(o.value=n.message||"删除项目失败",!1)}catch(i){return o.value=i.message||"删除项目失败",!1}finally{n.value=!1}},refreshCurrentProject:async function(){var t;if(!(null==(t=e.value)?void 0:t.id))return;const a=await b(e.value.id);a&&(e.value=a,_())},setPagination:function(e,t){s.value.page=e,s.value.pageSize=t},nextPage:async function(){s.value.page<v.value&&(s.value.page+=1,await y())},prevPage:async function(){s.value.page>1&&(s.value.page-=1,await y())},restoreFromStorage:function(){try{const t=localStorage.getItem("current_project");t&&(e.value=JSON.parse(t))}catch(t){}},saveToStorage:_,$reset:function(){e.value=null,t.value=[],n.value=!1,o.value=null,s.value={page:1,pageSize:10,total:0},localStorage.removeItem("current_project")}}}),I=["disabled"],M=$(n({__name:"IconButton",props:{icon:{default:"bi-question-circle"},tooltip:{default:""},tooltipPlacement:{default:"top"},type:{default:"default"},size:{default:"default"},circle:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},badge:{default:""},badgeMax:{default:99},badgeType:{default:"danger"}},emits:["click"],setup(e,{emit:t}){const a=e,n=t,y=l(()=>({[`icon-button--${a.type}`]:!0,[`icon-button--${a.size}`]:!0,"icon-button--circle":a.circle,"is-disabled":a.disabled,"is-loading":a.loading})),b=l(()=>({large:20,default:18,small:16}[a.size])),_=l(()=>({fontSize:`${b.value}px`}));function h(e){a.disabled||a.loading||n("click",e)}return(t,a)=>{const l=r("el-icon"),n=r("el-badge"),j=r("el-tooltip");return s(),o(j,{content:e.tooltip,placement:e.tooltipPlacement,disabled:!e.tooltip},{default:i(()=>[c(n,{value:e.badge,hidden:!e.badge,max:e.badgeMax,type:e.badgeType},{default:i(()=>[u("button",{class:m(["icon-button",y.value]),disabled:e.disabled||e.loading,onClick:h},[e.loading?(s(),o(l,{key:0,class:"is-loading",size:b.value},{default:i(()=>[(s(),o(p(g(v))))]),_:1},8,["size"])):(s(),d("i",{key:1,class:m([e.icon,"icon-button-icon"]),style:f(_.value)},null,6))],10,I)]),_:1},8,["value","hidden","max","type"])]),_:1},8,["content","placement","disabled"])}}}),[["__scopeId","data-v-628ec5f8"]]),O={class:"dashboard-page"},B={class:"quick-actions"},F=["onClick"],H={class:"action-label"},L={class:"pagination-wrapper"},N={class:"activity-content"},Y=$(n({__name:"Dashboard",setup(e){const t=k(),l=D(),{success:n,error:p,confirm:v}=y(),$=a(!1),I=a(!1),Y=a(!1),q=a({totalProjects:0,inProgressProjects:0,wonThisMonth:0,pendingTasks:0}),A=a([]),R=a(1),J=a(10),U=a(0),E=a([]),K=[{name:"start-tender",label:"开始投标",icon:"bi bi-play-circle-fill",color:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",route:"/tender-management"},{name:"business-response",label:"商务应答",icon:"bi bi-briefcase-fill",color:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",route:"/business-response"},{name:"point-to-point",label:"点对点应答",icon:"bi bi-arrow-left-right",color:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",route:"/point-to-point"},{name:"tech-proposal",label:"技术方案",icon:"bi bi-file-code-fill",color:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",route:"/tech-proposal"},{name:"tender-scoring",label:"标书评分",icon:"bi bi-star-fill",color:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",route:"/tender-scoring"},{name:"knowledge",label:"知识中心",icon:"bi bi-book-fill",color:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)",route:"/knowledge/company-library"}];async function Q(){I.value=!0;try{const e=await z.getProjects({page:R.value,page_size:J.value});e.success&&e.data&&(Array.isArray(e.data)?(A.value=e.data,U.value=e.data.length):e.data.items&&(A.value=e.data.items,U.value=e.data.total||0))}catch(e){p("加载项目列表失败: "+e.message)}finally{I.value=!1}}async function G(){await Q(),n("刷新成功")}function V(){t.push("/tender-management")}function W(e){l.setCurrentProject(e),t.push(`/tender-processing/${e.id}`)}function X(e){J.value=e,R.value=1,Q()}function Z(e){R.value=e,Q()}function ee(e){return{pending:"待处理",in_progress:"进行中",completed:"已完成",won:"已中标",lost:"未中标",archived:"已归档"}[e]||e}function te(e){return{document_upload:"bi bi-file-earmark-arrow-up",business_response:"bi bi-briefcase-fill",tech_proposal:"bi bi-file-code-fill",project_won:"bi bi-trophy-fill",project_lost:"bi bi-x-circle-fill"}[e]||"bi bi-circle-fill"}function ae(e){return e?P(e).format("YYYY-MM-DD HH:mm"):"-"}return b(()=>{!async function(){$.value=!0;try{setTimeout(()=>{q.value={totalProjects:156,inProgressProjects:23,wonThisMonth:8,pendingTasks:12},$.value=!1},500)}catch(e){p("加载统计数据失败: "+e.message),$.value=!1}}(),Q(),async function(){Y.value=!0;try{setTimeout(()=>{E.value=[{id:1,type:"document_upload",description:"上传了招标文档《某市政府采购项目招标文件.pdf》",created_at:new Date(Date.now()-72e5).toISOString()},{id:2,type:"business_response",description:"商务应答文档生成完成",created_at:new Date(Date.now()-18e6).toISOString()},{id:3,type:"tech_proposal",description:"技术方案已提交审核",created_at:new Date(Date.now()-864e5).toISOString()},{id:4,type:"project_won",description:'项目"智慧城市建设项目"中标',created_at:new Date(Date.now()-1728e5).toISOString()}],Y.value=!1},300)}catch(e){p("加载活动记录失败: "+e.message),Y.value=!1}}()}),(e,a)=>{const y=r("el-button"),b=r("el-statistic"),k=r("el-col"),P=r("el-row"),z=r("el-link"),D=r("el-table-column"),le=r("el-tag"),ne=r("el-table"),oe=r("el-pagination"),se=r("el-timeline-item"),ie=r("el-timeline");return s(),d("div",O,[c(g(x),{title:"工作台",description:"欢迎使用AI智能标书生成平台"},{actions:i(()=>[c(y,{type:"primary",icon:"Plus",onClick:V},{default:i(()=>[...a[2]||(a[2]=[_(" 新建项目 ",-1)])]),_:1})]),_:1}),c(P,{gutter:16,class:"kpi-cards"},{default:i(()=>[c(k,{xs:12,sm:12,md:6,lg:6},{default:i(()=>[c(g(C),{shadow:"hover",loading:$.value},{default:i(()=>[c(b,{title:"总项目数",value:q.value.totalProjects},{prefix:i(()=>[...a[3]||(a[3]=[u("i",{class:"bi bi-folder-fill statistic-icon",style:{color:"#409eff"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1}),c(k,{xs:12,sm:12,md:6,lg:6},{default:i(()=>[c(g(C),{shadow:"hover",loading:$.value},{default:i(()=>[c(b,{title:"进行中项目",value:q.value.inProgressProjects},{prefix:i(()=>[...a[4]||(a[4]=[u("i",{class:"bi bi-clock-fill statistic-icon",style:{color:"#e6a23c"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1}),c(k,{xs:12,sm:12,md:6,lg:6},{default:i(()=>[c(g(C),{shadow:"hover",loading:$.value},{default:i(()=>[c(b,{title:"本月中标",value:q.value.wonThisMonth},{prefix:i(()=>[...a[5]||(a[5]=[u("i",{class:"bi bi-trophy-fill statistic-icon",style:{color:"#67c23a"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1}),c(k,{xs:12,sm:12,md:6,lg:6},{default:i(()=>[c(g(C),{shadow:"hover",loading:$.value},{default:i(()=>[c(b,{title:"待处理任务",value:q.value.pendingTasks},{prefix:i(()=>[...a[6]||(a[6]=[u("i",{class:"bi bi-list-task statistic-icon",style:{color:"#f56c6c"}},null,-1)])]),_:1},8,["value"])]),_:1},8,["loading"])]),_:1})]),_:1}),c(g(C),{title:"快捷入口",class:"quick-actions-card"},{default:i(()=>[u("div",B,[(s(),d(h,null,j(K,e=>u("div",{key:e.name,class:"action-item",onClick:a=>function(e){t.push(e.route)}(e)},[u("div",{class:"action-icon",style:f({background:e.color})},[u("i",{class:m(e.icon)},null,2)],4),u("div",H,w(e.label),1)],8,F)),64))])]),_:1}),c(g(C),{title:"进行中的项目",class:"projects-card"},{actions:i(()=>[c(g(M),{icon:"bi-arrow-clockwise",tooltip:"刷新",onClick:G})]),default:i(()=>[I.value?(s(),o(g(S),{key:0,visible:!0,fullscreen:!1,text:"加载项目列表..."})):0===A.value.length?(s(),o(g(T),{key:1,type:"no-data",description:"暂无进行中的项目"},{action:i(()=>[c(y,{type:"primary",onClick:V},{default:i(()=>[...a[7]||(a[7]=[_("创建第一个项目",-1)])]),_:1})]),_:1})):(s(),d(h,{key:2},[c(ne,{data:A.value,stripe:"",style:{width:"100%"}},{default:i(()=>[c(D,{prop:"name",label:"项目名称","min-width":"200"},{default:i(({row:e})=>[c(z,{type:"primary",onClick:t=>W(e)},{default:i(()=>[_(w(e.name),1)]),_:2},1032,["onClick"])]),_:1}),c(D,{prop:"project_number",label:"项目编号",width:"150"}),c(D,{prop:"status",label:"状态",width:"120"},{default:i(({row:e})=>{return[c(le,{type:(t=e.status,{pending:"info",in_progress:"warning",completed:"success",won:"success",lost:"danger",archived:"info"}[t]||"info")},{default:i(()=>[_(w(ee(e.status)),1)]),_:2},1032,["type"])];var t}),_:1}),c(D,{prop:"company_name",label:"关联企业",width:"200"}),c(D,{prop:"created_at",label:"创建时间",width:"180"},{default:i(({row:e})=>[_(w(ae(e.created_at)),1)]),_:1}),c(D,{label:"操作",width:"200",fixed:"right"},{default:i(({row:e})=>[c(g(M),{icon:"bi-eye",type:"primary",tooltip:"查看详情",onClick:t=>W(e)},null,8,["onClick"]),c(g(M),{icon:"bi-play-circle",type:"success",tooltip:"继续处理",onClick:a=>{return n=e,l.setCurrentProject(n),void t.push(`/tender-processing/${n.id}`);var n}},null,8,["onClick"]),c(g(M),{icon:"bi-archive",type:"warning",tooltip:"归档",onClick:t=>async function(e){if(await v(`确定要归档项目"${e.name}"吗?`,"归档项目","归档后项目将不再显示在进行中列表"))try{await l.updateProject(e.id,{status:"archived"}),n("项目已归档"),await Q()}catch(t){p("归档失败: "+t.message)}}(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),u("div",L,[c(oe,{"current-page":R.value,"onUpdate:currentPage":a[0]||(a[0]=e=>R.value=e),"page-size":J.value,"onUpdate:pageSize":a[1]||(a[1]=e=>J.value=e),total:U.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Z},null,8,["current-page","page-size","total"])])],64))]),_:1}),c(g(C),{title:"最近活动",class:"activities-card"},{default:i(()=>[Y.value?(s(),o(g(S),{key:0,visible:!0,fullscreen:!1,text:"加载活动记录..."})):0===E.value.length?(s(),o(g(T),{key:1,type:"no-data",description:"暂无活动记录"})):(s(),o(ie,{key:2},{default:i(()=>[(s(!0),d(h,null,j(E.value,e=>{return s(),o(se,{key:e.id,timestamp:ae(e.created_at),type:(t=e.type,{document_upload:"primary",business_response:"success",tech_proposal:"warning",project_won:"success",project_lost:"danger"}[t]||"primary"),placement:"top"},{default:i(()=>[u("div",N,[u("i",{class:m([te(e.type),"activity-icon"])},null,2),u("span",null,w(e.description),1)])]),_:2},1032,["timestamp","type"]);var t}),128))]),_:1}))]),_:1})])}}}),[["__scopeId","data-v-3261048a"]]);export{Y as default};
