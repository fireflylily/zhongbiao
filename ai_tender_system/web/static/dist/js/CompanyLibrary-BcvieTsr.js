import{K as a,M as e,e as t,ab as l,ac as o,P as s,N as i,O as n,S as r,d,ad as c,ae as p,af as u,ag as m,G as _,q as f}from"./index.js";/* empty css                             *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                                                        */import{E as y,a as v}from"./el-select-DZeK41OH.js";/* empty css                */import{L as w}from"./Loading-BVHBNKFx.js";import{E as g}from"./Empty-D5VnJphi.js";/* empty css                */import{C as h}from"./Card-DjWxEjgq.js";/* empty css                                                                          */import{am as b,an as j,ao as x,aX as k,au as C,ar as E,aw as q,ax as V,as as z,ay as L,aC as D,aq as I,aD as $}from"./editor-CkQC1Uq_.js";/* empty css                   *//* empty css                */import{c as P}from"./company-CHa0NuIL.js";import{C as M}from"./CompanyInfoExtractorDialog-DuC7lRWJ.js";import{E as U}from"./index-CPjPqG6g.js";import{b as F,E as O,a as T}from"./index-Dk4OhDm6.js";import{E as B,a as G}from"./index-Ct_FIOsr.js";import{E as H}from"./index-DzllSHb7.js";import{E as N}from"./index-Jdk3-L3D.js";import"./index-DO7-lxyV.js";import"./strings-DygAwr0H.js";import"./index-C1LY3n9p.js";import"./toNumber-B_atpBHU.js";import"./_baseFindIndex-BTqrMG7V.js";import"./_baseIteratee-CwtmDzoV.js";import"./el-tab-pane-Dwr03H4K.js";import"./raf-BZHcGSIv.js";import"./clamp-HmQ8FArD.js";import"./index-ZlCuKr4C.js";import"./cloneDeep-syPWYH98.js";import"./index-CwhopI9-.js";import"./index-CwbKUXgF.js";import"./index-lVhqCxeU.js";import"./flatMap-D7uPVDtS.js";import"./map-B_SlaKiF.js";import"./_baseEach-V8knk74i.js";const Q={class:"company-library"},S={class:"stats-bar"},A={class:"stat-content"},K={class:"stat-icon"},R={class:"stat-info"},X={class:"stat-value"},Z={class:"stat-content"},J={class:"stat-icon"},W={class:"stat-info"},Y={class:"stat-value"},aa={class:"filter-section"},ea={class:"qualification-progress"},ta={class:"progress-text"},la=f(b({__name:"CompanyLibrary",setup(f){const b=a(),{success:la,error:oa}=e(),sa=j(!1),ia=j([]),na=j({keyword:"",industry:""}),ra=j(!1),da=x(()=>{let a=[...ia.value];if(na.value.keyword){const e=na.value.keyword.toLowerCase();a=a.filter(a=>{var t,l,o;return(null==(t=a.company_name)?void 0:t.toLowerCase().includes(e))||(null==(l=a.social_credit_code)?void 0:l.toLowerCase().includes(e))||(null==(o=a.company_code)?void 0:o.toLowerCase().includes(e))})}return na.value.industry&&(a=a.filter(a=>a.industry_type===na.value.industry)),a}),ca=async()=>{sa.value=!0;try{const a=(await P.getCompanies()).data||[],e=await Promise.all(a.map(async a=>{let e=0;try{const t=await P.getCompanyQualifications(a.company_id);t.data&&(e=Object.keys(t.data).length)}catch(l){}const t=Math.round(e/17*100);return{company_id:a.company_id,company_name:a.company_name||"未命名",company_code:a.company_code||"",social_credit_code:a.social_credit_code||"-",legal_representative:a.legal_representative||"-",registered_capital:a.registered_capital||"-",employee_count:a.employee_count||"-",industry_type:a.industry_type||"",product_count:a.product_count||0,document_count:a.document_count||0,qualification_completed:e,qualification_total:17,qualification_progress:t,created_at:a.created_at||"-",updated_at:a.updated_at||"-",...a}}));ia.value=e}catch(a){oa("加载失败",a instanceof Error?a.message:"未知错误")}finally{sa.value=!1}},pa=()=>{},ua=()=>{na.value.keyword="",na.value.industry=""},ma=()=>{b.push("/knowledge/company/new")},_a=a=>{"manual"===a?b.push("/knowledge/company/new"):"extract"===a&&(ra.value=!0)},fa=a=>{b.push(`/knowledge/company/${a}`)};return k(()=>{ca()}),(a,e)=>{const f=t,j=U,x=n,k=i,ya=v,va=y,wa=d,ga=T,ha=O,ba=F,ja=s,xa=G,ka=H,Ca=N,Ea=B;return E(),C("div",Q,[q("div",S,[V(j,{class:"stat-card"},{default:z(()=>[q("div",A,[q("div",K,[V(f,{size:32,color:"#409eff"},{default:z(()=>[V(L(l))]),_:1})]),q("div",R,[e[3]||(e[3]=q("div",{class:"stat-label"},"总企业数",-1)),q("div",X,D(ia.value.length),1)])])]),_:1}),V(j,{class:"stat-card"},{default:z(()=>[q("div",Z,[q("div",J,[V(f,{size:32,color:"#67c23a"},{default:z(()=>[V(L(o))]),_:1})]),q("div",W,[e[4]||(e[4]=q("div",{class:"stat-label"},"筛选结果",-1)),q("div",Y,D(da.value.length),1)])])]),_:1})]),V(L(h),{title:"企业列表"},{default:z(()=>[q("div",aa,[V(ja,{inline:!0,model:na.value},{default:z(()=>[V(k,{label:"搜索"},{default:z(()=>[V(x,{modelValue:na.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>na.value.keyword=a),placeholder:"搜索企业名称、社会信用代码...",clearable:"",style:{width:"300px"},onInput:pa},{prefix:z(()=>[V(f,null,{default:z(()=>[V(L(r))]),_:1})]),_:1},8,["modelValue"])]),_:1}),V(k,{label:"行业类型"},{default:z(()=>[V(va,{modelValue:na.value.industry,"onUpdate:modelValue":e[1]||(e[1]=a=>na.value.industry=a),placeholder:"全部行业",clearable:"",style:{width:"150px"},onChange:pa},{default:z(()=>[V(ya,{label:"全部行业",value:""}),V(ya,{label:"科技",value:"technology"}),V(ya,{label:"制造业",value:"manufacturing"}),V(ya,{label:"金融",value:"finance"}),V(ya,{label:"教育",value:"education"}),V(ya,{label:"医疗",value:"healthcare"}),V(ya,{label:"零售",value:"retail"}),V(ya,{label:"建筑",value:"construction"}),V(ya,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),V(k,null,{default:z(()=>[V(wa,{onClick:ua},{default:z(()=>[V(f,null,{default:z(()=>[V(L(c))]),_:1}),e[5]||(e[5]=$(" 重置 ",-1))]),_:1})]),_:1}),V(k,{style:{"margin-left":"auto"}},{default:z(()=>[V(ba,{"split-button":"",type:"primary",onClick:ma,onCommand:_a},{dropdown:z(()=>[V(ha,null,{default:z(()=>[V(ga,{command:"manual"},{default:z(()=>[V(f,null,{default:z(()=>[V(L(u))]),_:1}),e[6]||(e[6]=$(" 手动创建 ",-1))]),_:1}),V(ga,{command:"extract",divided:""},{default:z(()=>[V(f,null,{default:z(()=>[V(L(m))]),_:1}),e[7]||(e[7]=$(" 从标书创建 ",-1))]),_:1})]),_:1})]),default:z(()=>[V(f,null,{default:z(()=>[V(L(p))]),_:1}),e[8]||(e[8]=$(" 新建企业 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),V(M,{modelValue:ra.value,"onUpdate:modelValue":e[2]||(e[2]=a=>ra.value=a),onSuccess:fa},null,8,["modelValue"]),sa.value?(E(),I(L(w),{key:0,text:"加载中..."})):da.value.length?(E(),I(Ea,{key:2,data:da.value,stripe:"",style:{width:"100%"}},{default:z(()=>[V(xa,{prop:"company_id",label:"ID",width:"70",fixed:""}),V(xa,{prop:"company_name",label:"企业名称","min-width":"200",fixed:"","show-overflow-tooltip":""}),V(xa,{prop:"social_credit_code",label:"统一社会信用代码",width:"180","show-overflow-tooltip":""}),V(xa,{prop:"legal_representative",label:"法定代表人",width:"120"}),V(xa,{prop:"registered_capital",label:"注册资本",width:"120"}),V(xa,{prop:"employee_count",label:"员工人数",width:"100",align:"center"}),V(xa,{label:"资质完成度",width:"180",align:"center"},{default:z(({row:a})=>{return[q("div",ea,[V(ka,{percentage:a.qualification_progress||0,color:(e=a.qualification_progress||0,e<30?"#f56c6c":e<70?"#e6a23c":"#67c23a"),"stroke-width":8},null,8,["percentage","color"]),q("span",ta,D(a.qualification_completed||0)+"/"+D(a.qualification_total||17),1)])];var e}),_:1}),V(xa,{prop:"product_count",label:"产品数",width:"90",align:"center"},{default:z(({row:a})=>[V(Ca,{size:"small",type:"info"},{default:z(()=>[$(D(a.product_count||0),1)]),_:2},1024)]),_:1}),V(xa,{prop:"document_count",label:"文档数",width:"90",align:"center"},{default:z(({row:a})=>[V(Ca,{size:"small",type:"success"},{default:z(()=>[$(D(a.document_count||0),1)]),_:2},1024)]),_:1}),V(xa,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),V(xa,{prop:"updated_at",label:"更新时间",width:"160","show-overflow-tooltip":""}),V(xa,{label:"操作",width:"220",fixed:"right"},{default:z(({row:a})=>[V(wa,{text:"",type:"primary",size:"small",onClick:e=>(a=>{b.push(`/knowledge/company/${a.company_id}`)})(a)},{default:z(()=>[...e[9]||(e[9]=[$(" 查看详情 ",-1)])]),_:1},8,["onClick"]),V(wa,{text:"",type:"warning",size:"small",onClick:e=>(a=>{b.push(`/knowledge/company/${a.company_id}`)})(a)},{default:z(()=>[...e[10]||(e[10]=[$(" 编辑 ",-1)])]),_:1},8,["onClick"]),V(wa,{text:"",type:"danger",size:"small",onClick:e=>(async a=>{try{await _.confirm(`确定要删除企业 "${a.company_name}" 吗？此操作将同时删除企业的所有产品和文档，且不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await P.deleteCompany(a.company_id),la("删除成功",`已删除企业: ${a.company_name}`),await ca()}catch(e){oa("删除失败",e instanceof Error?e.message:"未知错误")}})(a)},{default:z(()=>[...e[11]||(e[11]=[$(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(E(),I(L(g),{key:1,type:"no-data",description:"暂无企业数据"}))]),_:1})])}}}),[["__scopeId","data-v-af62fee0"]]);export{la as default};
