import{T as e,a6 as t,_ as s,u as a,aA as i,w as l,i as r,q as n}from"./index.js";import{am as o,ao as u,aH as c,au as f,ar as p,av as d,aw as y,aB as m,ay as v,aP as x,aD as h,aC as g,aT as _,an as b,ax as S,as as w,az as k,aA as j,aq as F,bL as E}from"./editor-CkQC1Uq_.js";/* empty css                             *//* empty css                                                                          */import{E as L,a as $}from"./index-CwhopI9-.js";const R=e({decimalSeparator:{type:String,default:"."},groupSeparator:{type:String,default:","},precision:{type:Number,default:0},formatter:Function,value:{type:t([Number,Object]),default:0},prefix:String,suffix:String,title:String,valueStyle:{type:t([String,Object,Array])}}),T=o({name:"ElStatistic"});const C=l(s(o({...T,props:R,setup(e,{expose:t}){const s=e,l=a("statistic"),r=u(()=>{const{value:e,formatter:t,precision:a,decimalSeparator:l,groupSeparator:r}=s;if(c(t))return t(e);if(!i(e)||Number.isNaN(e))return e;let[n,o=""]=String(e).split(".");return o=o.padEnd(a,"0").slice(0,a>0?a:0),n=n.replace(/\B(?=(\d{3})+(?!\d))/g,r),[n,o].join(o?l:"")});return t({displayValue:r}),(e,t)=>(p(),f("div",{class:m(v(l).b())},[e.$slots.title||e.title?(p(),f("div",{key:0,class:m(v(l).e("head"))},[x(e.$slots,"title",{},()=>[h(g(e.title),1)])],2)):d("v-if",!0),y("div",{class:m(v(l).e("content"))},[e.$slots.prefix||e.prefix?(p(),f("div",{key:0,class:m(v(l).e("prefix"))},[x(e.$slots,"prefix",{},()=>[y("span",null,g(e.prefix),1)])],2)):d("v-if",!0),y("span",{class:m(v(l).e("number")),style:_(e.valueStyle)},g(v(r)),7),e.$slots.suffix||e.suffix?(p(),f("div",{key:1,class:m(v(l).e("suffix"))},[x(e.$slots,"suffix",{},()=>[y("span",null,g(e.suffix),1)])],2)):d("v-if",!0)],2)],2))}}),[["__file","statistic.vue"]]));function H(e={}){const{onFileLoaded:t,onFileCancelled:s,onSyncSuccess:a}=e,i=b(!1),l=b(null),n=b(!1),o=b(!1),c=u(()=>!!l.value),f=e=>({technicalFile:"技术需求文件",tenderFile:"招标文档",templateFile:"应答模板",businessResponseFile:"商务应答文件",p2pResponseFile:"点对点应答文件",techProposalFile:"技术方案文件"}[e]||"文件");return{useHitlFile:i,hitlFileInfo:l,hasHitlFile:c,syncing:n,synced:o,loadFromHITL:(e,s="technicalFile")=>{const a=e[s];return a?(l.value={filename:a.filename||a.name||"未知文件",file_path:a.file_path||a.url||"",file_size:a.file_size||a.size,file_url:a.file_url||a.url},i.value=!0,o.value=!1,t&&t(l.value),!0):(r.warning(`当前项目没有${f(s)}`),!1)},cancelHitlFile:()=>{i.value=!1,l.value=null,o.value=!1,s&&s()},syncToHitl:async(e,t,s)=>{if(!e)return r.error("项目ID无效"),!1;if(!t)return r.error("文件路径无效"),!1;n.value=!0;try{const i=await fetch(`/api/tender-processing/sync-file/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,file_type:s})}),l=i.headers.get("content-type");if(!(null==l?void 0:l.includes("application/json"))){await i.text();throw new Error(`服务器返回异常响应 (${i.status}): ${i.statusText}。可能是后端配置问题，请联系管理员。`)}const n=await i.json();if(n.success||i.ok)return o.value=!0,r.success({message:n.message||"已成功同步到投标项目",duration:3e3}),a&&await a(),!0;throw new Error(n.error||n.message||"同步失败")}catch(i){let e="同步到项目失败";return i.message?e=i.message:"TypeError"===i.name&&(e="网络请求失败，请检查网络连接"),r.error({message:e,duration:5e3}),!1}finally{n.value=!1}},resetSyncStatus:()=>{o.value=!1}}}const O={class:"stats-card"},U={key:0,class:"stats-title"},I={class:"stat-item"},N={class:"stat-prefix"},z={class:"stat-suffix"},P=n(o({__name:"StatsCard",props:{title:{},stats:{},statItems:{},span:{default:6},gutter:{default:20},valueStyle:{default:()=>({})}},setup(e){const t=e,s=[{key:"total_replacements",label:"文本替换",suffix:"处"},{key:"tables_processed",label:"表格处理",suffix:"个"},{key:"cells_filled",label:"单元格填充",suffix:"个"},{key:"images_inserted",label:"图片插入",suffix:"张"}],a=u(()=>t.statItems||s),i=e=>{const s=e.split(".");let a=t.stats;for(const t of s)if(a=null==a?void 0:a[t],null==a)break;return"number"==typeof a?a:0};return(t,s)=>{const l=C,r=$,n=L;return p(),f("div",O,[e.title?(p(),f("h4",U,g(e.title),1)):d("",!0),S(n,{gutter:e.gutter},{default:w(()=>[(p(!0),f(k,null,j(a.value,t=>(p(),F(r,{key:t.key,span:e.span},{default:w(()=>[y("div",I,[S(l,{title:t.label,value:i(t.key),precision:t.precision,"value-style":e.valueStyle},E({_:2},[t.prefix?{name:"prefix",fn:w(()=>[y("span",N,g(t.prefix),1)]),key:"0"}:void 0,t.suffix?{name:"suffix",fn:w(()=>[y("span",z,g(t.suffix),1)]),key:"1"}:void 0]),1032,["title","value","precision","value-style"])])]),_:2},1032,["span"]))),128))]),_:1},8,["gutter"])])}}}),[["__scopeId","data-v-a61794d1"]]);async function A(e,t){if("string"!=typeof e){const s=URL.createObjectURL(e),a=document.createElement("a");return a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),void URL.revokeObjectURL(s)}try{const s=await fetch(e);if(!s.ok){const e=s.headers.get("content-type");if(e&&e.includes("application/json")){const e=await s.json();throw new Error(e.error||e.message||"文件下载失败")}throw new Error(`文件下载失败: HTTP ${s.status}`)}const a=s.headers.get("content-type");if(a&&(a.includes("text/html")||a.includes("application/json")))throw new Error("服务器返回了错误页面，而不是文件");const i=await s.blob(),l=URL.createObjectURL(i),r=document.createElement("a");r.href=l,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)}catch(s){throw s}}export{P as S,A as d,H as u};
