import{E as e,m as a,n as t,y as l,o,z as n,A as s,B as i,C as u,D as r,_ as d}from"./index.js";/* empty css                                                                          *//* empty css               */import{ax as c,am as v,an as m,ay as f,aX as p,aY as y,aD as h,aA as g,aO as _,aP as b,az as C,aR as w,aB as S,aF as k,aS as z,aG as x,aE as T,aV as N,aW as I,aK as O,aH as U,aI as E}from"./editor-6w6Zv5fp.js";import{E as j}from"./index-Cdh5ckaS.js";import{E as R}from"./index-y0eMMvEO.js";const B={class:"editor-header"},V={class:"header-left"},L={class:"header-actions"},A={class:"editor-body"},M={key:0,class:"outline-sidebar"},P={class:"outline-header"},F={class:"outline-list"},H=["onClick"],W={class:"outline-text"},D={class:"outline-footer"},$={class:"editor-main"},G={key:0,class:"streaming-indicator"},q=d(c({__name:"RichTextEditor",props:{modelValue:{},title:{default:"æ–‡æ¡£ç¼–è¾‘"},height:{default:600},readonly:{type:Boolean,default:!1},streaming:{type:Boolean,default:!1},showOutline:{type:Boolean,default:!0},companyId:{},projectName:{}},emits:["update:modelValue","save","preview","export","ready"],setup(d,{expose:c,emit:q}){const J=d,K=q,Q=v(null),X=v(J.modelValue),Y=v(!1),Z=v(!1),ee=v(!1),ae=m(()=>J.streaming),te=m(()=>!!X.value&&"<p></p>"!==X.value),le=v(!1),oe=m(()=>({toolbar:{defaultMode:"ribbon"},page:{layouts:["page","web"],defaultMargin:{left:3.18,right:3.18,top:2.54,bottom:2.54},defaultOrientation:"portrait",defaultBackground:"#ffffff",showBreakMarks:!0,showLineNumber:!1,showToc:!1,watermark:{type:"compact",alpha:.2,fontColor:"#000",fontSize:16,fontFamily:"SimSun",fontWeight:"normal",text:""}},document:{enableSpellcheck:!1,readOnly:J.readonly},file:{maxSize:10485760,allowedMimeTypes:["image/jpeg","image/png","image/gif","image/webp"]},onFileUpload:async e=>new Promise((a,t)=>{const l=new FileReader;l.onload=e=>{var t;const l=null==(t=e.target)?void 0:t.result;a({id:`img-${Date.now()}`,url:l})},l.onerror=()=>t(new Error("è¯»å–å¤±è´¥")),l.readAsDataURL(e)}),onFileDelete:e=>!0,ai:{assistant:{enabled:!0,commands:[{label:{en_US:"Auto Fill",zh_CN:"æ™ºèƒ½å¡«å†™"},value:{en_US:"auto_fill",zh_CN:"auto_fill"}},{label:{en_US:"Generate Table",zh_CN:"ç”Ÿæˆè¡¨æ ¼"},value:{en_US:"generate_table",zh_CN:"generate_table"}},{label:{en_US:"Rewrite",zh_CN:"é‡å†™"},value:{en_US:"rewrite",zh_CN:"rewrite"}},{label:{en_US:"Expansion",zh_CN:"æ‰©å†™"},value:{en_US:"expand",zh_CN:"expand"}},{label:{en_US:"Summarize",zh_CN:"æ€»ç»“"},value:{en_US:"summarize",zh_CN:"summarize"}},{label:{en_US:"Polish",zh_CN:"æ¶¦è‰²"},value:{en_US:"polish",zh_CN:"polish"}},{label:{en_US:"Translate",zh_CN:"ç¿»è¯‘"},value:{en_US:"translate",zh_CN:"translate"}}],onMessage:async(a,t)=>{try{const{command:t,lang:l,input:o,output:n}=a,s=await fetch("/api/editor/ai-assistant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:t,input:o,output:n,lang:l,company_id:J.companyId||1,project_name:J.projectName||""})});if(!s.ok)throw new Error("AI è¯·æ±‚å¤±è´¥");const i=await s.json();return i.success?i.content:(e.error(i.error||"AI ç”Ÿæˆå¤±è´¥"),o)}catch(l){return e.error("AI åŠ©æ‰‹è°ƒç”¨å¤±è´¥: "+l.message),a.input}}}}})),ne=v([]),se=v(!1),ie=v(""),ue=v(!1);m(()=>ee.value?"calc(100vh - 120px)":"number"==typeof J.height?`${J.height}px`:J.height),f(()=>J.modelValue,e=>{e&&e!==X.value&&(X.value=e,Y.value=!1,Q.value&&ve(e))}),f(ae,e=>{Q.value&&"function"==typeof Q.value.setReadOnly&&Q.value.setReadOnly(e||J.readonly)});const re=()=>{setTimeout(()=>{de()},300),J.modelValue&&setTimeout(()=>{ve(J.modelValue)},100),(J.readonly||J.streaming)&&Q.value&&"function"==typeof Q.value.setReadOnly&&Q.value.setReadOnly(!0),K("ready"),setTimeout(()=>{ye()},800)},de=()=>{if(Q.value)try{"function"==typeof Q.value.setLayout&&(Q.value.setLayout("page"),le.value=!1,setTimeout(()=>{const e=document.querySelector(".umo-editor-container");e&&(e.classList.add("umo-page-mode"),e.classList.remove("umo-continuous-mode"))},500))}catch(e){}},ce=()=>{if(Q.value)try{const e=Q.value.getHTML();e!==X.value&&(X.value=e,Y.value=!0,K("update:modelValue",e),pe())}catch(e){}},ve=e=>{if(Q.value)try{be(),"function"==typeof Q.value.setContent&&(Q.value.setContent(e),setTimeout(()=>{be()},100))}catch(a){if("QuotaExceededError"===a.name){be();try{Q.value.setContent(e)}catch(t){}}}},me=()=>{var e;try{const a=null==(e=Q.value)?void 0:e.getEditor();if(a&&a.view){const{dom:e}=a.view;e.scrollTop=e.scrollHeight}}catch(a){}};let fe=null;const pe=()=>{fe&&clearTimeout(fe),fe=window.setTimeout(()=>{ye()},500)},ye=async()=>{if(Q.value&&J.showOutline){ue.value=!0;try{if("function"==typeof Q.value.getTableOfContents){const e=Q.value.getTableOfContents();ne.value=e||[]}else ne.value=[]}catch(e){ne.value=[]}finally{ue.value=!1}}},he=async()=>{if(Y.value&&!ae.value){Z.value=!0;try{K("save",X.value),await E(),Y.value=!1}catch(a){e.error("ä¿å­˜å¤±è´¥")}finally{Z.value=!1}}},ge=()=>{ee.value=!ee.value,ee.value?document.body.style.overflow="hidden":document.body.style.overflow=""},_e=()=>{var e,a;return null==(a=null==(e=Q.value)?void 0:e.getEditor)?void 0:a.call(e)};c({getContent:()=>{try{if(Q.value&&"function"==typeof Q.value.getHTML)return Q.value.getHTML()}catch(e){}return X.value},setContent:e=>{X.value=e,ve(e),Y.value=!1,setTimeout(()=>{ye()},300)},appendContent:e=>{if(Q.value)try{const a=Q.value.getHTML()+e;Q.value.setContent(a),X.value=a,E(()=>{me()}),pe()}catch(a){}else X.value+=e},clear:()=>{X.value="",ve(""),ne.value=[],Y.value=!1},refreshOutline:ye,setStreaming:e=>{},getEditor:_e,insertPageBreak:()=>{try{let e=_e();return e&&e.__v_isRef&&(e=e.value),!!(e&&e.commands&&e.commands.setPageBreak)&&(e.commands.setPageBreak(),!0)}catch(e){return!1}}});const be=()=>{try{const e=Object.keys(localStorage);for(const a of e)a.startsWith("umo-editor:")&&localStorage.removeItem(a)}catch(e){}},Ce=localStorage.setItem;let we=!1;return p(()=>{localStorage.setItem=function(e,a){if(!e.startsWith("umo-editor:"))return Ce.call(localStorage,e,a);we||(we=!0)},be()}),y(()=>{ee.value&&(document.body.style.overflow=""),fe&&clearTimeout(fe),localStorage.setItem=Ce,be()}),(e,c)=>{const v=t,m=j,f=o,p=R;return g(),h("div",{class:_(["rich-text-editor",{fullscreen:ee.value,streaming:ae.value}])},[b("div",B,[b("div",V,[b("h3",null,"âœï¸ "+w(d.title),1),ae.value?(g(),C(m,{key:0,type:"primary",effect:"plain"},{default:S(()=>[k(v,{class:"is-loading"},{default:S(()=>[k(x(a))]),_:1}),c[4]||(c[4]=z(" AIç”Ÿæˆä¸­... ",-1))]),_:1})):Y.value?(g(),C(m,{key:1,type:"warning"},{default:S(()=>[...c[5]||(c[5]=[z("æœ‰æœªä¿å­˜çš„ä¿®æ”¹",-1)])]),_:1})):(g(),C(m,{key:2,type:"success"},{default:S(()=>[...c[6]||(c[6]=[z("å·²ä¿å­˜",-1)])]),_:1}))]),b("div",L,[k(f,{onClick:ge,size:"small"},{default:S(()=>[k(v,null,{default:S(()=>[k(x(l))]),_:1}),z(" "+w(ee.value?"é€€å‡ºå…¨å±":"å…¨å±ç¼–è¾‘"),1)]),_:1}),k(f,{type:"primary",onClick:c[0]||(c[0]=e=>K("preview")),size:"small",disabled:!te.value||ae.value},{default:S(()=>[k(v,null,{default:S(()=>[k(x(n))]),_:1}),c[7]||(c[7]=z(" é¢„è§ˆWord ",-1))]),_:1},8,["disabled"]),k(f,{type:"success",onClick:c[1]||(c[1]=e=>K("export")),size:"small",disabled:!te.value||ae.value},{default:S(()=>[k(v,null,{default:S(()=>[k(x(s))]),_:1}),c[8]||(c[8]=z(" å¯¼å‡ºWord ",-1))]),_:1},8,["disabled"]),k(f,{type:"primary",loading:Z.value,disabled:!te.value||ae.value,onClick:he,size:"small"},{default:S(()=>[...c[9]||(c[9]=[z(" ä¿å­˜ ",-1)])]),_:1},8,["loading","disabled"])])]),b("div",A,[d.showOutline&&!se.value?(g(),h("div",M,[b("div",P,[c[10]||(c[10]=b("h4",null,"ğŸ“‘ ç›®å½•",-1)),k(f,{text:"",size:"small",onClick:ye,loading:ue.value},{default:S(()=>[k(v,null,{default:S(()=>[k(x(i))]),_:1})]),_:1},8,["loading"])]),b("div",F,[(g(!0),h(N,null,I(ne.value,(e,a)=>(g(),h("div",{key:e.id||a,class:_(["outline-item",`level-${e.level}`,{active:ie.value===e.id}]),onClick:a=>(e=>{if(e)try{if(e.dom&&"function"==typeof e.dom.scrollIntoView)return e.dom.scrollIntoView({behavior:"smooth",block:"start"}),void(ie.value=e.id);if(e.id){const a=document.getElementById(e.id);if(a)return a.scrollIntoView({behavior:"smooth",block:"start"}),void(ie.value=e.id)}}catch(a){}})(e)},[b("span",W,w(e.textContent),1)],10,H))),128)),0!==ne.value.length||ae.value?T("",!0):(g(),C(p,{key:0,description:"æš‚æ— æ ‡é¢˜","image-size":60}))]),b("div",D,[k(f,{text:"",size:"small",onClick:c[2]||(c[2]=e=>se.value=!0)},{default:S(()=>[k(v,null,{default:S(()=>[k(x(u))]),_:1}),c[11]||(c[11]=z(" æŠ˜å ç›®å½• ",-1))]),_:1})])])):T("",!0),d.showOutline&&se.value?(g(),h("div",{key:1,class:"outline-toggle",onClick:c[3]||(c[3]=e=>se.value=!1)},[k(v,null,{default:S(()=>[k(x(r))]),_:1}),c[12]||(c[12]=b("span",{class:"toggle-text"},"å±•å¼€ç›®å½•",-1))])):T("",!0),b("div",$,[ae.value?(g(),h("div",G,[k(v,{class:"is-loading"},{default:S(()=>[k(x(a))]),_:1}),c[13]||(c[13]=b("span",null,"AI æ­£åœ¨ç”Ÿæˆå†…å®¹ï¼Œè¯·ç¨å€™...",-1))])):T("",!0),k(x(U),O({ref_key:"umoEditorRef",ref:Q},oe.value,{onChanged:ce,onCreated:re}),null,16)])])],2)}}}),[["__scopeId","data-v-9ca8f464"]]);export{q as R};
