<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…ç†æµè§ˆå™¨å­˜å‚¨</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    }
    h1 {
      color: #409EFF;
      margin-top: 0;
    }
    button {
      background: #409EFF;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 12px;
    }
    button:hover {
      background: #66b1ff;
    }
    button.danger {
      background: #F56C6C;
    }
    button.danger:hover {
      background: #f78989;
    }
    .result {
      margin-top: 20px;
      padding: 12px;
      border-radius: 4px;
      background: #f0f9ff;
      border-left: 4px solid #409EFF;
    }
    .success {
      background: #f0f9ff;
      border-color: #67C23A;
    }
    .warning {
      background: #fdf6ec;
      border-color: #E6A23C;
    }
    ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    li {
      margin: 5px 0;
      font-family: monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§¹ æ¸…ç†æµè§ˆå™¨å­˜å‚¨</h1>
    <p>Umo Editoré»˜è®¤ä¼šå°†æ–‡æ¡£ä¿å­˜åˆ°localStorageï¼Œå½“æ–‡æ¡£è¿‡å¤§æ—¶ä¼šå¯¼è‡´"QuotaExceededError"é”™è¯¯ã€‚</p>
    <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ¸…ç†å­˜å‚¨ï¼š</p>

    <button onclick="clearUmoStorage()">æ¸…ç†Umo Editorå­˜å‚¨</button>
    <button class="danger" onclick="clearAllStorage()">æ¸…ç©ºæ‰€æœ‰localStorage</button>

    <div id="result"></div>
  </div>

  <script>
    function clearUmoStorage() {
      const result = document.getElementById('result');
      const keys = Object.keys(localStorage);
      const umoKeys = keys.filter(key => key.startsWith('umo-editor:'));

      if (umoKeys.length === 0) {
        result.innerHTML = '<div class="result warning"><strong>âš ï¸ æ²¡æœ‰æ‰¾åˆ°Umo Editoræ•°æ®</strong><p>localStorageå·²ç»æ˜¯å¹²å‡€çš„ã€‚</p></div>';
        return;
      }

      const deletedKeys = [];
      umoKeys.forEach(key => {
        try {
          localStorage.removeItem(key);
          deletedKeys.push(key);
        } catch (e) {
          console.error('åˆ é™¤å¤±è´¥:', key, e);
        }
      });

      result.innerHTML = `
        <div class="result success">
          <strong>âœ… æ¸…ç†å®Œæˆ</strong>
          <p>å·²åˆ é™¤ ${deletedKeys.length} é¡¹æ•°æ®ï¼š</p>
          <ul>
            ${deletedKeys.map(key => `<li>${key}</li>`).join('')}
          </ul>
          <p style="margin-top: 16px; color: #67C23A;">
            <strong>è¯·åˆ·æ–°é¡µé¢ï¼ˆCtrl+Shift+Rï¼‰ä»¥ç”Ÿæ•ˆ</strong>
          </p>
        </div>
      `;
    }

    function clearAllStorage() {
      if (!confirm('âš ï¸ è¿™å°†æ¸…ç©ºæ‰€æœ‰localStorageæ•°æ®ï¼ŒåŒ…æ‹¬ç™»å½•çŠ¶æ€ç­‰ã€‚\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
        return;
      }

      const count = Object.keys(localStorage).length;
      localStorage.clear();

      document.getElementById('result').innerHTML = `
        <div class="result success">
          <strong>âœ… å·²æ¸…ç©ºæ‰€æœ‰localStorage</strong>
          <p>å…±åˆ é™¤ ${count} é¡¹æ•°æ®</p>
          <p style="margin-top: 16px; color: #67C23A;">
            <strong>è¯·åˆ·æ–°é¡µé¢ï¼ˆCtrl+Shift+Rï¼‰ä»¥ç”Ÿæ•ˆ</strong>
          </p>
        </div>
      `;
    }

    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰å­˜å‚¨çŠ¶æ€
    window.onload = () => {
      const keys = Object.keys(localStorage);
      const umoKeys = keys.filter(key => key.startsWith('umo-editor:'));

      if (umoKeys.length > 0) {
        const totalSize = umoKeys.reduce((sum, key) => {
          return sum + (localStorage.getItem(key)?.length || 0);
        }, 0);

        document.getElementById('result').innerHTML = `
          <div class="result warning">
            <strong>âš ï¸ æ£€æµ‹åˆ° ${umoKeys.length} é¡¹Umo Editoræ•°æ®</strong>
            <p>å ç”¨ç©ºé—´ï¼šçº¦ ${(totalSize / 1024).toFixed(2)} KB</p>
            <p>å»ºè®®ç‚¹å‡»"æ¸…ç†Umo Editorå­˜å‚¨"æŒ‰é’®æ¸…ç†</p>
          </div>
        `;
      }
    };
  </script>
</body>
</html>
