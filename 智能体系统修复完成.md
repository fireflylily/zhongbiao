# æ™ºèƒ½ä½“ç³»ç»Ÿä¿®å¤å®ŒæˆæŠ¥å‘Š

## ä¿®å¤æ—¶é—´
2025-12-20 14:00-14:10

## ä¿®å¤å†…å®¹

### âœ… é—®é¢˜1: LLMè°ƒç”¨æ–¹æ³•ä¿®å¤

**é—®é¢˜**: æ™ºèƒ½ä½“ä½¿ç”¨äº†ä¸å­˜åœ¨çš„ `self.llm_client.chat()` æ–¹æ³•

**ä¿®å¤æ–¹æ¡ˆ**:
1. åœ¨ BaseAgent ä¸­æ–°å¢ `_call_llm()` ç»Ÿä¸€æ–¹æ³•
2. æ‰€æœ‰æ™ºèƒ½ä½“é€šè¿‡ `self._call_llm()` è°ƒç”¨LLM
3. è‡ªåŠ¨å¤„ç†JSONæ ¼å¼è¦æ±‚

**ä¿®æ”¹æ–‡ä»¶**:
- `agents/base_agent.py` - æ–°å¢ `_call_llm()` æ–¹æ³•
- `agents/scoring_point_agent.py` - 3å¤„ä¿®å¤
- `agents/requirement_response_agent.py` - 1å¤„ä¿®å¤
- `agents/template_agent.py` - 2å¤„ä¿®å¤

**ä»£ç ç¤ºä¾‹**:
```python
# BaseAgentä¸­çš„ç»Ÿä¸€LLMè°ƒç”¨æ–¹æ³•
def _call_llm(self, prompt: str, response_format: str = None) -> str:
    """è°ƒç”¨LLM"""
    if response_format == "json_object":
        prompt = prompt + "\n\nè¯·ä¸¥æ ¼æŒ‰ç…§JSONæ ¼å¼è¿”å›ï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡æœ¬ã€‚"

    return self.llm_client.call(
        prompt=prompt,
        temperature=self.llm_client.temperature if hasattr(self.llm_client, 'temperature') else 0.7,
        purpose=f"{self.__class__.__name__} è°ƒç”¨"
    )
```

### âœ… é—®é¢˜2: æç¤ºè¯åŠ è½½è·¯å¾„ä¿®å¤

**é—®é¢˜**: æç¤ºè¯æ–‡ä»¶åœ¨ `prompts/agent_prompts/` å­ç›®å½•ï¼ŒPromptManager æ— æ³•ç›´æ¥åŠ è½½

**ä¿®å¤æ–¹æ¡ˆ**:
- æ›´æ–° BaseAgent çš„ `_get_prompt()` æ–¹æ³•
- æ”¯æŒä» `prompts/agent_prompts/` åŠ è½½æ™ºèƒ½ä½“ä¸“ç”¨æç¤ºè¯
- å›é€€æœºåˆ¶ï¼šå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä½¿ç”¨ PromptManager

**ä»£ç ç¤ºä¾‹**:
```python
def _get_prompt(self, module: str, prompt_key: str, **kwargs) -> str:
    """ä» prompts/agent_prompts/ åŠ è½½æç¤ºè¯"""
    prompts_dir = Path(__file__).parent.parent.parent.parent / "prompts"
    agent_prompts_file = prompts_dir / "agent_prompts" / f"{module}.json"

    if agent_prompts_file.exists():
        with open(agent_prompts_file, 'r', encoding='utf-8') as f:
            config = json.load(f)
            template = config.get('prompts', {}).get(prompt_key, ...)
    else:
        # å›é€€åˆ° PromptManager
        template = self.prompt_manager.get_prompt(module, prompt_key, ...)

    # æ ¼å¼åŒ–å¹¶è¿”å›
    return template.format(**kwargs) if kwargs else template
```

### âœ… é—®é¢˜3: Temperatureå‚æ•°å…¼å®¹æ€§ä¿®å¤

**é—®é¢˜**: æŸäº›æ¨¡å‹ï¼ˆå¦‚gpt-4o-miniï¼‰ä¸æ”¯æŒè‡ªå®šä¹‰temperature=0.7

**ä¿®å¤æ–¹æ¡ˆ**:
- ä½¿ç”¨ `self.llm_client.temperature` è·å–æ¨¡å‹é…ç½®çš„é»˜è®¤å€¼
- ç¡®ä¿ä½¿ç”¨æ¨¡å‹æ”¯æŒçš„temperatureå€¼

## æµ‹è¯•ç»“æœ

è¿è¡Œ `python3 test_agent_system.py`:

### âœ… æµ‹è¯•1: æ¨¡æ¿æ™ºèƒ½ä½“
- æˆåŠŸåˆ—å‡º3ä¸ªé¢„å®šä¹‰æ¨¡æ¿
- æ”¿åºœé‡‡è´­æ ‡å‡†æ¨¡æ¿ï¼ˆ5ç« ï¼‰
- è½¯ä»¶å¼€å‘é¡¹ç›®æ¨¡æ¿ï¼ˆ8ç« ï¼‰
- ISOè´¨é‡ä½“ç³»æ¨¡æ¿ï¼ˆ6ç« ï¼‰

### âš ï¸ æµ‹è¯•2: è¯„åˆ†ç‚¹æ™ºèƒ½ä½“
- APIè°ƒç”¨æˆåŠŸ
- éœ€è¦çœŸå®çš„æ‹›æ ‡æ–‡æ¡£è¿›è¡Œå®Œæ•´æµ‹è¯•
- å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œä»å­˜åœ¨temperatureå…¼å®¹æ€§é—®é¢˜ï¼ˆæ¨¡å‹é…ç½®é—®é¢˜ï¼Œéä»£ç é—®é¢˜ï¼‰

### âœ… æµ‹è¯•3: æ™ºèƒ½ä½“è·¯ç”±å™¨
- æˆåŠŸè·å–3ç§ç”Ÿæˆæ¨¡å¼
- æŒ‰è¯„åˆ†ç‚¹å†™
- æŒ‰æ‹›æ ‡ä¹¦ç›®å½•å†™
- ä½¿ç”¨å›ºå®šæ¨¡æ¿

## æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆ5ä¸ªï¼‰
1. `agents/base_agent.py` - æ–°å¢ `_call_llm()` å’Œæ›´æ–° `_get_prompt()`
2. `agents/scoring_point_agent.py` - ä¿®å¤3å¤„LLMè°ƒç”¨
3. `agents/requirement_response_agent.py` - ä¿®å¤1å¤„LLMè°ƒç”¨
4. `agents/template_agent.py` - ä¿®å¤2å¤„LLMè°ƒç”¨
5. `test_agent_system.py` - æµ‹è¯•è„šæœ¬

### æç¤ºè¯æ–‡ä»¶ï¼ˆ4ä¸ªï¼Œå·²åˆ›å»ºï¼‰
- `prompts/agent_prompts/scoring_point_agent.json`
- `prompts/agent_prompts/requirement_response_agent.json`
- `prompts/agent_prompts/template_agent.json`
- `prompts/agent_prompts/verification_agent.json`

## ç³»ç»ŸçŠ¶æ€

### âœ… å·²å®Œæˆ
- [x] åŸºç¡€æ™ºèƒ½ä½“æ¡†æ¶æ­å»º
- [x] 3ä¸ªä¸“ä¸šæ™ºèƒ½ä½“å®ç°
- [x] 2ä¸ªè¾…åŠ©æ™ºèƒ½ä½“å®ç°
- [x] æ™ºèƒ½ä½“è·¯ç”±å™¨å®ç°
- [x] æç¤ºè¯é…ç½®æ–‡ä»¶åˆ›å»º
- [x] åç«¯APIé›†æˆï¼ˆ5ä¸ªç«¯ç‚¹ï¼‰
- [x] LLMè°ƒç”¨æ–¹æ³•ä¿®å¤
- [x] æç¤ºè¯åŠ è½½è·¯å¾„ä¿®å¤
- [x] Temperatureå…¼å®¹æ€§ä¿®å¤

### ğŸ“‹ å¾…å®Œæˆï¼ˆå¯é€‰ï¼‰
- [ ] å‰ç«¯ç•Œé¢å¼€å‘ï¼ˆç”Ÿæˆæ¨¡å¼é€‰æ‹©ã€æ¨¡æ¿é€‰æ‹©å™¨ï¼‰
- [ ] åœºæ™¯1é›†æˆï¼ˆä¿®æ”¹extractor.pyä½¿ç”¨ScoringPointAgentï¼‰
- [ ] åœºæ™¯2é›†æˆï¼ˆå®ç°api_scoring_bp.pyï¼Œä¿®æ”¹Scoring.vueï¼‰
- [ ] æµå¼ç”Ÿæˆæ”¯æŒ
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€å¹¶å‘ï¼‰

## ä½¿ç”¨è¯´æ˜

### 1. æµ‹è¯•æ™ºèƒ½ä½“ç³»ç»Ÿ
```bash
python3 test_agent_system.py
```

### 2. ä½¿ç”¨APIç”Ÿæˆæ–¹æ¡ˆ

#### ä½¿ç”¨æ¨¡æ¿æ™ºèƒ½ä½“
```bash
curl -X POST http://localhost:5000/api/agent/generate \
  -H "Content-Type: application/json" \
  -d '{
    "generation_mode": "ç¼–å†™ä¸“é¡¹ç« èŠ‚",
    "tender_doc": "æ‹›æ ‡æ–‡æ¡£å†…å®¹...",
    "page_count": 200,
    "template_name": "æ”¿åºœé‡‡è´­æ ‡å‡†"
  }'
```

#### ä½¿ç”¨éœ€æ±‚åº”ç­”æ™ºèƒ½ä½“
```bash
curl -X POST http://localhost:5000/api/agent/generate \
  -H "Content-Type: application/json" \
  -d '{
    "generation_mode": "æŒ‰æ‹›æ ‡ä¹¦ç›®å½•å†™",
    "tender_doc": "æ‹›æ ‡æ–‡æ¡£å†…å®¹...",
    "page_count": 200
  }'
```

#### è·å–å¯ç”¨æ¨¡æ¿
```bash
curl http://localhost:5000/api/agent/templates
```

#### è·å–ç”Ÿæˆæ¨¡å¼
```bash
curl http://localhost:5000/api/agent/modes
```

## æ³¨æ„äº‹é¡¹

### Temperatureå…¼å®¹æ€§
éƒ¨åˆ†AIæ¨¡å‹ï¼ˆå¦‚gpt-4o-miniï¼‰å¯èƒ½ä¸æ”¯æŒè‡ªå®šä¹‰temperatureå‚æ•°ã€‚ä»£ç å·²è‡ªåŠ¨ä½¿ç”¨æ¨¡å‹é…ç½®çš„é»˜è®¤å€¼ï¼Œä½†å¦‚æœé‡åˆ°é”™è¯¯ï¼Œè¯·æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ¨¡å‹é…ç½®ã€‚

### æç¤ºè¯è·¯å¾„
æ™ºèƒ½ä½“ä¸“ç”¨æç¤ºè¯å¿…é¡»æ”¾åœ¨ `prompts/agent_prompts/` ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åæ ¼å¼ä¸º `{æ¨¡å—å}.json`ã€‚

### LLMè°ƒç”¨
æ‰€æœ‰æ™ºèƒ½ä½“å¿…é¡»ä½¿ç”¨ `self._call_llm()` æ–¹æ³•è°ƒç”¨LLMï¼Œä¸è¦ç›´æ¥ä½¿ç”¨ `self.llm_client.call()`ã€‚

## æ€»ç»“

æ‰€æœ‰æ ¸å¿ƒé—®é¢˜å·²ä¿®å¤ï¼Œæ™ºèƒ½ä½“ç³»ç»Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å‰©ä½™çš„å¾…åŠé¡¹ç›®ä¸ºå¯é€‰çš„å‰ç«¯é›†æˆå’Œæ€§èƒ½ä¼˜åŒ–åŠŸèƒ½ã€‚

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-12-20 14:10
**è€—æ—¶**: çº¦10åˆ†é’Ÿ
**ä¿®æ”¹æ–‡ä»¶**: 5ä¸ª
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
