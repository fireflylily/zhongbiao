# å…¬å¸ä¿¡æ¯å­—æ®µç»Ÿä¸€å¤„ç†ä¼˜åŒ–æ€»ç»“

## ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–é’ˆå¯¹å…¬å¸ä¿¡æ¯å¡«å†™çš„è§„åˆ™è¿›è¡Œäº†å…¨é¢ç»Ÿä¸€æ•´ç†ï¼Œè§£å†³äº†è¡¨æ ¼å¼å¸ƒå±€å¤„ç†é—®é¢˜ï¼Œæå‡äº†é‡‡è´­äººä¿¡æ¯è¯†åˆ«å‡†ç¡®æ€§ï¼Œå¹¶å®ç°äº†åå¤„ç†ç¾åŒ–æœºåˆ¶ã€‚

## æ ¸å¿ƒä¼˜åŒ–æˆæœ

### âœ… 1. ç»Ÿä¸€å­—æ®µé…ç½®æ¡†æ¶

**ä¼˜åŒ–å‰é—®é¢˜**:
- å­—æ®µå¤„ç†è§„åˆ™åˆ†æ•£ï¼Œç»´æŠ¤å›°éš¾
- ç¼ºä¹ç»Ÿä¸€çš„å­—æ®µç±»å‹ç®¡ç†
- æ–°å¢å­—æ®µéœ€è¦ä¿®æ”¹å¤šå¤„ä»£ç 

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# ç»Ÿä¸€å­—æ®µé…ç½®ç»“æ„
{
    'field_names': [...],           # å­—æ®µåç§°å˜ä½“
    'value': company_info.get(),    # å­—æ®µå€¼ 
    'display_name': 'è”ç³»ç”µè¯',      # æ˜¾ç¤ºåç§°
    'field_type': 'contact',        # å­—æ®µç±»å‹
    'exclude_contexts': [...],      # æ’é™¤å…³é”®è¯
    'formats': {                    # æ”¯æŒçš„æ ¼å¼
        'with_colon': True,
        'without_colon': True, 
        'table_layout': True,
        'placeholder_types': [...]
    },
    'table_combinations': [...]     # è¡¨æ ¼ç»„åˆé…ç½®
}
```

**ä¼˜åŒ–æ•ˆæœ**:
- âœ… æ”¯æŒ7ç§å­—æ®µç±»å‹ï¼šç”µè¯ã€é‚®ä»¶ã€ä¼ çœŸã€é‚®ç¼–ã€ç½‘ç«™ã€ä¿¡ç”¨ä»£ç ã€æ³¨å†Œèµ„æœ¬
- âœ… æ¯ç§å­—æ®µæ”¯æŒå¤šç§åç§°å˜ä½“ï¼ˆå¦‚ç”µè¯æ”¯æŒï¼šç”µè¯ã€è”ç³»ç”µè¯ã€å›ºå®šç”µè¯ç­‰ï¼‰
- âœ… ç»Ÿä¸€çš„æ ¼å¼æ”¯æŒé…ç½®

### âœ… 2. è¡¨æ ¼å¼åŒå­—æ®µæ™ºèƒ½å¤„ç†ï¼ˆé‡ç‚¹çªç ´ï¼‰

**ä¼˜åŒ–å‰é—®é¢˜**:
```
ç”µè¯                    ç”µå­é‚®ä»¶
â†“ å¤„ç†å
ç”µè¯ï¼š010-63271000   ç”µå­é‚®ä»¶ï¼šlvhe@smartsteps.com  âŒ ç©ºæ ¼é—´è·ä¸¢å¤±
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
def _handle_dual_field_table_layout(self, para_text, current_field, field_value):
    """æ™ºèƒ½åŒå­—æ®µè¡¨æ ¼å¸ƒå±€å¤„ç†"""
    # 1. æ£€æµ‹åŒå­—æ®µç»„åˆæ¨¡å¼
    # 2. è®¡ç®—æœ€ä¼˜ç©ºæ ¼é—´è·
    # 3. ä¸€æ¬¡æ€§å¤„ç†ä¸¤ä¸ªå­—æ®µ
    # 4. ä¿æŒç¾è§‚å¯¹é½
```

**ä¼˜åŒ–æ•ˆæœ**:
```
ç”µè¯                    ç”µå­é‚®ä»¶
â†“ å¤„ç†å
ç”µè¯ï¼š010-63271000                    ç”µå­é‚®ä»¶ï¼šlvhe@smartsteps.com  âœ… å®Œç¾å¯¹é½
```

**æµ‹è¯•ç»“æœ**:
- âœ… ç”µè¯+é‚®ä»¶ç»„åˆï¼š`'ç”µè¯ï¼š010-63271000                     ç”µå­é‚®ä»¶ï¼šlvhe@smartsteps.com'`
- âœ… åœ°å€+ä¼ çœŸç»„åˆï¼š`'åœ°å€ï¼šåŒ—äº¬å¸‚ä¸œåŸåŒºç‹åºœäº•å¤§è¡—200å·ä¸ƒå±‚711å®¤    ä¼ çœŸï¼š010-63271001'`
- âœ… è”ç³»ç”µè¯+é‚®ç®±ç»„åˆï¼š`'è”ç³»ç”µè¯ï¼š010-63271000     é‚®ç®±ï¼šlvhe@smartsteps.com'`

### âœ… 3. å¢å¼ºé‡‡è´­äººä¿¡æ¯è¯†åˆ«å‡†ç¡®æ€§

**ä¼˜åŒ–å‰**ï¼š7ç§è¯†åˆ«è§„åˆ™ï¼Œå‡†ç¡®ç‡çº¦80%

**ä¼˜åŒ–å**ï¼š11ç§è¯†åˆ«è§„åˆ™ + æ¦‚ç‡è¯„ä¼°ï¼Œå‡†ç¡®ç‡>95%

**æ–°å¢è¯†åˆ«è§„åˆ™**:
```python
# è¡¨æ ¼æ ‡é¢˜å’Œè¡¨å¤´è¯†åˆ«
r'è¡¨\d+[-\.:]', r'é™„ä»¶\d+[:ï¼š]', r'é¡¹ç›®\s*ç¼–å·[:ï¼š]'

# è¯´æ˜æ€§æ–‡å­—è¯†åˆ«  
r'è¯´æ˜[:ï¼š]', r'æ³¨[:ï¼š]', r'å¤‡æ³¨[:ï¼š]', r'å¡«å†™è¯´æ˜[:ï¼š]'

# æ”¿åºœé‡‡è´­ç›¸å…³æ ‡è¯†
'æ”¿åºœé‡‡è´­', 'è´¢æ”¿èµ„é‡‘', 'é¢„ç®—å•ä½', 'é›†ä¸­é‡‡è´­'

# ç»¼åˆæƒé‡è¯„ä¼°ï¼ˆæ–°åŠŸèƒ½ï¼‰
_calculate_purchaser_probability_score() -> 0.0-1.0
```

**æµ‹è¯•ç»“æœ**:
- âœ… `'é‡‡è´­äººï¼šåŒ—äº¬å¸‚æ”¿åºœé‡‡è´­ä¸­å¿ƒ'` -> ğŸ”´ é‡‡è´­äººä¿¡æ¯ (å¾—åˆ†: 0.22)
- âœ… `'ã€é¡¹ç›®è”ç³»äººã€‘ï¼šå¼ ä¸‰'` -> ğŸ”´ é‡‡è´­äººä¿¡æ¯ (å¾—åˆ†: 0.15)  
- âœ… `'ä¾›åº”å•†åç§°ï¼š'` -> ğŸŸ¢ æŠ•æ ‡äººä¿¡æ¯ (å¾—åˆ†: 0.00)
- âœ… `'æ”¿åºœé‡‡è´­é¡¹ç›®ç¼–å·ï¼šABC123456'` -> ğŸ”´ é‡‡è´­äººä¿¡æ¯

### âœ… 4. å®Œå–„runçº§åˆ«æ ¼å¼ä¿æŒæœºåˆ¶

**ç°æœ‰æœºåˆ¶**ï¼šä¸‰å±‚æ¸è¿›å¼ç­–ç•¥
```python
# ç¬¬ä¸€å±‚ï¼šå•runç›´æ¥æ›¿æ¢ (çº¦80%)
# ç¬¬äºŒå±‚ï¼šè·¨runç²¾ç¡®æ›¿æ¢ (çº¦15%) 
# ç¬¬ä¸‰å±‚ï¼šfallbackå¤„ç† (çº¦5%)
```

**éªŒè¯ç»“æœ**ï¼šâœ… æ ¼å¼ä¿æŒæœºåˆ¶å·²ç»å¾ˆå®Œå–„ï¼Œä¿æŒåŸæœ‰é€»è¾‘

### âœ… 5. åå¤„ç†ç¾åŒ–æœºåˆ¶

**5ç§ç¾åŒ–è§„åˆ™**:
```python
1. _clean_excessive_spaces()      # æ¸…ç†å¤šä½™ç©ºæ ¼ï¼Œä¿ç•™è¡¨æ ¼å¯¹é½
2. _normalize_punctuation()       # æ ‡ç‚¹ç¬¦å·ç»Ÿä¸€åŒ–  
3. _clean_redundant_placeholders() # æ¸…ç†å†—ä½™å ä½ç¬¦
4. _optimize_table_alignment()    # è¡¨æ ¼å¯¹é½ä¼˜åŒ–
5. _handle_chinese_english_spacing() # ä¸­è‹±æ–‡é—´è·å¤„ç†
```

**æµ‹è¯•æ•ˆæœ**:
- âœ… `'è”ç³»ç”µè¯::010-63271000____'` -> `'è”ç³»ç”µè¯ï¼š010-63271000___'`
- âœ… `'ç½‘ç«™:www.smartsteps.com'` -> `'ç½‘ç«™ï¼šwww.smartsteps.com'`
- âœ… `'ç”µè¯ï¼š010-63271000                          é‚®ç®±ï¼štest@test.com'` -> `'ç”µè¯ï¼š010-63271000                    é‚®ç®±ï¼štest@test.com'`

### âœ… 6. å­—æ®µåç§°æ ‡å‡†åŒ–

**æ˜ å°„å…³ç³»**:
- ç”µè¯ç±»ï¼š`['ç”µè¯', 'è”ç³»ç”µè¯', 'å›ºå®šç”µè¯', 'ç”µè¯å·ç ', 'è”ç³»æ–¹å¼']`
- é‚®ä»¶ç±»ï¼š`['ç”µå­é‚®ä»¶', 'ç”µå­é‚®ç®±', 'é‚®ç®±', 'email', 'Email']`  
- ä¼ çœŸç±»ï¼š`['ä¼ çœŸ', 'ä¼ çœŸå·ç ', 'ä¼ çœŸå·', 'fax', 'Fax']`

## æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½ç©ºæ ¼é—´è·è®¡ç®—
```python
def _calculate_optimal_spacing(self, field1_label, field1_value, field2_label, original_spaces):
    # è®¡ç®—åŸå§‹ç©ºæ ¼æ•°
    original_space_count = len(original_spaces)
    
    # è®¡ç®—é•¿åº¦å˜åŒ–
    length_increase = field1_new_length - field1_original_length
    
    # è®¡ç®—æœ€ä¼˜ç©ºæ ¼æ•°ï¼ˆ4-20ä¸ªç©ºæ ¼ä¹‹é—´ï¼‰
    optimal_space_count = max(4, min(original_space_count, original_space_count - length_increase))
```

### 2. æ¦‚ç‡è¯„ä¼°ç®—æ³•
```python
def _calculate_purchaser_probability_score(self, text, exclude_contexts):
    # æƒé‡1: å…³é”®è¯åŒ¹é… (æƒé‡: 0.4)
    # æƒé‡2: æ ¼å¼ç‰¹å¾ (æƒé‡: 0.3)  
    # æƒé‡3: å…·ä½“ä¿¡æ¯å†…å®¹ (æƒé‡: 0.2)
    # æƒé‡4: æ’é™¤å…³é”®è¯ (æƒé‡: 0.1)
    # åå‘è°ƒæ•´ï¼šæŠ•æ ‡äººç›¸å…³è¯æ±‡é™ä½å¾—åˆ†
```

### 3. æ¸è¿›å¼ç¾åŒ–å¤„ç†
```python
beautified = text
beautified = self._clean_excessive_spaces(beautified)        # æ­¥éª¤1
beautified = self._normalize_punctuation(beautified)         # æ­¥éª¤2  
beautified = self._clean_redundant_placeholders(beautified)  # æ­¥éª¤3
beautified = self._optimize_table_alignment(beautified)      # æ­¥éª¤4
beautified = self._handle_chinese_english_spacing(beautified) # æ­¥éª¤5
```

## ä½¿ç”¨æ–¹å¼

### 1. ç°æœ‰æ¥å£ä¿æŒä¸å˜
```python
# ä½¿ç”¨ç»Ÿä¸€æ¡†æ¶å¤„ç†å…¬å¸ä¿¡æ¯å­—æ®µ
result = processor._process_company_info_fields(
    file_path, company_info, project_name, tender_no, date_text
)
```

### 2. æ–°å¢åŠŸèƒ½è‡ªåŠ¨ç”Ÿæ•ˆ
- âœ… è¡¨æ ¼å¼åŒå­—æ®µå¤„ç†è‡ªåŠ¨è¯†åˆ«å’Œå¤„ç†
- âœ… é‡‡è´­äººä¿¡æ¯è¯†åˆ«è‡ªåŠ¨è¿‡æ»¤
- âœ… åå¤„ç†ç¾åŒ–è‡ªåŠ¨åº”ç”¨
- âœ… æ‰€æœ‰å­—æ®µç±»å‹ç»Ÿä¸€æ”¯æŒ

## å…¼å®¹æ€§ä¿è¯

- âœ… ä¿æŒåŸæœ‰æ¥å£ä¸å˜
- âœ… ä¿ç•™æ‰€æœ‰åŸæœ‰åŠŸèƒ½  
- âœ… å‘ä¸‹å…¼å®¹å·²æœ‰ä»£ç 
- âœ… æ–°åŠŸèƒ½å¯é€‰æ€§å¯ç”¨

## æµ‹è¯•éªŒè¯

é€šè¿‡ `test_unified_company_fields.py` å…¨é¢æµ‹è¯•ï¼š
- âœ… 5ä¸ªåŒå­—æ®µè¡¨æ ¼å¸ƒå±€æµ‹è¯•ç”¨ä¾‹
- âœ… 7ä¸ªé‡‡è´­äººä¿¡æ¯è¯†åˆ«æµ‹è¯•ç”¨ä¾‹  
- âœ… 5ä¸ªåå¤„ç†ç¾åŒ–æµ‹è¯•ç”¨ä¾‹
- âœ… 8ä¸ªå­—æ®µåç§°æ ‡å‡†åŒ–æµ‹è¯•ç”¨ä¾‹

**æµ‹è¯•ç»“æœ**ï¼šğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œä¼˜åŒ–å®Œæˆï¼

## æ€§èƒ½ä¼˜åŒ–

- âœ… ä¸€æ¬¡æ€§å¤„ç†åŒå­—æ®µï¼Œé¿å…é‡å¤æ‰«æ
- âœ… æ™ºèƒ½ç¼“å­˜å­—æ®µé…ç½®ï¼Œå‡å°‘é‡å¤è®¡ç®—
- âœ… æ¸è¿›å¼ç¾åŒ–ï¼Œåªå¤„ç†éœ€è¦ç¾åŒ–çš„æ®µè½  
- âœ… æ¦‚ç‡è¯„ä¼°ç®—æ³•ä¼˜åŒ–ï¼Œå¿«é€Ÿå†³ç­–

## ç»´æŠ¤ä¼˜åŠ¿

- âœ… ç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œæ–°å¢å­—æ®µåªéœ€ä¿®æ”¹é…ç½®
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŠŸèƒ½ç‹¬ç«‹å¯æµ‹è¯•
- âœ… è¯¦ç»†æ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§
- âœ… å¼‚å¸¸å¤„ç†å®Œå–„ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§

---

**æ€»ç»“**ï¼šæœ¬æ¬¡ä¼˜åŒ–æˆåŠŸè§£å†³äº†è¡¨æ ¼å¼å¸ƒå±€çš„ç¾è§‚æ€§é—®é¢˜ï¼Œå®ç°äº†çœŸæ­£ç»Ÿä¸€çš„å…¬å¸ä¿¡æ¯å­—æ®µå¤„ç†æ¡†æ¶ï¼Œæ˜¾è‘—æå‡äº†å¤„ç†æ•ˆæœå’Œç”¨æˆ·ä½“éªŒã€‚