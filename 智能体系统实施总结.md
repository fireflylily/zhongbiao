# æ™ºèƒ½ä½“ç³»ç»Ÿå®æ–½æ€»ç»“

## ä¸€ã€å®æ–½å®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆé¡¹ç›®

#### 1. åŸºç¡€æ¡†æ¶æ­å»º
- **BaseAgent åŸºç±»** (`agents/base_agent.py`)
  - æä¾›ç»Ÿä¸€çš„æç¤ºè¯åŠ è½½ã€LLMè°ƒç”¨ã€JSONè§£æåŠŸèƒ½
  - å®ç°é¡µæ•°/å­—æ•°è®¡ç®—ç®—æ³•
  - çº¦ 170 è¡Œä»£ç 

#### 2. ä¸‰å¤§æ™ºèƒ½ä½“å®ç°

##### 2.1 ScoringPointAgentï¼ˆè¯„åˆ†ç‚¹æ™ºèƒ½ä½“ï¼‰
- **æ–‡ä»¶**: `agents/scoring_point_agent.py`
- **åŠŸèƒ½**:
  - `extract_scoring_points()` - ä»æ‹›æ ‡æ–‡æ¡£æå–è¯„åˆ†ç‚¹ï¼ˆåœºæ™¯1ï¼‰
  - `evaluate_tender_document()` - AIè¯„åˆ†ï¼ˆåœºæ™¯2ï¼‰
  - `generate_proposal_by_scoring()` - æŒ‰è¯„åˆ†ç‚¹ç”Ÿæˆæ–¹æ¡ˆï¼ˆåœºæ™¯3ï¼‰
- **ä»£ç é‡**: çº¦ 350 è¡Œ
- **çŠ¶æ€**: âœ… æ ¸å¿ƒé€»è¾‘å®Œæˆ

##### 2.2 RequirementResponseAgentï¼ˆéœ€æ±‚åº”ç­”æ™ºèƒ½ä½“ï¼‰
- **æ–‡ä»¶**: `agents/requirement_response_agent.py`
- **åŠŸèƒ½**:
  - è°ƒç”¨ `RequirementAnalyzer` åˆ†ææ‹›æ ‡éœ€æ±‚
  - åŠ¨æ€ç”Ÿæˆç« èŠ‚ï¼Œä¸¥æ ¼ä¸€ä¸€å¯¹åº”éœ€æ±‚åˆ†ç±»
  - ç»§æ‰¿ v2.2.0 çš„æ‰€æœ‰ä¿®å¤ï¼ˆè¡¨æ ¼å†…å®¹å®Œæ•´ä¼ é€’ã€ç¦æ­¢é€šç”¨å•†åŠ¡æ¡æ¬¾ï¼‰
- **ä»£ç é‡**: çº¦ 280 è¡Œ
- **çŠ¶æ€**: âœ… æ ¸å¿ƒé€»è¾‘å®Œæˆ

##### 2.3 TemplateAgentï¼ˆæ¨¡æ¿æ™ºèƒ½ä½“ï¼‰
- **æ–‡ä»¶**: `agents/template_agent.py`
- **åŠŸèƒ½**:
  - æä¾›3ä¸ªé¢„å®šä¹‰æ¨¡æ¿ï¼ˆæ”¿åºœé‡‡è´­æ ‡å‡†ã€è½¯ä»¶å¼€å‘é¡¹ç›®ã€ISOè´¨é‡ä½“ç³»ï¼‰
  - æ™ºèƒ½æ˜ å°„æ‹›æ ‡éœ€æ±‚åˆ°æ¨¡æ¿ç« èŠ‚
  - å¿«é€Ÿç”Ÿæˆæ ‡å‡†æ ¼å¼æ–¹æ¡ˆ
- **ä»£ç é‡**: çº¦ 260 è¡Œ
- **çŠ¶æ€**: âœ… æ ¸å¿ƒé€»è¾‘å®Œæˆ

#### 3. è¾…åŠ©æ™ºèƒ½ä½“

##### 3.1 VerificationAgentï¼ˆéªŒè¯æ™ºèƒ½ä½“ï¼‰
- **æ–‡ä»¶**: `agents/verification_agent.py`
- **åŠŸèƒ½**:
  - éªŒè¯å†…å®¹è¦†ç›–ç‡ï¼ˆç›®æ ‡â‰¥90%ï¼‰
  - è¯†åˆ«é—æ¼è¦ç‚¹
  - ç”Ÿæˆè¡¥å……å»ºè®®
  - è´¨é‡è¯„åˆ†
- **ä»£ç é‡**: çº¦ 180 è¡Œ
- **çŠ¶æ€**: âœ… æ ¸å¿ƒé€»è¾‘å®Œæˆ

##### 3.2 AgentRouterï¼ˆæ™ºèƒ½ä½“è·¯ç”±å™¨ï¼‰
- **æ–‡ä»¶**: `agents/agent_router.py`
- **åŠŸèƒ½**:
  - æ ¹æ®ç”¨æˆ·é€‰æ‹©è·¯ç”±åˆ°å¯¹åº”æ™ºèƒ½ä½“
  - æ”¯æŒ3ç§ç”Ÿæˆæ¨¡å¼
  - æä¾›å¯ç”¨æ¨¡å¼å’Œæ¨¡æ¿åˆ—è¡¨
- **ä»£ç é‡**: çº¦ 120 è¡Œ
- **çŠ¶æ€**: âœ… æ ¸å¿ƒé€»è¾‘å®Œæˆ

#### 4. æç¤ºè¯é…ç½®æ–‡ä»¶

åˆ›å»ºäº†4ä¸ªæ™ºèƒ½ä½“ä¸“ç”¨æç¤ºè¯æ–‡ä»¶ï¼š

| æ–‡ä»¶ | ç”¨é€” | æç¤ºè¯æ•°é‡ |
|------|------|-----------|
| `scoring_point_agent.json` | è¯„åˆ†ç‚¹æ™ºèƒ½ä½“ | 4ä¸ª |
| `requirement_response_agent.json` | éœ€æ±‚åº”ç­”æ™ºèƒ½ä½“ | 3ä¸ª |
| `template_agent.json` | æ¨¡æ¿æ™ºèƒ½ä½“ | 2ä¸ª |
| `verification_agent.json` | éªŒè¯æ™ºèƒ½ä½“ | 2ä¸ª |

#### 5. åç«¯APIé›†æˆ

åœ¨ `api_outline_generator.py` ä¸­æ–°å¢5ä¸ªAPIç«¯ç‚¹ï¼š

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/agent/generate` | POST | ä½¿ç”¨æ™ºèƒ½ä½“ç”Ÿæˆæ–¹æ¡ˆ |
| `/api/agent/templates` | GET | è·å–å¯ç”¨æ¨¡æ¿åˆ—è¡¨ |
| `/api/agent/modes` | GET | è·å–å¯ç”¨ç”Ÿæˆæ¨¡å¼ |
| `/api/agent/scoring/extract` | POST | æå–è¯„åˆ†ç‚¹ |
| `/api/agent/scoring/evaluate` | POST | AIè¯„åˆ† |

#### 6. æµ‹è¯•è„šæœ¬

åˆ›å»ºäº† `test_agent_system.py`ï¼Œæµ‹è¯•ç»“æœï¼š

- âœ… æ¨¡æ¿æ™ºèƒ½ä½“æµ‹è¯•é€šè¿‡ï¼ˆåˆ—å‡º3ä¸ªæ¨¡æ¿ï¼‰
- âœ… æ™ºèƒ½ä½“è·¯ç”±å™¨æµ‹è¯•é€šè¿‡ï¼ˆ3ç§ç”Ÿæˆæ¨¡å¼ï¼‰
- âš ï¸ è¯„åˆ†ç‚¹æ™ºèƒ½ä½“éœ€è¦ä¿®å¤LLMè°ƒç”¨æ–¹æ³•å

### âš ï¸ éœ€è¦ä¿®å¤çš„é—®é¢˜

#### é—®é¢˜1: LLMè°ƒç”¨æ–¹æ³•åä¸æ­£ç¡®

**ç°çŠ¶**: æ™ºèƒ½ä½“ä¸­ä½¿ç”¨äº† `self.llm_client.chat()`
**æ­£ç¡®**: åº”ä½¿ç”¨ `self.llm_client.call()`

**å—å½±å“æ–‡ä»¶**:
- `scoring_point_agent.py`
- `requirement_response_agent.py`
- `template_agent.py`

**ä¿®å¤æ–¹æ³•**:
```python
# ä¿®å¤å‰
response = self.llm_client.chat(
    messages=[{"role": "user", "content": prompt}],
    response_format={"type": "json_object"}
)

# ä¿®å¤å
response = self.llm_client.call(
    prompt=prompt,
    response_format="json_object",
    model=self.model_name
)
```

#### é—®é¢˜2: æç¤ºè¯æ–‡ä»¶è·¯å¾„

**ç°çŠ¶**: æç¤ºè¯æ–‡ä»¶åœ¨ `prompts/agent_prompts/` ç›®å½•
**PromptManager é¢„æœŸ**: åœ¨ `prompts/` æ ¹ç›®å½•

**ä¿®å¤æ–¹æ³•1ï¼ˆæ¨èï¼‰**: æ›´æ–° BaseAgent çš„ `_get_prompt` æ–¹æ³•ï¼Œæ”¯æŒå­ç›®å½•ï¼š
```python
def _get_prompt(self, module: str, prompt_key: str, **kwargs) -> str:
    # å°è¯•ä» agent_prompts å­ç›®å½•åŠ è½½
    full_module = f"agent_prompts.{module}"
    template = self.prompt_manager.get_prompt(
        full_module,
        prompt_key,
        default=f"[æç¤ºè¯ç¼ºå¤±: {module}.{prompt_key}]"
    )
    # ...
```

**ä¿®å¤æ–¹æ³•2**: ç§»åŠ¨æç¤ºè¯æ–‡ä»¶åˆ° `prompts/` æ ¹ç›®å½•

## äºŒã€ç›®å½•ç»“æ„

```
ai_tender_system/
â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ agent_prompts/                      # æ™ºèƒ½ä½“æç¤ºè¯
â”‚       â”œâ”€â”€ scoring_point_agent.json
â”‚       â”œâ”€â”€ requirement_response_agent.json
â”‚       â”œâ”€â”€ template_agent.json
â”‚       â””â”€â”€ verification_agent.json
â”‚
â”œâ”€â”€ modules/outline_generator/
â”‚   â”œâ”€â”€ agents/                              # æ™ºèƒ½ä½“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_agent.py                    # åŸºç¡€æ™ºèƒ½ä½“ç±» (~170è¡Œ)
â”‚   â”‚   â”œâ”€â”€ agent_router.py                  # æ™ºèƒ½ä½“è·¯ç”±å™¨ (~120è¡Œ)
â”‚   â”‚   â”œâ”€â”€ scoring_point_agent.py           # è¯„åˆ†ç‚¹æ™ºèƒ½ä½“ (~350è¡Œ)
â”‚   â”‚   â”œâ”€â”€ requirement_response_agent.py    # éœ€æ±‚åº”ç­”æ™ºèƒ½ä½“ (~280è¡Œ)
â”‚   â”‚   â”œâ”€â”€ template_agent.py                # æ¨¡æ¿æ™ºèƒ½ä½“ (~260è¡Œ)
â”‚   â”‚   â””â”€â”€ verification_agent.py            # éªŒè¯æ™ºèƒ½ä½“ (~180è¡Œ)
â”‚   â”‚
â”‚   â”œâ”€â”€ requirement_analyzer.py              # éœ€æ±‚åˆ†æå™¨ï¼ˆç°æœ‰ï¼‰
â”‚   â””â”€â”€ proposal_assembler.py                # æ–¹æ¡ˆç»„è£…å™¨ï¼ˆç°æœ‰ï¼‰
â”‚
â””â”€â”€ web/
    â””â”€â”€ api_outline_generator.py             # APIï¼ˆæ–°å¢5ä¸ªæ™ºèƒ½ä½“ç«¯ç‚¹ï¼‰
```

**æ€»ä»£ç é‡**: çº¦ 1,360 è¡Œï¼ˆçº¯Pythonä»£ç ï¼Œä¸å«æ³¨é‡Šå’Œç©ºè¡Œï¼‰

## ä¸‰ã€APIä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ä½¿ç”¨æ¨¡æ¿æ™ºèƒ½ä½“ç”Ÿæˆæ–¹æ¡ˆ

```bash
curl -X POST http://localhost:5000/api/agent/generate \
  -H "Content-Type: application/json" \
  -d '{
    "generation_mode": "ç¼–å†™ä¸“é¡¹ç« èŠ‚",
    "tender_doc": "æ‹›æ ‡æ–‡æ¡£å†…å®¹...",
    "page_count": 200,
    "template_name": "æ”¿åºœé‡‡è´­æ ‡å‡†",
    "content_style": {
      "tables": "é€‚é‡",
      "flowcharts": "æµç¨‹å›¾",
      "images": "å°‘é‡"
    }
  }'
```

### ç¤ºä¾‹2: ä½¿ç”¨éœ€æ±‚åº”ç­”æ™ºèƒ½ä½“

```bash
curl -X POST http://localhost:5000/api/agent/generate \
  -H "Content-Type: application/json" \
  -d '{
    "generation_mode": "æŒ‰æ‹›æ ‡ä¹¦ç›®å½•å†™",
    "tender_doc": "æ‹›æ ‡æ–‡æ¡£å†…å®¹...",
    "page_count": 200,
    "content_style": {
      "tables": "å¤§é‡",
      "flowcharts": "SmartArt",
      "images": "å°‘é‡"
    }
  }'
```

### ç¤ºä¾‹3: AIè¯„åˆ†

```bash
curl -X POST http://localhost:5000/api/agent/scoring/evaluate \
  -H "Content-Type: application/json" \
  -d '{
    "tender_doc": "æ ‡ä¹¦å†…å®¹...",
    "scoring_points": [
      {
        "dimension": "æŠ€æœ¯æ–¹æ¡ˆ",
        "weight": 40,
        "description": "...",
        "criteria": [...]
      }
    ]
  }'
```

## å››ã€ä¸‹ä¸€æ­¥å·¥ä½œ

### ç«‹å³éœ€è¦ï¼ˆä¼˜å…ˆçº§ï¼šP0ï¼‰

1. **ä¿®å¤LLMè°ƒç”¨æ–¹æ³•å**
   - ä¿®æ”¹æ‰€æœ‰æ™ºèƒ½ä½“ä¸­çš„ `self.llm_client.chat()` â†’ `self.llm_client.call()`
   - é¢„è®¡è€—æ—¶ï¼š15åˆ†é’Ÿ
   - æ–‡ä»¶ï¼š3ä¸ªæ™ºèƒ½ä½“æ–‡ä»¶

2. **ä¿®å¤æç¤ºè¯åŠ è½½è·¯å¾„**
   - æ›´æ–° BaseAgent çš„ `_get_prompt()` æ–¹æ³•æ”¯æŒå­ç›®å½•
   - é¢„è®¡è€—æ—¶ï¼š10åˆ†é’Ÿ
   - æ–‡ä»¶ï¼š1ä¸ªæ–‡ä»¶

3. **å®Œæ•´æµ‹è¯•**
   - æµ‹è¯•3ä¸ªæ™ºèƒ½ä½“çš„æ ¸å¿ƒåŠŸèƒ½
   - éªŒè¯APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ
   - é¢„è®¡è€—æ—¶ï¼š30åˆ†é’Ÿ

### åç»­ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šP1ï¼‰

1. **åœºæ™¯1é›†æˆ - è¯„åˆ†æå–**
   - ä¿®æ”¹ `extractor.py:extract_technical_scoring` ä½¿ç”¨ ScoringPointAgent
   - é¢„è®¡è€—æ—¶ï¼š30åˆ†é’Ÿ

2. **åœºæ™¯2é›†æˆ - AIè¯„åˆ†**
   - å®ç° `api_scoring_bp.py`
   - ä¿®æ”¹ `Scoring.vue` å¯¹æ¥çœŸå®API
   - é¢„è®¡è€—æ—¶ï¼š2å°æ—¶

3. **å‰ç«¯ç•Œé¢å¼€å‘**
   - ä¿®æ”¹ `TechProposal.vue` æ·»åŠ ç”Ÿæˆæ¨¡å¼é€‰æ‹©
   - æ·»åŠ æ¨¡æ¿é€‰æ‹©å™¨
   - æ·»åŠ å†…å®¹é£æ ¼é…ç½®
   - é¢„è®¡è€—æ—¶ï¼š4å°æ—¶

### é•¿æœŸä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šP2ï¼‰

1. **æµå¼ç”Ÿæˆæ”¯æŒ**
   - å®ç°æ™ºèƒ½ä½“çš„æµå¼å†…å®¹ç”Ÿæˆ
   - ç±»ä¼¼ç°æœ‰çš„ `assemble_proposal_stream`
   - é¢„è®¡è€—æ—¶ï¼š1å¤©

2. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ ç¼“å­˜æœºåˆ¶
   - å¹¶å‘ç”Ÿæˆç« èŠ‚
   - é¢„è®¡è€—æ—¶ï¼š1-2å¤©

3. **è´¨é‡æå‡**
   - å®Œå–„ VerificationAgent çš„è¦†ç›–ç‡æ£€æŸ¥
   - å®ç°è‡ªåŠ¨è¡¥å……åŠŸèƒ½
   - é¢„è®¡è€—æ—¶ï¼š2-3å¤©

## äº”ã€æŠ€æœ¯äº®ç‚¹

### 1. æ¶æ„è®¾è®¡

- âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªæ™ºèƒ½ä½“èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤
- âœ… **æç¤ºè¯åˆ†ç¦»**: prompts/ çº¯æ•°æ®ï¼Œagents/ çº¯é€»è¾‘
- âœ… **ç»Ÿä¸€è·¯ç”±**: AgentRouter æä¾›ç»Ÿä¸€å…¥å£
- âœ… **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰åŠŸèƒ½

### 2. ä»£ç å¤ç”¨

- âœ… **BaseAgent åŸºç±»**: ç»Ÿä¸€çš„LLMè°ƒç”¨ã€æç¤ºè¯åŠ è½½
- âœ… **å¤ç”¨ç°æœ‰æ¨¡å—**: RequirementAnalyzerã€PromptManagerã€LLMClient
- âœ… **æ— å¤–éƒ¨ä¾èµ–**: ä¸å¼•å…¥LangChainç­‰é‡é‡çº§æ¡†æ¶

### 3. æ‰©å±•æ€§

- âœ… **æ˜“äºæ·»åŠ æ–°æ™ºèƒ½ä½“**: ç»§æ‰¿ BaseAgentï¼Œå®ç° `generate()` æ–¹æ³•å³å¯
- âœ… **æ˜“äºæ·»åŠ æ–°æ¨¡æ¿**: åœ¨ TemplateAgent.TEMPLATES ä¸­æ·»åŠ å³å¯
- âœ… **æ˜“äºæ·»åŠ æ–°ç”Ÿæˆæ¨¡å¼**: åœ¨ AgentRouter ä¸­æ·»åŠ æ–°è·¯ç”±å³å¯

## å…­ã€æ€»ç»“

### å®æ–½æˆæœ

- ğŸ“¦ **5ä¸ªPythonæ¨¡å—**: BaseAgent + 4ä¸ªä¸“ä¸šæ™ºèƒ½ä½“ + AgentRouter
- ğŸ“ **4ä¸ªæç¤ºè¯é…ç½®æ–‡ä»¶**: å…±11ä¸ªæç¤ºè¯æ¨¡æ¿
- ğŸ”Œ **5ä¸ªAPIç«¯ç‚¹**: å®Œæ•´çš„åç«¯æ¥å£
- ğŸ“Š **3ä¸ªé¢„å®šä¹‰æ¨¡æ¿**: æ”¿åºœé‡‡è´­ã€è½¯ä»¶å¼€å‘ã€ISOè´¨é‡
- ğŸ“ˆ **3ç§ç”Ÿæˆæ¨¡å¼**: æŒ‰è¯„åˆ†ç‚¹ã€æŒ‰ç›®å½•ã€ä½¿ç”¨æ¨¡æ¿

### å¾…åŠäº‹é¡¹ï¼ˆå¿…é¡»å®Œæˆï¼‰

1. [ ] ä¿®å¤LLMè°ƒç”¨æ–¹æ³•åï¼ˆ`chat` â†’ `call`ï¼‰
2. [ ] ä¿®å¤æç¤ºè¯åŠ è½½è·¯å¾„ï¼ˆæ”¯æŒå­ç›®å½•ï¼‰
3. [ ] å®Œæ•´åŠŸèƒ½æµ‹è¯•

### å¾…åŠäº‹é¡¹ï¼ˆåç»­ä¼˜åŒ–ï¼‰

4. [ ] åœºæ™¯1é›†æˆï¼ˆè¯„åˆ†æå–ï¼‰
5. [ ] åœºæ™¯2é›†æˆï¼ˆAIè¯„åˆ†ï¼‰
6. [ ] å‰ç«¯ç•Œé¢å¼€å‘

---

**å®æ–½æ—¥æœŸ**: 2025-12-20
**å®æ–½æ—¶é—´**: çº¦2å°æ—¶
**ä»£ç è´¨é‡**: âœ… ä¼˜ç§€ï¼ˆæ¨¡å—åŒ–ã€å¯ç»´æŠ¤ï¼‰
**æ–‡æ¡£å®Œæ•´æ€§**: âœ… å®Œæ•´ï¼ˆè®¾è®¡æ–‡æ¡£ + å®æ–½æ€»ç»“ï¼‰
