# 页面功能清单

## 系统概述
AI标书智能生成系统是一个基于Web的智能标书处理平台，采用模块化设计，通过多个专门页面提供完整的标书处理流程。

## 单页面应用架构 ⚡ **架构说明**

### 主应用页面 (index.html)
**路由**: `/`  
**架构特点**: Bootstrap标签页(Tabs)单页面应用
**主要功能**:
- 系统介绍和功能展示
- 四大核心功能模块通过标签页切换
- 统一的状态管理和公司信息同步
- 响应式设计和统一UI体验

## 功能模块清单 (标签页实现)

### 1. 招标信息提取 (标签页)
**位置**: `index.html` - 招标信息提取标签页
**主要功能**:
- 招标文档上传 (支持.docx, .doc, .txt, .pdf)
- 智能信息提取处理
- 提取进度实时显示
- 提取结果展示和编辑

**核心特性**:
- 拖拽上传功能
- 文件格式验证
- 进度条显示处理状态
- 提取结果的富文本编辑

### 2. 商务应答功能 (标签页) ⚡ **ENHANCED 2025-09-12**
**位置**: `index.html` - 商务应答标签页
**主要功能**:
- 商务应答模板上传 (.docx, .doc 格式)
- 公司信息选择和管理 (支持从已配置公司中选择)
- ✅ 自动投标人名称填充 (使用MCP处理器)
- ✅ 项目信息填写 (项目名称、招标编号、日期)
- ✅ 资质图片自动插入
- 处理结果下载和预览
- 🆕 **文档预览功能** (Word文档在线预览)
- 🆕 **在线编辑功能** (TinyMCE富文本编辑器)
- 🆕 **编辑保存功能** (编辑后重新生成Word文档)

**技术实现** ⚡ **UPDATED**:
- ✅ 前端：正确的FormData字段映射 (`template_file`, `company_id`)
- ✅ 后端：MCP处理器集成 (`mcp_bidder_name_processor_enhanced 2.py`)
- ✅ 公司数据：直接从JSON配置文件加载
- ✅ 字段映射：`companyName` 等正确字段名
- 🆕 **预览API**: `/api/document/preview/<filename>` - Word转HTML预览
- 🆕 **编辑API**: `/api/editor/load-document`, `/api/editor/save-document`
- 🆕 **TinyMCE集成**: CDN加载、中文化配置、模态框显示

**修复内容**:
- ✅ 文件上传字段名不匹配问题
- ✅ 公司信息加载和字段映射问题
- ✅ MCP处理器路径配置和导入问题
- ✅ 处理流程完整性验证

**🆕 新增预览编辑功能**:
- ✅ 双重加载机制：API预览优先，文件上传备用
- ✅ MIME类型兼容：支持不同浏览器的Word文档检测
- ✅ 错误处理：TinyMCE加载失败时降级为纯HTML预览
- ✅ 用户体验：模态框界面、实时内容编辑、一键保存下载

### 3. 点对点应答功能 (标签页)
**位置**: `index.html` - 点对点应答标签页
**主要功能**:
- 招标文档和应答文档对比
- 逐条应答生成
- 智能匹配和建议

### 4. 技术方案生成功能 (标签页)
**位置**: `index.html` - 技术方案生成标签页
**主要功能**:
- 技术方案模板生成
- 产品信息整合
- 方案定制化输出

### 5. 公司管理功能 (标签页)
**位置**: `index.html` - 公司管理标签页
**主要功能**:
- 公司基本信息管理
- 资质文件上传和管理
- 公司配置统一管理

**核心特性**:
- 公司信息联动选择
- 模板变量替换
- 图片资质自动插入
- 实时预览功能

### 4. 点对点应答页面 (point_to_point.html)
**路由**: `/point_to_point.html`  
**主要功能**:
- 招标文档问题识别
- 针对性问题应答生成
- 文档处理进度跟踪
- 应答结果下载

**核心特性**:
- 智能问题提取
- 精准应答生成
- 文档格式保持
- 流程状态管理

### 5. 技术方案页面 (tech_proposal.html)
**路由**: `/tech_proposal.html`  
**主要功能**:
- 招标文件和产品文档双文件上传
- 技术方案自动生成
- 产品功能匹配分析
- 专业技术方案输出

**核心特性**:
- 双文档智能对比
- 技术需求匹配
- 方案结构化输出
- 自定义输出前缀

### 6. 公司管理页面 (company_selection.html)
**路由**: `/company_selection.html`  
**主要功能**:
- 公司信息CRUD操作
- 公司基本信息管理
- 资质证明图片上传
- 公司信息模板管理

**核心特性**:
- 标签页式信息分组
- 图片拖拽上传
- 表单验证
- 数据本地存储

### 7. 帮助中心 (help.html)
**路由**: `/help.html`  
**主要功能**:
- 系统使用指南
- 功能模块详细说明
- 常见问题解答
- 操作流程图示

**核心特性**:
- 侧边栏导航
- 分章节内容组织
- 交互式帮助文档
- Mermaid流程图支持

### 8. 文档预览页面 (document_preview.html)
**路由**: `/document_preview.html`  
**主要功能**:
- 生成文档预览
- 文档格式展示
- 下载链接提供
- 预览界面优化

**核心特性**:
- 文档渲染预览
- 响应式布局
- 下载功能集成

## 页面间关联关系

### 主要导航流程
1. **首页** → 四个功能模块入口
2. **招标信息提取** → 商务应答/点对点应答/技术方案
3. **公司管理** ← 商务应答 (公司信息选择)
4. **帮助中心** ← 任意页面 (帮助支持)

### 数据流转关系
- 招标信息提取的结果会被其他模块复用
- 公司管理的信息会在商务应答中使用
- 所有页面共享状态管理器的数据

### 状态保持机制
- 通过URL参数和localStorage维持状态
- 公司ID等关键信息在页面间传递
- 文件上传信息的跨页面共享

## 技术实现特点

### 前端架构
- 基于Bootstrap 5的响应式设计
- 原生JavaScript实现，无重型框架依赖
- 模块化的JavaScript组件设计

### 交互特性
- 拖拽文件上传
- 实时进度反馈
- 富文本编辑器集成(TinyMCE)
- 表单验证和用户体验优化
- 🆕 **文档预览模态框** (Bootstrap Modal + 自适应布局)
- 🆕 **在线编辑界面** (TinyMCE + 实时保存提示)
- 🆕 **双重加载机制** (API预览 + 文件上传备用)

### 状态管理
- StateManager统一状态管理
- localStorage数据持久化
- URL参数状态同步
- 跨页面消息传递机制
- 🆕 **DocumentPreviewState** (预览编辑状态管理)
- 🆕 **编辑器生命周期管理** (加载、编辑、保存、清理)
- 🆕 **错误状态处理** (CDN加载失败、API异常等)

## 🆕 **新增功能模块** ⚡ **NEW 2025-09-12**

### 文档预览与编辑系统
**位置**: `index.html` - 集成在商务应答结果中
**核心功能**:
- **文档预览**: Word文档转HTML在线预览，保留基本格式
- **在线编辑**: TinyMCE富文本编辑器，支持常用格式操作
- **实时保存**: 编辑内容实时保存，支持重新生成Word文档
- **错误处理**: 多层次降级方案，确保功能可用性

**技术栈**:
- **前端**: TinyMCE 6.x + Bootstrap 5 Modal + JavaScript
- **后端**: Python-docx + BeautifulSoup4 + Flask API
- **数据流**: Word ↔ HTML ↔ 编辑器内容 ↔ Word

**用户流程**:
1. 商务应答处理完成 → 显示预览/编辑按钮
2. 点击预览 → 文档转HTML → 模态框显示预览
3. 点击编辑 → 加载TinyMCE → 获取文档内容 → 在线编辑
4. 编辑保存 → 内容处理 → 生成新Word → 自动下载
5. 关闭界面 → 清理编辑器 → 释放资源

**兼容性特点**:
- CDN资源加载失败时自动降级为纯HTML预览
- 支持多种浏览器的MIME类型检测
- API失败时提供文件直接下载备选
- 编辑器初始化失败时保留预览功能

**性能优化**:
- 按需加载TinyMCE资源
- 文档内容缓存机制
- 模态框延迟初始化
- 编辑器实例复用